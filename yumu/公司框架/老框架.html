<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>导入 | 学而时习之</title>
    <meta name="generator" content="VuePress 1.9.7">
    <link rel="icon" href="/img/qiyu.jpg">
    <meta name="description" content="个人学习博客">
    
    <link rel="preload" href="/assets/css/0.styles.e4d8b86b.css" as="style"><link rel="preload" href="/assets/js/app.6ef7aeda.js" as="script"><link rel="preload" href="/assets/js/2.716a1f37.js" as="script"><link rel="preload" href="/assets/js/91.932f1454.js" as="script"><link rel="prefetch" href="/assets/js/10.a4a050d1.js"><link rel="prefetch" href="/assets/js/11.344787d3.js"><link rel="prefetch" href="/assets/js/12.b25f9ccf.js"><link rel="prefetch" href="/assets/js/13.fbdea543.js"><link rel="prefetch" href="/assets/js/14.5fc0584b.js"><link rel="prefetch" href="/assets/js/15.688b7501.js"><link rel="prefetch" href="/assets/js/16.fbd251ee.js"><link rel="prefetch" href="/assets/js/17.6b6b044b.js"><link rel="prefetch" href="/assets/js/18.4da62780.js"><link rel="prefetch" href="/assets/js/19.e76bd09c.js"><link rel="prefetch" href="/assets/js/20.c6c4fad3.js"><link rel="prefetch" href="/assets/js/21.76180caa.js"><link rel="prefetch" href="/assets/js/22.6f1b73fd.js"><link rel="prefetch" href="/assets/js/23.a95962c2.js"><link rel="prefetch" href="/assets/js/24.eee43d5e.js"><link rel="prefetch" href="/assets/js/25.56e05948.js"><link rel="prefetch" href="/assets/js/26.43f2e3ff.js"><link rel="prefetch" href="/assets/js/27.09054ea0.js"><link rel="prefetch" href="/assets/js/28.c4e54eaa.js"><link rel="prefetch" href="/assets/js/29.06c6b4e5.js"><link rel="prefetch" href="/assets/js/3.eaf135e1.js"><link rel="prefetch" href="/assets/js/30.250c7c81.js"><link rel="prefetch" href="/assets/js/31.91b37571.js"><link rel="prefetch" href="/assets/js/32.d2677ff0.js"><link rel="prefetch" href="/assets/js/33.41ead764.js"><link rel="prefetch" href="/assets/js/34.133f8e54.js"><link rel="prefetch" href="/assets/js/35.362db0cb.js"><link rel="prefetch" href="/assets/js/36.db01e9cc.js"><link rel="prefetch" href="/assets/js/37.78fd90d2.js"><link rel="prefetch" href="/assets/js/38.27112b1c.js"><link rel="prefetch" href="/assets/js/39.c077219c.js"><link rel="prefetch" href="/assets/js/4.75ddad43.js"><link rel="prefetch" href="/assets/js/40.c9153258.js"><link rel="prefetch" href="/assets/js/41.c0b0dba4.js"><link rel="prefetch" href="/assets/js/42.787b0675.js"><link rel="prefetch" href="/assets/js/43.35499284.js"><link rel="prefetch" href="/assets/js/44.ea23a009.js"><link rel="prefetch" href="/assets/js/45.e5cd72c6.js"><link rel="prefetch" href="/assets/js/46.f1392760.js"><link rel="prefetch" href="/assets/js/47.1553f24b.js"><link rel="prefetch" href="/assets/js/48.c696d608.js"><link rel="prefetch" href="/assets/js/49.a7940cc9.js"><link rel="prefetch" href="/assets/js/5.f9f3c101.js"><link rel="prefetch" href="/assets/js/50.e8cadfe4.js"><link rel="prefetch" href="/assets/js/51.080e63aa.js"><link rel="prefetch" href="/assets/js/52.7347d36c.js"><link rel="prefetch" href="/assets/js/53.aba50764.js"><link rel="prefetch" href="/assets/js/54.ca1160dc.js"><link rel="prefetch" href="/assets/js/55.b6574861.js"><link rel="prefetch" href="/assets/js/56.be3c310f.js"><link rel="prefetch" href="/assets/js/57.037820ea.js"><link rel="prefetch" href="/assets/js/58.24474c32.js"><link rel="prefetch" href="/assets/js/59.3b585e3d.js"><link rel="prefetch" href="/assets/js/6.c86d08c0.js"><link rel="prefetch" href="/assets/js/60.75b5bae2.js"><link rel="prefetch" href="/assets/js/61.1831f564.js"><link rel="prefetch" href="/assets/js/62.18a1b459.js"><link rel="prefetch" href="/assets/js/63.346f7f49.js"><link rel="prefetch" href="/assets/js/64.a7683029.js"><link rel="prefetch" href="/assets/js/65.1a938596.js"><link rel="prefetch" href="/assets/js/66.0106ad50.js"><link rel="prefetch" href="/assets/js/67.b0b943da.js"><link rel="prefetch" href="/assets/js/68.60534009.js"><link rel="prefetch" href="/assets/js/69.72e1bfa9.js"><link rel="prefetch" href="/assets/js/7.e0e4b61b.js"><link rel="prefetch" href="/assets/js/70.3a29dfd9.js"><link rel="prefetch" href="/assets/js/71.3e57d5ec.js"><link rel="prefetch" href="/assets/js/72.be56e12f.js"><link rel="prefetch" href="/assets/js/73.b6934116.js"><link rel="prefetch" href="/assets/js/74.81f5b5c3.js"><link rel="prefetch" href="/assets/js/75.e9dacdaf.js"><link rel="prefetch" href="/assets/js/76.7c0855f1.js"><link rel="prefetch" href="/assets/js/77.98a4a794.js"><link rel="prefetch" href="/assets/js/78.3049e29b.js"><link rel="prefetch" href="/assets/js/79.9c741fac.js"><link rel="prefetch" href="/assets/js/8.8c856480.js"><link rel="prefetch" href="/assets/js/80.46cc42c2.js"><link rel="prefetch" href="/assets/js/81.2647d9b6.js"><link rel="prefetch" href="/assets/js/82.0c7a9946.js"><link rel="prefetch" href="/assets/js/83.fa03835c.js"><link rel="prefetch" href="/assets/js/84.909232bc.js"><link rel="prefetch" href="/assets/js/85.7cf12395.js"><link rel="prefetch" href="/assets/js/86.805e61d2.js"><link rel="prefetch" href="/assets/js/87.5ec873ab.js"><link rel="prefetch" href="/assets/js/88.54c3c15b.js"><link rel="prefetch" href="/assets/js/89.286a5312.js"><link rel="prefetch" href="/assets/js/9.6133e2ec.js"><link rel="prefetch" href="/assets/js/90.e91320ce.js">
    <link rel="stylesheet" href="/assets/css/0.styles.e4d8b86b.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container"><header class="navbar"><div class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/" class="home-link router-link-active"><!----> <span class="site-name">学而时习之</span></a> <div class="links"><div class="search-box"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <nav class="nav-links can-hide"><div class="nav-item"><a href="/" class="nav-link">
  主页
</a></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="博文" class="dropdown-title"><span class="title">博文</span> <span class="arrow down"></span></button> <button type="button" aria-label="博文" class="mobile-dropdown-title"><span class="title">博文</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/vuePress/" class="nav-link">
  博客相关知识
</a></li><li class="dropdown-item"><!----> <a href="/javaBasics/" class="nav-link">
  JavaSE基础知识
</a></li><li class="dropdown-item"><!----> <a href="/javaFramework/" class="nav-link">
  Java框架知识
</a></li><li class="dropdown-item"><!----> <a href="/book/" class="nav-link">
  技术书籍
</a></li><li class="dropdown-item"><!----> <a href="/js/" class="nav-link">
  前端
</a></li><li class="dropdown-item"><!----> <a href="/sql/" class="nav-link">
  数据库知识
</a></li><li class="dropdown-item"><!----> <a href="/projectPractice/" class="nav-link">
  项目实战
</a></li><li class="dropdown-item"><!----> <a href="/projectNote/" class="nav-link">
  工作项目积累
</a></li><li class="dropdown-item"><!----> <a href="/faultNote/" class="nav-link">
  记错本
</a></li><li class="dropdown-item"><!----> <a href="/php/" class="nav-link">
  php
</a></li><li class="dropdown-item"><!----> <a href="/linux/" class="nav-link">
  linux学习
</a></li><li class="dropdown-item"><!----> <a href="/git/" class="nav-link">
  git笔记
</a></li><li class="dropdown-item"><!----> <a href="/middleware/" class="nav-link">
  中间件
</a></li><li class="dropdown-item"><!----> <a href="/docker/" class="nav-link">
  docker笔记
</a></li><li class="dropdown-item"><!----> <a href="/nginx/" class="nav-link">
  nginx笔记
</a></li><li class="dropdown-item"><!----> <a href="/systemArchitecture/" class="nav-link">
  系统架构
</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="工具网站" class="dropdown-title"><span class="title">工具网站</span> <span class="arrow down"></span></button> <button type="button" aria-label="工具网站" class="mobile-dropdown-title"><span class="title">工具网站</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="https://postimages.org" target="_blank" rel="noopener noreferrer" class="nav-link external">
  postimages图床
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li></ul></div></div> <!----></nav></div></header> <div class="sidebar-mask"></div> <aside class="sidebar"><nav class="nav-links"><div class="nav-item"><a href="/" class="nav-link">
  主页
</a></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="博文" class="dropdown-title"><span class="title">博文</span> <span class="arrow down"></span></button> <button type="button" aria-label="博文" class="mobile-dropdown-title"><span class="title">博文</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/vuePress/" class="nav-link">
  博客相关知识
</a></li><li class="dropdown-item"><!----> <a href="/javaBasics/" class="nav-link">
  JavaSE基础知识
</a></li><li class="dropdown-item"><!----> <a href="/javaFramework/" class="nav-link">
  Java框架知识
</a></li><li class="dropdown-item"><!----> <a href="/book/" class="nav-link">
  技术书籍
</a></li><li class="dropdown-item"><!----> <a href="/js/" class="nav-link">
  前端
</a></li><li class="dropdown-item"><!----> <a href="/sql/" class="nav-link">
  数据库知识
</a></li><li class="dropdown-item"><!----> <a href="/projectPractice/" class="nav-link">
  项目实战
</a></li><li class="dropdown-item"><!----> <a href="/projectNote/" class="nav-link">
  工作项目积累
</a></li><li class="dropdown-item"><!----> <a href="/faultNote/" class="nav-link">
  记错本
</a></li><li class="dropdown-item"><!----> <a href="/php/" class="nav-link">
  php
</a></li><li class="dropdown-item"><!----> <a href="/linux/" class="nav-link">
  linux学习
</a></li><li class="dropdown-item"><!----> <a href="/git/" class="nav-link">
  git笔记
</a></li><li class="dropdown-item"><!----> <a href="/middleware/" class="nav-link">
  中间件
</a></li><li class="dropdown-item"><!----> <a href="/docker/" class="nav-link">
  docker笔记
</a></li><li class="dropdown-item"><!----> <a href="/nginx/" class="nav-link">
  nginx笔记
</a></li><li class="dropdown-item"><!----> <a href="/systemArchitecture/" class="nav-link">
  系统架构
</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="工具网站" class="dropdown-title"><span class="title">工具网站</span> <span class="arrow down"></span></button> <button type="button" aria-label="工具网站" class="mobile-dropdown-title"><span class="title">工具网站</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="https://postimages.org" target="_blank" rel="noopener noreferrer" class="nav-link external">
  postimages图床
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li></ul></div></div> <!----></nav>  <ul class="sidebar-links"><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading open"><span>公司框架使用</span> <span class="arrow down"></span></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/yumu/公司框架/新框架.html" class="sidebar-link">新框架</a></li><li><a href="/yumu/公司框架/老框架.html" class="active sidebar-link">老框架</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/yumu/公司框架/老框架.html#导入" class="sidebar-link">导入</a></li><li class="sidebar-sub-header"><a href="/yumu/公司框架/老框架.html#导出" class="sidebar-link">导出</a></li><li class="sidebar-sub-header"><a href="/yumu/公司框架/老框架.html#表格" class="sidebar-link">表格</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/yumu/公司框架/老框架.html#tablemany" class="sidebar-link">tableMany</a></li></ul></li><li class="sidebar-sub-header"><a href="/yumu/公司框架/老框架.html#数据处理" class="sidebar-link">数据处理</a></li><li class="sidebar-sub-header"><a href="/yumu/公司框架/老框架.html#详情页面" class="sidebar-link">详情页面</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/yumu/公司框架/老框架.html#js方法" class="sidebar-link">JS方法</a></li></ul></li></ul></li><li><a href="/yumu/公司框架/2020开年新框架.html" class="sidebar-link">2020框架</a></li><li><a href="/yumu/公司框架/框架通用.html" class="sidebar-link">框架通用</a></li><li><a href="/yumu/公司框架/js相关.html" class="sidebar-link">js相关</a></li></ul></section></li></ul> </aside> <main class="page"> <div class="theme-default-content content__default"><h2 id="导入"><a href="#导入" class="header-anchor">#</a> 导入</h2> <ul><li><p>导入的话,主要是指<strong>导入excel文件</strong>,然后更新表格数据.</p></li> <li><p>首先需要写好导入按钮,之后去<code>post.php</code>中写导入方法.</p> <div class="language-php extra-class"><pre class="language-php"><code><span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token function">power</span><span class="token punctuation">(</span><span class="token string double-quoted-string">&quot;adUser&quot;</span><span class="token punctuation">,</span> <span class="token string double-quoted-string">&quot;import&quot;</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span> <span class="token comment">//导入按钮layer括号中第一个参数就是状态值,要去post.php中判断</span>
 <span class="token variable">$result</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'button'</span><span class="token punctuation">]</span> <span class="token operator">.=</span> <span class="token string double-quoted-string">&quot;&lt;span onclick=\&quot;layer('adUserImport',{})\&quot; class='spanButton'&gt;导入&lt;/span&gt;\n&quot;</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre></div><div class="language-php extra-class"><pre class="language-php"><code><span class="token comment">/****************会员-CSV导入*****************************/</span>
<span class="token keyword">elseif</span> <span class="token punctuation">(</span><span class="token variable">$get</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'type'</span><span class="token punctuation">]</span> <span class="token operator">==</span> <span class="token string single-quoted-string">'adUserImport'</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token comment">//赋值</span>
    <span class="token variable">$password</span> <span class="token operator">=</span> <span class="token variable">$post</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'password'</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
<span class="token comment">//判断</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span><span class="token function">power</span><span class="token punctuation">(</span><span class="token string double-quoted-string">&quot;adUser&quot;</span><span class="token punctuation">,</span> <span class="token string double-quoted-string">&quot;import&quot;</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token variable">$warn</span> <span class="token operator">=</span> <span class="token string double-quoted-string">&quot;权限不足&quot;</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span> <span class="token keyword">elseif</span> <span class="token punctuation">(</span><span class="token keyword">empty</span><span class="token punctuation">(</span><span class="token variable">$password</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token variable">$warn</span> <span class="token operator">=</span> <span class="token string double-quoted-string">&quot;管理员登录密码为空&quot;</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span> <span class="token keyword">elseif</span> <span class="token punctuation">(</span><span class="token function">md5</span><span class="token punctuation">(</span><span class="token variable">$password</span><span class="token punctuation">)</span> <span class="token operator">!=</span> <span class="token variable">$control</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'adpas'</span><span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token variable">$warn</span> <span class="token operator">=</span> <span class="token string double-quoted-string">&quot;管理员登录密码输入有误&quot;</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
        <span class="token comment">//将上传的csv临时文件读入数组</span>
        <span class="token comment">//电话号码可能是手机号，也可能是座机号，格式不做限制</span>
        <span class="token variable">$excel</span> <span class="token operator">=</span> <span class="token function">file</span><span class="token punctuation">(</span><span class="token variable">$_FILES</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'userExcel'</span><span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token string double-quoted-string">&quot;tmp_name&quot;</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token variable">$x</span> <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>
        <span class="token variable">$m</span> <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>
        <span class="token variable">$lose</span> <span class="token operator">=</span> <span class="token string double-quoted-string">&quot;&quot;</span><span class="token punctuation">;</span>
        <span class="token variable">$successarr</span> <span class="token operator">=</span> <span class="token keyword">array</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">foreach</span> <span class="token punctuation">(</span><span class="token variable">$excel</span> <span class="token keyword">as</span> <span class="token variable">$k</span> <span class="token operator">=&gt;</span> <span class="token variable">$row</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token variable">$row</span> <span class="token operator">=</span> <span class="token function">iconv</span><span class="token punctuation">(</span><span class="token string double-quoted-string">&quot;gb18030//IGNORE&quot;</span><span class="token punctuation">,</span> <span class="token string double-quoted-string">&quot;utf-8&quot;</span><span class="token punctuation">,</span> <span class="token variable">$row</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token variable">$word</span> <span class="token operator">=</span> <span class="token function">explode</span><span class="token punctuation">(</span><span class="token string double-quoted-string">&quot;,&quot;</span><span class="token punctuation">,</span> <span class="token variable">$row</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token variable">$m</span><span class="token operator">++</span><span class="token punctuation">;</span>
            <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token variable">$m</span> <span class="token operator">&gt;</span> <span class="token number">1</span> <span class="token operator">&amp;&amp;</span> <span class="token operator">!</span><span class="token keyword">empty</span><span class="token punctuation">(</span><span class="token function">FormSub</span><span class="token punctuation">(</span><span class="token variable">$word</span><span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
                <span class="token variable">$data</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'khid'</span><span class="token punctuation">]</span><span class="token operator">=</span><span class="token function">suiji</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token variable">$data</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'userName'</span><span class="token punctuation">]</span><span class="token operator">=</span><span class="token function">FormSub</span><span class="token punctuation">(</span><span class="token variable">$word</span><span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token variable">$data</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'sex'</span><span class="token punctuation">]</span><span class="token operator">=</span><span class="token function">FormSub</span><span class="token punctuation">(</span><span class="token variable">$word</span><span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token variable">$data</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'userTel'</span><span class="token punctuation">]</span><span class="token operator">=</span><span class="token function">FormSub</span><span class="token punctuation">(</span><span class="token variable">$word</span><span class="token punctuation">[</span><span class="token number">2</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token variable">$data</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'IDCard'</span><span class="token punctuation">]</span><span class="token operator">=</span><span class="token function">FormSub</span><span class="token punctuation">(</span><span class="token variable">$word</span><span class="token punctuation">[</span><span class="token number">3</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token variable">$data</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'birthday'</span><span class="token punctuation">]</span><span class="token operator">=</span><span class="token function">FormSub</span><span class="token punctuation">(</span><span class="token variable">$word</span><span class="token punctuation">[</span><span class="token number">4</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token variable">$data</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'email'</span><span class="token punctuation">]</span><span class="token operator">=</span><span class="token function">FormSub</span><span class="token punctuation">(</span><span class="token variable">$word</span><span class="token punctuation">[</span><span class="token number">5</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token variable">$data</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'address'</span><span class="token punctuation">]</span><span class="token operator">=</span><span class="token function">FormSub</span><span class="token punctuation">(</span><span class="token variable">$word</span><span class="token punctuation">[</span><span class="token number">6</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token variable">$data</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'height'</span><span class="token punctuation">]</span><span class="token operator">=</span><span class="token function">FormSub</span><span class="token punctuation">(</span><span class="token variable">$word</span><span class="token punctuation">[</span><span class="token number">7</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token variable">$data</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'size'</span><span class="token punctuation">]</span><span class="token operator">=</span><span class="token function">FormSub</span><span class="token punctuation">(</span><span class="token variable">$word</span><span class="token punctuation">[</span><span class="token number">8</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token variable">$data</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'weight'</span><span class="token punctuation">]</span><span class="token operator">=</span><span class="token function">FormSub</span><span class="token punctuation">(</span><span class="token variable">$word</span><span class="token punctuation">[</span><span class="token number">9</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token variable">$data</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'waist'</span><span class="token punctuation">]</span><span class="token operator">=</span><span class="token function">FormSub</span><span class="token punctuation">(</span><span class="token variable">$word</span><span class="token punctuation">[</span><span class="token number">10</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token variable">$data</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'userCard'</span><span class="token punctuation">]</span><span class="token operator">=</span><span class="token function">FormSub</span><span class="token punctuation">(</span><span class="token variable">$word</span><span class="token punctuation">[</span><span class="token number">11</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token variable">$data</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'level'</span><span class="token punctuation">]</span><span class="token operator">=</span><span class="token function">FormSub</span><span class="token punctuation">(</span><span class="token variable">$word</span><span class="token punctuation">[</span><span class="token number">12</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token variable">$data</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'subbranch'</span><span class="token punctuation">]</span><span class="token operator">=</span><span class="token function">FormSub</span><span class="token punctuation">(</span><span class="token variable">$word</span><span class="token punctuation">[</span><span class="token number">13</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token variable">$data</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'startTime'</span><span class="token punctuation">]</span><span class="token operator">=</span><span class="token function">FormSub</span><span class="token punctuation">(</span><span class="token variable">$word</span><span class="token punctuation">[</span><span class="token number">14</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token variable">$data</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'overdueTime'</span><span class="token punctuation">]</span><span class="token operator">=</span><span class="token function">FormSub</span><span class="token punctuation">(</span><span class="token variable">$word</span><span class="token punctuation">[</span><span class="token number">15</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token variable">$data</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'sumMoney'</span><span class="token punctuation">]</span><span class="token operator">=</span><span class="token function">FormSub</span><span class="token punctuation">(</span><span class="token variable">$word</span><span class="token punctuation">[</span><span class="token number">16</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token variable">$data</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'sumPoint'</span><span class="token punctuation">]</span><span class="token operator">=</span><span class="token function">FormSub</span><span class="token punctuation">(</span><span class="token variable">$word</span><span class="token punctuation">[</span><span class="token number">17</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token variable">$data</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'balance'</span><span class="token punctuation">]</span><span class="token operator">=</span><span class="token function">FormSub</span><span class="token punctuation">(</span><span class="token variable">$word</span><span class="token punctuation">[</span><span class="token number">18</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token variable">$data</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'point'</span><span class="token punctuation">]</span><span class="token operator">=</span><span class="token function">FormSub</span><span class="token punctuation">(</span><span class="token variable">$word</span><span class="token punctuation">[</span><span class="token number">19</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token variable">$data</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'residueDegree'</span><span class="token punctuation">]</span><span class="token operator">=</span><span class="token function">FormSub</span><span class="token punctuation">(</span><span class="token variable">$word</span><span class="token punctuation">[</span><span class="token number">20</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token variable">$data</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'earlPoint'</span><span class="token punctuation">]</span><span class="token operator">=</span><span class="token function">FormSub</span><span class="token punctuation">(</span><span class="token variable">$word</span><span class="token punctuation">[</span><span class="token number">21</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>


                <span class="token variable">$warn</span> <span class="token operator">=</span> <span class="token function">insert</span><span class="token punctuation">(</span><span class="token keyword">array</span><span class="token punctuation">(</span><span class="token string double-quoted-string">&quot;table&quot;</span> <span class="token operator">=&gt;</span> <span class="token string double-quoted-string">&quot;kehu&quot;</span><span class="token punctuation">,</span> <span class="token string double-quoted-string">&quot;field&quot;</span> <span class="token operator">=&gt;</span> <span class="token variable">$data</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token variable">$warn</span> <span class="token operator">==</span> <span class="token string double-quoted-string">&quot;新增成功&quot;</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
                    <span class="token variable">$successarr</span><span class="token punctuation">[</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token variable">$k</span> <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">;</span>
                    <span class="token variable">$x</span><span class="token operator">++</span><span class="token punctuation">;</span>
                <span class="token punctuation">}</span>
            <span class="token punctuation">}</span>
        <span class="token punctuation">}</span>
        <span class="token variable">$contNum</span> <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>
        <span class="token keyword">foreach</span> <span class="token punctuation">(</span><span class="token variable">$excel</span> <span class="token keyword">as</span> <span class="token variable">$key</span> <span class="token operator">=&gt;</span> <span class="token variable">$val</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span><span class="token function">in_array</span><span class="token punctuation">(</span><span class="token variable">$key</span><span class="token punctuation">,</span> <span class="token variable">$successarr</span><span class="token punctuation">)</span> <span class="token operator">&amp;&amp;</span> <span class="token variable">$key</span> <span class="token operator">!=</span> <span class="token number">0</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
                <span class="token variable">$lose</span> <span class="token operator">.=</span> <span class="token variable">$key</span> <span class="token operator">.</span> <span class="token string double-quoted-string">&quot;/&quot;</span><span class="token punctuation">;</span>
                <span class="token variable">$contNum</span><span class="token operator">++</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span>
        <span class="token punctuation">}</span>
        <span class="token variable">$text</span> <span class="token operator">=</span> <span class="token string double-quoted-string">&quot;管理员<span class="token interpolation"><span class="token punctuation">{</span><span class="token variable">$control</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'adName'</span><span class="token punctuation">]</span><span class="token punctuation">}</span></span>使用Excel上传了<span class="token interpolation"><span class="token punctuation">{</span><span class="token variable">$x</span><span class="token punctuation">}</span></span>个会员信息；&lt;br/&gt;导数据失败总数据（共<span class="token interpolation"><span class="token punctuation">{</span><span class="token variable">$contNum</span><span class="token punctuation">}</span></span>条）：<span class="token interpolation"><span class="token punctuation">{</span><span class="token variable">$lose</span><span class="token punctuation">}</span></span>）&quot;</span><span class="token punctuation">;</span>
        <span class="token function">logText</span><span class="token punctuation">(</span><span class="token keyword">array</span><span class="token punctuation">(</span><span class="token string double-quoted-string">&quot;type&quot;</span> <span class="token operator">=&gt;</span> <span class="token string double-quoted-string">&quot;adUser&quot;</span><span class="token punctuation">,</span><span class="token string double-quoted-string">&quot;text&quot;</span> <span class="token operator">=&gt;</span> <span class="token variable">$text</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token variable">$warn</span> <span class="token operator">=</span> <span class="token string double-quoted-string">&quot;导入了<span class="token interpolation"><span class="token punctuation">{</span><span class="token variable">$x</span><span class="token punctuation">}</span></span>个会员信息,如有问题请到系统日期查看详情&quot;</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div></li></ul> <hr> <ul><li><p>导入功能在方法中如果<strong>不止想return一个数据</strong>,就以$x[&quot;one&quot;],$x[&quot;two&quot;]格式传递多个值,最后return$x即可.</p></li> <li><p>其中有一个值$result[&quot;action&quot;]是可以改变form标签上的action属性的.</p></li> <li><p>在layer中也要<strong>对整个表单数据传递的源码做出修改</strong>,比如判断如果传过来的aciton不为空,就不能生成默认生成的跳转到data.php中处理数据的button按钮,而是生成一个submit按钮,因为form表单的action值已经确定跳转到post中去处理.</p></li> <li><p>还有就是取出你return的多个数据,默认只取出$result[&quot;table&quot;],因为这个数据是用来生成弹出层页面的.</p> <div class="language-php extra-class"><pre class="language-php"><code><span class="token comment">//判断如果action不为空,就把button按钮替换为一个普通的submit按钮,一旦传递了action,证明你不想让提交按钮帮你跳转到默认的data.php处理数据</span>
               <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token operator">!</span><span class="token keyword">empty</span><span class="token punctuation">(</span><span class="token variable">$result</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'action'</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
                   <span class="token variable">$result</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'button'</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token string double-quoted-string">&quot;&lt;input type=\&quot;submit\&quot; value=\&quot;提交\&quot; class='spanButton'/&gt;&quot;</span><span class="token punctuation">;</span>
               <span class="token punctuation">}</span>
 
               <span class="token variable">$result</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'table'</span><span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token variable">$hidden</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token variable">$result</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'button'</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
<span class="token comment">//这里一次性取出你在Class中return的多个数据,默认只取出$result['table']来生成弹出层</span>
                <span class="token variable">$html</span> <span class="token operator">.=</span> <span class="token variable">$this</span><span class="token operator">-&gt;</span><span class="token function">table</span><span class="token punctuation">(</span><span class="token variable">$result</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'table'</span><span class="token punctuation">]</span><span class="token punctuation">,</span><span class="token variable">$result</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'tables'</span><span class="token punctuation">]</span><span class="token punctuation">,</span><span class="token variable">$result</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'action'</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><div class="language-php extra-class"><pre class="language-php"><code><span class="token comment">//一旦return了多个值,就需要在layer的table方法的形参上接收这多个值,当然多个值是在layer上面的代码部分取出</span>
<span class="token keyword">public</span> <span class="token keyword">function</span> <span class="token function-definition function">table</span><span class="token punctuation">(</span><span class="token variable">$table</span><span class="token punctuation">,</span><span class="token variable">$tables</span><span class="token operator">=</span><span class="token string single-quoted-string">''</span><span class="token punctuation">,</span><span class="token variable">$action</span><span class="token operator">=</span><span class="token string single-quoted-string">''</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
        <span class="token variable">$tr</span> <span class="token operator">=</span> <span class="token string double-quoted-string">&quot;&quot;</span><span class="token punctuation">;</span>
        <span class="token keyword">foreach</span><span class="token punctuation">(</span><span class="token variable">$table</span> <span class="token keyword">as</span> <span class="token variable">$key</span> <span class="token operator">=&gt;</span> <span class="token variable">$value</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
            <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token function">is_int</span><span class="token punctuation">(</span><span class="token variable">$key</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
                <span class="token variable">$key</span> <span class="token operator">=</span> <span class="token string double-quoted-string">&quot;&quot;</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span>
            <span class="token variable">$tr</span> <span class="token operator">.=</span> <span class="token string double-quoted-string">&quot;&lt;tr&gt;&lt;td&gt;&quot;</span><span class="token operator">.</span><span class="token variable">$key</span><span class="token operator">.</span><span class="token string double-quoted-string">&quot;&lt;/td&gt;&lt;td&gt;&quot;</span><span class="token operator">.</span><span class="token variable">$value</span><span class="token operator">.</span><span class="token string double-quoted-string">&quot;&lt;/td&gt;&lt;/tr&gt;&quot;</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
    <span class="token comment">//判断如果return了action来,就生成带action值的form标签,意味着不去默认的data.php处理数据</span>
        <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token variable">$action</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
            <span class="token variable">$form</span> <span class="token operator">=</span> <span class="token string double-quoted-string">&quot; &lt;form name='&quot;</span><span class="token operator">.</span><span class="token variable">$this</span><span class="token operator">-&gt;</span><span class="token property">type</span><span class="token operator">.</span><span class="token string double-quoted-string">&quot;Form' method='post' enctype='multipart/form-data' action='&quot;</span><span class="token operator">.</span><span class="token variable">$action</span><span class="token operator">.</span><span class="token string double-quoted-string">&quot;'&gt;  &quot;</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span><span class="token keyword">else</span><span class="token punctuation">{</span>
            <span class="token variable">$form</span> <span class="token operator">=</span> <span class="token string double-quoted-string">&quot;&lt;form name='&quot;</span><span class="token operator">.</span><span class="token variable">$this</span><span class="token operator">-&gt;</span><span class="token property">type</span><span class="token operator">.</span><span class="token string double-quoted-string">&quot;Form' onsubmit='return false'&gt;&quot;</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
        <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token operator">!</span><span class="token keyword">empty</span><span class="token punctuation">(</span><span class="token variable">$tables</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
            <span class="token variable">$html</span> <span class="token operator">=</span> <span class="token variable">$form</span><span class="token operator">.</span><span class="token string double-quoted-string">&quot;
                        &lt;table class='tableEdit'&gt;&quot;</span><span class="token operator">.</span><span class="token variable">$tr</span><span class="token operator">.</span><span class="token string double-quoted-string">&quot;&lt;/table&gt;
                    &lt;/form&gt;&quot;</span><span class="token punctuation">;</span>

        <span class="token punctuation">}</span><span class="token keyword">else</span><span class="token punctuation">{</span>
            <span class="token variable">$html</span> <span class="token operator">=</span> <span class="token variable">$form</span><span class="token operator">.</span><span class="token string double-quoted-string">&quot;
                        &lt;table class='tableRight'&gt;&quot;</span><span class="token operator">.</span><span class="token variable">$tr</span><span class="token operator">.</span><span class="token string double-quoted-string">&quot;&lt;/table&gt;
                    &lt;/form&gt;&quot;</span><span class="token punctuation">;</span>

        <span class="token punctuation">}</span>
        <span class="token keyword">return</span> <span class="token variable">$html</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
</code></pre></div></li></ul> <h2 id="导出"><a href="#导出" class="header-anchor">#</a> 导出</h2> <ul><li><p>想做<strong>导出功能</strong>,就先在Class中写好按钮,不过这个按钮不是一般的按钮,而是个超链接,只需要给超链接标签加上按钮的样式即可.</p></li> <li><p>之后把超链接的href绑定为你指定处理数据的那个页面,然后去到这个页面写对应的导出方法.要把Class中完成的模糊查询sql语句存到Session中,在处理数据页面取出,这样就可以导出页面上显示的所有数据.</p> <div class="language-php extra-class"><pre class="language-php"><code><span class="token comment">//生成查询语句</span>
 <span class="token variable">$where</span> <span class="token operator">=</span> <span class="token function">search</span><span class="token punctuation">(</span><span class="token keyword">array</span><span class="token punctuation">(</span><span class="token string double-quoted-string">&quot;like&quot;</span> <span class="token operator">=&gt;</span> <span class="token variable">$like</span><span class="token punctuation">,</span> <span class="token string double-quoted-string">&quot;=&quot;</span> <span class="token operator">=&gt;</span> <span class="token variable">$equal</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
 <span class="token comment">//获取查询结果</span>
 <span class="token variable">$sql</span> <span class="token operator">=</span> <span class="token string double-quoted-string">&quot; select * from kehu where 1=1 &quot;</span> <span class="token operator">.</span> <span class="token variable">$where</span> <span class="token operator">.</span> <span class="token string double-quoted-string">&quot; order by time desc &quot;</span><span class="token punctuation">;</span>
 <span class="token comment">//把模糊查询语句存储到session</span>
 <span class="token variable">$_SESSION</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'sql'</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token variable">$sql</span><span class="token punctuation">;</span>
</code></pre></div><div class="language-php extra-class"><pre class="language-php"><code> <span class="token variable">$postUrl</span> <span class="token operator">=</span> root <span class="token operator">.</span> <span class="token string double-quoted-string">&quot;control/data.php?type=adUserExport&quot;</span><span class="token punctuation">;</span>  <span class="token comment">//导出的url</span>

  <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token function">power</span><span class="token punctuation">(</span><span class="token string double-quoted-string">&quot;adUser&quot;</span><span class="token punctuation">,</span> <span class="token string double-quoted-string">&quot;export&quot;</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      	<span class="token comment">//导出的url就写到a标签的href中</span>
        <span class="token variable">$result</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'button'</span><span class="token punctuation">]</span> <span class="token operator">.=</span> <span class="token string double-quoted-string">&quot;&lt;a href='<span class="token interpolation"><span class="token variable">$postUrl</span></span>' class='spanButton'&gt;导出&lt;/a&gt;\n&quot;</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
</code></pre></div><div class="language-php extra-class"><pre class="language-php"><code><span class="token comment">/************************会员管理-导出excel*****************************/</span>
  <span class="token comment">//到这个页面去完成导出功能</span>
  <span class="token keyword">elseif</span><span class="token punctuation">(</span><span class="token variable">$get</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'type'</span><span class="token punctuation">]</span> <span class="token operator">==</span> <span class="token string single-quoted-string">'adUserExport'</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
      <span class="token comment">//取出session中存储的模糊查询sql语句</span>
      <span class="token variable">$kehu</span><span class="token operator">=</span><span class="token function">sqlQueryAll</span><span class="token punctuation">(</span><span class="token variable">$_SESSION</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'sql'</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>  <span class="token comment">//查你要导出的数据的那张表</span>
      <span class="token comment">//var_dump($_SESSION['sql']);</span>
  <span class="token comment">//    exit();</span>
      <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token operator">!</span><span class="token keyword">empty</span><span class="token punctuation">(</span><span class="token variable">$kehu</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
          <span class="token variable">$title</span> <span class="token operator">=</span> <span class="token keyword">array</span><span class="token punctuation">(</span><span class="token string single-quoted-string">'会员名称'</span><span class="token punctuation">,</span> <span class="token string single-quoted-string">'会员等级'</span><span class="token punctuation">,</span> <span class="token string single-quoted-string">'性别'</span><span class="token punctuation">,</span> <span class="token string single-quoted-string">'账户余额'</span><span class="token punctuation">,</span> <span class="token string single-quoted-string">'账户积分'</span><span class="token punctuation">,</span> <span class="token string single-quoted-string">'剩余次数'</span><span class="token punctuation">,</span> <span class="token string single-quoted-string">'身高'</span><span class="token punctuation">,</span> <span class="token string single-quoted-string">'鞋码'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
          <span class="token keyword">foreach</span> <span class="token punctuation">(</span><span class="token variable">$kehu</span> <span class="token keyword">as</span> <span class="token variable">$value</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
              <span class="token punctuation">{</span>
                  <span class="token variable">$data</span><span class="token punctuation">[</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token keyword">array</span><span class="token punctuation">(</span>
                      <span class="token variable">$value</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'userName'</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
                      <span class="token variable">$value</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'level'</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
                      <span class="token variable">$value</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'sex'</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
                      <span class="token variable">$value</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'balance'</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
                      <span class="token variable">$value</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'point'</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
                      <span class="token variable">$value</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'residueDegree'</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
                      <span class="token variable">$value</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'height'</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
                      <span class="token variable">$value</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'size'</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
                  <span class="token punctuation">)</span><span class="token punctuation">;</span>
              <span class="token punctuation">}</span>
              <span class="token function">exportexcel</span><span class="token punctuation">(</span><span class="token variable">$data</span><span class="token punctuation">,</span> <span class="token variable">$title</span><span class="token punctuation">,</span> <span class="token string single-quoted-string">'会员表'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  
          <span class="token punctuation">}</span>
      <span class="token punctuation">}</span>
  <span class="token punctuation">}</span>
</code></pre></div></li></ul> <h2 id="表格"><a href="#表格" class="header-anchor">#</a> 表格</h2> <h3 id="tablemany"><a href="#tablemany" class="header-anchor">#</a> tableMany</h3> <ul><li><p>老框架的tableMany方法和新框架不同,不是传递数组,而是直接把拼接好的数组变量放到方法括号中即可.</p> <div class="language-php extra-class"><pre class="language-php"><code><span class="token comment">//询价信息表部分</span>
                <span class="token variable">$trOne</span><span class="token punctuation">[</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token keyword">array</span><span class="token punctuation">(</span><span class="token string double-quoted-string">&quot;供应商名称&quot;</span><span class="token punctuation">,</span><span class="token string double-quoted-string">&quot;供应商地址&quot;</span><span class="token punctuation">,</span><span class="token string double-quoted-string">&quot;供应商联系方式&quot;</span><span class="token punctuation">,</span><span class="token string double-quoted-string">&quot;采购方案&quot;</span><span class="token punctuation">,</span><span class="token string double-quoted-string">&quot;新增行&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token comment">//不知道要怎样拿到按钮传过来的id</span>
                <span class="token comment">//拿到全局变量中的数据库连接con</span>
                <span class="token variable">$con</span> <span class="token operator">=</span> <span class="token variable">$GLOBALS</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'con'</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
                <span class="token comment">//用get拿到id</span>
                <span class="token variable">$enquiryInfo</span> <span class="token operator">=</span> <span class="token function">sqlQueryAll</span><span class="token punctuation">(</span><span class="token string double-quoted-string">&quot;select * from enquiryInfo where purchaseEnquiryId = '<span class="token interpolation"><span class="token variable">$purchaseEnquiryId</span></span>'&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">//通过拿到的采购询价表id查询这个采购询价表的询价信息表(不止一次)</span>
                <span class="token variable">$enquiryInfoCount</span> <span class="token operator">=</span> <span class="token function">count</span><span class="token punctuation">(</span><span class="token variable">$enquiryInfo</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">//for循环,因为一个会员可能有不止一个</span>
                <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token variable">$x</span><span class="token operator">=</span><span class="token number">0</span><span class="token punctuation">;</span><span class="token variable">$x</span><span class="token operator">&lt;</span><span class="token variable">$enquiryInfoCount</span><span class="token punctuation">;</span><span class="token variable">$x</span><span class="token operator">++</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
<span class="token variable">$mx</span> <span class="token operator">=</span> <span class="token string double-quoted-string">&quot;&lt;span class='spanButton' onclick=\&quot;layer('adThemeRound',{'themeId':'<span class="token interpolation"><span class="token variable">$get</span><span class="token punctuation">[</span>id<span class="token punctuation">]</span></span>','id':'&quot;</span><span class="token operator">.</span><span class="token variable">$round</span><span class="token punctuation">[</span><span class="token variable">$x</span><span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'id'</span><span class="token punctuation">]</span><span class="token operator">.</span><span class="token string double-quoted-string">&quot;'})\&quot;&gt;+&lt;/span&gt;&quot;</span><span class="token punctuation">;</span>
<span class="token variable">$trOne</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token operator">=</span><span class="token keyword">array</span><span class="token punctuation">(</span><span class="token variable">$enquiryInfo</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'supplierName'</span><span class="token punctuation">]</span><span class="token punctuation">,</span><span class="token variable">$enquiryInfo</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'supplierAddress'</span><span class="token punctuation">]</span><span class="token punctuation">,</span><span class="token variable">$enquiryInfo</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'supplierTel'</span><span class="token punctuation">]</span><span class="token punctuation">,</span><span class="token variable">$enquiryInfo</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'supplierScheme'</span><span class="token punctuation">]</span><span class="token punctuation">,</span><span class="token variable">$mx</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token punctuation">}</span>
<span class="token variable">$enquiryInfoHtml</span> <span class="token operator">=</span> space<span class="token operator">.</span><span class="token string double-quoted-string">&quot;&lt;style&gt;.tableMany td{background-color: white!important;text-align: center!important;}.tableMany tr:hover {color: #555!important;}&lt;/style&gt;&quot;</span><span class="token operator">.</span><span class="token function">tableMany</span><span class="token punctuation">(</span><span class="token variable">$trOne</span><span class="token punctuation">)</span><span class="token operator">.</span><span class="token string double-quoted-string">&quot;&lt;input name='themeId' style='display: none' value='<span class="token interpolation"><span class="token variable">$purchaseEnquiryId</span></span>' /&gt;&quot;</span><span class="token punctuation">;</span>  <span class="token comment">//这里的tableMany方法就只需要填之前写好的tr数组变量进去,而新框架则是这样的tableMany(array(&quot;tr&quot; =&gt; $tr))</span>

</code></pre></div></li></ul> <h2 id="数据处理"><a href="#数据处理" class="header-anchor">#</a> 数据处理</h2> <ul><li><p>老框架中新建编辑页面跳转处理数据的链接拼接也是和新框架有很大区别的,他需要提前定义你要跳转的文件名.</p> <div class="language-php extra-class"><pre class="language-php"><code><span class="token keyword">if</span><span class="token punctuation">(</span><span class="token keyword">empty</span><span class="token punctuation">(</span><span class="token variable">$para</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'warn'</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
            <span class="token variable">$para</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'sub'</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token string double-quoted-string">&quot;addata&quot;</span><span class="token punctuation">;</span>  <span class="token comment">//这里是老框架特色,决定了跳转处理数据的链接的拼接,这样写才会跳转addata.php中处理数据</span>
            <span class="token variable">$duty</span> <span class="token operator">=</span> <span class="token function">query</span><span class="token punctuation">(</span><span class="token string double-quoted-string">&quot;adDuty&quot;</span><span class="token punctuation">,</span><span class="token string double-quoted-string">&quot; id = '<span class="token interpolation"><span class="token variable">$purchaseEnquiry</span><span class="token punctuation">[</span>adDutyId<span class="token punctuation">]</span></span>' &quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token variable">$product</span> <span class="token operator">=</span> <span class="token function">query</span><span class="token punctuation">(</span><span class="token string double-quoted-string">&quot;product&quot;</span><span class="token punctuation">,</span><span class="token string double-quoted-string">&quot;id = <span class="token interpolation"><span class="token variable">$purchaseEnquiry</span><span class="token punctuation">[</span>productId<span class="token punctuation">]</span></span>&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token variable">$enquiryNum</span> <span class="token operator">=</span> <span class="token function">getEnquiryNum</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

</code></pre></div></li></ul> <h2 id="详情页面"><a href="#详情页面" class="header-anchor">#</a> 详情页面</h2> <h3 id="js方法"><a href="#js方法" class="header-anchor">#</a> JS方法</h3> <ul><li><p>老框架之中做的小表格,是那种点击加号添加一行,点击减号消失一行.如果想完成小表格的删除功能,思路大概是这样的</p></li> <li><p>首先一进到编辑页面就先拿到小表格中所有的数据的id组成一维数组,之后等你把想删的数据删掉,想改的想新增的数据都完成之后点击提交,提交之后把提交的所有小表格数据的id组成一个一维数组,和之前的数组求差得到删掉的数据的id数组.</p></li> <li><p>把这个差值id数组中的id在数据库中全部删掉即可.</p> <div class="language-php extra-class"><pre class="language-php"><code><span class="token variable">$enquiryInfoId</span> <span class="token operator">=</span> <span class="token variable">$post</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'enquiryInfoId'</span><span class="token punctuation">]</span><span class="token punctuation">;</span> <span class="token comment">//得到隐藏域携带的id数组</span>
    <span class="token variable">$purchaseBargainId</span> <span class="token operator">=</span> <span class="token variable">$post</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'purchaseBargainId'</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
</code></pre></div><div class="language-php extra-class"><pre class="language-php"><code><span class="token variable">$enquiryInfoIdArr</span>  <span class="token operator">=</span> <span class="token function">sqlQueryAll</span><span class="token punctuation">(</span><span class="token string double-quoted-string">&quot;select id from enquiryInfo where purchaseEnquiryId = '<span class="token interpolation"><span class="token variable">$post</span><span class="token punctuation">[</span>id<span class="token punctuation">]</span></span>'&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token variable">$purchaseBargainIdArr</span> <span class="token operator">=</span> <span class="token function">sqlQueryAll</span><span class="token punctuation">(</span><span class="token string double-quoted-string">&quot;select id from purchaseBargain where purchaseEnquiryId = '<span class="token interpolation"><span class="token variable">$post</span><span class="token punctuation">[</span>id<span class="token punctuation">]</span></span>'&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">//在所有限制条件结束后先查询数据库中小表格所有id.</span>
</code></pre></div></li></ul> <hr> <ul><li><p>老框架中点击加号新增一行的功能是这样做出来的.</p> <div class="language-php extra-class"><pre class="language-php"><code><span class="token variable">$addButtonOne</span> <span class="token operator">=</span> <span class="token string double-quoted-string">&quot;&lt;span onclick='addInquiryRow(this)' class='spanButton'&gt;+&lt;/span&gt;&quot;</span><span class="token punctuation">;</span>  <span class="token comment">//添加一行表格的按钮  在detailPara中定义一个按钮,点击触发添加一行表格的js方法</span>
</code></pre></div><div class="language-php extra-class"><pre class="language-php"><code><span class="token comment">/************点击添加一行询价信息表格**************/</span>
<span class="token comment">//点击触发添加一行小表格的js方法,中间定义的输入框随着你自己的表格数据你自己去改</span>
<span class="token keyword">function</span> <span class="token function-definition function">addInquiryRow</span><span class="token punctuation">(</span>e<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">var</span> body<span class="token operator">=</span> $<span class="token punctuation">(</span>e<span class="token punctuation">)</span><span class="token operator">.</span><span class="token keyword">parent</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">.</span><span class="token keyword">parent</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">.</span><span class="token keyword">parent</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">var</span> vTr<span class="token operator">=</span> <span class="token string double-quoted-string">&quot;&lt;tr&gt;&quot;</span> <span class="token operator">+</span>
        <span class="token string double-quoted-string">&quot;&lt;td&gt;&quot;</span> <span class="token operator">+</span>
        <span class="token string double-quoted-string">&quot;&lt;input type='text' name='supplierNameInquiry[]'&gt;&quot;</span> <span class="token operator">+</span>
        <span class="token string double-quoted-string">&quot;&lt;/td&gt;&quot;</span> <span class="token operator">+</span>
        <span class="token string double-quoted-string">&quot;&lt;td&gt;&quot;</span> <span class="token operator">+</span>
        <span class="token string double-quoted-string">&quot;&lt;input type='text' name='supplierAddress[]'&gt;&quot;</span> <span class="token operator">+</span>
        <span class="token string double-quoted-string">&quot;&lt;/td&gt;&quot;</span> <span class="token operator">+</span>
        <span class="token string double-quoted-string">&quot;&lt;td&gt;&quot;</span> <span class="token operator">+</span>
        <span class="token string double-quoted-string">&quot;&lt;input type='text' name='supplierTel[]'&gt;&quot;</span> <span class="token operator">+</span>
        <span class="token string double-quoted-string">&quot;&lt;/td&gt;&quot;</span><span class="token operator">+</span>
        <span class="token string double-quoted-string">&quot;&lt;td&gt;&quot;</span> <span class="token operator">+</span>
        <span class="token string double-quoted-string">&quot;&lt;input type='text' name='supplierScheme[]'&gt;&quot;</span> <span class="token operator">+</span>
        <span class="token string double-quoted-string">&quot;&lt;/td&gt;&quot;</span> <span class="token operator">+</span>
        <span class="token string double-quoted-string">&quot;&lt;td&gt;&quot;</span> <span class="token operator">+</span>
        <span class="token string double-quoted-string">&quot;&lt;span onclick='removeRow(this)' class='spanButton'&gt;-&lt;/span&gt;&quot;</span> <span class="token operator">+</span>
        <span class="token string double-quoted-string">&quot;&lt;/td&gt;&gt;&quot;</span> <span class="token operator">+</span>
        <span class="token string double-quoted-string">&quot;&lt;/tr&gt;&quot;</span><span class="token punctuation">;</span>
    body<span class="token operator">.</span><span class="token function">append</span><span class="token punctuation">(</span>vTr<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre></div></li> <li><p>小表格中点击减号减少一行表格的功能是这样做的</p> <div class="language-php extra-class"><pre class="language-php"><code><span class="token variable">$removeRow</span> <span class="token operator">=</span> <span class="token string double-quoted-string">&quot;&lt;span onclick='removeRow(this)' class='spanButton'&gt;-&lt;/span&gt;&quot;</span><span class="token punctuation">;</span>
<span class="token comment">//在detailPara中定义一个点击之后触发js减少一行表格方法的按钮</span>

</code></pre></div><div class="language-js extra-class"><pre class="language-js"><code><span class="token comment">/************点击删除一行表格**************/</span>
<span class="token keyword">function</span> <span class="token function">removeRow</span><span class="token punctuation">(</span><span class="token parameter">e</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token function">$</span><span class="token punctuation">(</span>e<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">parent</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">parent</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">remove</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

</code></pre></div></li> <li><p>为了让没有数据的时候就有一行小表格的输入框,就需要重写tableMany方法,放到extend.php中</p> <div class="language-php extra-class"><pre class="language-php"><code><span class="token comment">/***********************询价信息列表页table拼接************************/</span>
<span class="token keyword">function</span> <span class="token function-definition function">tableManyPlusOne</span><span class="token punctuation">(</span><span class="token variable">$tr</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
<span class="token comment">//    global $lang;</span>
    <span class="token variable">$maxdim</span> <span class="token operator">=</span> <span class="token function">arrayLevel</span><span class="token punctuation">(</span><span class="token variable">$tr</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token variable">$maxdim</span> <span class="token operator">==</span> <span class="token number">3</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token variable">$table</span> <span class="token operator">=</span> <span class="token function">tableManyTwo</span><span class="token punctuation">(</span><span class="token variable">$tr</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span><span class="token keyword">else</span><span class="token punctuation">{</span>
        <span class="token comment">//检查最后一组是不是全是空的</span>
        <span class="token keyword">foreach</span><span class="token punctuation">(</span><span class="token variable">$tr</span> <span class="token keyword">as</span> <span class="token variable">$key</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
            <span class="token variable">$endValue</span> <span class="token operator">=</span> <span class="token function">end</span><span class="token punctuation">(</span><span class="token variable">$key</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token operator">!</span><span class="token keyword">empty</span><span class="token punctuation">(</span><span class="token variable">$endValue</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
                <span class="token variable">$end</span> <span class="token operator">=</span> <span class="token string double-quoted-string">&quot;yes&quot;</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span>
        <span class="token punctuation">}</span>
        <span class="token comment">//组合table</span>
        <span class="token variable">$row</span> <span class="token operator">=</span> <span class="token string double-quoted-string">&quot;&quot;</span><span class="token punctuation">;</span>
        <span class="token keyword">foreach</span><span class="token punctuation">(</span><span class="token variable">$tr</span> <span class="token keyword">as</span> <span class="token variable">$key</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
            <span class="token variable">$td</span> <span class="token operator">=</span> <span class="token string double-quoted-string">&quot;&quot;</span><span class="token punctuation">;</span>
            <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token variable">$end</span> <span class="token operator">!=</span> <span class="token string double-quoted-string">&quot;yes&quot;</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
                <span class="token function">array_pop</span><span class="token punctuation">(</span><span class="token variable">$key</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span>
            <span class="token keyword">foreach</span><span class="token punctuation">(</span><span class="token variable">$key</span> <span class="token keyword">as</span> <span class="token variable">$value</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
                <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token operator">!</span><span class="token keyword">empty</span><span class="token punctuation">(</span><span class="token variable">$row</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
                    <span class="token variable">$value</span> <span class="token operator">=</span> <span class="token function">kong</span><span class="token punctuation">(</span><span class="token variable">$value</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">//如果不是表头，则补全空字段</span>
                <span class="token punctuation">}</span>
                <span class="token variable">$td</span> <span class="token operator">.=</span> <span class="token string double-quoted-string">&quot;&lt;td&gt;<span class="token interpolation"><span class="token punctuation">{</span><span class="token variable">$value</span><span class="token punctuation">}</span></span>&lt;/td&gt;&quot;</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span>
            <span class="token variable">$row</span> <span class="token operator">.=</span> <span class="token string double-quoted-string">&quot;&lt;tr&gt;<span class="token interpolation"><span class="token punctuation">{</span><span class="token variable">$td</span><span class="token punctuation">}</span></span>&lt;/tr&gt;&quot;</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
        <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token function">count</span><span class="token punctuation">(</span><span class="token variable">$tr</span><span class="token punctuation">)</span> <span class="token operator">==</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
            <span class="token variable">$n</span> <span class="token operator">=</span> <span class="token function">count</span><span class="token punctuation">(</span><span class="token variable">$tr</span><span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token variable">$row</span> <span class="token operator">.=</span> <span class="token string double-quoted-string">&quot;
            &lt;tr&gt; 
        &lt;td&gt;
        &lt;input type='text' name='supplierNameInquiry[]'&gt;
        &lt;/td&gt;
        &lt;td&gt;
        &lt;input type='text' name='supplierAddress[]'&gt;
        &lt;/td&gt;
        &lt;td&gt;
        &lt;input type='text' name='supplierTel[]'&gt; 
        &lt;/td&gt;
        &lt;td&gt; 
        &lt;input type='text' name='supplierScheme[]'&gt; 
        &lt;/td&gt; 
        &lt;td&gt;
        &lt;span onclick='removeRow(this)' class='spanButton'&gt;-&lt;/span&gt;
&lt;/td&gt;
 &lt;/tr&gt;
            &quot;</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
        <span class="token variable">$table</span> <span class="token operator">=</span> <span class="token string double-quoted-string">&quot;&lt;table class='tableMany'&gt;<span class="token interpolation"><span class="token punctuation">{</span><span class="token variable">$row</span><span class="token punctuation">}</span></span>&lt;/table&gt;&quot;</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token keyword">return</span> <span class="token variable">$table</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

</code></pre></div></li> <li><p>在detailPara中的小表格部分整体代码如下</p> <div class="language-php extra-class"><pre class="language-php"><code><span class="token variable">$purchaseEnquiryId</span> <span class="token operator">=</span> <span class="token variable">$get</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'id'</span><span class="token punctuation">]</span><span class="token punctuation">;</span> <span class="token comment">//采购询价表id</span>
        <span class="token variable">$addButtonOne</span> <span class="token operator">=</span> <span class="token string double-quoted-string">&quot;&lt;span onclick='addInquiryRow(this)' class='spanButton'&gt;+&lt;/span&gt;&quot;</span><span class="token punctuation">;</span>  <span class="token comment">//添加一行表格的按钮</span>
        <span class="token variable">$addButtonWwo</span> <span class="token operator">=</span> <span class="token string double-quoted-string">&quot;&lt;span onclick='addBargainRow(this)' class='spanButton'&gt;+&lt;/span&gt;&quot;</span><span class="token punctuation">;</span>  <span class="token comment">//添加一行表格的按钮</span>
        <span class="token variable">$removeRow</span> <span class="token operator">=</span> <span class="token string double-quoted-string">&quot;&lt;span onclick='removeRow(this)' class='spanButton'&gt;-&lt;/span&gt;&quot;</span><span class="token punctuation">;</span>
                <span class="token comment">//询价信息表部分</span>
                <span class="token variable">$trOne</span><span class="token punctuation">[</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token keyword">array</span><span class="token punctuation">(</span><span class="token string double-quoted-string">&quot;供应商名称&quot;</span><span class="token punctuation">,</span><span class="token string double-quoted-string">&quot;供应商地址&quot;</span><span class="token punctuation">,</span><span class="token string double-quoted-string">&quot;供应商联系方式&quot;</span><span class="token punctuation">,</span><span class="token string double-quoted-string">&quot;采购方案&quot;</span><span class="token punctuation">,</span><span class="token variable">$addButtonOne</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token comment">//拿到全局变量中的数据库连接con</span>
                <span class="token variable">$con</span> <span class="token operator">=</span> <span class="token variable">$GLOBALS</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'con'</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
                <span class="token comment">//用get拿到id</span>
                <span class="token variable">$enquiryInfo</span> <span class="token operator">=</span> <span class="token function">sqlQueryAll</span><span class="token punctuation">(</span><span class="token string double-quoted-string">&quot;select * from enquiryInfo where purchaseEnquiryId = '<span class="token interpolation"><span class="token variable">$purchaseEnquiryId</span></span>' order by time&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">//通过拿到的采购询价表id查询这个采购询价表的询价信息表(不止一次)</span>
                <span class="token variable">$enquiryInfoCount</span> <span class="token operator">=</span> <span class="token function">count</span><span class="token punctuation">(</span><span class="token variable">$enquiryInfo</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">//for循环,因为一个会员可能有不止一个</span>
                <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token variable">$x</span><span class="token operator">=</span><span class="token number">0</span><span class="token punctuation">;</span><span class="token variable">$x</span><span class="token operator">&lt;</span><span class="token variable">$enquiryInfoCount</span><span class="token punctuation">;</span><span class="token variable">$x</span><span class="token operator">++</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
                    <span class="token variable">$enquiryInfoId</span> <span class="token operator">=</span> <span class="token variable">$enquiryInfo</span><span class="token punctuation">[</span><span class="token variable">$x</span><span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'id'</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
                    <span class="token variable">$supplierNameInquiry</span> <span class="token operator">=</span> <span class="token variable">$enquiryInfo</span><span class="token punctuation">[</span><span class="token variable">$x</span><span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'supplierName'</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
                    <span class="token variable">$supplierAddress</span> <span class="token operator">=</span> <span class="token variable">$enquiryInfo</span><span class="token punctuation">[</span><span class="token variable">$x</span><span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'supplierAddress'</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
                    <span class="token variable">$supplierTel</span> <span class="token operator">=</span> <span class="token variable">$enquiryInfo</span><span class="token punctuation">[</span><span class="token variable">$x</span><span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'supplierTel'</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
                    <span class="token variable">$supplierScheme</span> <span class="token operator">=</span> <span class="token variable">$enquiryInfo</span><span class="token punctuation">[</span><span class="token variable">$x</span><span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'supplierScheme'</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
                    <span class="token variable">$trOne</span><span class="token punctuation">[</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token keyword">array</span><span class="token punctuation">(</span><span class="token string double-quoted-string">&quot;&lt;input type='text' name='supplierNameInquiry[]' value='<span class="token interpolation"><span class="token variable">$supplierNameInquiry</span></span>'&gt;&quot;</span><span class="token punctuation">,</span><span class="token string double-quoted-string">&quot;&lt;input type='text' name='supplierAddress[]' value='<span class="token interpolation"><span class="token variable">$supplierAddress</span></span>'&gt;&quot;</span><span class="token punctuation">,</span><span class="token string double-quoted-string">&quot;&lt;input type='text' name='supplierTel[]' value='<span class="token interpolation"><span class="token variable">$supplierTel</span></span>'&gt;&quot;</span><span class="token punctuation">,</span><span class="token string double-quoted-string">&quot;&lt;input type='text' name='supplierScheme[]' value='<span class="token interpolation"><span class="token variable">$supplierScheme</span></span>'&gt;&quot;</span><span class="token punctuation">,</span><span class="token variable">$removeRow</span><span class="token operator">.</span><span class="token string double-quoted-string">&quot;&lt;input name='enquiryInfoId[]' value='<span class="token interpolation"><span class="token variable">$enquiryInfoId</span></span>' style='display: none'&gt;&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token punctuation">}</span>
                <span class="token variable">$enquiryInfoHtml</span> <span class="token operator">=</span> space<span class="token operator">.</span><span class="token string double-quoted-string">&quot;&lt;style&gt;.tableMany td{background-color: white!important;
            text-align: center!important;}.tableMany tr:hover {color: #555!important;}&lt;/style&gt;&quot;</span><span class="token operator">.</span><span class="token function">tableManyPlusOne</span><span class="token punctuation">(</span><span class="token variable">$trOne</span><span class="token punctuation">)</span><span class="token operator">.</span><span class="token string double-quoted-string">&quot;&lt;input name='purchaseEnquiryId' style='display: none' value='<span class="token interpolation"><span class="token variable">$purchaseEnquiryId</span></span>' /&gt;&quot;</span><span class="token punctuation">;</span>

</code></pre></div></li></ul></div> <footer class="page-edit"><!----> <div class="last-updated"><span class="prefix">Last Updated:</span> <span class="time">9/27/2020, 10:06:51 PM</span></div></footer> <div class="page-nav"><p class="inner"><span class="prev">
      ←
      <a href="/yumu/公司框架/新框架.html" class="prev">
        新框架
      </a></span> <span class="next"><a href="/yumu/公司框架/2020开年新框架.html">
        2020框架
      </a>
      →
    </span></p></div> </main></div><div class="global-ui"></div></div>
    <script src="/assets/js/app.6ef7aeda.js" defer></script><script src="/assets/js/2.716a1f37.js" defer></script><script src="/assets/js/91.932f1454.js" defer></script>
  </body>
</html>
