<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>扩展方法 | 学而时习之</title>
    <meta name="generator" content="VuePress 1.9.7">
    <link rel="icon" href="/img/qiyu.jpg">
    <meta name="description" content="个人学习博客">
    
    <link rel="preload" href="/assets/css/0.styles.e4d8b86b.css" as="style"><link rel="preload" href="/assets/js/app.6ef7aeda.js" as="script"><link rel="preload" href="/assets/js/2.716a1f37.js" as="script"><link rel="preload" href="/assets/js/87.5ec873ab.js" as="script"><link rel="prefetch" href="/assets/js/10.a4a050d1.js"><link rel="prefetch" href="/assets/js/11.344787d3.js"><link rel="prefetch" href="/assets/js/12.b25f9ccf.js"><link rel="prefetch" href="/assets/js/13.fbdea543.js"><link rel="prefetch" href="/assets/js/14.5fc0584b.js"><link rel="prefetch" href="/assets/js/15.688b7501.js"><link rel="prefetch" href="/assets/js/16.fbd251ee.js"><link rel="prefetch" href="/assets/js/17.6b6b044b.js"><link rel="prefetch" href="/assets/js/18.4da62780.js"><link rel="prefetch" href="/assets/js/19.e76bd09c.js"><link rel="prefetch" href="/assets/js/20.c6c4fad3.js"><link rel="prefetch" href="/assets/js/21.76180caa.js"><link rel="prefetch" href="/assets/js/22.6f1b73fd.js"><link rel="prefetch" href="/assets/js/23.a95962c2.js"><link rel="prefetch" href="/assets/js/24.eee43d5e.js"><link rel="prefetch" href="/assets/js/25.56e05948.js"><link rel="prefetch" href="/assets/js/26.43f2e3ff.js"><link rel="prefetch" href="/assets/js/27.09054ea0.js"><link rel="prefetch" href="/assets/js/28.c4e54eaa.js"><link rel="prefetch" href="/assets/js/29.06c6b4e5.js"><link rel="prefetch" href="/assets/js/3.eaf135e1.js"><link rel="prefetch" href="/assets/js/30.250c7c81.js"><link rel="prefetch" href="/assets/js/31.91b37571.js"><link rel="prefetch" href="/assets/js/32.d2677ff0.js"><link rel="prefetch" href="/assets/js/33.41ead764.js"><link rel="prefetch" href="/assets/js/34.133f8e54.js"><link rel="prefetch" href="/assets/js/35.362db0cb.js"><link rel="prefetch" href="/assets/js/36.db01e9cc.js"><link rel="prefetch" href="/assets/js/37.78fd90d2.js"><link rel="prefetch" href="/assets/js/38.27112b1c.js"><link rel="prefetch" href="/assets/js/39.c077219c.js"><link rel="prefetch" href="/assets/js/4.75ddad43.js"><link rel="prefetch" href="/assets/js/40.c9153258.js"><link rel="prefetch" href="/assets/js/41.c0b0dba4.js"><link rel="prefetch" href="/assets/js/42.787b0675.js"><link rel="prefetch" href="/assets/js/43.35499284.js"><link rel="prefetch" href="/assets/js/44.ea23a009.js"><link rel="prefetch" href="/assets/js/45.e5cd72c6.js"><link rel="prefetch" href="/assets/js/46.f1392760.js"><link rel="prefetch" href="/assets/js/47.1553f24b.js"><link rel="prefetch" href="/assets/js/48.c696d608.js"><link rel="prefetch" href="/assets/js/49.a7940cc9.js"><link rel="prefetch" href="/assets/js/5.f9f3c101.js"><link rel="prefetch" href="/assets/js/50.e8cadfe4.js"><link rel="prefetch" href="/assets/js/51.080e63aa.js"><link rel="prefetch" href="/assets/js/52.7347d36c.js"><link rel="prefetch" href="/assets/js/53.aba50764.js"><link rel="prefetch" href="/assets/js/54.ca1160dc.js"><link rel="prefetch" href="/assets/js/55.b6574861.js"><link rel="prefetch" href="/assets/js/56.be3c310f.js"><link rel="prefetch" href="/assets/js/57.037820ea.js"><link rel="prefetch" href="/assets/js/58.24474c32.js"><link rel="prefetch" href="/assets/js/59.3b585e3d.js"><link rel="prefetch" href="/assets/js/6.c86d08c0.js"><link rel="prefetch" href="/assets/js/60.75b5bae2.js"><link rel="prefetch" href="/assets/js/61.1831f564.js"><link rel="prefetch" href="/assets/js/62.18a1b459.js"><link rel="prefetch" href="/assets/js/63.346f7f49.js"><link rel="prefetch" href="/assets/js/64.a7683029.js"><link rel="prefetch" href="/assets/js/65.1a938596.js"><link rel="prefetch" href="/assets/js/66.0106ad50.js"><link rel="prefetch" href="/assets/js/67.b0b943da.js"><link rel="prefetch" href="/assets/js/68.60534009.js"><link rel="prefetch" href="/assets/js/69.72e1bfa9.js"><link rel="prefetch" href="/assets/js/7.e0e4b61b.js"><link rel="prefetch" href="/assets/js/70.3a29dfd9.js"><link rel="prefetch" href="/assets/js/71.3e57d5ec.js"><link rel="prefetch" href="/assets/js/72.be56e12f.js"><link rel="prefetch" href="/assets/js/73.b6934116.js"><link rel="prefetch" href="/assets/js/74.81f5b5c3.js"><link rel="prefetch" href="/assets/js/75.e9dacdaf.js"><link rel="prefetch" href="/assets/js/76.7c0855f1.js"><link rel="prefetch" href="/assets/js/77.98a4a794.js"><link rel="prefetch" href="/assets/js/78.3049e29b.js"><link rel="prefetch" href="/assets/js/79.9c741fac.js"><link rel="prefetch" href="/assets/js/8.8c856480.js"><link rel="prefetch" href="/assets/js/80.46cc42c2.js"><link rel="prefetch" href="/assets/js/81.2647d9b6.js"><link rel="prefetch" href="/assets/js/82.0c7a9946.js"><link rel="prefetch" href="/assets/js/83.fa03835c.js"><link rel="prefetch" href="/assets/js/84.909232bc.js"><link rel="prefetch" href="/assets/js/85.7cf12395.js"><link rel="prefetch" href="/assets/js/86.805e61d2.js"><link rel="prefetch" href="/assets/js/88.54c3c15b.js"><link rel="prefetch" href="/assets/js/89.286a5312.js"><link rel="prefetch" href="/assets/js/9.6133e2ec.js"><link rel="prefetch" href="/assets/js/90.e91320ce.js"><link rel="prefetch" href="/assets/js/91.932f1454.js">
    <link rel="stylesheet" href="/assets/css/0.styles.e4d8b86b.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container"><header class="navbar"><div class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/" class="home-link router-link-active"><!----> <span class="site-name">学而时习之</span></a> <div class="links"><div class="search-box"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <nav class="nav-links can-hide"><div class="nav-item"><a href="/" class="nav-link">
  主页
</a></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="博文" class="dropdown-title"><span class="title">博文</span> <span class="arrow down"></span></button> <button type="button" aria-label="博文" class="mobile-dropdown-title"><span class="title">博文</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/vuePress/" class="nav-link">
  博客相关知识
</a></li><li class="dropdown-item"><!----> <a href="/javaBasics/" class="nav-link">
  JavaSE基础知识
</a></li><li class="dropdown-item"><!----> <a href="/javaFramework/" class="nav-link">
  Java框架知识
</a></li><li class="dropdown-item"><!----> <a href="/book/" class="nav-link">
  技术书籍
</a></li><li class="dropdown-item"><!----> <a href="/js/" class="nav-link">
  前端
</a></li><li class="dropdown-item"><!----> <a href="/sql/" class="nav-link">
  数据库知识
</a></li><li class="dropdown-item"><!----> <a href="/projectPractice/" class="nav-link">
  项目实战
</a></li><li class="dropdown-item"><!----> <a href="/projectNote/" class="nav-link">
  工作项目积累
</a></li><li class="dropdown-item"><!----> <a href="/faultNote/" class="nav-link">
  记错本
</a></li><li class="dropdown-item"><!----> <a href="/php/" class="nav-link">
  php
</a></li><li class="dropdown-item"><!----> <a href="/linux/" class="nav-link">
  linux学习
</a></li><li class="dropdown-item"><!----> <a href="/git/" class="nav-link">
  git笔记
</a></li><li class="dropdown-item"><!----> <a href="/middleware/" class="nav-link">
  中间件
</a></li><li class="dropdown-item"><!----> <a href="/docker/" class="nav-link">
  docker笔记
</a></li><li class="dropdown-item"><!----> <a href="/nginx/" class="nav-link">
  nginx笔记
</a></li><li class="dropdown-item"><!----> <a href="/systemArchitecture/" class="nav-link">
  系统架构
</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="工具网站" class="dropdown-title"><span class="title">工具网站</span> <span class="arrow down"></span></button> <button type="button" aria-label="工具网站" class="mobile-dropdown-title"><span class="title">工具网站</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="https://postimages.org" target="_blank" rel="noopener noreferrer" class="nav-link external">
  postimages图床
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li></ul></div></div> <!----></nav></div></header> <div class="sidebar-mask"></div> <aside class="sidebar"><nav class="nav-links"><div class="nav-item"><a href="/" class="nav-link">
  主页
</a></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="博文" class="dropdown-title"><span class="title">博文</span> <span class="arrow down"></span></button> <button type="button" aria-label="博文" class="mobile-dropdown-title"><span class="title">博文</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/vuePress/" class="nav-link">
  博客相关知识
</a></li><li class="dropdown-item"><!----> <a href="/javaBasics/" class="nav-link">
  JavaSE基础知识
</a></li><li class="dropdown-item"><!----> <a href="/javaFramework/" class="nav-link">
  Java框架知识
</a></li><li class="dropdown-item"><!----> <a href="/book/" class="nav-link">
  技术书籍
</a></li><li class="dropdown-item"><!----> <a href="/js/" class="nav-link">
  前端
</a></li><li class="dropdown-item"><!----> <a href="/sql/" class="nav-link">
  数据库知识
</a></li><li class="dropdown-item"><!----> <a href="/projectPractice/" class="nav-link">
  项目实战
</a></li><li class="dropdown-item"><!----> <a href="/projectNote/" class="nav-link">
  工作项目积累
</a></li><li class="dropdown-item"><!----> <a href="/faultNote/" class="nav-link">
  记错本
</a></li><li class="dropdown-item"><!----> <a href="/php/" class="nav-link">
  php
</a></li><li class="dropdown-item"><!----> <a href="/linux/" class="nav-link">
  linux学习
</a></li><li class="dropdown-item"><!----> <a href="/git/" class="nav-link">
  git笔记
</a></li><li class="dropdown-item"><!----> <a href="/middleware/" class="nav-link">
  中间件
</a></li><li class="dropdown-item"><!----> <a href="/docker/" class="nav-link">
  docker笔记
</a></li><li class="dropdown-item"><!----> <a href="/nginx/" class="nav-link">
  nginx笔记
</a></li><li class="dropdown-item"><!----> <a href="/systemArchitecture/" class="nav-link">
  系统架构
</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="工具网站" class="dropdown-title"><span class="title">工具网站</span> <span class="arrow down"></span></button> <button type="button" aria-label="工具网站" class="mobile-dropdown-title"><span class="title">工具网站</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="https://postimages.org" target="_blank" rel="noopener noreferrer" class="nav-link external">
  postimages图床
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li></ul></div></div> <!----></nav>  <ul class="sidebar-links"><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading open"><span>公司框架使用</span> <span class="arrow down"></span></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/yumu/公司框架/新框架.html" class="sidebar-link">新框架</a></li><li><a href="/yumu/公司框架/老框架.html" class="sidebar-link">老框架</a></li><li><a href="/yumu/公司框架/2020开年新框架.html" class="active sidebar-link">2020框架</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/yumu/公司框架/2020开年新框架.html#扩展方法" class="sidebar-link">扩展方法</a></li><li class="sidebar-sub-header"><a href="/yumu/公司框架/2020开年新框架.html#跳转" class="sidebar-link">跳转</a></li><li class="sidebar-sub-header"><a href="/yumu/公司框架/2020开年新框架.html#分支" class="sidebar-link">分支</a></li><li class="sidebar-sub-header"><a href="/yumu/公司框架/2020开年新框架.html#封装方法" class="sidebar-link">封装方法</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/yumu/公司框架/2020开年新框架.html#条件判断" class="sidebar-link">条件判断</a></li></ul></li><li class="sidebar-sub-header"><a href="/yumu/公司框架/2020开年新框架.html#模块显示" class="sidebar-link">模块显示</a></li><li class="sidebar-sub-header"><a href="/yumu/公司框架/2020开年新框架.html#图片上传" class="sidebar-link">图片上传</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/yumu/公司框架/2020开年新框架.html#上传多张图" class="sidebar-link">上传多张图</a></li></ul></li><li class="sidebar-sub-header"><a href="/yumu/公司框架/2020开年新框架.html#上传文件" class="sidebar-link">上传文件</a></li><li class="sidebar-sub-header"><a href="/yumu/公司框架/2020开年新框架.html#导出" class="sidebar-link">导出</a></li><li class="sidebar-sub-header"><a href="/yumu/公司框架/2020开年新框架.html#word" class="sidebar-link">Word</a></li></ul></li><li><a href="/yumu/公司框架/框架通用.html" class="sidebar-link">框架通用</a></li><li><a href="/yumu/公司框架/js相关.html" class="sidebar-link">js相关</a></li></ul></section></li></ul> </aside> <main class="page"> <div class="theme-default-content content__default"><h2 id="扩展方法"><a href="#扩展方法" class="header-anchor">#</a> 扩展方法</h2> <ul><li><p>现在用上了最新的框架,而最新框架中没有了extend.php文件,所以如果想使用扩展方法,那就得自己去新建一个文件,这个文件可能还要用到框架自带方法,所以就需要require系统中的<code>base.php</code>.</p></li> <li><p>最后写好了之后到系统基类<code>adIndexClass.php</code>中引入即可</p> <div class="language-php extra-class"><pre class="language-php"><code><span class="token keyword">require_once</span> <span class="token punctuation">(</span><span class="token string double-quoted-string">&quot;control/base.php&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">trait</span> <span class="token class-name-definition class-name">extendClass</span><span class="token punctuation">{</span>
<span class="token comment">//..所有函数</span>
<span class="token punctuation">}</span>
</code></pre></div><div class="language-php extra-class"><pre class="language-php"><code><span class="token keyword">require_once</span> <span class="token punctuation">(</span><span class="token string double-quoted-string">&quot;../extendClass.php&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">class</span> <span class="token class-name-definition class-name">adIndexClass</span><span class="token punctuation">{</span>
    <span class="token keyword">use</span> <span class="token package">extendClass</span><span class="token punctuation">;</span>
    <span class="token comment">/*属性*/</span>
   <span class="token punctuation">}</span>
</code></pre></div></li> <li><p>就是要注意,所有这个拓展类中的函数使用都必须加$this.</p></li></ul> <hr> <ul><li><p>在接口中如果要使用那些系统中的函数以及我们自己编写的<code>extendClass</code>中的函数,需要特别处理</p></li> <li><p>因为首先接口文件不是Class文件,所以不能extend基类.</p></li> <li><p>该怎么做呢?一共有两种方法</p> <ol><li><p>第一种是在接口最开头写一个简单类,在类中<code>use extendClass</code>,然后在下方实例化这个类,就可以用这个类引用拓展的方法了.</p> <div class="language-php extra-class"><pre class="language-php"><code><span class="token keyword">require</span> <span class="token punctuation">(</span><span class="token string double-quoted-string">&quot;../../extendClass.php&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">class</span> <span class="token class-name-definition class-name">extend</span><span class="token punctuation">{</span>
    <span class="token keyword">use</span> <span class="token package">extendClass</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token variable">$ex</span> <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">extend</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token variable">$ex</span><span class="token operator">-&gt;</span><span class="token function">sqlQuery</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><p>当然,那些基类中的方法只需要引入base.php文件即可.</p> <div class="language-php extra-class"><pre class="language-php"><code><span class="token keyword">require</span> <span class="token punctuation">(</span><span class="token string double-quoted-string">&quot;../../control/base.php&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div></li> <li><p>第二种则是把接口写成类,然后把原先接口中的所有代码放到类中的一个函数中,在结尾echo这个类的实例化.当然,是在类外面echo;</p> <div class="language-php extra-class"><pre class="language-php"><code><span class="token keyword">require</span> <span class="token punctuation">(</span><span class="token string double-quoted-string">&quot;../../extendClass.php&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">class</span> 接口<span class="token keyword">Class</span><span class="token punctuation">{</span>
	<span class="token keyword">use</span> <span class="token package">extendClass</span><span class="token punctuation">;</span>
    
    <span class="token keyword">function</span> 接口<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
        <span class="token comment">//原先接口中的代码放在这里</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
$接口 <span class="token operator">=</span> <span class="token keyword">new</span> 接口<span class="token keyword">Class</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">echo</span> $接口<span class="token operator">-&gt;</span>接口<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div></li></ol></li></ul> <hr> <h2 id="跳转"><a href="#跳转" class="header-anchor">#</a> 跳转</h2> <ul><li><p>使用连接调用方法的时候,最新的框架要这样</p> <div class="language-php extra-class"><pre class="language-php"><code><span class="token variable">$postUrl</span> <span class="token operator">=</span> root <span class="token operator">.</span> <span class="token string double-quoted-string">&quot;control/adIndex.php?cla=&quot;</span><span class="token operator">.</span><span class="token variable">$this</span><span class="token operator">-&gt;</span><span class="token property">get</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'cla'</span><span class="token punctuation">]</span><span class="token operator">.</span><span class="token string double-quoted-string">&quot;&amp;fun=kehuExport&quot;</span><span class="token punctuation">;</span>  <span class="token comment">//导出的url</span>
<span class="token comment">//所有的跳转都要跳到基类才可以,然后cla都是用这个this的,这就自动拿到类名,之后想调用哪个函数就fun=函数名,就会自动调用当前类的那个函数</span>
</code></pre></div></li></ul> <h2 id="分支"><a href="#分支" class="header-anchor">#</a> 分支</h2> <ul><li><p>现在最新框架详情页的分支可以直接用其他类中的页面,这样自然也就解决了分支页面中搜索框不好写的问题.</p></li> <li><p>首先是在主要类的detail中配置menu,用数组就可以引入其他类</p> <div class="language-php extra-class"><pre class="language-php"><code><span class="token string double-quoted-string">&quot;menu&quot;</span> <span class="token operator">=&gt;</span> <span class="token keyword">array</span><span class="token punctuation">(</span>
    <span class="token string double-quoted-string">&quot;edit&quot;</span> <span class="token operator">=&gt;</span> <span class="token string double-quoted-string">&quot;基本信息&quot;</span><span class="token punctuation">,</span>
    <span class="token string double-quoted-string">&quot;account&quot;</span> <span class="token operator">=&gt;</span> <span class="token keyword">array</span><span class="token punctuation">(</span><span class="token string double-quoted-string">&quot;name&quot;</span> <span class="token operator">=&gt;</span> <span class="token string double-quoted-string">&quot;商品规格&quot;</span><span class="token punctuation">,</span><span class="token string double-quoted-string">&quot;cla&quot;</span> <span class="token operator">=&gt;</span> <span class="token string double-quoted-string">&quot;goodsSize&quot;</span><span class="token punctuation">,</span><span class="token string double-quoted-string">&quot;fun&quot;</span> <span class="token operator">=&gt;</span> <span class="token string double-quoted-string">&quot;goodsSizeAction&quot;</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
<span class="token punctuation">)</span><span class="token punctuation">,</span>
</code></pre></div></li> <li><p>然后创建对应的类名的类,进入之后这里填的方法名fun就是搜索栏的函数,表格顶部按钮需要自己写一个方法,方法最后return到列表函数中.</p> <div class="language-php extra-class"><pre class="language-php"><code><span class="token comment">//**行政人事-员工管理-页卡-会计账户**//</span>
<span class="token keyword">public</span> <span class="token keyword">function</span> <span class="token function-definition function">goodsSizeAction</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
    <span class="token variable">$html</span> <span class="token operator">=</span>
        <span class="token function">text</span><span class="token punctuation">(</span><span class="token keyword">array</span><span class="token punctuation">(</span><span class="token string double-quoted-string">&quot;name&quot;</span> <span class="token operator">=&gt;</span> <span class="token string double-quoted-string">&quot;sName&quot;</span><span class="token punctuation">,</span><span class="token string double-quoted-string">&quot;title&quot;</span> <span class="token operator">=&gt;</span> <span class="token string double-quoted-string">&quot;规格名称&quot;</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token operator">.</span>
        <span class="token function">hidden</span><span class="token punctuation">(</span><span class="token keyword">array</span><span class="token punctuation">(</span><span class="token string double-quoted-string">&quot;name&quot;</span> <span class="token operator">=&gt;</span> <span class="token string double-quoted-string">&quot;id&quot;</span><span class="token punctuation">,</span><span class="token string double-quoted-string">&quot;value&quot;</span> <span class="token operator">=&gt;</span> <span class="token variable">$this</span><span class="token operator">-&gt;</span><span class="token property">get</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'id'</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token variable">$json</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'html'</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token variable">$this</span><span class="token operator">-&gt;</span><span class="token function">search</span><span class="token punctuation">(</span><span class="token variable">$html</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">return</span> <span class="token function">json_encode</span><span class="token punctuation">(</span><span class="token variable">$json</span><span class="token punctuation">,</span><span class="token number">320</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
<span class="token comment">/*行政人事-员工管理-员工会计账户-列表*/</span>
<span class="token keyword">public</span> <span class="token keyword">function</span> <span class="token function-definition function">goodsSizeActionSearch</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
    <span class="token comment">//查询对象</span>
    <span class="token variable">$data</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'goodsId'</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token variable">$this</span><span class="token operator">-&gt;</span><span class="token property">post</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'id'</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
    <span class="token variable">$data</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'button'</span><span class="token punctuation">]</span> <span class="token operator">.=</span> <span class="token variable">$this</span><span class="token operator">-&gt;</span><span class="token function">checkAll</span><span class="token punctuation">(</span><span class="token string double-quoted-string">&quot;listForm&quot;</span><span class="token punctuation">,</span><span class="token string double-quoted-string">&quot;check&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token comment">//控件</span>
    <span class="token variable">$sizeArr</span> <span class="token operator">=</span> <span class="token function">query</span><span class="token punctuation">(</span><span class="token string double-quoted-string">&quot;size&quot;</span><span class="token punctuation">,</span><span class="token string double-quoted-string">&quot; gId = '&quot;</span><span class="token operator">.</span><span class="token variable">$this</span><span class="token operator">-&gt;</span><span class="token property">post</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'id'</span><span class="token punctuation">]</span><span class="token operator">.</span><span class="token string double-quoted-string">&quot;' &quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">//查到对应商品的所以规格</span>
    <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token function">power</span><span class="token punctuation">(</span><span class="token string double-quoted-string">&quot;goodsList&quot;</span><span class="token punctuation">,</span><span class="token string double-quoted-string">&quot;edit&quot;</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
        <span class="token variable">$data</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'button'</span><span class="token punctuation">]</span> <span class="token operator">.=</span> <span class="token string double-quoted-string">&quot;&lt;span class='spanButton' title='新建规格' onclick=\&quot;layer('goodsSize','goodsSizeEdit',{goodsId:'&quot;</span><span class="token operator">.</span><span class="token variable">$data</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'goodsId'</span><span class="token punctuation">]</span><span class="token operator">.</span><span class="token string double-quoted-string">&quot;'})\&quot;&gt;新建规格&lt;/span&gt;&quot;</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token function">power</span><span class="token punctuation">(</span><span class="token string double-quoted-string">&quot;goodsList&quot;</span><span class="token punctuation">,</span><span class="token string double-quoted-string">&quot;del&quot;</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
        <span class="token variable">$data</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'button'</span><span class="token punctuation">]</span> <span class="token operator">.=</span> <span class="token string double-quoted-string">&quot;&lt;span onclick=\&quot;pasWarn('listForm','delSize')\&quot; class='spanButton'&gt;删除所选&lt;/span&gt;\n&quot;</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token comment">//返回</span>
    <span class="token keyword">return</span> <span class="token variable">$this</span><span class="token operator">-&gt;</span><span class="token function">accountList</span><span class="token punctuation">(</span><span class="token variable">$data</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
<span class="token comment">/*员工会计账户-列表页函数*/</span>
<span class="token keyword">public</span> <span class="token keyword">function</span> <span class="token function-definition function">accountList</span><span class="token punctuation">(</span><span class="token variable">$data</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
    <span class="token comment">//like查询数组</span>
    <span class="token variable">$like</span> <span class="token operator">=</span> <span class="token keyword">array</span><span class="token punctuation">(</span>
        <span class="token string double-quoted-string">&quot;sName&quot;</span> <span class="token operator">=&gt;</span> <span class="token variable">$this</span><span class="token operator">-&gt;</span><span class="token property">post</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'sName'</span><span class="token punctuation">]</span><span class="token punctuation">,</span><span class="token comment">//规格名称</span>
    <span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token comment">//生成查询语句</span>
    <span class="token variable">$where</span> <span class="token operator">=</span> <span class="token function">search</span><span class="token punctuation">(</span><span class="token keyword">array</span><span class="token punctuation">(</span><span class="token string double-quoted-string">&quot;like&quot;</span> <span class="token operator">=&gt;</span> <span class="token variable">$like</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token comment">//获取查询结果</span>
    <span class="token variable">$sql</span> <span class="token operator">=</span> <span class="token string double-quoted-string">&quot; select * from size where gId='<span class="token interpolation"><span class="token punctuation">{</span><span class="token variable">$data</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'goodsId'</span><span class="token punctuation">]</span><span class="token punctuation">}</span></span>' &quot;</span><span class="token operator">.</span><span class="token variable">$where</span><span class="token operator">.</span><span class="token string double-quoted-string">&quot; order by time desc &quot;</span><span class="token punctuation">;</span>
    <span class="token variable">$page</span> <span class="token operator">=</span> <span class="token variable">$this</span><span class="token operator">-&gt;</span><span class="token function">page</span><span class="token punctuation">(</span><span class="token keyword">array</span><span class="token punctuation">(</span><span class="token string double-quoted-string">&quot;cla&quot;</span> <span class="token operator">=&gt;</span> <span class="token variable">$this</span><span class="token operator">-&gt;</span><span class="token property">get</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'cla'</span><span class="token punctuation">]</span><span class="token punctuation">,</span><span class="token string double-quoted-string">&quot;fun&quot;</span> <span class="token operator">=&gt;</span> <span class="token variable">$this</span><span class="token operator">-&gt;</span><span class="token property">get</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'fun'</span><span class="token punctuation">]</span><span class="token punctuation">,</span><span class="token string double-quoted-string">&quot;sql&quot;</span> <span class="token operator">=&gt;</span> <span class="token variable">$sql</span><span class="token punctuation">,</span><span class="token string double-quoted-string">&quot;pageGet&quot;</span> <span class="token operator">=&gt;</span> <span class="token variable">$this</span><span class="token operator">-&gt;</span><span class="token property">get</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'page'</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token comment">//获取表头</span>
    <span class="token variable">$tr</span><span class="token punctuation">[</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token keyword">array</span><span class="token punctuation">(</span><span class="token string double-quoted-string">&quot;&quot;</span><span class="token punctuation">,</span><span class="token string double-quoted-string">&quot;规格名称&quot;</span><span class="token punctuation">,</span><span class="token string double-quoted-string">&quot;单位&quot;</span><span class="token punctuation">,</span><span class="token string double-quoted-string">&quot;零售价&quot;</span><span class="token punctuation">,</span><span class="token string double-quoted-string">&quot;成本&quot;</span><span class="token punctuation">,</span><span class="token string double-quoted-string">&quot;库存数量&quot;</span><span class="token punctuation">,</span><span class="token string double-quoted-string">&quot;已销售数量&quot;</span><span class="token punctuation">,</span><span class="token string double-quoted-string">&quot;剩余库存数量&quot;</span><span class="token punctuation">,</span><span class="token string double-quoted-string">&quot;默认规格（是/否）&quot;</span><span class="token punctuation">,</span><span class="token string double-quoted-string">&quot;起购值&quot;</span><span class="token punctuation">,</span><span class="token string double-quoted-string">&quot;更新时间&quot;</span><span class="token punctuation">,</span><span class="token string double-quoted-string">&quot;操作&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token comment">//获取记录</span>
    <span class="token keyword">foreach</span><span class="token punctuation">(</span><span class="token variable">$page</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'sql'</span><span class="token punctuation">]</span> <span class="token keyword">as</span> <span class="token variable">$array</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
        <span class="token variable">$mx</span> <span class="token operator">=</span> <span class="token string double-quoted-string">&quot;&lt;span class='spanButton' title='规格详情' onclick=\&quot;layer('goodsSize','goodsSizeEdit',{id:'&quot;</span><span class="token operator">.</span><span class="token variable">$array</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'id'</span><span class="token punctuation">]</span><span class="token operator">.</span><span class="token string double-quoted-string">&quot;',goodsId:'&quot;</span><span class="token operator">.</span><span class="token variable">$data</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'goodsId'</span><span class="token punctuation">]</span><span class="token operator">.</span><span class="token string double-quoted-string">&quot;'})\&quot;&gt;详情&lt;/span&gt;&quot;</span><span class="token punctuation">;</span>
        <span class="token variable">$checkbox</span>  <span class="token operator">=</span> <span class="token string double-quoted-string">&quot;&lt;input name='check[]' type='checkbox' value='&quot;</span><span class="token operator">.</span><span class="token variable">$array</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'id'</span><span class="token punctuation">]</span><span class="token operator">.</span><span class="token string double-quoted-string">&quot;'/&gt;&quot;</span><span class="token punctuation">;</span>
        <span class="token variable">$tr</span><span class="token punctuation">[</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token keyword">array</span><span class="token punctuation">(</span><span class="token variable">$checkbox</span><span class="token punctuation">,</span><span class="token variable">$array</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'sName'</span><span class="token punctuation">]</span><span class="token punctuation">,</span><span class="token variable">$array</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'unit'</span><span class="token punctuation">]</span><span class="token punctuation">,</span><span class="token variable">$array</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'price'</span><span class="token punctuation">]</span><span class="token punctuation">,</span><span class="token variable">$array</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'cost'</span><span class="token punctuation">]</span><span class="token punctuation">,</span><span class="token variable">$array</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'inventory'</span><span class="token punctuation">]</span><span class="token punctuation">,</span><span class="token variable">$array</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'selled'</span><span class="token punctuation">]</span><span class="token punctuation">,</span><span class="token variable">$array</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'inventory'</span><span class="token punctuation">]</span><span class="token operator">-</span><span class="token variable">$array</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'selled'</span><span class="token punctuation">]</span><span class="token punctuation">,</span><span class="token variable">$array</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'defaults'</span><span class="token punctuation">]</span><span class="token punctuation">,</span><span class="token variable">$array</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'buyOn'</span><span class="token punctuation">]</span><span class="token punctuation">,</span><span class="token variable">$array</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'updateTime'</span><span class="token punctuation">]</span><span class="token punctuation">,</span><span class="token variable">$mx</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token comment">//返回</span>
    <span class="token variable">$json</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'html'</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token variable">$page</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'hint'</span><span class="token punctuation">]</span><span class="token operator">.</span><span class="token variable">$data</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'button'</span><span class="token punctuation">]</span><span class="token operator">.</span><span class="token string double-quoted-string">&quot;&lt;form name='listForm'&gt;&quot;</span><span class="token operator">.</span>space<span class="token operator">.</span><span class="token variable">$this</span><span class="token operator">-&gt;</span><span class="token function">tableMany</span><span class="token punctuation">(</span><span class="token keyword">array</span><span class="token punctuation">(</span><span class="token string double-quoted-string">&quot;tr&quot;</span> <span class="token operator">=&gt;</span> <span class="token variable">$tr</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token operator">.</span><span class="token string double-quoted-string">&quot;&lt;/form&gt;&quot;</span><span class="token operator">.</span><span class="token variable">$page</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'button'</span><span class="token punctuation">]</span><span class="token operator">.</span>clear<span class="token punctuation">;</span>
    <span class="token keyword">return</span> <span class="token function">json_encode</span><span class="token punctuation">(</span><span class="token variable">$json</span><span class="token punctuation">,</span><span class="token number">320</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre></div></li></ul> <hr> <ul><li><p><strong>点击提交回显到详情的具体分支页面</strong></p></li> <li><p>现在如果想自己写详情页的提交按钮并且点击之后跳转到对应的详情分支</p></li> <li><p>首先需要在分支方法最后返回html外层添加form标签,而自己写的按钮应该在form之内</p> <div class="language-php extra-class"><pre class="language-php"><code><span class="token variable">$url</span> <span class="token operator">=</span> root<span class="token operator">.</span><span class="token string double-quoted-string">&quot;control/adIndex.php?cla=onlineOrder&amp;fun=checkReportEdit&amp;id=&quot;</span><span class="token operator">.</span><span class="token variable">$_GET</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'id'</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
<span class="token variable">$json</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'html'</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token string double-quoted-string">&quot;&lt;form name='checkReportForm'&gt;&quot;</span><span class="token operator">.</span><span class="token variable">$this</span><span class="token operator">-&gt;</span><span class="token function">tableEdit</span><span class="token punctuation">(</span><span class="token variable">$trData</span><span class="token punctuation">)</span><span class="token operator">.</span><span class="token string double-quoted-string">&quot;
        &lt;div class='formButton' onclick=\&quot;subForm('checkReportForm','&quot;</span><span class="token operator">.</span><span class="token variable">$url</span><span class="token operator">.</span><span class="token string double-quoted-string">&quot;')\&quot;&gt;
            更新
        &lt;/div&gt;
        &lt;/form&gt;&quot;</span><span class="token punctuation">;</span>
<span class="token keyword">return</span> <span class="token function">json_encode</span><span class="token punctuation">(</span><span class="token variable">$json</span><span class="token punctuation">,</span><span class="token number">320</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div></li> <li><p>然后在类中跳转的数据处理方法中写的链接应该是这样的</p> <div class="language-php extra-class"><pre class="language-php"><code><span class="token variable">$json</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'href'</span><span class="token punctuation">]</span> <span class="token operator">=</span> root<span class="token operator">.</span><span class="token string double-quoted-string">&quot;control/adIndex.php?cla=onlineOrder&amp;fun=detail&amp;id=&quot;</span><span class="token operator">.</span><span class="token variable">$_GET</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'id'</span><span class="token punctuation">]</span><span class="token operator">.</span><span class="token string double-quoted-string">&quot;&amp;menu=checkReport&quot;</span><span class="token punctuation">;</span><span class="token comment">//这里的fun应该写detail</span>
</code></pre></div></li></ul> <hr> <ul><li></li></ul> <h2 id="封装方法"><a href="#封装方法" class="header-anchor">#</a> 封装方法</h2> <h3 id="条件判断"><a href="#条件判断" class="header-anchor">#</a> 条件判断</h3> <ul><li><p>现在最新框架详情页的分支可以直接用其他类中的页面,这样自然也就解决了分支页面中搜索框不好写的问题.</p></li> <li><p>首先是在主要类的detail中配置menu,用数组就可以引入其他类</p> <div class="language-php extra-class"><pre class="language-php"><code> <span class="token string double-quoted-string">&quot;menu&quot;</span> <span class="token operator">=&gt;</span> <span class="token keyword">array</span><span class="token punctuation">(</span>
                    <span class="token string double-quoted-string">&quot;edit&quot;</span> <span class="token operator">=&gt;</span> <span class="token string double-quoted-string">&quot;基本信息&quot;</span><span class="token punctuation">,</span>
                    <span class="token string double-quoted-string">&quot;account&quot;</span> <span class="token operator">=&gt;</span> <span class="token keyword">array</span><span class="token punctuation">(</span><span class="token string double-quoted-string">&quot;name&quot;</span> <span class="token operator">=&gt;</span> <span class="token string double-quoted-string">&quot;商品规格&quot;</span><span class="token punctuation">,</span><span class="token string double-quoted-string">&quot;cla&quot;</span> <span class="token operator">=&gt;</span> <span class="token string double-quoted-string">&quot;goodsSize&quot;</span><span class="token punctuation">,</span><span class="token string double-quoted-string">&quot;fun&quot;</span> <span class="token operator">=&gt;</span> <span class="token string double-quoted-string">&quot;goodsSizeAction&quot;</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
                <span class="token punctuation">)</span><span class="token punctuation">,</span>
</code></pre></div></li> <li><p>然后创建对应的类名的类,进入之后这里填的方法名fun就是搜索栏的函数,表格顶部按钮需要自己写一个方法,方法最后return到列表函数中.</p> <div class="language-php extra-class"><pre class="language-php"><code><span class="token comment">//**行政人事-员工管理-页卡-会计账户**//</span>
    <span class="token keyword">public</span> <span class="token keyword">function</span> <span class="token function-definition function">goodsSizeAction</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
        <span class="token variable">$html</span> <span class="token operator">=</span>
        <span class="token function">text</span><span class="token punctuation">(</span><span class="token keyword">array</span><span class="token punctuation">(</span><span class="token string double-quoted-string">&quot;name&quot;</span> <span class="token operator">=&gt;</span> <span class="token string double-quoted-string">&quot;sName&quot;</span><span class="token punctuation">,</span><span class="token string double-quoted-string">&quot;title&quot;</span> <span class="token operator">=&gt;</span> <span class="token string double-quoted-string">&quot;规格名称&quot;</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token operator">.</span>
        <span class="token function">hidden</span><span class="token punctuation">(</span><span class="token keyword">array</span><span class="token punctuation">(</span><span class="token string double-quoted-string">&quot;name&quot;</span> <span class="token operator">=&gt;</span> <span class="token string double-quoted-string">&quot;id&quot;</span><span class="token punctuation">,</span><span class="token string double-quoted-string">&quot;value&quot;</span> <span class="token operator">=&gt;</span> <span class="token variable">$this</span><span class="token operator">-&gt;</span><span class="token property">get</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'id'</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token variable">$json</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'html'</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token variable">$this</span><span class="token operator">-&gt;</span><span class="token function">search</span><span class="token punctuation">(</span><span class="token variable">$html</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">return</span> <span class="token function">json_encode</span><span class="token punctuation">(</span><span class="token variable">$json</span><span class="token punctuation">,</span><span class="token number">320</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token comment">/*行政人事-员工管理-员工会计账户-列表*/</span>
    <span class="token keyword">public</span> <span class="token keyword">function</span> <span class="token function-definition function">goodsSizeActionSearch</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
        <span class="token comment">//查询对象</span>
        <span class="token variable">$data</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'goodsId'</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token variable">$this</span><span class="token operator">-&gt;</span><span class="token property">post</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'id'</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
        <span class="token variable">$data</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'button'</span><span class="token punctuation">]</span> <span class="token operator">.=</span> <span class="token variable">$this</span><span class="token operator">-&gt;</span><span class="token function">checkAll</span><span class="token punctuation">(</span><span class="token string double-quoted-string">&quot;listForm&quot;</span><span class="token punctuation">,</span><span class="token string double-quoted-string">&quot;check&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">//控件</span>
        <span class="token variable">$sizeArr</span> <span class="token operator">=</span> <span class="token function">query</span><span class="token punctuation">(</span><span class="token string double-quoted-string">&quot;size&quot;</span><span class="token punctuation">,</span><span class="token string double-quoted-string">&quot; gId = '&quot;</span><span class="token operator">.</span><span class="token variable">$this</span><span class="token operator">-&gt;</span><span class="token property">post</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'id'</span><span class="token punctuation">]</span><span class="token operator">.</span><span class="token string double-quoted-string">&quot;' &quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">//查到对应商品的所以规格</span>
        <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token function">power</span><span class="token punctuation">(</span><span class="token string double-quoted-string">&quot;goodsList&quot;</span><span class="token punctuation">,</span><span class="token string double-quoted-string">&quot;edit&quot;</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
            <span class="token variable">$data</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'button'</span><span class="token punctuation">]</span> <span class="token operator">.=</span> <span class="token string double-quoted-string">&quot;&lt;span class='spanButton' title='新建规格' onclick=\&quot;layer('goodsSize','goodsSizeEdit',{goodsId:'&quot;</span><span class="token operator">.</span><span class="token variable">$data</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'goodsId'</span><span class="token punctuation">]</span><span class="token operator">.</span><span class="token string double-quoted-string">&quot;'})\&quot;&gt;新建规格&lt;/span&gt;&quot;</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
        <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token function">power</span><span class="token punctuation">(</span><span class="token string double-quoted-string">&quot;goodsList&quot;</span><span class="token punctuation">,</span><span class="token string double-quoted-string">&quot;del&quot;</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
            <span class="token variable">$data</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'button'</span><span class="token punctuation">]</span> <span class="token operator">.=</span> <span class="token string double-quoted-string">&quot;&lt;span onclick=\&quot;pasWarn('listForm','delSize')\&quot; class='spanButton'&gt;删除所选&lt;/span&gt;\n&quot;</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
        <span class="token comment">//返回</span>
        <span class="token keyword">return</span> <span class="token variable">$this</span><span class="token operator">-&gt;</span><span class="token function">accountList</span><span class="token punctuation">(</span><span class="token variable">$data</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token comment">/*员工会计账户-列表页函数*/</span>
    <span class="token keyword">public</span> <span class="token keyword">function</span> <span class="token function-definition function">accountList</span><span class="token punctuation">(</span><span class="token variable">$data</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
        <span class="token comment">//like查询数组</span>
        <span class="token variable">$like</span> <span class="token operator">=</span> <span class="token keyword">array</span><span class="token punctuation">(</span>
            <span class="token string double-quoted-string">&quot;sName&quot;</span> <span class="token operator">=&gt;</span> <span class="token variable">$this</span><span class="token operator">-&gt;</span><span class="token property">post</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'sName'</span><span class="token punctuation">]</span><span class="token punctuation">,</span><span class="token comment">//规格名称</span>
        <span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">//生成查询语句</span>
        <span class="token variable">$where</span> <span class="token operator">=</span> <span class="token function">search</span><span class="token punctuation">(</span><span class="token keyword">array</span><span class="token punctuation">(</span><span class="token string double-quoted-string">&quot;like&quot;</span> <span class="token operator">=&gt;</span> <span class="token variable">$like</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">//获取查询结果</span>
        <span class="token variable">$sql</span> <span class="token operator">=</span> <span class="token string double-quoted-string">&quot; select * from size where gId='<span class="token interpolation"><span class="token punctuation">{</span><span class="token variable">$data</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'goodsId'</span><span class="token punctuation">]</span><span class="token punctuation">}</span></span>' &quot;</span><span class="token operator">.</span><span class="token variable">$where</span><span class="token operator">.</span><span class="token string double-quoted-string">&quot; order by time desc &quot;</span><span class="token punctuation">;</span>
        <span class="token variable">$page</span> <span class="token operator">=</span> <span class="token variable">$this</span><span class="token operator">-&gt;</span><span class="token function">page</span><span class="token punctuation">(</span><span class="token keyword">array</span><span class="token punctuation">(</span><span class="token string double-quoted-string">&quot;cla&quot;</span> <span class="token operator">=&gt;</span> <span class="token variable">$this</span><span class="token operator">-&gt;</span><span class="token property">get</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'cla'</span><span class="token punctuation">]</span><span class="token punctuation">,</span><span class="token string double-quoted-string">&quot;fun&quot;</span> <span class="token operator">=&gt;</span> <span class="token variable">$this</span><span class="token operator">-&gt;</span><span class="token property">get</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'fun'</span><span class="token punctuation">]</span><span class="token punctuation">,</span><span class="token string double-quoted-string">&quot;sql&quot;</span> <span class="token operator">=&gt;</span> <span class="token variable">$sql</span><span class="token punctuation">,</span><span class="token string double-quoted-string">&quot;pageGet&quot;</span> <span class="token operator">=&gt;</span> <span class="token variable">$this</span><span class="token operator">-&gt;</span><span class="token property">get</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'page'</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">//获取表头</span>
        <span class="token variable">$tr</span><span class="token punctuation">[</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token keyword">array</span><span class="token punctuation">(</span><span class="token string double-quoted-string">&quot;&quot;</span><span class="token punctuation">,</span><span class="token string double-quoted-string">&quot;规格名称&quot;</span><span class="token punctuation">,</span><span class="token string double-quoted-string">&quot;单位&quot;</span><span class="token punctuation">,</span><span class="token string double-quoted-string">&quot;零售价&quot;</span><span class="token punctuation">,</span><span class="token string double-quoted-string">&quot;成本&quot;</span><span class="token punctuation">,</span><span class="token string double-quoted-string">&quot;库存数量&quot;</span><span class="token punctuation">,</span><span class="token string double-quoted-string">&quot;已销售数量&quot;</span><span class="token punctuation">,</span><span class="token string double-quoted-string">&quot;剩余库存数量&quot;</span><span class="token punctuation">,</span><span class="token string double-quoted-string">&quot;默认规格（是/否）&quot;</span><span class="token punctuation">,</span><span class="token string double-quoted-string">&quot;起购值&quot;</span><span class="token punctuation">,</span><span class="token string double-quoted-string">&quot;更新时间&quot;</span><span class="token punctuation">,</span><span class="token string double-quoted-string">&quot;操作&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">//获取记录</span>
        <span class="token keyword">foreach</span><span class="token punctuation">(</span><span class="token variable">$page</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'sql'</span><span class="token punctuation">]</span> <span class="token keyword">as</span> <span class="token variable">$array</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
            <span class="token variable">$mx</span> <span class="token operator">=</span> <span class="token string double-quoted-string">&quot;&lt;span class='spanButton' title='规格详情' onclick=\&quot;layer('goodsSize','goodsSizeEdit',{id:'&quot;</span><span class="token operator">.</span><span class="token variable">$array</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'id'</span><span class="token punctuation">]</span><span class="token operator">.</span><span class="token string double-quoted-string">&quot;',goodsId:'&quot;</span><span class="token operator">.</span><span class="token variable">$data</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'goodsId'</span><span class="token punctuation">]</span><span class="token operator">.</span><span class="token string double-quoted-string">&quot;'})\&quot;&gt;详情&lt;/span&gt;&quot;</span><span class="token punctuation">;</span>
            <span class="token variable">$checkbox</span>  <span class="token operator">=</span> <span class="token string double-quoted-string">&quot;&lt;input name='check[]' type='checkbox' value='&quot;</span><span class="token operator">.</span><span class="token variable">$array</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'id'</span><span class="token punctuation">]</span><span class="token operator">.</span><span class="token string double-quoted-string">&quot;'/&gt;&quot;</span><span class="token punctuation">;</span>
            <span class="token variable">$tr</span><span class="token punctuation">[</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token keyword">array</span><span class="token punctuation">(</span><span class="token variable">$checkbox</span><span class="token punctuation">,</span><span class="token variable">$array</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'sName'</span><span class="token punctuation">]</span><span class="token punctuation">,</span><span class="token variable">$array</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'unit'</span><span class="token punctuation">]</span><span class="token punctuation">,</span><span class="token variable">$array</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'price'</span><span class="token punctuation">]</span><span class="token punctuation">,</span><span class="token variable">$array</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'cost'</span><span class="token punctuation">]</span><span class="token punctuation">,</span><span class="token variable">$array</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'inventory'</span><span class="token punctuation">]</span><span class="token punctuation">,</span><span class="token variable">$array</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'selled'</span><span class="token punctuation">]</span><span class="token punctuation">,</span><span class="token variable">$array</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'inventory'</span><span class="token punctuation">]</span><span class="token operator">-</span><span class="token variable">$array</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'selled'</span><span class="token punctuation">]</span><span class="token punctuation">,</span><span class="token variable">$array</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'defaults'</span><span class="token punctuation">]</span><span class="token punctuation">,</span><span class="token variable">$array</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'buyOn'</span><span class="token punctuation">]</span><span class="token punctuation">,</span><span class="token variable">$array</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'updateTime'</span><span class="token punctuation">]</span><span class="token punctuation">,</span><span class="token variable">$mx</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
        <span class="token comment">//返回</span>
        <span class="token variable">$json</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'html'</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token variable">$page</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'hint'</span><span class="token punctuation">]</span><span class="token operator">.</span><span class="token variable">$data</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'button'</span><span class="token punctuation">]</span><span class="token operator">.</span><span class="token string double-quoted-string">&quot;&lt;form name='listForm'&gt;&quot;</span><span class="token operator">.</span>space<span class="token operator">.</span><span class="token variable">$this</span><span class="token operator">-&gt;</span><span class="token function">tableMany</span><span class="token punctuation">(</span><span class="token keyword">array</span><span class="token punctuation">(</span><span class="token string double-quoted-string">&quot;tr&quot;</span> <span class="token operator">=&gt;</span> <span class="token variable">$tr</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token operator">.</span><span class="token string double-quoted-string">&quot;&lt;/form&gt;&quot;</span><span class="token operator">.</span><span class="token variable">$page</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'button'</span><span class="token punctuation">]</span><span class="token operator">.</span>clear<span class="token punctuation">;</span>
        <span class="token keyword">return</span> <span class="token function">json_encode</span><span class="token punctuation">(</span><span class="token variable">$json</span><span class="token punctuation">,</span><span class="token number">320</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
</code></pre></div></li></ul> <hr> <ul><li><p>有时候会遇到需要判断当前多选删除的数据是否有其他关联数据,如果有则不能删除,封装如下方法可以使用.</p> <div class="language-php extra-class"><pre class="language-php"><code><span class="token comment">/*************判断当前要删除的东西有没有其他的关联数据****************/</span>

<span class="token comment">/**
     * @param $data
     *          $data['id']:传过来的id数组,因为是多选删除
     *          $data['table']:需要去搜索的表名,也就是可能和要删除的数据有关联的那张表
     *          $data['idName']:需要去搜索的表中的你要删除的数据的ID字段名
     * @return bool 为false则表示没有关联数据,可以删除,否则就不能删除
     */</span>
<span class="token keyword">public</span> <span class="token keyword">function</span> <span class="token function-definition function">haveOtherData</span><span class="token punctuation">(</span><span class="token variable">$data</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
    <span class="token variable">$num</span> <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>
    <span class="token keyword">foreach</span> <span class="token punctuation">(</span><span class="token variable">$data</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'id'</span><span class="token punctuation">]</span> <span class="token keyword">as</span> <span class="token variable">$id</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
        <span class="token variable">$selectResult</span> <span class="token operator">=</span> <span class="token variable">$this</span><span class="token operator">-&gt;</span><span class="token function">sqlQueryAll</span><span class="token punctuation">(</span><span class="token string double-quoted-string">&quot;select * from &quot;</span><span class="token operator">.</span><span class="token variable">$data</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'table'</span><span class="token punctuation">]</span><span class="token operator">.</span><span class="token string double-quoted-string">&quot; where &quot;</span><span class="token operator">.</span><span class="token variable">$data</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'idName'</span><span class="token punctuation">]</span><span class="token operator">.</span><span class="token string double-quoted-string">&quot; = '<span class="token interpolation"><span class="token variable">$id</span></span>'&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token function">count</span><span class="token punctuation">(</span><span class="token variable">$selectResult</span><span class="token punctuation">)</span><span class="token operator">==</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
            <span class="token variable">$num</span><span class="token operator">++</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
    <span class="token keyword">return</span> <span class="token variable">$result</span> <span class="token operator">=</span> <span class="token function">count</span><span class="token punctuation">(</span><span class="token variable">$data</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'id'</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token operator">==</span><span class="token variable">$num</span><span class="token operator">?</span><span class="token constant boolean">false</span><span class="token punctuation">:</span><span class="token constant boolean">true</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre></div></li></ul> <h2 id="模块显示"><a href="#模块显示" class="header-anchor">#</a> 模块显示</h2> <ul><li><p>如果想直接点开左侧菜单就打开详情页这种页面,那就不需要在class里写home和homesearch</p></li> <li><p>直接写detail函数,然后关键的是需要去configer里配置.</p> <div class="language-php extra-class"><pre class="language-php"><code><span class="token string double-quoted-string">&quot;店铺管理&quot;</span> <span class="token operator">=&gt;</span> <span class="token keyword">array</span><span class="token punctuation">(</span>
    <span class="token string double-quoted-string">&quot;shop&quot;</span> <span class="token operator">=&gt;</span> <span class="token keyword">array</span><span class="token punctuation">(</span>
        <span class="token string double-quoted-string">&quot;name&quot;</span> <span class="token operator">=&gt;</span> <span class="token string double-quoted-string">&quot;店铺管理&quot;</span><span class="token punctuation">,</span>
        <span class="token string double-quoted-string">&quot;see&quot;</span> <span class="token operator">=&gt;</span> <span class="token string double-quoted-string">&quot;查询自己&quot;</span><span class="token punctuation">,</span>
        <span class="token string double-quoted-string">&quot;seeAll&quot;</span> <span class="token operator">=&gt;</span> <span class="token string double-quoted-string">&quot;查询所有&quot;</span><span class="token punctuation">,</span>
        <span class="token string double-quoted-string">&quot;edit&quot;</span> <span class="token operator">=&gt;</span> <span class="token string double-quoted-string">&quot;编辑&quot;</span><span class="token punctuation">,</span>
        <span class="token string double-quoted-string">&quot;cla&quot;</span> <span class="token operator">=&gt;</span> <span class="token string double-quoted-string">&quot;shop&quot;</span><span class="token punctuation">,</span>
        <span class="token string double-quoted-string">&quot;fun&quot;</span> <span class="token operator">=&gt;</span> <span class="token string double-quoted-string">&quot;detail&quot;</span><span class="token punctuation">,</span>
    <span class="token punctuation">)</span><span class="token punctuation">,</span>
<span class="token punctuation">)</span><span class="token punctuation">,</span>
<span class="token comment">//这里需要添加两个数组元素,一个是cla,一个是fun,cla是类名,fun是进入这个页面时调用的函数名</span>
<span class="token comment">//所以直接把fun定义为detail,然后去类中写好detail方法就可以在点击左侧菜单的时候直接跳转进detail页面,注意函数中跳转链接也都要写成跳转到detail</span>
<span class="token variable">$root</span> <span class="token operator">=</span> root<span class="token operator">.</span><span class="token string double-quoted-string">&quot;control/adIndex.php?cla=shop&amp;fun=detail&quot;</span><span class="token punctuation">;</span>
</code></pre></div></li></ul> <h2 id="图片上传"><a href="#图片上传" class="header-anchor">#</a> 图片上传</h2> <ul><li><p>新框架图片上传分两种情况</p> <ul><li><p>图片URL存在某个表的其中一个字段</p> <div class="language-php extra-class"><pre class="language-php"><code><span class="token variable">$listPic</span><span class="token punctuation">[</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token string double-quoted-string">&quot;title&quot;</span> <span class="token operator">=&gt;</span> <span class="token string double-quoted-string">&quot;列表图像&quot;</span><span class="token punctuation">,</span><span class="token comment">//上传框题目</span>
              <span class="token string double-quoted-string">&quot;url&quot;</span> <span class="token operator">=&gt;</span> <span class="token variable">$listPicData</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'url'</span><span class="token punctuation">]</span><span class="token punctuation">,</span><span class="token comment">//图片url</span>
              <span class="token string double-quoted-string">&quot;name&quot;</span> <span class="token operator">=&gt;</span> <span class="token string double-quoted-string">&quot;commodityList&quot;</span><span class="token punctuation">,</span><span class="token comment">//类名</span>
              <span class="token string double-quoted-string">&quot;fun&quot;</span> <span class="token operator">=&gt;</span> <span class="token string double-quoted-string">&quot;listPic&quot;</span><span class="token punctuation">,</span><span class="token comment">//函数名</span>
              <span class="token string double-quoted-string">&quot;id&quot;</span> <span class="token operator">=&gt;</span> <span class="token variable">$commodity</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'id'</span><span class="token punctuation">]</span><span class="token punctuation">,</span><span class="token punctuation">]</span><span class="token punctuation">;</span><span class="token comment">//存储url的数据的id</span>
<span class="token comment">//需要把这个数组放进photo方法</span>
<span class="token operator">&lt;</span>span <span class="token keyword">class</span><span class="token operator">=</span><span class="token string single-quoted-string">'listPic'</span><span class="token operator">&gt;</span>
    <span class="token string double-quoted-string">&quot;.<span class="token interpolation"><span class="token variable">$this</span><span class="token operator">-&gt;</span><span class="token property">photo</span></span>(<span class="token interpolation"><span class="token variable">$listPic</span></span>).&quot;</span>
    <span class="token operator">&lt;</span><span class="token operator">/</span>span<span class="token operator">&gt;</span>

</code></pre></div><div class="language-php extra-class"><pre class="language-php"><code><span class="token comment">/*上传橱窗图片*/</span>
<span class="token comment">//这个就是上面数组中指向的类中指向的函数</span>
<span class="token keyword">public</span> <span class="token keyword">function</span> <span class="token function-definition function">listPic</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
    <span class="token comment">//赋值</span>
    <span class="token variable">$id</span> <span class="token operator">=</span> <span class="token variable">$this</span><span class="token operator">-&gt;</span><span class="token property">post</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'id'</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
    <span class="token variable">$commodity</span> <span class="token operator">=</span> <span class="token function">query</span><span class="token punctuation">(</span><span class="token string double-quoted-string">&quot;commodity&quot;</span><span class="token punctuation">,</span><span class="token string double-quoted-string">&quot;id = '<span class="token interpolation"><span class="token variable">$id</span></span>'&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token variable">$listPic</span> <span class="token operator">=</span> <span class="token function">query</span><span class="token punctuation">(</span><span class="token string double-quoted-string">&quot;listPic&quot;</span><span class="token punctuation">,</span><span class="token string double-quoted-string">&quot; commodityId = '<span class="token interpolation"><span class="token variable">$id</span></span>' &quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token comment">//判断</span>
    <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token operator">!</span><span class="token function">power</span><span class="token punctuation">(</span><span class="token string double-quoted-string">&quot;commodityList&quot;</span><span class="token punctuation">,</span><span class="token string double-quoted-string">&quot;edit&quot;</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
        <span class="token variable">$warn</span> <span class="token operator">=</span> <span class="token string double-quoted-string">&quot;您没有编辑商品列表图片的权限&quot;</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span><span class="token keyword">else</span><span class="token punctuation">{</span>
        <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token keyword">empty</span><span class="token punctuation">(</span><span class="token variable">$listPic</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'id'</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
            <span class="token variable">$para</span> <span class="token operator">=</span> <span class="token keyword">array</span><span class="token punctuation">(</span>
                <span class="token string double-quoted-string">&quot;id&quot;</span> <span class="token operator">=&gt;</span> <span class="token function">suiji</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
                <span class="token string double-quoted-string">&quot;commodityId&quot;</span> <span class="token operator">=&gt;</span> <span class="token variable">$commodity</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'id'</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
                <span class="token string double-quoted-string">&quot;time&quot;</span> <span class="token operator">=&gt;</span> <span class="token function">date</span><span class="token punctuation">(</span><span class="token string double-quoted-string">&quot;Y-m-d H:i:s&quot;</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
                <span class="token string double-quoted-string">&quot;updateTime&quot;</span> <span class="token operator">=&gt;</span> <span class="token function">date</span><span class="token punctuation">(</span><span class="token string double-quoted-string">&quot;Y-m-d H:i:s&quot;</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
            <span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token variable">$insert</span> <span class="token operator">=</span> <span class="token function">insert</span><span class="token punctuation">(</span><span class="token keyword">array</span><span class="token punctuation">(</span><span class="token string double-quoted-string">&quot;table&quot;</span> <span class="token operator">=&gt;</span> <span class="token string double-quoted-string">&quot;listPic&quot;</span><span class="token punctuation">,</span><span class="token string double-quoted-string">&quot;field&quot;</span> <span class="token operator">=&gt;</span> <span class="token variable">$para</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token variable">$insert</span><span class="token operator">==</span><span class="token string single-quoted-string">'新增成功'</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
                <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token variable">$_FILES</span><span class="token punctuation">[</span><span class="token string double-quoted-string">&quot;file&quot;</span><span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'name'</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
                    <span class="token variable">$name</span> <span class="token operator">=</span> <span class="token string double-quoted-string">&quot;file&quot;</span><span class="token punctuation">;</span>
                    <span class="token variable">$dir</span> <span class="token operator">=</span> <span class="token variable">$this</span><span class="token operator">-&gt;</span><span class="token function">ThemeUpload</span><span class="token punctuation">(</span><span class="token variable">$name</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token punctuation">}</span>
                <span class="token variable">$update</span> <span class="token operator">=</span> <span class="token function">update</span><span class="token punctuation">(</span><span class="token keyword">array</span><span class="token punctuation">(</span><span class="token string double-quoted-string">&quot;table&quot;</span> <span class="token operator">=&gt;</span> <span class="token string double-quoted-string">&quot;listPic&quot;</span><span class="token punctuation">,</span>
                                       <span class="token string double-quoted-string">&quot;field&quot;</span> <span class="token operator">=&gt;</span> <span class="token punctuation">[</span><span class="token string single-quoted-string">'url'</span> <span class="token operator">=&gt;</span> <span class="token variable">$dir</span><span class="token punctuation">,</span>
                                                   <span class="token string double-quoted-string">&quot;updateTime&quot;</span> <span class="token operator">=&gt;</span> <span class="token function">date</span><span class="token punctuation">(</span><span class="token string double-quoted-string">&quot;Y-m-d H:i:s&quot;</span><span class="token punctuation">)</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
                                       <span class="token string double-quoted-string">&quot;where&quot;</span> <span class="token operator">=&gt;</span> <span class="token string double-quoted-string">&quot;id = '<span class="token interpolation"><span class="token variable">$para</span><span class="token punctuation">[</span>id<span class="token punctuation">]</span></span>'&quot;</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token variable">$update</span> <span class="token operator">==</span> <span class="token string double-quoted-string">&quot;更新成功&quot;</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
                    <span class="token variable">$text</span> <span class="token operator">=</span> <span class="token variable">$this</span><span class="token operator">-&gt;</span><span class="token property">control</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'adName'</span><span class="token punctuation">]</span><span class="token operator">.</span><span class="token string double-quoted-string">&quot;新增了商品-&quot;</span><span class="token operator">.</span><span class="token variable">$commodity</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'name'</span><span class="token punctuation">]</span><span class="token operator">.</span><span class="token string double-quoted-string">&quot;的列表图片&quot;</span><span class="token punctuation">;</span>
                    <span class="token function">logText</span><span class="token punctuation">(</span><span class="token keyword">array</span><span class="token punctuation">(</span><span class="token string double-quoted-string">&quot;type&quot;</span> <span class="token operator">=&gt;</span> <span class="token string double-quoted-string">&quot;commodityList&quot;</span><span class="token punctuation">,</span><span class="token string double-quoted-string">&quot;text&quot;</span> <span class="token operator">=&gt;</span> <span class="token variable">$text</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token punctuation">}</span>
            <span class="token punctuation">}</span>
        <span class="token punctuation">}</span><span class="token keyword">else</span><span class="token punctuation">{</span>
            <span class="token variable">$para</span> <span class="token operator">=</span> <span class="token keyword">array</span><span class="token punctuation">(</span>
                <span class="token string double-quoted-string">&quot;fileName&quot;</span> <span class="token operator">=&gt;</span> <span class="token string double-quoted-string">&quot;file&quot;</span><span class="token punctuation">,</span><span class="token comment">//上传图片的表单文件域名称</span>
                <span class="token string double-quoted-string">&quot;sqlSearch&quot;</span> <span class="token operator">=&gt;</span> <span class="token string double-quoted-string">&quot; select * from listPic where id = '<span class="token interpolation"><span class="token punctuation">{</span><span class="token variable">$listPic</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'id'</span><span class="token punctuation">]</span><span class="token punctuation">}</span></span>' &quot;</span><span class="token punctuation">,</span><span class="token comment">//查询图片的数据库代码</span>
                <span class="token string double-quoted-string">&quot;make&quot;</span> <span class="token operator">=&gt;</span> <span class="token string double-quoted-string">&quot;缩放图像&quot;</span><span class="token punctuation">,</span><span class="token comment">//处理方式：裁剪图像、缩放图像、空</span>
                <span class="token string double-quoted-string">&quot;type&quot;</span> <span class="token operator">=&gt;</span> <span class="token string double-quoted-string">&quot;更新图像&quot;</span><span class="token punctuation">,</span><span class="token comment">//插入类型：更新图像、新增图像</span>
                <span class="token string double-quoted-string">&quot;field&quot;</span> <span class="token operator">=&gt;</span> <span class="token string double-quoted-string">&quot;url&quot;</span><span class="token punctuation">,</span><span class="token comment">//存放图片根目录的数据库字段名</span>
                <span class="token string double-quoted-string">&quot;url&quot;</span> <span class="token operator">=&gt;</span> <span class="token string double-quoted-string">&quot;file/&quot;</span><span class="token operator">.</span><span class="token function">suiji</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">.</span><span class="token string double-quoted-string">&quot;.jpg&quot;</span><span class="token punctuation">,</span><span class="token comment">//新图片保存的网站根目录位置</span>
                <span class="token string double-quoted-string">&quot;maxNum&quot;</span> <span class="token operator">=&gt;</span> <span class="token string double-quoted-string">&quot;&quot;</span><span class="token punctuation">,</span><span class="token comment">//新增图像时限定的图像总数</span>
                <span class="token string double-quoted-string">&quot;newWidth&quot;</span> <span class="token operator">=&gt;</span> <span class="token number">1000</span><span class="token punctuation">,</span><span class="token comment">//新图像的宽度</span>
                <span class="token string double-quoted-string">&quot;newHeight&quot;</span> <span class="token operator">=&gt;</span> <span class="token string double-quoted-string">&quot;&quot;</span><span class="token punctuation">,</span><span class="token comment">//新图像的高度</span>
                <span class="token string double-quoted-string">&quot;maxHeight&quot;</span> <span class="token operator">=&gt;</span> <span class="token number">4000</span><span class="token punctuation">,</span><span class="token comment">//缩放后图片的最大高度</span>
            <span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token variable">$para</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'sqlIn'</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token keyword">array</span><span class="token punctuation">(</span><span class="token string double-quoted-string">&quot;table&quot;</span> <span class="token operator">=&gt;</span> <span class="token string double-quoted-string">&quot;listPic&quot;</span><span class="token punctuation">,</span><span class="token string double-quoted-string">&quot;field&quot;</span> <span class="token operator">=&gt;</span> <span class="token keyword">array</span><span class="token punctuation">(</span><span class="token variable">$para</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'field'</span><span class="token punctuation">]</span> <span class="token operator">=&gt;</span> <span class="token variable">$para</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'url'</span><span class="token punctuation">]</span><span class="token punctuation">,</span><span class="token string double-quoted-string">&quot;updateTime&quot;</span> <span class="token operator">=&gt;</span> <span class="token function">date</span><span class="token punctuation">(</span><span class="token string double-quoted-string">&quot;Y-m-d H:i:s&quot;</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">,</span><span class="token string double-quoted-string">&quot;where&quot;</span> <span class="token operator">=&gt;</span> <span class="token string double-quoted-string">&quot; id = '<span class="token interpolation"><span class="token punctuation">{</span><span class="token variable">$listPic</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'id'</span><span class="token punctuation">]</span><span class="token punctuation">}</span></span>' &quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token variable">$warn</span> <span class="token operator">=</span> <span class="token function">imgUpdate</span><span class="token punctuation">(</span><span class="token variable">$para</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token comment">//添加日志</span>
            <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token variable">$warn</span> <span class="token operator">==</span> <span class="token string double-quoted-string">&quot;图像处理成功&quot;</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
                @<span class="token function">unlink</span><span class="token punctuation">(</span>serverRoot<span class="token operator">.</span><span class="token variable">$listPic</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'url'</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token variable">$text</span> <span class="token operator">=</span> <span class="token variable">$this</span><span class="token operator">-&gt;</span><span class="token property">control</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'adName'</span><span class="token punctuation">]</span><span class="token operator">.</span><span class="token string double-quoted-string">&quot;更新了商品-&quot;</span><span class="token operator">.</span><span class="token variable">$commodity</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'name'</span><span class="token punctuation">]</span><span class="token operator">.</span><span class="token string double-quoted-string">&quot;的列表图片&quot;</span><span class="token punctuation">;</span>
                <span class="token function">logText</span><span class="token punctuation">(</span><span class="token keyword">array</span><span class="token punctuation">(</span><span class="token string double-quoted-string">&quot;type&quot;</span> <span class="token operator">=&gt;</span> <span class="token string double-quoted-string">&quot;commodityList&quot;</span><span class="token punctuation">,</span><span class="token string double-quoted-string">&quot;text&quot;</span> <span class="token operator">=&gt;</span> <span class="token variable">$text</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
    <span class="token variable">$root</span> <span class="token operator">=</span> root<span class="token operator">.</span><span class="token string double-quoted-string">&quot;control/adIndex.php?cla=commodityList&amp;fun=detail&amp;id=&quot;</span><span class="token operator">.</span><span class="token variable">$commodity</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'id'</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
    <span class="token variable">$_SESSION</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'warn'</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token variable">$warn</span><span class="token punctuation">;</span>
    <span class="token function">header</span><span class="token punctuation">(</span><span class="token string double-quoted-string">&quot;location:&quot;</span><span class="token operator">.</span><span class="token variable">$root</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">exit</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token punctuation">}</span>
</code></pre></div></li> <li><p>图片URL单独建表存</p> <div class="language-php extra-class"><pre class="language-php"><code><span class="token variable">$windowPic</span> <span class="token operator">=</span> <span class="token variable">$this</span><span class="token operator">-&gt;</span><span class="token function">sqlQueryAll</span><span class="token punctuation">(</span><span class="token string double-quoted-string">&quot;select * from windowPic where commodityId = '<span class="token interpolation"><span class="token punctuation">{</span><span class="token variable">$commodity</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'id'</span><span class="token punctuation">]</span><span class="token punctuation">}</span></span>' order by sequence&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token variable">$x</span><span class="token operator">=</span><span class="token number">0</span><span class="token punctuation">;</span><span class="token variable">$x</span><span class="token operator">&lt;</span><span class="token number">5</span><span class="token punctuation">;</span><span class="token variable">$x</span><span class="token operator">++</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
    <span class="token variable">$num</span> <span class="token operator">=</span> <span class="token variable">$x</span><span class="token operator">+</span><span class="token number">1</span><span class="token punctuation">;</span>
    <span class="token variable">$sequencePhoto</span><span class="token punctuation">[</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token string double-quoted-string">&quot;title&quot;</span> <span class="token operator">=&gt;</span> <span class="token string double-quoted-string">&quot;橱窗图像&quot;</span><span class="token operator">.</span><span class="token variable">$num</span><span class="token punctuation">,</span>
                        <span class="token string double-quoted-string">&quot;url&quot;</span> <span class="token operator">=&gt;</span> <span class="token variable">$windowPic</span><span class="token punctuation">[</span><span class="token variable">$x</span><span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'url'</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
                        <span class="token string double-quoted-string">&quot;name&quot;</span> <span class="token operator">=&gt;</span> <span class="token string double-quoted-string">&quot;commodityList&quot;</span><span class="token punctuation">,</span>
                        <span class="token string double-quoted-string">&quot;formName&quot;</span> <span class="token operator">=&gt;</span> <span class="token string double-quoted-string">&quot;windowPic&quot;</span><span class="token operator">.</span><span class="token variable">$x</span><span class="token punctuation">,</span><span class="token comment">//这里是有顺序的单独图片上传,所以每个上传图片都有一个单独的表单名,在photo中也需要改造一下才可以</span>
                        <span class="token string double-quoted-string">&quot;fun&quot;</span> <span class="token operator">=&gt;</span> <span class="token string double-quoted-string">&quot;windowPic&quot;</span><span class="token punctuation">,</span>
                        <span class="token string double-quoted-string">&quot;num&quot;</span> <span class="token operator">=&gt;</span> <span class="token variable">$x</span><span class="token punctuation">,</span>
                        <span class="token string double-quoted-string">&quot;id&quot;</span> <span class="token operator">=&gt;</span> <span class="token variable">$commodity</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'id'</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
                       <span class="token punctuation">]</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
<span class="token operator">&lt;</span>span <span class="token keyword">class</span><span class="token operator">=</span><span class="token string single-quoted-string">'windowPic'</span><span class="token operator">&gt;</span>
    <span class="token string double-quoted-string">&quot;.<span class="token interpolation"><span class="token variable">$this</span><span class="token operator">-&gt;</span><span class="token property">numPhoto</span></span>(<span class="token interpolation"><span class="token variable">$sequencePhoto</span></span>).&quot;</span>
    <span class="token operator">&lt;</span><span class="token operator">/</span>span<span class="token operator">&gt;</span>
</code></pre></div><div class="language-php extra-class"><pre class="language-php"><code><span class="token keyword">public</span> <span class="token keyword">function</span> <span class="token function-definition function">numPhoto</span><span class="token punctuation">(</span><span class="token variable">$data</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
    <span class="token variable">$li</span> <span class="token operator">=</span> <span class="token string double-quoted-string">&quot;&quot;</span><span class="token punctuation">;</span>
    <span class="token keyword">foreach</span><span class="token punctuation">(</span><span class="token variable">$data</span> <span class="token keyword">as</span> <span class="token variable">$num</span> <span class="token operator">=&gt;</span> <span class="token variable">$array</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
        <span class="token comment">//编辑表单</span>
        <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token keyword">empty</span><span class="token punctuation">(</span><span class="token variable">$array</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'fun'</span><span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token keyword">or</span> <span class="token operator">!</span><span class="token function">power</span><span class="token punctuation">(</span><span class="token string double-quoted-string">&quot;admin&quot;</span><span class="token punctuation">,</span><span class="token string double-quoted-string">&quot;edit&quot;</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
            <span class="token variable">$click</span> <span class="token operator">=</span> <span class="token variable">$form</span> <span class="token operator">=</span> <span class="token string double-quoted-string">&quot;&quot;</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span><span class="token keyword">else</span><span class="token punctuation">{</span>
            <span class="token variable">$click</span> <span class="token operator">=</span> <span class="token string double-quoted-string">&quot;&lt;img src='&quot;</span><span class="token operator">.</span>root<span class="token operator">.</span><span class="token string double-quoted-string">&quot;img/images/clickEdit.png' onclick='document.&quot;</span><span class="token operator">.</span><span class="token variable">$array</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'formName'</span><span class="token punctuation">]</span><span class="token operator">.</span><span class="token string double-quoted-string">&quot;Form.file.click();' class='clickIco'&gt;&quot;</span><span class="token punctuation">;</span>
            <span class="token comment">//比如这里就需要改成点击触发formName,因为表单不止一个,不能触发同一个和fun同名的form</span>
            <span class="token variable">$form</span> <span class="token operator">=</span> <span class="token string double-quoted-string">&quot;
				&lt;form name='&quot;</span><span class="token operator">.</span><span class="token variable">$array</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'formName'</span><span class="token punctuation">]</span><span class="token operator">.</span><span class="token string double-quoted-string">&quot;Form' action='&quot;</span><span class="token operator">.</span>root<span class="token operator">.</span><span class="token string double-quoted-string">&quot;control/adIndex.php?cla=&quot;</span><span class="token operator">.</span><span class="token variable">$array</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'name'</span><span class="token punctuation">]</span><span class="token operator">.</span><span class="token string double-quoted-string">&quot;&amp;fun=&quot;</span><span class="token operator">.</span><span class="token variable">$array</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'fun'</span><span class="token punctuation">]</span><span class="token operator">.</span><span class="token string double-quoted-string">&quot;&amp;num=&quot;</span><span class="token operator">.</span><span class="token variable">$array</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'num'</span><span class="token punctuation">]</span><span class="token operator">.</span><span class="token string double-quoted-string">&quot;' method='post' enctype='multipart/form-data' class='hide'&gt;
					&lt;input name='file' type='file' num='&quot;</span><span class="token operator">.</span><span class="token variable">$array</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'num'</span><span class="token punctuation">]</span><span class="token operator">.</span><span class="token string double-quoted-string">&quot;' onchange='document.&quot;</span><span class="token operator">.</span><span class="token variable">$array</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'formName'</span><span class="token punctuation">]</span><span class="token operator">.</span><span class="token string double-quoted-string">&quot;Form.submit();'&gt;
					&lt;input name='id' type='hidden' value='&quot;</span><span class="token operator">.</span><span class="token variable">$array</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'id'</span><span class="token punctuation">]</span><span class="token operator">.</span><span class="token string double-quoted-string">&quot;'&gt;
				&lt;/form&gt;
				&quot;</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
        <span class="token comment">//点击显示大图功能</span>
        <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token keyword">empty</span><span class="token punctuation">(</span><span class="token variable">$array</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'url'</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
            <span class="token variable">$img</span> <span class="token operator">=</span> <span class="token string double-quoted-string">&quot;&lt;img class='smallImg imgHover' src='&quot;</span><span class="token operator">.</span>root<span class="token operator">.</span><span class="token string double-quoted-string">&quot;img/images/emptyImg.jpg'&gt;&quot;</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span><span class="token keyword">else</span><span class="token punctuation">{</span>
            <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token function">strstr</span><span class="token punctuation">(</span><span class="token variable">$array</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'url'</span><span class="token punctuation">]</span><span class="token punctuation">,</span><span class="token string double-quoted-string">&quot;http&quot;</span><span class="token punctuation">)</span> <span class="token operator">!==</span> <span class="token constant boolean">false</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
                <span class="token variable">$r</span> <span class="token operator">=</span> <span class="token string double-quoted-string">&quot;&quot;</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span><span class="token keyword">else</span><span class="token punctuation">{</span>
                <span class="token variable">$r</span> <span class="token operator">=</span> root<span class="token punctuation">;</span>
            <span class="token punctuation">}</span>
            <span class="token variable">$img</span> <span class="token operator">=</span> <span class="token string double-quoted-string">&quot;&lt;a target='_blank' href='&quot;</span><span class="token operator">.</span><span class="token variable">$r</span><span class="token operator">.</span><span class="token variable">$array</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'url'</span><span class="token punctuation">]</span><span class="token operator">.</span><span class="token string double-quoted-string">&quot;' title='点击查看大图'&gt;&lt;img class='smallImg imgHover' src='&quot;</span><span class="token operator">.</span><span class="token variable">$r</span><span class="token operator">.</span><span class="token variable">$array</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'url'</span><span class="token punctuation">]</span><span class="token operator">.</span><span class="token string double-quoted-string">&quot;'&gt;&lt;/a&gt;&quot;</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
        <span class="token comment">//打印本图像框</span>
        <span class="token variable">$li</span> <span class="token operator">.=</span> <span class="token string double-quoted-string">&quot;
			&lt;li&gt;
				&quot;</span><span class="token operator">.</span><span class="token variable">$click</span><span class="token operator">.</span><span class="token string double-quoted-string">&quot;
				&lt;p&gt;&quot;</span><span class="token operator">.</span><span class="token variable">$array</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'title'</span><span class="token punctuation">]</span><span class="token operator">.</span><span class="token string double-quoted-string">&quot;&lt;/p&gt;
				&lt;div&gt;&quot;</span><span class="token operator">.</span><span class="token variable">$img</span><span class="token operator">.</span><span class="token string double-quoted-string">&quot;&lt;/div&gt;
				&quot;</span><span class="token operator">.</span><span class="token variable">$form</span><span class="token operator">.</span><span class="token string double-quoted-string">&quot;
			&lt;/li&gt;
			&quot;</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token variable">$html</span> <span class="token operator">=</span> <span class="token string double-quoted-string">&quot;
		&lt;div class='imgSingle'&gt;
			&lt;ul&gt;&quot;</span><span class="token operator">.</span><span class="token variable">$li</span><span class="token operator">.</span><span class="token string double-quoted-string">&quot;&lt;/ul&gt;
			&lt;div class='clear'&gt;&lt;/div&gt;
		&lt;/div&gt;
		&quot;</span><span class="token punctuation">;</span>
    <span class="token keyword">return</span> <span class="token variable">$html</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre></div></li></ul></li></ul> <h3 id="上传多张图"><a href="#上传多张图" class="header-anchor">#</a> 上传多张图</h3> <ul><li><p><strong>一次上传多张图片</strong></p></li> <li><p>这首先就涉及到HTML5的内容,在input标签上添加multiple属性就可以支持多选上传</p> <div class="language-html extra-class"><pre class="language-html"><code>真正的上传按钮,隐藏起来,点击你写的上传图片再触发
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>input</span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">'</span>uploads<span class="token punctuation">'</span></span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">'</span>uploads[]<span class="token punctuation">'</span></span> <span class="token special-attr"><span class="token attr-name">onchange</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">'</span><span class="token value javascript language-javascript"><span class="token function">preview</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">)</span></span><span class="token punctuation">'</span></span></span> <span class="token attr-name">multiple</span> <span class="token special-attr"><span class="token attr-name">style</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">'</span><span class="token value css language-css"><span class="token property">display</span><span class="token punctuation">:</span> none</span><span class="token punctuation">'</span></span></span> <span class="token attr-name">type</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">'</span>file<span class="token punctuation">'</span></span>  <span class="token attr-name">accept</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">'</span>image/jpeg,image/jpg,image/png<span class="token punctuation">'</span></span> <span class="token punctuation">/&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>script</span><span class="token punctuation">&gt;</span></span><span class="token script"><span class="token language-javascript">
    <span class="token function">$</span><span class="token punctuation">(</span><span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token function">$</span><span class="token punctuation">(</span>\&quot;#uploadButton\&quot;<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">click</span><span class="token punctuation">(</span><span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
           <span class="token comment">//如果点击上传图标触发真正的上传按钮</span>
           <span class="token function">$</span><span class="token punctuation">(</span><span class="token string">'#uploads'</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">trigger</span><span class="token punctuation">(</span><span class="token string">'click'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
          <span class="token punctuation">}</span><span class="token punctuation">)</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span>
</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>script</span><span class="token punctuation">&gt;</span></span>
这个是预览标签,上传的图片都塞进这个标签内部
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">'</span>preview<span class="token punctuation">'</span></span> <span class="token special-attr"><span class="token attr-name">style</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">'</span><span class="token value css language-css"><span class="token property">display</span><span class="token punctuation">:</span> inline-block<span class="token punctuation">;</span></span><span class="token punctuation">'</span></span></span><span class="token punctuation">&gt;</span></span>

<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">&gt;</span></span>
//上传图标
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>img</span>  <span class="token special-attr"><span class="token attr-name">style</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">'</span><span class="token value css language-css"><span class="token property">float</span><span class="token punctuation">:</span> right</span><span class="token punctuation">'</span></span></span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">'</span>uploadButton<span class="token punctuation">'</span></span> <span class="token attr-name">src</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">'</span><span class="token punctuation">&quot;</span>.img(<span class="token punctuation">'</span></span><span class="token attr-name">uploadIcon').&quot;'</span><span class="token punctuation">/&gt;</span></span>
</code></pre></div></li> <li><p>平时用的提交表单的js方法只能提交数据,不能提交文件,需要改造方法,把data改为formData,</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token comment">/********异步提交函数**************************/</span>
<span class="token comment">//图片上传版本js</span>
<span class="token keyword">function</span> <span class="token function">upForm</span><span class="token punctuation">(</span><span class="token parameter">form<span class="token punctuation">,</span>url</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
    <span class="token comment">// alert(form);</span>
    <span class="token comment">//防止高频点击</span>
    <span class="token keyword">var</span> date <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Date</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">var</span> time <span class="token operator">=</span> date<span class="token punctuation">.</span><span class="token function">getTime</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">//毫秒时间戳</span>
    <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token keyword">typeof</span> minTime <span class="token operator">==</span> <span class="token string">&quot;undefined&quot;</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
        <span class="token keyword">var</span> finger <span class="token operator">=</span> <span class="token number">2</span><span class="token punctuation">;</span>
        minTime <span class="token operator">=</span> time<span class="token operator">+</span><span class="token number">2000</span><span class="token punctuation">;</span><span class="token comment">//下次点击的最小时间</span>
        console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">&quot;定义minTime&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span><span class="token keyword">else</span><span class="token punctuation">{</span>
        <span class="token keyword">if</span><span class="token punctuation">(</span>minTime <span class="token operator">&amp;&amp;</span> time <span class="token operator">&lt;</span> minTime<span class="token punctuation">)</span><span class="token punctuation">{</span>
            <span class="token keyword">var</span> finger <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">;</span>
            <span class="token function">warn</span><span class="token punctuation">(</span><span class="token string">&quot;操作过于频繁&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">&quot;time:&quot;</span><span class="token operator">+</span>time<span class="token operator">+</span><span class="token string">&quot;，mintime:&quot;</span><span class="token operator">+</span>minTime<span class="token operator">+</span><span class="token string">&quot;，差额：&quot;</span><span class="token operator">+</span><span class="token punctuation">(</span>time<span class="token operator">-</span>minTime<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span><span class="token keyword">else</span><span class="token punctuation">{</span>
            <span class="token keyword">var</span> finger <span class="token operator">=</span> <span class="token number">2</span><span class="token punctuation">;</span>
            console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">&quot;time:&quot;</span><span class="token operator">+</span>time<span class="token operator">+</span><span class="token string">&quot;，mintime:&quot;</span><span class="token operator">+</span>minTime<span class="token operator">+</span><span class="token string">&quot;，多出：&quot;</span><span class="token operator">+</span><span class="token punctuation">(</span>time<span class="token operator">-</span>minTime<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            minTime <span class="token operator">=</span> time<span class="token operator">+</span><span class="token number">2000</span><span class="token punctuation">;</span><span class="token comment">//下次点击的最小时间</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
    <span class="token keyword">if</span><span class="token punctuation">(</span>finger <span class="token operator">==</span> <span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
        <span class="token function">$</span><span class="token punctuation">(</span><span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
            <span class="token keyword">var</span> formData <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">FormData</span><span class="token punctuation">(</span><span class="token function">$</span><span class="token punctuation">(</span><span class="token string">&quot;[name='&quot;</span><span class="token operator">+</span>form<span class="token operator">+</span><span class="token string">&quot;']&quot;</span><span class="token punctuation">)</span><span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>formData<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token string">'file'</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            $<span class="token punctuation">.</span><span class="token function">ajax</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
                <span class="token literal-property property">url</span><span class="token operator">:</span> url<span class="token punctuation">,</span>
                <span class="token literal-property property">type</span><span class="token operator">:</span> <span class="token string">'POST'</span><span class="token punctuation">,</span>
                <span class="token literal-property property">cache</span><span class="token operator">:</span> <span class="token boolean">false</span><span class="token punctuation">,</span>
                <span class="token literal-property property">data</span><span class="token operator">:</span> formData<span class="token punctuation">,</span>
                <span class="token comment">// 告诉jQuery不要去处理发送的数据</span>
                <span class="token literal-property property">processData</span><span class="token operator">:</span> <span class="token boolean">false</span><span class="token punctuation">,</span>
                <span class="token comment">// 告诉jQuery不要去设置Content-Type请求头</span>
                <span class="token literal-property property">contentType</span><span class="token operator">:</span> <span class="token boolean">false</span><span class="token punctuation">,</span>
                <span class="token function-variable function">beforeSend</span><span class="token operator">:</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
                    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">&quot;正在进行，请稍候&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token punctuation">}</span><span class="token punctuation">,</span>
                <span class="token function-variable function">success</span><span class="token operator">:</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token parameter">res</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
                    <span class="token keyword">var</span> data <span class="token operator">=</span> <span class="token constant">JSON</span><span class="token punctuation">.</span><span class="token function">parse</span><span class="token punctuation">(</span>res<span class="token punctuation">)</span><span class="token punctuation">;</span>
                    <span class="token keyword">if</span> <span class="token punctuation">(</span>data<span class="token punctuation">.</span>warn <span class="token operator">==</span> <span class="token number">2</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
                        <span class="token keyword">if</span> <span class="token punctuation">(</span>data<span class="token punctuation">.</span>href<span class="token punctuation">)</span> <span class="token punctuation">{</span><span class="token comment">//如果异步返回的json参数中定义了重定向url，则跳转到本url</span>
                            window<span class="token punctuation">.</span>location<span class="token punctuation">.</span>href <span class="token operator">=</span> data<span class="token punctuation">.</span>href<span class="token punctuation">;</span>
                        <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
                            window<span class="token punctuation">.</span>location<span class="token punctuation">.</span><span class="token function">reload</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                        <span class="token punctuation">}</span>
                    <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
                        <span class="token function">warn</span><span class="token punctuation">(</span>data<span class="token punctuation">.</span>warn<span class="token punctuation">)</span><span class="token punctuation">;</span>
                    <span class="token punctuation">}</span>
                <span class="token punctuation">}</span><span class="token punctuation">,</span>
                <span class="token function-variable function">error</span><span class="token operator">:</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token parameter">responseStr</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
                    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">&quot;error&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token punctuation">}</span>
            <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token punctuation">}</span><span class="token punctuation">)</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div></li> <li><p>然后去改造对应的生成表单的地方,比如我这里是layer,那就去adIndex文件里改造一下layerEdit方法,生成一个触发upform方法的也就是新提交表单方法的表单.然后在生成layer的时候使用layerEdit方法的时候,参数中添加我们这里判断的参数<code>$data['upload']</code></p> <div class="language-php extra-class"><pre class="language-php"><code><span class="token keyword">if</span><span class="token punctuation">(</span><span class="token operator">!</span><span class="token keyword">empty</span><span class="token punctuation">(</span><span class="token variable">$data</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'upload'</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
    <span class="token comment">//这里就是上传图片的新增详情页面自定义js方法的提交按钮</span>
    <span class="token variable">$button</span> <span class="token operator">=</span> <span class="token string double-quoted-string">&quot;&lt;input onclick=\&quot;upForm('&quot;</span><span class="token operator">.</span><span class="token variable">$subForm</span><span class="token operator">.</span><span class="token string double-quoted-string">&quot;','&quot;</span><span class="token operator">.</span><span class="token variable">$url</span><span class="token operator">.</span><span class="token string double-quoted-string">&quot;')\&quot; type='button' class='button' value='确认提交'&gt;&quot;</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token keyword">else</span><span class="token punctuation">{</span>
    <span class="token variable">$button</span> <span class="token operator">=</span> <span class="token string double-quoted-string">&quot;&lt;input onclick=\&quot;subForm('&quot;</span><span class="token operator">.</span><span class="token variable">$subForm</span><span class="token operator">.</span><span class="token string double-quoted-string">&quot;','&quot;</span><span class="token operator">.</span><span class="token variable">$url</span><span class="token operator">.</span><span class="token string double-quoted-string">&quot;')\&quot; type='button' class='button' value='确认提交'&gt;&quot;</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre></div></li> <li><p>js方面还需要有一个预览方法</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token comment">//图片上传弹出框预览js</span>
<span class="token keyword">function</span> <span class="token function">preview</span><span class="token punctuation">(</span><span class="token parameter">a</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'files的length'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>a<span class="token punctuation">.</span>files<span class="token punctuation">.</span>length<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token comment">//其实这个判断限制不住真正上传的图片,只能让选中上传的图片不显示出来</span>
    <span class="token keyword">if</span><span class="token punctuation">(</span>a<span class="token punctuation">.</span>files<span class="token punctuation">.</span>length<span class="token operator">&lt;=</span><span class="token number">4</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
        <span class="token comment">//上传的时候就清楚之前所有预览的图片</span>
        <span class="token function">$</span><span class="token punctuation">(</span><span class="token string">'#preview'</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">html</span><span class="token punctuation">(</span><span class="token string">''</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">var</span> x<span class="token operator">=</span><span class="token number">0</span><span class="token punctuation">;</span>x<span class="token operator">&lt;</span>a<span class="token punctuation">.</span>files<span class="token punctuation">.</span>length<span class="token punctuation">;</span>x<span class="token operator">++</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
            <span class="token comment">// 判断文件类型</span>
            <span class="token keyword">var</span> fileType <span class="token operator">=</span> a<span class="token punctuation">.</span>files<span class="token punctuation">[</span>x<span class="token punctuation">]</span><span class="token punctuation">.</span>type<span class="token punctuation">.</span><span class="token function">split</span><span class="token punctuation">(</span><span class="token string">'/'</span><span class="token punctuation">)</span><span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
            console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'fileType'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>fileType<span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token keyword">if</span><span class="token punctuation">(</span>fileType <span class="token operator">==</span> <span class="token string">&quot;png&quot;</span> <span class="token operator">||</span> fileType <span class="token operator">==</span> <span class="token string">&quot;jpeg&quot;</span> <span class="token operator">||</span> fileType <span class="token operator">==</span> <span class="token string">&quot;jpg&quot;</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
                <span class="token keyword">var</span> file <span class="token operator">=</span> a<span class="token punctuation">.</span>files<span class="token punctuation">[</span>x<span class="token punctuation">]</span><span class="token punctuation">;</span>
                console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>window<span class="token punctuation">.</span>FileReader<span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token keyword">if</span> <span class="token punctuation">(</span>window<span class="token punctuation">.</span>FileReader<span class="token punctuation">)</span> <span class="token punctuation">{</span>
                    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'进入window.FileReader'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                    <span class="token keyword">var</span> reader <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">FileReader</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                    reader<span class="token punctuation">.</span><span class="token function">readAsDataURL</span><span class="token punctuation">(</span>file<span class="token punctuation">)</span><span class="token punctuation">;</span>
                    <span class="token comment">//监听文件读取结束后事件</span>
                    reader<span class="token punctuation">.</span><span class="token function-variable function">onloadend</span> <span class="token operator">=</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token parameter">e</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
                        <span class="token comment">//e.target.result就是最后的路径地址</span>

                        <span class="token keyword">var</span> photo <span class="token operator">=</span> <span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">&lt;img src=&quot;</span><span class="token template-punctuation string">`</span></span><span class="token operator">+</span>e<span class="token punctuation">.</span>target<span class="token punctuation">.</span>result<span class="token operator">+</span><span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">&quot; style=&quot;width: 50px;height: 50px&quot; /&gt;</span><span class="token template-punctuation string">`</span></span><span class="token punctuation">;</span>
                        console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'预览图片'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                        console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>photo<span class="token punctuation">)</span><span class="token punctuation">;</span>
                        <span class="token function">$</span><span class="token punctuation">(</span><span class="token string">'#preview'</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">append</span><span class="token punctuation">(</span>photo<span class="token punctuation">)</span><span class="token punctuation">;</span>
                    <span class="token punctuation">}</span><span class="token punctuation">;</span>
                <span class="token punctuation">}</span>
            <span class="token punctuation">}</span><span class="token keyword">else</span><span class="token punctuation">{</span>
                <span class="token function">warn</span><span class="token punctuation">(</span><span class="token string">&quot;文件格式不正确&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span>

        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span><span class="token keyword">else</span><span class="token punctuation">{</span>
        <span class="token function">warn</span><span class="token punctuation">(</span><span class="token string">'只能上传四张以下的图片'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>


<span class="token punctuation">}</span>
</code></pre></div></li> <li><p>这样上传图片只能上传你最后一次选中的图片,无论几张,你如果做了多次选中,那么之前的选中图片是无法上传的,除非你每选中一次就异步直接上传图片.</p></li> <li><p>上传完毕之后在后端就可以使用<code>$FIELS</code>拿到具体的上传文件信息了.如果你上传多张,那么你使用<code>$_FILES['标签的name']['具体的属性比如name/type']</code>拿到的属性数组,也就是``$_FILES['标签的name']`这个数组的结构,是一个大数组,名字就是标签的name属性,然后大数组下面有很多的键,分别是name,type之类的,每个键下面就由对应你上传图片数量的值,用0,1,2排列.</p></li> <li><p>所以在后端拿数据,就得<code>$_FILES['标签的name']['具体的属性比如name/type'][索引]</code>这样去拿.</p></li> <li><p>由于我是把四张图存在同一条数据的四个字段,所以我写的上传方法是这样的.</p> <div class="language-php extra-class"><pre class="language-php"><code><span class="token comment">/**
     * @param $name
     */</span>
<span class="token keyword">function</span> <span class="token function-definition function">PicUpload</span><span class="token punctuation">(</span><span class="token variable">$index</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
    <span class="token variable">$url</span> <span class="token operator">=</span> <span class="token string double-quoted-string">&quot;file/&quot;</span><span class="token operator">.</span><span class="token function">date</span><span class="token punctuation">(</span><span class="token string double-quoted-string">&quot;Ym&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token operator">!</span><span class="token function">file_exists</span><span class="token punctuation">(</span>serverRoot<span class="token operator">.</span><span class="token variable">$url</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
        <span class="token function">mkdir</span><span class="token punctuation">(</span>serverRoot<span class="token operator">.</span><span class="token variable">$url</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token variable">$max_file_size</span><span class="token operator">=</span><span class="token number">200000000</span><span class="token punctuation">;</span>     <span class="token comment">//上传文件大小限制, 单位BYTE</span>

    <span class="token variable">$file</span><span class="token operator">=</span><span class="token variable">$_FILES</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'uploads'</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
    <span class="token variable">$filetype</span> <span class="token operator">=</span> <span class="token variable">$file</span><span class="token punctuation">[</span><span class="token string double-quoted-string">&quot;type&quot;</span><span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token variable">$index</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
    <span class="token variable">$filesize</span> <span class="token operator">=</span> <span class="token variable">$file</span><span class="token punctuation">[</span><span class="token string double-quoted-string">&quot;size&quot;</span><span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token variable">$index</span><span class="token punctuation">]</span><span class="token punctuation">;</span>

    <span class="token variable">$base64</span> <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">base64_file</span><span class="token punctuation">(</span><span class="token string double-quoted-string">&quot;img&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token variable">$expandedName</span> <span class="token operator">=</span> <span class="token variable">$base64</span><span class="token operator">-&gt;</span><span class="token function">mime</span><span class="token punctuation">(</span><span class="token variable">$filetype</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token variable">$typeJudge</span> <span class="token operator">=</span> <span class="token variable">$this</span><span class="token operator">-&gt;</span><span class="token function">typeFile</span><span class="token punctuation">(</span><span class="token variable">$filetype</span><span class="token punctuation">)</span><span class="token punctuation">;</span>  <span class="token comment">// 文件类型判断</span>

    <span class="token comment">//$typeJudge['warn']为空意味着typeFile方法没有传递错误信息,说明文件格式没问题</span>
    <span class="token comment">//格式没问题才考虑判断大小,文件是否存在</span>
    <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token keyword">empty</span><span class="token punctuation">(</span><span class="token variable">$typeJudge</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'warn'</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
        <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token variable">$filesize</span> <span class="token operator">&gt;</span> <span class="token variable">$max_file_size</span><span class="token punctuation">)</span><span class="token punctuation">{</span>                <span class="token comment">// 文件大小判断</span>
            <span class="token variable">$json</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'warn'</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token string double-quoted-string">&quot;文件太大!&quot;</span><span class="token punctuation">;</span>
            <span class="token keyword">exit</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>


        <span class="token variable">$src</span> <span class="token operator">=</span> <span class="token variable">$url</span><span class="token operator">.</span><span class="token string double-quoted-string">&quot;/&quot;</span><span class="token operator">.</span><span class="token function">suiji</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">.</span><span class="token string double-quoted-string">&quot;.&quot;</span><span class="token operator">.</span><span class="token variable">$expandedName</span><span class="token punctuation">;</span>

        <span class="token variable">$filename</span> <span class="token operator">=</span> <span class="token function">iconv</span><span class="token punctuation">(</span><span class="token string double-quoted-string">&quot;UTF-8&quot;</span><span class="token punctuation">,</span><span class="token string double-quoted-string">&quot;gb2312&quot;</span><span class="token punctuation">,</span>serverRoot<span class="token operator">.</span><span class="token variable">$src</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">//当文件存在</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token function">file_exists</span><span class="token punctuation">(</span><span class="token variable">$filename</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token comment">//echo $fileName.&quot; already exists.&quot;;</span>
            <span class="token variable">$json</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'warn'</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token variable">$filename</span><span class="token operator">.</span><span class="token string double-quoted-string">&quot;文件存在&quot;</span><span class="token punctuation">;</span>

            <span class="token variable">$dir</span> <span class="token operator">=</span> <span class="token variable">$src</span><span class="token punctuation">;</span>

        <span class="token punctuation">}</span><span class="token keyword">else</span><span class="token punctuation">{</span><span class="token comment">//当文件不存在</span>
            <span class="token variable">$chenggong</span> <span class="token operator">=</span> <span class="token function">move_uploaded_file</span><span class="token punctuation">(</span><span class="token variable">$_FILES</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'uploads'</span><span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token string double-quoted-string">&quot;tmp_name&quot;</span><span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token variable">$index</span><span class="token punctuation">]</span><span class="token punctuation">,</span><span class="token variable">$filename</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token variable">$dir</span> <span class="token operator">=</span> <span class="token variable">$src</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>


        <span class="token keyword">return</span> <span class="token variable">$dir</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div></li> <li><p>具体处理数据的时候就可以这样使用了</p> <div class="language-php extra-class"><pre class="language-php"><code><span class="token variable">$dir</span> <span class="token operator">=</span> <span class="token variable">$this</span><span class="token operator">-&gt;</span><span class="token function">PicUpload</span><span class="token punctuation">(</span><span class="token variable">$x</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token variable">$update</span> <span class="token operator">=</span> <span class="token function">update</span><span class="token punctuation">(</span><span class="token keyword">array</span><span class="token punctuation">(</span><span class="token string double-quoted-string">&quot;table&quot;</span> <span class="token operator">=&gt;</span> <span class="token string double-quoted-string">&quot;workHoliday&quot;</span><span class="token punctuation">,</span>
                       <span class="token string double-quoted-string">&quot;field&quot;</span> <span class="token operator">=&gt;</span> <span class="token punctuation">[</span><span class="token string single-quoted-string">'evidenceOne'</span><span class="token operator">=&gt;</span><span class="token variable">$dir</span><span class="token punctuation">,</span><span class="token string double-quoted-string">&quot;updateTime&quot;</span> <span class="token operator">=&gt;</span> <span class="token function">date</span><span class="token punctuation">(</span><span class="token string double-quoted-string">&quot;Y-m-d H:i:s&quot;</span><span class="token punctuation">)</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
                       <span class="token string double-quoted-string">&quot;where&quot;</span> <span class="token operator">=&gt;</span> <span class="token string double-quoted-string">&quot;id = '<span class="token interpolation"><span class="token punctuation">{</span><span class="token variable">$this</span><span class="token operator">-&gt;</span><span class="token property">post</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'id'</span><span class="token punctuation">]</span><span class="token punctuation">}</span></span>'&quot;</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">if</span><span class="token punctuation">(</span><span class="token variable">$update</span><span class="token operator">==</span><span class="token string single-quoted-string">'更新成功'</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
    <span class="token variable">$picSuccess</span><span class="token operator">++</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre></div></li></ul> <h2 id="上传文件"><a href="#上传文件" class="header-anchor">#</a> 上传文件</h2> <ul><li><p>上传首先需要一个上传封装方法</p> <div class="language-php extra-class"><pre class="language-php"><code><span class="token comment">/**
     * @param $name
     */</span>
<span class="token keyword">function</span> <span class="token function-definition function">ThemeUpload</span><span class="token punctuation">(</span><span class="token variable">$name</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
    <span class="token variable">$url</span> <span class="token operator">=</span> <span class="token string double-quoted-string">&quot;file/&quot;</span><span class="token operator">.</span><span class="token function">date</span><span class="token punctuation">(</span><span class="token string double-quoted-string">&quot;Ym&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token operator">!</span><span class="token function">file_exists</span><span class="token punctuation">(</span>serverRoot<span class="token operator">.</span><span class="token variable">$url</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
        <span class="token function">mkdir</span><span class="token punctuation">(</span>serverRoot<span class="token operator">.</span><span class="token variable">$url</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token variable">$max_file_size</span><span class="token operator">=</span><span class="token number">200000000</span><span class="token punctuation">;</span>     <span class="token comment">//上传文件大小限制, 单位BYTE</span>

    <span class="token variable">$file</span><span class="token operator">=</span><span class="token variable">$_FILES</span><span class="token punctuation">[</span><span class="token variable">$name</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
    <span class="token variable">$filetype</span> <span class="token operator">=</span> <span class="token variable">$file</span><span class="token punctuation">[</span><span class="token string double-quoted-string">&quot;type&quot;</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
    <span class="token variable">$filesize</span> <span class="token operator">=</span> <span class="token variable">$file</span><span class="token punctuation">[</span><span class="token string double-quoted-string">&quot;size&quot;</span><span class="token punctuation">]</span><span class="token punctuation">;</span>

    <span class="token variable">$base64</span> <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">base64_file</span><span class="token punctuation">(</span><span class="token string double-quoted-string">&quot;office&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token variable">$expandedName</span> <span class="token operator">=</span> <span class="token variable">$base64</span><span class="token operator">-&gt;</span><span class="token function">mime</span><span class="token punctuation">(</span><span class="token variable">$filetype</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token variable">$typeJudge</span> <span class="token operator">=</span> <span class="token variable">$this</span><span class="token operator">-&gt;</span><span class="token function">typeFile</span><span class="token punctuation">(</span><span class="token variable">$filetype</span><span class="token punctuation">)</span><span class="token punctuation">;</span>  <span class="token comment">// 文件类型判断</span>

    <span class="token comment">//$typeJudge['warn']为空意味着typeFile方法没有传递错误信息,说明文件格式没问题</span>
    <span class="token comment">//格式没问题才考虑判断大小,文件是否存在</span>
    <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token keyword">empty</span><span class="token punctuation">(</span><span class="token variable">$typeJudge</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'warn'</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
        <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token variable">$filesize</span> <span class="token operator">&gt;</span> <span class="token variable">$max_file_size</span><span class="token punctuation">)</span><span class="token punctuation">{</span>                <span class="token comment">// 文件大小判断</span>
            <span class="token variable">$json</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'warn'</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token string double-quoted-string">&quot;文件太大!&quot;</span><span class="token punctuation">;</span>
            <span class="token keyword">exit</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>


        <span class="token variable">$src</span> <span class="token operator">=</span> <span class="token variable">$url</span><span class="token operator">.</span><span class="token string double-quoted-string">&quot;/&quot;</span><span class="token operator">.</span><span class="token function">suiji</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">.</span><span class="token string double-quoted-string">&quot;.&quot;</span><span class="token operator">.</span><span class="token variable">$expandedName</span><span class="token punctuation">;</span>

        <span class="token variable">$filename</span> <span class="token operator">=</span> <span class="token function">iconv</span><span class="token punctuation">(</span><span class="token string double-quoted-string">&quot;UTF-8&quot;</span><span class="token punctuation">,</span><span class="token string double-quoted-string">&quot;gb2312&quot;</span><span class="token punctuation">,</span>serverRoot<span class="token operator">.</span><span class="token variable">$src</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">//当文件存在</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token function">file_exists</span><span class="token punctuation">(</span><span class="token variable">$filename</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token comment">//echo $fileName.&quot; already exists.&quot;;</span>
            <span class="token variable">$json</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'warn'</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token variable">$filename</span><span class="token operator">.</span><span class="token string double-quoted-string">&quot;文件存在&quot;</span><span class="token punctuation">;</span>

            <span class="token variable">$dir</span> <span class="token operator">=</span> <span class="token variable">$src</span><span class="token punctuation">;</span>

        <span class="token punctuation">}</span><span class="token keyword">else</span><span class="token punctuation">{</span><span class="token comment">//当文件不存在</span>
            <span class="token variable">$chenggong</span> <span class="token operator">=</span> <span class="token function">move_uploaded_file</span><span class="token punctuation">(</span><span class="token variable">$_FILES</span><span class="token punctuation">[</span><span class="token variable">$name</span><span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token string double-quoted-string">&quot;tmp_name&quot;</span><span class="token punctuation">]</span><span class="token punctuation">,</span><span class="token variable">$filename</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token variable">$dir</span> <span class="token operator">=</span> <span class="token variable">$src</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>


        <span class="token comment">//            return ['dir'=&gt;$dir,'name'=&gt;$file['name']];</span>
        <span class="token keyword">return</span> <span class="token variable">$dir</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div></li> <li><p>其中需要base64类和一个类型验证拓展,这个base64记得要去extend文件require</p> <div class="language-php extra-class"><pre class="language-php"><code><span class="token php language-php"><span class="token delimiter important">&lt;?php</span>
    <span class="token comment">/**
 * Created by PhpStorm.
 * User: admin
 * Date: 2020/3/24
 * Time: 17:29
 */</span>

    <span class="token keyword">class</span> <span class="token class-name-definition class-name">base64_file</span>
<span class="token punctuation">{</span>
    <span class="token comment">//声明系统配置上传目录</span>
    <span class="token keyword">private</span> <span class="token variable">$path</span><span class="token punctuation">;</span>
    <span class="token comment">/**
     * 初始化类
     */</span>
    <span class="token keyword">public</span> <span class="token keyword">function</span> <span class="token function-definition function">__construct</span><span class="token punctuation">(</span><span class="token variable">$path</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token variable">$this</span><span class="token operator">-&gt;</span><span class="token property">path</span> <span class="token operator">=</span> <span class="token variable">$path</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token keyword">public</span> <span class="token keyword">function</span> <span class="token function-definition function">file</span><span class="token punctuation">(</span><span class="token variable">$base64</span><span class="token punctuation">,</span><span class="token variable">$dir</span> <span class="token operator">=</span> <span class="token string single-quoted-string">'default'</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
        <span class="token variable">$path_dir</span> <span class="token operator">=</span> <span class="token string double-quoted-string">&quot;/&quot;</span><span class="token operator">.</span><span class="token variable">$this</span><span class="token operator">-&gt;</span><span class="token property">path</span><span class="token operator">.</span><span class="token string double-quoted-string">&quot;/&quot;</span><span class="token operator">.</span><span class="token variable">$dir</span><span class="token punctuation">;</span>
        <span class="token variable">$path_file</span> <span class="token operator">=</span> <span class="token function">suiji</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token variable">$base64_arr</span> <span class="token operator">=</span> <span class="token function">explode</span><span class="token punctuation">(</span><span class="token string double-quoted-string">&quot;,&quot;</span><span class="token punctuation">,</span><span class="token variable">$base64</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token variable">$base64_head</span> <span class="token operator">=</span> <span class="token variable">$base64_arr</span><span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
        <span class="token variable">$str_arr</span> <span class="token operator">=</span> <span class="token function">explode</span><span class="token punctuation">(</span><span class="token string double-quoted-string">&quot;:&quot;</span><span class="token punctuation">,</span><span class="token variable">$base64_head</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token variable">$str_arr</span> <span class="token operator">=</span> <span class="token function">explode</span><span class="token punctuation">(</span><span class="token string double-quoted-string">&quot;;&quot;</span><span class="token punctuation">,</span><span class="token variable">$str_arr</span><span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token variable">$suffix</span> <span class="token operator">=</span> <span class="token variable">$this</span><span class="token operator">-&gt;</span><span class="token function">mime</span><span class="token punctuation">(</span><span class="token variable">$str_arr</span><span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token variable">$new_path</span> <span class="token operator">=</span> <span class="token variable">$path_dir</span><span class="token operator">.</span><span class="token string double-quoted-string">&quot;/&quot;</span><span class="token operator">.</span><span class="token variable">$path_file</span><span class="token operator">.</span><span class="token string double-quoted-string">&quot;.&quot;</span><span class="token operator">.</span><span class="token variable">$suffix</span><span class="token punctuation">;</span>
        <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token operator">!</span><span class="token function">is_dir</span><span class="token punctuation">(</span>serverRoot<span class="token operator">.</span><span class="token variable">$path_dir</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
            <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token operator">!</span><span class="token function">mkdir</span><span class="token punctuation">(</span>serverRoot<span class="token operator">.</span><span class="token variable">$path_dir</span><span class="token punctuation">,</span><span class="token number">0777</span><span class="token punctuation">,</span><span class="token constant boolean">true</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
                <span class="token keyword">return</span> <span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token string double-quoted-string">&quot;创建失败 目录：&quot;</span><span class="token operator">.</span><span class="token variable">$path_dir</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span>
        <span class="token punctuation">}</span>
        <span class="token variable">$newbase64</span> <span class="token operator">=</span> <span class="token function">str_replace</span><span class="token punctuation">(</span><span class="token variable">$base64_head</span><span class="token punctuation">,</span> <span class="token string single-quoted-string">''</span><span class="token punctuation">,</span> <span class="token variable">$base64</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token function">file_put_contents</span><span class="token punctuation">(</span>serverRoot<span class="token operator">.</span><span class="token variable">$new_path</span><span class="token punctuation">,</span><span class="token function">base64_decode</span><span class="token punctuation">(</span><span class="token variable">$newbase64</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">return</span> <span class="token variable">$new_path</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token comment">/**
     * 获取文件的后缀
     * @param $type 当前文件的mime类型
     * @return bool 返回结果
     */</span>
    <span class="token keyword">public</span> <span class="token keyword">function</span> <span class="token function-definition function">mime</span><span class="token punctuation">(</span><span class="token variable">$type</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
        <span class="token variable">$arr</span> <span class="token operator">=</span> <span class="token punctuation">[</span>
            <span class="token string single-quoted-string">'*'</span> <span class="token operator">=&gt;</span> <span class="token string single-quoted-string">'application/octet-stream'</span><span class="token punctuation">,</span>
            <span class="token string single-quoted-string">'323'</span> <span class="token operator">=&gt;</span> <span class="token string single-quoted-string">'text/h323'</span><span class="token punctuation">,</span>
            <span class="token string single-quoted-string">'acx'</span> <span class="token operator">=&gt;</span> <span class="token string single-quoted-string">'application/internet-property-stream'</span><span class="token punctuation">,</span>
            <span class="token string single-quoted-string">'ai'</span> <span class="token operator">=&gt;</span> <span class="token string single-quoted-string">'application/postscript'</span><span class="token punctuation">,</span>
            <span class="token string single-quoted-string">'aif'</span> <span class="token operator">=&gt;</span> <span class="token string single-quoted-string">'audio/x-aiff'</span><span class="token punctuation">,</span>
            <span class="token string single-quoted-string">'aifc'</span> <span class="token operator">=&gt;</span> <span class="token string single-quoted-string">'audio/x-aiff'</span><span class="token punctuation">,</span>
            <span class="token string single-quoted-string">'aiff'</span> <span class="token operator">=&gt;</span> <span class="token string single-quoted-string">'audio/x-aiff'</span><span class="token punctuation">,</span>
            <span class="token string single-quoted-string">'asf'</span> <span class="token operator">=&gt;</span> <span class="token string single-quoted-string">'video/x-ms-asf'</span><span class="token punctuation">,</span>
            <span class="token string single-quoted-string">'asr'</span> <span class="token operator">=&gt;</span> <span class="token string single-quoted-string">'video/x-ms-asf'</span><span class="token punctuation">,</span>
            <span class="token string single-quoted-string">'asx'</span> <span class="token operator">=&gt;</span> <span class="token string single-quoted-string">'video/x-ms-asf'</span><span class="token punctuation">,</span>
            <span class="token string single-quoted-string">'au'</span> <span class="token operator">=&gt;</span> <span class="token string single-quoted-string">'audio/basic'</span><span class="token punctuation">,</span>
            <span class="token string single-quoted-string">'avi'</span> <span class="token operator">=&gt;</span> <span class="token string single-quoted-string">'video/x-msvideo'</span><span class="token punctuation">,</span>
            <span class="token string single-quoted-string">'axs'</span> <span class="token operator">=&gt;</span> <span class="token string single-quoted-string">'application/olescript'</span><span class="token punctuation">,</span>
            <span class="token string single-quoted-string">'bas'</span> <span class="token operator">=&gt;</span> <span class="token string single-quoted-string">'text/plain'</span><span class="token punctuation">,</span>
            <span class="token string single-quoted-string">'bcpio'</span> <span class="token operator">=&gt;</span> <span class="token string single-quoted-string">'application/x-bcpio'</span><span class="token punctuation">,</span>
            <span class="token string single-quoted-string">'bin'</span> <span class="token operator">=&gt;</span> <span class="token string single-quoted-string">'application/octet-stream'</span><span class="token punctuation">,</span>
            <span class="token string single-quoted-string">'bmp'</span> <span class="token operator">=&gt;</span> <span class="token string single-quoted-string">'image/bmp'</span><span class="token punctuation">,</span>
            <span class="token string single-quoted-string">'c'</span> <span class="token operator">=&gt;</span> <span class="token string single-quoted-string">'text/plain'</span><span class="token punctuation">,</span>
            <span class="token string single-quoted-string">'cat'</span> <span class="token operator">=&gt;</span> <span class="token string single-quoted-string">'application/vnd.ms-pkiseccat'</span><span class="token punctuation">,</span>
            <span class="token string single-quoted-string">'cdf'</span> <span class="token operator">=&gt;</span> <span class="token string single-quoted-string">'application/x-cdf'</span><span class="token punctuation">,</span>
            <span class="token string single-quoted-string">'cer'</span> <span class="token operator">=&gt;</span> <span class="token string single-quoted-string">'application/x-x509-ca-cert'</span><span class="token punctuation">,</span>
            <span class="token string single-quoted-string">'class'</span> <span class="token operator">=&gt;</span> <span class="token string single-quoted-string">'application/octet-stream'</span><span class="token punctuation">,</span>
            <span class="token string single-quoted-string">'clp'</span> <span class="token operator">=&gt;</span> <span class="token string single-quoted-string">'application/x-msclip'</span><span class="token punctuation">,</span>
            <span class="token string single-quoted-string">'cmx'</span> <span class="token operator">=&gt;</span> <span class="token string single-quoted-string">'image/x-cmx'</span><span class="token punctuation">,</span>
            <span class="token string single-quoted-string">'cod'</span> <span class="token operator">=&gt;</span> <span class="token string single-quoted-string">'image/cis-cod'</span><span class="token punctuation">,</span>
            <span class="token string single-quoted-string">'cpio'</span> <span class="token operator">=&gt;</span> <span class="token string single-quoted-string">'application/x-cpio'</span><span class="token punctuation">,</span>
            <span class="token string single-quoted-string">'crd'</span> <span class="token operator">=&gt;</span> <span class="token string single-quoted-string">'application/x-mscardfile'</span><span class="token punctuation">,</span>
            <span class="token string single-quoted-string">'crl'</span> <span class="token operator">=&gt;</span> <span class="token string single-quoted-string">'application/pkix-crl'</span><span class="token punctuation">,</span>
            <span class="token string single-quoted-string">'crt'</span> <span class="token operator">=&gt;</span> <span class="token string single-quoted-string">'application/x-x509-ca-cert'</span><span class="token punctuation">,</span>
            <span class="token string single-quoted-string">'csh'</span> <span class="token operator">=&gt;</span> <span class="token string single-quoted-string">'application/x-csh'</span><span class="token punctuation">,</span>
            <span class="token string single-quoted-string">'css'</span> <span class="token operator">=&gt;</span> <span class="token string single-quoted-string">'text/css'</span><span class="token punctuation">,</span>
            <span class="token string single-quoted-string">'dcr'</span> <span class="token operator">=&gt;</span> <span class="token string single-quoted-string">'application/x-director'</span><span class="token punctuation">,</span>
            <span class="token string single-quoted-string">'der'</span> <span class="token operator">=&gt;</span> <span class="token string single-quoted-string">'application/x-x509-ca-cert'</span><span class="token punctuation">,</span>
            <span class="token string single-quoted-string">'dir'</span> <span class="token operator">=&gt;</span> <span class="token string single-quoted-string">'application/x-director'</span><span class="token punctuation">,</span>
            <span class="token string single-quoted-string">'dll'</span> <span class="token operator">=&gt;</span> <span class="token string single-quoted-string">'application/x-msdownload'</span><span class="token punctuation">,</span>
            <span class="token string single-quoted-string">'dms'</span> <span class="token operator">=&gt;</span> <span class="token string single-quoted-string">'application/octet-stream'</span><span class="token punctuation">,</span>
            <span class="token string single-quoted-string">'doc'</span> <span class="token operator">=&gt;</span> <span class="token string single-quoted-string">'application/msword'</span><span class="token punctuation">,</span>
            <span class="token string single-quoted-string">'docx'</span> <span class="token operator">=&gt;</span> <span class="token string single-quoted-string">'application/vnd.openxmlformats-officedocument.wordprocessingml.document'</span><span class="token punctuation">,</span>
            <span class="token string single-quoted-string">'dot'</span> <span class="token operator">=&gt;</span> <span class="token string single-quoted-string">'application/msword'</span><span class="token punctuation">,</span>
            <span class="token string single-quoted-string">'dvi'</span> <span class="token operator">=&gt;</span> <span class="token string single-quoted-string">'application/x-dvi'</span><span class="token punctuation">,</span>
            <span class="token string single-quoted-string">'dxr'</span> <span class="token operator">=&gt;</span> <span class="token string single-quoted-string">'application/x-director'</span><span class="token punctuation">,</span>
            <span class="token string single-quoted-string">'eps'</span> <span class="token operator">=&gt;</span> <span class="token string single-quoted-string">'application/postscript'</span><span class="token punctuation">,</span>
            <span class="token string single-quoted-string">'etx'</span> <span class="token operator">=&gt;</span> <span class="token string single-quoted-string">'text/x-setext'</span><span class="token punctuation">,</span>
            <span class="token string single-quoted-string">'evy'</span> <span class="token operator">=&gt;</span> <span class="token string single-quoted-string">'application/envoy'</span><span class="token punctuation">,</span>
            <span class="token string single-quoted-string">'exe'</span> <span class="token operator">=&gt;</span> <span class="token string single-quoted-string">'application/octet-stream'</span><span class="token punctuation">,</span>
            <span class="token string single-quoted-string">'fif'</span> <span class="token operator">=&gt;</span> <span class="token string single-quoted-string">'application/fractals'</span><span class="token punctuation">,</span>
            <span class="token string single-quoted-string">'flr'</span> <span class="token operator">=&gt;</span> <span class="token string single-quoted-string">'x-world/x-vrml'</span><span class="token punctuation">,</span>
            <span class="token string single-quoted-string">'gif'</span> <span class="token operator">=&gt;</span> <span class="token string single-quoted-string">'image/gif'</span><span class="token punctuation">,</span>
            <span class="token string single-quoted-string">'gtar'</span> <span class="token operator">=&gt;</span> <span class="token string single-quoted-string">'application/x-gtar'</span><span class="token punctuation">,</span>
            <span class="token string single-quoted-string">'gz'</span> <span class="token operator">=&gt;</span> <span class="token string single-quoted-string">'application/x-gzip'</span><span class="token punctuation">,</span>
            <span class="token string single-quoted-string">'h'</span> <span class="token operator">=&gt;</span> <span class="token string single-quoted-string">'text/plain'</span><span class="token punctuation">,</span>
            <span class="token string single-quoted-string">'hdf'</span> <span class="token operator">=&gt;</span> <span class="token string single-quoted-string">'application/x-hdf'</span><span class="token punctuation">,</span>
            <span class="token string single-quoted-string">'hlp'</span> <span class="token operator">=&gt;</span> <span class="token string single-quoted-string">'application/winhlp'</span><span class="token punctuation">,</span>
            <span class="token string single-quoted-string">'hqx'</span> <span class="token operator">=&gt;</span> <span class="token string single-quoted-string">'application/mac-binhex40'</span><span class="token punctuation">,</span>
            <span class="token string single-quoted-string">'hta'</span> <span class="token operator">=&gt;</span> <span class="token string single-quoted-string">'application/hta'</span><span class="token punctuation">,</span>
            <span class="token string single-quoted-string">'htc'</span> <span class="token operator">=&gt;</span> <span class="token string single-quoted-string">'text/x-component'</span><span class="token punctuation">,</span>
            <span class="token string single-quoted-string">'htm'</span> <span class="token operator">=&gt;</span> <span class="token string single-quoted-string">'text/html'</span><span class="token punctuation">,</span>
            <span class="token string single-quoted-string">'html'</span> <span class="token operator">=&gt;</span> <span class="token string single-quoted-string">'text/html'</span><span class="token punctuation">,</span>
            <span class="token string single-quoted-string">'htt'</span> <span class="token operator">=&gt;</span> <span class="token string single-quoted-string">'text/webviewhtml'</span><span class="token punctuation">,</span>
            <span class="token string single-quoted-string">'ico'</span> <span class="token operator">=&gt;</span> <span class="token string single-quoted-string">'image/x-icon'</span><span class="token punctuation">,</span>
            <span class="token string single-quoted-string">'ief'</span> <span class="token operator">=&gt;</span> <span class="token string single-quoted-string">'image/ief'</span><span class="token punctuation">,</span>
            <span class="token string single-quoted-string">'iii'</span> <span class="token operator">=&gt;</span> <span class="token string single-quoted-string">'application/x-iphone'</span><span class="token punctuation">,</span>
            <span class="token string single-quoted-string">'ins'</span> <span class="token operator">=&gt;</span> <span class="token string single-quoted-string">'application/x-internet-signup'</span><span class="token punctuation">,</span>
            <span class="token string single-quoted-string">'isp'</span> <span class="token operator">=&gt;</span> <span class="token string single-quoted-string">'application/x-internet-signup'</span><span class="token punctuation">,</span>
            <span class="token string single-quoted-string">'jfif'</span> <span class="token operator">=&gt;</span> <span class="token string single-quoted-string">'image/pipeg'</span><span class="token punctuation">,</span>
            <span class="token string single-quoted-string">'jpe'</span> <span class="token operator">=&gt;</span> <span class="token string single-quoted-string">'image/jpeg'</span><span class="token punctuation">,</span>
            <span class="token string single-quoted-string">'jpeg'</span> <span class="token operator">=&gt;</span> <span class="token string single-quoted-string">'image/jpeg'</span><span class="token punctuation">,</span>
            <span class="token string single-quoted-string">'jpg'</span> <span class="token operator">=&gt;</span> <span class="token string single-quoted-string">'image/jpeg'</span><span class="token punctuation">,</span>
            <span class="token string single-quoted-string">'js'</span> <span class="token operator">=&gt;</span> <span class="token string single-quoted-string">'application/x-javascript'</span><span class="token punctuation">,</span>
            <span class="token string single-quoted-string">'latex'</span> <span class="token operator">=&gt;</span> <span class="token string single-quoted-string">'application/x-latex'</span><span class="token punctuation">,</span>
            <span class="token string single-quoted-string">'lha'</span> <span class="token operator">=&gt;</span> <span class="token string single-quoted-string">'application/octet-stream'</span><span class="token punctuation">,</span>
            <span class="token string single-quoted-string">'lsf'</span> <span class="token operator">=&gt;</span> <span class="token string single-quoted-string">'video/x-la-asf'</span><span class="token punctuation">,</span>
            <span class="token string single-quoted-string">'lsx'</span> <span class="token operator">=&gt;</span> <span class="token string single-quoted-string">'video/x-la-asf'</span><span class="token punctuation">,</span>
            <span class="token string single-quoted-string">'lzh'</span> <span class="token operator">=&gt;</span> <span class="token string single-quoted-string">'application/octet-stream'</span><span class="token punctuation">,</span>
            <span class="token string single-quoted-string">'m13'</span> <span class="token operator">=&gt;</span> <span class="token string single-quoted-string">'application/x-msmediaview'</span><span class="token punctuation">,</span>
            <span class="token string single-quoted-string">'m14'</span> <span class="token operator">=&gt;</span> <span class="token string single-quoted-string">'application/x-msmediaview'</span><span class="token punctuation">,</span>
            <span class="token string single-quoted-string">'m3u'</span> <span class="token operator">=&gt;</span> <span class="token string single-quoted-string">'audio/x-mpegurl'</span><span class="token punctuation">,</span>
            <span class="token string single-quoted-string">'man'</span> <span class="token operator">=&gt;</span> <span class="token string single-quoted-string">'application/x-troff-man'</span><span class="token punctuation">,</span>
            <span class="token string single-quoted-string">'mdb'</span> <span class="token operator">=&gt;</span> <span class="token string single-quoted-string">'application/x-msaccess'</span><span class="token punctuation">,</span>
            <span class="token string single-quoted-string">'me'</span> <span class="token operator">=&gt;</span> <span class="token string single-quoted-string">'application/x-troff-me'</span><span class="token punctuation">,</span>
            <span class="token string single-quoted-string">'mht'</span> <span class="token operator">=&gt;</span> <span class="token string single-quoted-string">'message/rfc822'</span><span class="token punctuation">,</span>
            <span class="token string single-quoted-string">'mhtml'</span> <span class="token operator">=&gt;</span> <span class="token string single-quoted-string">'message/rfc822'</span><span class="token punctuation">,</span>
            <span class="token string single-quoted-string">'mid'</span> <span class="token operator">=&gt;</span> <span class="token string single-quoted-string">'audio/mid'</span><span class="token punctuation">,</span>
            <span class="token string single-quoted-string">'mny'</span> <span class="token operator">=&gt;</span> <span class="token string single-quoted-string">'application/x-msmoney'</span><span class="token punctuation">,</span>
            <span class="token string single-quoted-string">'mov'</span> <span class="token operator">=&gt;</span> <span class="token string single-quoted-string">'video/quicktime'</span><span class="token punctuation">,</span>
            <span class="token string single-quoted-string">'movie'</span> <span class="token operator">=&gt;</span> <span class="token string single-quoted-string">'video/x-sgi-movie'</span><span class="token punctuation">,</span>
            <span class="token string single-quoted-string">'mp2'</span> <span class="token operator">=&gt;</span> <span class="token string single-quoted-string">'video/mpeg'</span><span class="token punctuation">,</span>
            <span class="token string single-quoted-string">'mp3'</span> <span class="token operator">=&gt;</span> <span class="token string single-quoted-string">'audio/mpeg'</span><span class="token punctuation">,</span>
            <span class="token string single-quoted-string">'mpa'</span> <span class="token operator">=&gt;</span> <span class="token string single-quoted-string">'video/mpeg'</span><span class="token punctuation">,</span>
            <span class="token string single-quoted-string">'mpe'</span> <span class="token operator">=&gt;</span> <span class="token string single-quoted-string">'video/mpeg'</span><span class="token punctuation">,</span>
            <span class="token string single-quoted-string">'mpeg'</span> <span class="token operator">=&gt;</span> <span class="token string single-quoted-string">'video/mpeg'</span><span class="token punctuation">,</span>
            <span class="token string single-quoted-string">'mpg'</span> <span class="token operator">=&gt;</span> <span class="token string single-quoted-string">'video/mpeg'</span><span class="token punctuation">,</span>
            <span class="token string single-quoted-string">'mpp'</span> <span class="token operator">=&gt;</span> <span class="token string single-quoted-string">'application/vnd.ms-project'</span><span class="token punctuation">,</span>
            <span class="token string single-quoted-string">'mpv2'</span> <span class="token operator">=&gt;</span> <span class="token string single-quoted-string">'video/mpeg'</span><span class="token punctuation">,</span>
            <span class="token string single-quoted-string">'ms'</span> <span class="token operator">=&gt;</span> <span class="token string single-quoted-string">'application/x-troff-ms'</span><span class="token punctuation">,</span>
            <span class="token string single-quoted-string">'mvb'</span> <span class="token operator">=&gt;</span> <span class="token string single-quoted-string">'application/x-msmediaview'</span><span class="token punctuation">,</span>
            <span class="token string single-quoted-string">'nws'</span> <span class="token operator">=&gt;</span> <span class="token string single-quoted-string">'message/rfc822'</span><span class="token punctuation">,</span>
            <span class="token string single-quoted-string">'oda'</span> <span class="token operator">=&gt;</span> <span class="token string single-quoted-string">'application/oda'</span><span class="token punctuation">,</span>
            <span class="token string single-quoted-string">'p10'</span> <span class="token operator">=&gt;</span> <span class="token string single-quoted-string">'application/pkcs10'</span><span class="token punctuation">,</span>
            <span class="token string single-quoted-string">'p12'</span> <span class="token operator">=&gt;</span> <span class="token string single-quoted-string">'application/x-pkcs12'</span><span class="token punctuation">,</span>
            <span class="token string single-quoted-string">'p7b'</span> <span class="token operator">=&gt;</span> <span class="token string single-quoted-string">'application/x-pkcs7-certificates'</span><span class="token punctuation">,</span>
            <span class="token string single-quoted-string">'p7c'</span> <span class="token operator">=&gt;</span> <span class="token string single-quoted-string">'application/x-pkcs7-mime'</span><span class="token punctuation">,</span>
            <span class="token string single-quoted-string">'p7m'</span> <span class="token operator">=&gt;</span> <span class="token string single-quoted-string">'application/x-pkcs7-mime'</span><span class="token punctuation">,</span>
            <span class="token string single-quoted-string">'p7r'</span> <span class="token operator">=&gt;</span> <span class="token string single-quoted-string">'application/x-pkcs7-certreqresp'</span><span class="token punctuation">,</span>
            <span class="token string single-quoted-string">'p7s'</span> <span class="token operator">=&gt;</span> <span class="token string single-quoted-string">'application/x-pkcs7-signature'</span><span class="token punctuation">,</span>
            <span class="token string single-quoted-string">'pbm'</span> <span class="token operator">=&gt;</span> <span class="token string single-quoted-string">'image/x-portable-bitmap'</span><span class="token punctuation">,</span>
            <span class="token string single-quoted-string">'pdf'</span> <span class="token operator">=&gt;</span> <span class="token string single-quoted-string">'application/pdf'</span><span class="token punctuation">,</span>
            <span class="token string single-quoted-string">'pfx'</span> <span class="token operator">=&gt;</span> <span class="token string single-quoted-string">'application/x-pkcs12'</span><span class="token punctuation">,</span>
            <span class="token string single-quoted-string">'pgm'</span> <span class="token operator">=&gt;</span> <span class="token string single-quoted-string">'image/x-portable-graymap'</span><span class="token punctuation">,</span>
            <span class="token string single-quoted-string">'pko'</span> <span class="token operator">=&gt;</span> <span class="token string single-quoted-string">'application/ynd.ms-pkipko'</span><span class="token punctuation">,</span>
            <span class="token string single-quoted-string">'pma'</span> <span class="token operator">=&gt;</span> <span class="token string single-quoted-string">'application/x-perfmon'</span><span class="token punctuation">,</span>
            <span class="token string single-quoted-string">'pmc'</span> <span class="token operator">=&gt;</span> <span class="token string single-quoted-string">'application/x-perfmon'</span><span class="token punctuation">,</span>
            <span class="token string single-quoted-string">'pml'</span> <span class="token operator">=&gt;</span> <span class="token string single-quoted-string">'application/x-perfmon'</span><span class="token punctuation">,</span>
            <span class="token string single-quoted-string">'pmr'</span> <span class="token operator">=&gt;</span> <span class="token string single-quoted-string">'application/x-perfmon'</span><span class="token punctuation">,</span>
            <span class="token string single-quoted-string">'pmw'</span> <span class="token operator">=&gt;</span> <span class="token string single-quoted-string">'application/x-perfmon'</span><span class="token punctuation">,</span>
            <span class="token string single-quoted-string">'pnm'</span> <span class="token operator">=&gt;</span> <span class="token string single-quoted-string">'image/x-portable-anymap'</span><span class="token punctuation">,</span>
            <span class="token string single-quoted-string">'png'</span> <span class="token operator">=&gt;</span> <span class="token string single-quoted-string">'image/png'</span><span class="token punctuation">,</span>
            <span class="token string single-quoted-string">'pot'</span> <span class="token operator">=&gt;</span> <span class="token string single-quoted-string">'application/vnd.ms-powerpoint'</span><span class="token punctuation">,</span>
            <span class="token string single-quoted-string">'ppm'</span> <span class="token operator">=&gt;</span> <span class="token string single-quoted-string">'image/x-portable-pixmap'</span><span class="token punctuation">,</span>
            <span class="token string single-quoted-string">'pps'</span> <span class="token operator">=&gt;</span> <span class="token string single-quoted-string">'application/vnd.ms-powerpoint'</span><span class="token punctuation">,</span>
            <span class="token string single-quoted-string">'ppt'</span> <span class="token operator">=&gt;</span> <span class="token string single-quoted-string">'application/vnd.ms-powerpoint'</span><span class="token punctuation">,</span>
            <span class="token string single-quoted-string">'prf'</span> <span class="token operator">=&gt;</span> <span class="token string single-quoted-string">'application/pics-rules'</span><span class="token punctuation">,</span>
            <span class="token string single-quoted-string">'ps'</span> <span class="token operator">=&gt;</span> <span class="token string single-quoted-string">'application/postscript'</span><span class="token punctuation">,</span>
            <span class="token string single-quoted-string">'pub'</span> <span class="token operator">=&gt;</span> <span class="token string single-quoted-string">'application/x-mspublisher'</span><span class="token punctuation">,</span>
            <span class="token string single-quoted-string">'qt'</span> <span class="token operator">=&gt;</span> <span class="token string single-quoted-string">'video/quicktime'</span><span class="token punctuation">,</span>
            <span class="token string single-quoted-string">'ra'</span> <span class="token operator">=&gt;</span> <span class="token string single-quoted-string">'audio/x-pn-realaudio'</span><span class="token punctuation">,</span>
            <span class="token string single-quoted-string">'ram'</span> <span class="token operator">=&gt;</span> <span class="token string single-quoted-string">'audio/x-pn-realaudio'</span><span class="token punctuation">,</span>
            <span class="token string single-quoted-string">'ras'</span> <span class="token operator">=&gt;</span> <span class="token string single-quoted-string">'image/x-cmu-raster'</span><span class="token punctuation">,</span>
            <span class="token string single-quoted-string">'rgb'</span> <span class="token operator">=&gt;</span> <span class="token string single-quoted-string">'image/x-rgb'</span><span class="token punctuation">,</span>
            <span class="token string single-quoted-string">'rmi'</span> <span class="token operator">=&gt;</span> <span class="token string single-quoted-string">'audio/mid'</span><span class="token punctuation">,</span>
            <span class="token string single-quoted-string">'roff'</span> <span class="token operator">=&gt;</span> <span class="token string single-quoted-string">'application/x-troff'</span><span class="token punctuation">,</span>
            <span class="token string single-quoted-string">'rtf'</span> <span class="token operator">=&gt;</span> <span class="token string single-quoted-string">'application/rtf'</span><span class="token punctuation">,</span>
            <span class="token string single-quoted-string">'rtx'</span> <span class="token operator">=&gt;</span> <span class="token string single-quoted-string">'text/richtext'</span><span class="token punctuation">,</span>
            <span class="token string single-quoted-string">'scd'</span> <span class="token operator">=&gt;</span> <span class="token string single-quoted-string">'application/x-msschedule'</span><span class="token punctuation">,</span>
            <span class="token string single-quoted-string">'sct'</span> <span class="token operator">=&gt;</span> <span class="token string single-quoted-string">'text/scriptlet'</span><span class="token punctuation">,</span>
            <span class="token string single-quoted-string">'setpay'</span> <span class="token operator">=&gt;</span> <span class="token string single-quoted-string">'application/set-payment-initiation'</span><span class="token punctuation">,</span>
            <span class="token string single-quoted-string">'setreg'</span> <span class="token operator">=&gt;</span> <span class="token string single-quoted-string">'application/set-registration-initiation'</span><span class="token punctuation">,</span>
            <span class="token string single-quoted-string">'sh'</span> <span class="token operator">=&gt;</span> <span class="token string single-quoted-string">'application/x-sh'</span><span class="token punctuation">,</span>
            <span class="token string single-quoted-string">'shar'</span> <span class="token operator">=&gt;</span> <span class="token string single-quoted-string">'application/x-shar'</span><span class="token punctuation">,</span>
            <span class="token string single-quoted-string">'sit'</span> <span class="token operator">=&gt;</span> <span class="token string single-quoted-string">'application/x-stuffit'</span><span class="token punctuation">,</span>
            <span class="token string single-quoted-string">'snd'</span> <span class="token operator">=&gt;</span> <span class="token string single-quoted-string">'audio/basic'</span><span class="token punctuation">,</span>
            <span class="token string single-quoted-string">'spc'</span> <span class="token operator">=&gt;</span> <span class="token string single-quoted-string">'application/x-pkcs7-certificates'</span><span class="token punctuation">,</span>
            <span class="token string single-quoted-string">'spl'</span> <span class="token operator">=&gt;</span> <span class="token string single-quoted-string">'application/futuresplash'</span><span class="token punctuation">,</span>
            <span class="token string single-quoted-string">'src'</span> <span class="token operator">=&gt;</span> <span class="token string single-quoted-string">'application/x-wais-source'</span><span class="token punctuation">,</span>
            <span class="token string single-quoted-string">'sst'</span> <span class="token operator">=&gt;</span> <span class="token string single-quoted-string">'application/vnd.ms-pkicertstore'</span><span class="token punctuation">,</span>
            <span class="token string single-quoted-string">'stl'</span> <span class="token operator">=&gt;</span> <span class="token string single-quoted-string">'application/vnd.ms-pkistl'</span><span class="token punctuation">,</span>
            <span class="token string single-quoted-string">'stm'</span> <span class="token operator">=&gt;</span> <span class="token string single-quoted-string">'text/html'</span><span class="token punctuation">,</span>
            <span class="token string single-quoted-string">'svg'</span> <span class="token operator">=&gt;</span> <span class="token string single-quoted-string">'image/svg+xml'</span><span class="token punctuation">,</span>
            <span class="token string single-quoted-string">'sv4cpio'</span> <span class="token operator">=&gt;</span> <span class="token string single-quoted-string">'application/x-sv4cpio'</span><span class="token punctuation">,</span>
            <span class="token string single-quoted-string">'sv4crc'</span> <span class="token operator">=&gt;</span> <span class="token string single-quoted-string">'application/x-sv4crc'</span><span class="token punctuation">,</span>
            <span class="token string single-quoted-string">'swf'</span> <span class="token operator">=&gt;</span> <span class="token string single-quoted-string">'application/x-shockwave-flash'</span><span class="token punctuation">,</span>
            <span class="token string single-quoted-string">'t'</span> <span class="token operator">=&gt;</span> <span class="token string single-quoted-string">'application/x-troff'</span><span class="token punctuation">,</span>
            <span class="token string single-quoted-string">'tar'</span> <span class="token operator">=&gt;</span> <span class="token string single-quoted-string">'application/x-tar'</span><span class="token punctuation">,</span>
            <span class="token string single-quoted-string">'tcl'</span> <span class="token operator">=&gt;</span> <span class="token string single-quoted-string">'application/x-tcl'</span><span class="token punctuation">,</span>
            <span class="token string single-quoted-string">'tex'</span> <span class="token operator">=&gt;</span> <span class="token string single-quoted-string">'application/x-tex'</span><span class="token punctuation">,</span>
            <span class="token string single-quoted-string">'texi'</span> <span class="token operator">=&gt;</span> <span class="token string single-quoted-string">'application/x-texinfo'</span><span class="token punctuation">,</span>
            <span class="token string single-quoted-string">'texinfo'</span> <span class="token operator">=&gt;</span> <span class="token string single-quoted-string">'application/x-texinfo'</span><span class="token punctuation">,</span>
            <span class="token string single-quoted-string">'tgz'</span> <span class="token operator">=&gt;</span> <span class="token string single-quoted-string">'application/x-compressed'</span><span class="token punctuation">,</span>
            <span class="token string single-quoted-string">'tif'</span> <span class="token operator">=&gt;</span> <span class="token string single-quoted-string">'image/tiff'</span><span class="token punctuation">,</span>
            <span class="token string single-quoted-string">'tiff'</span> <span class="token operator">=&gt;</span> <span class="token string single-quoted-string">'image/tiff'</span><span class="token punctuation">,</span>
            <span class="token string single-quoted-string">'tr'</span> <span class="token operator">=&gt;</span> <span class="token string single-quoted-string">'application/x-troff'</span><span class="token punctuation">,</span>
            <span class="token string single-quoted-string">'trm'</span> <span class="token operator">=&gt;</span> <span class="token string single-quoted-string">'application/x-msterminal'</span><span class="token punctuation">,</span>
            <span class="token string single-quoted-string">'tsv'</span> <span class="token operator">=&gt;</span> <span class="token string single-quoted-string">'text/tab-separated-values'</span><span class="token punctuation">,</span>
            <span class="token string single-quoted-string">'txt'</span> <span class="token operator">=&gt;</span> <span class="token string single-quoted-string">'text/plain'</span><span class="token punctuation">,</span>
            <span class="token string single-quoted-string">'uls'</span> <span class="token operator">=&gt;</span> <span class="token string single-quoted-string">'text/iuls'</span><span class="token punctuation">,</span>
            <span class="token string single-quoted-string">'ustar'</span> <span class="token operator">=&gt;</span> <span class="token string single-quoted-string">'application/x-ustar'</span><span class="token punctuation">,</span>
            <span class="token string single-quoted-string">'vcf'</span> <span class="token operator">=&gt;</span> <span class="token string single-quoted-string">'text/x-vcard'</span><span class="token punctuation">,</span>
            <span class="token string single-quoted-string">'vrml'</span> <span class="token operator">=&gt;</span> <span class="token string single-quoted-string">'x-world/x-vrml'</span><span class="token punctuation">,</span>
            <span class="token string single-quoted-string">'wav'</span> <span class="token operator">=&gt;</span> <span class="token string single-quoted-string">'audio/x-wav'</span><span class="token punctuation">,</span>
            <span class="token string single-quoted-string">'wcm'</span> <span class="token operator">=&gt;</span> <span class="token string single-quoted-string">'application/vnd.ms-works'</span><span class="token punctuation">,</span>
            <span class="token string single-quoted-string">'wdb'</span> <span class="token operator">=&gt;</span> <span class="token string single-quoted-string">'application/vnd.ms-works'</span><span class="token punctuation">,</span>
            <span class="token string single-quoted-string">'wks'</span> <span class="token operator">=&gt;</span> <span class="token string single-quoted-string">'application/vnd.ms-works'</span><span class="token punctuation">,</span>
            <span class="token string single-quoted-string">'wmf'</span> <span class="token operator">=&gt;</span> <span class="token string single-quoted-string">'application/x-msmetafile'</span><span class="token punctuation">,</span>
            <span class="token string single-quoted-string">'wps'</span> <span class="token operator">=&gt;</span> <span class="token string single-quoted-string">'application/vnd.ms-works'</span><span class="token punctuation">,</span>
            <span class="token string single-quoted-string">'wri'</span> <span class="token operator">=&gt;</span> <span class="token string single-quoted-string">'application/x-mswrite'</span><span class="token punctuation">,</span>
            <span class="token string single-quoted-string">'wrl'</span> <span class="token operator">=&gt;</span> <span class="token string single-quoted-string">'x-world/x-vrml'</span><span class="token punctuation">,</span>
            <span class="token string single-quoted-string">'wrz'</span> <span class="token operator">=&gt;</span> <span class="token string single-quoted-string">'x-world/x-vrml'</span><span class="token punctuation">,</span>
            <span class="token string single-quoted-string">'xaf'</span> <span class="token operator">=&gt;</span><span class="token string single-quoted-string">'x-world/x-vrml'</span><span class="token punctuation">,</span>
            <span class="token string single-quoted-string">'xbm'</span> <span class="token operator">=&gt;</span> <span class="token string single-quoted-string">'image/x-xbitmap'</span><span class="token punctuation">,</span>
            <span class="token string single-quoted-string">'xla'</span> <span class="token operator">=&gt;</span> <span class="token string single-quoted-string">'application/vnd.ms-excel'</span><span class="token punctuation">,</span>
            <span class="token string single-quoted-string">'xlc'</span> <span class="token operator">=&gt;</span> <span class="token string single-quoted-string">'application/vnd.ms-excel'</span><span class="token punctuation">,</span>
            <span class="token string single-quoted-string">'xlm'</span> <span class="token operator">=&gt;</span> <span class="token string single-quoted-string">'application/vnd.ms-excel'</span><span class="token punctuation">,</span>
            <span class="token string single-quoted-string">'xls'</span> <span class="token operator">=&gt;</span> <span class="token string single-quoted-string">'application/vnd.ms-excel'</span><span class="token punctuation">,</span>
            <span class="token string single-quoted-string">'xlt'</span> <span class="token operator">=&gt;</span> <span class="token string single-quoted-string">'application/vnd.ms-excel'</span><span class="token punctuation">,</span>
            <span class="token string single-quoted-string">'xlw'</span> <span class="token operator">=&gt;</span> <span class="token string single-quoted-string">'application/vnd.ms-excel'</span><span class="token punctuation">,</span>
            <span class="token string single-quoted-string">'xof'</span> <span class="token operator">=&gt;</span> <span class="token string single-quoted-string">'x-world/x-vrml'</span><span class="token punctuation">,</span>
            <span class="token string single-quoted-string">'xpm'</span> <span class="token operator">=&gt;</span> <span class="token string single-quoted-string">'image/x-xpixmap'</span><span class="token punctuation">,</span>
            <span class="token string single-quoted-string">'xwd'</span> <span class="token operator">=&gt;</span> <span class="token string single-quoted-string">'image/x-xwindowdump'</span><span class="token punctuation">,</span>
            <span class="token string single-quoted-string">'z'</span> <span class="token operator">=&gt;</span> <span class="token string single-quoted-string">'application/x-compress'</span><span class="token punctuation">,</span>
            <span class="token string single-quoted-string">'zip'</span> <span class="token operator">=&gt;</span> <span class="token string single-quoted-string">'application/zip'</span>
        <span class="token punctuation">]</span><span class="token punctuation">;</span>
        <span class="token variable">$str</span> <span class="token operator">=</span> <span class="token string double-quoted-string">&quot;&quot;</span><span class="token punctuation">;</span>
        <span class="token keyword">foreach</span><span class="token punctuation">(</span><span class="token variable">$arr</span> <span class="token keyword">as</span> <span class="token variable">$k</span> <span class="token operator">=&gt;</span> <span class="token variable">$v</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
            <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token variable">$type</span> <span class="token operator">==</span> <span class="token variable">$v</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
                <span class="token variable">$str</span> <span class="token operator">=</span> <span class="token variable">$k</span><span class="token punctuation">;</span>
                <span class="token keyword">break</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span>
        <span class="token punctuation">}</span>
        <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token variable">$str</span> <span class="token operator">==</span> <span class="token string double-quoted-string">&quot;jpe&quot;</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
            <span class="token variable">$str</span> <span class="token operator">=</span> <span class="token string double-quoted-string">&quot;jpg&quot;</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
        <span class="token keyword">return</span> <span class="token variable">$str</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</span></code></pre></div><div class="language-php extra-class"><pre class="language-php"><code><span class="token comment">/**********文件类型识别********************************************************/</span>
<span class="token comment">//$type为当前文件类型，即HTTP content-type</span>
<span class="token comment">//注fileType为php自带函数</span>
<span class="token keyword">function</span> <span class="token function-definition function">typeFile</span><span class="token punctuation">(</span><span class="token variable">$type</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
    <span class="token variable">$data</span> <span class="token operator">=</span> <span class="token keyword">array</span><span class="token punctuation">(</span>
        <span class="token string double-quoted-string">&quot;img&quot;</span> <span class="token operator">=&gt;</span> <span class="token keyword">array</span><span class="token punctuation">(</span>
            <span class="token string double-quoted-string">&quot;image/jpeg&quot;</span><span class="token punctuation">,</span>
            <span class="token string double-quoted-string">&quot;image/png&quot;</span><span class="token punctuation">,</span>
            <span class="token string double-quoted-string">&quot;image/gif&quot;</span><span class="token punctuation">,</span>
        <span class="token punctuation">)</span><span class="token punctuation">,</span>
        <span class="token string double-quoted-string">&quot;word&quot;</span> <span class="token operator">=&gt;</span> <span class="token keyword">array</span><span class="token punctuation">(</span>
            <span class="token string double-quoted-string">&quot;application/vnd.openxmlformats-officedocument.wordprocessingml.document&quot;</span><span class="token punctuation">,</span>
            <span class="token string double-quoted-string">&quot;application/msword&quot;</span><span class="token punctuation">,</span>
        <span class="token punctuation">)</span><span class="token punctuation">,</span>
        <span class="token string double-quoted-string">&quot;excel&quot;</span> <span class="token operator">=&gt;</span> <span class="token keyword">array</span><span class="token punctuation">(</span>
            <span class="token string double-quoted-string">&quot;application/vnd.openxmlformats-officedocument.spreadsheetml.sheet&quot;</span><span class="token punctuation">,</span>
            <span class="token string double-quoted-string">&quot;application/vnd.ms-excel&quot;</span><span class="token punctuation">,</span>
        <span class="token punctuation">)</span><span class="token punctuation">,</span>
        <span class="token string double-quoted-string">&quot;ppt&quot;</span> <span class="token operator">=&gt;</span> <span class="token keyword">array</span><span class="token punctuation">(</span>
            <span class="token string double-quoted-string">&quot;application/vnd.ms-powerpoint&quot;</span><span class="token punctuation">,</span>
            <span class="token string double-quoted-string">&quot;application/vnd.openxmlformats-officedocument.presentationml.presentation&quot;</span><span class="token punctuation">,</span>
        <span class="token punctuation">)</span><span class="token punctuation">,</span>
        <span class="token string double-quoted-string">&quot;pdf&quot;</span> <span class="token operator">=&gt;</span> <span class="token keyword">array</span><span class="token punctuation">(</span>
            <span class="token string double-quoted-string">&quot;application/pdf&quot;</span><span class="token punctuation">,</span>
        <span class="token punctuation">)</span><span class="token punctuation">,</span>
        <span class="token string double-quoted-string">&quot;zip&quot;</span> <span class="token operator">=&gt;</span> <span class="token keyword">array</span><span class="token punctuation">(</span>
            <span class="token string double-quoted-string">&quot;application/x-zip-compressed&quot;</span><span class="token punctuation">,</span>
        <span class="token punctuation">)</span><span class="token punctuation">,</span>
    <span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">foreach</span><span class="token punctuation">(</span><span class="token variable">$data</span> <span class="token keyword">as</span> <span class="token variable">$key</span> <span class="token operator">=&gt;</span> <span class="token variable">$value</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
        <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token function">in_array</span><span class="token punctuation">(</span><span class="token variable">$type</span><span class="token punctuation">,</span><span class="token variable">$value</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
            <span class="token variable">$result</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'type'</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token variable">$key</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
    <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token variable">$type</span> <span class="token operator">==</span> <span class="token string double-quoted-string">&quot;application/octet-stream&quot;</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
        <span class="token variable">$result</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'warn'</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token string double-quoted-string">&quot;未知文件类型，可能对系统造成风险！&quot;</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span><span class="token keyword">elseif</span><span class="token punctuation">(</span><span class="token keyword">empty</span><span class="token punctuation">(</span><span class="token variable">$result</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'type'</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
        <span class="token variable">$result</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'warn'</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token string double-quoted-string">&quot;目前仅支持【&quot;</span><span class="token operator">.</span><span class="token function">implode</span><span class="token punctuation">(</span><span class="token string double-quoted-string">&quot;，&quot;</span><span class="token punctuation">,</span><span class="token function">array_keys</span><span class="token punctuation">(</span><span class="token variable">$data</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token operator">.</span><span class="token string double-quoted-string">&quot;】类型的文件上传，您当前的文件类型为【&quot;</span><span class="token operator">.</span><span class="token variable">$type</span><span class="token operator">.</span><span class="token string double-quoted-string">&quot;】&quot;</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token keyword">return</span> <span class="token variable">$result</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre></div></li> <li><p>同时,提交表单的方法也要换成可以上传文件的方法</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token comment">/********异步提交函数**************************/</span>
<span class="token comment">//图片上传版本js</span>
<span class="token keyword">function</span> <span class="token function">upForm</span><span class="token punctuation">(</span><span class="token parameter">form<span class="token punctuation">,</span>url</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
    <span class="token comment">// alert(form);</span>
    <span class="token comment">//防止高频点击</span>
    <span class="token keyword">var</span> date <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Date</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">var</span> time <span class="token operator">=</span> date<span class="token punctuation">.</span><span class="token function">getTime</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">//毫秒时间戳</span>
    <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token keyword">typeof</span> minTime <span class="token operator">==</span> <span class="token string">&quot;undefined&quot;</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
        <span class="token keyword">var</span> finger <span class="token operator">=</span> <span class="token number">2</span><span class="token punctuation">;</span>
        minTime <span class="token operator">=</span> time<span class="token operator">+</span><span class="token number">2000</span><span class="token punctuation">;</span><span class="token comment">//下次点击的最小时间</span>
        console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">&quot;定义minTime&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span><span class="token keyword">else</span><span class="token punctuation">{</span>
        <span class="token keyword">if</span><span class="token punctuation">(</span>minTime <span class="token operator">&amp;&amp;</span> time <span class="token operator">&lt;</span> minTime<span class="token punctuation">)</span><span class="token punctuation">{</span>
            <span class="token keyword">var</span> finger <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">;</span>
            <span class="token function">warn</span><span class="token punctuation">(</span><span class="token string">&quot;操作过于频繁&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">&quot;time:&quot;</span><span class="token operator">+</span>time<span class="token operator">+</span><span class="token string">&quot;，mintime:&quot;</span><span class="token operator">+</span>minTime<span class="token operator">+</span><span class="token string">&quot;，差额：&quot;</span><span class="token operator">+</span><span class="token punctuation">(</span>time<span class="token operator">-</span>minTime<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span><span class="token keyword">else</span><span class="token punctuation">{</span>
            <span class="token keyword">var</span> finger <span class="token operator">=</span> <span class="token number">2</span><span class="token punctuation">;</span>
            console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">&quot;time:&quot;</span><span class="token operator">+</span>time<span class="token operator">+</span><span class="token string">&quot;，mintime:&quot;</span><span class="token operator">+</span>minTime<span class="token operator">+</span><span class="token string">&quot;，多出：&quot;</span><span class="token operator">+</span><span class="token punctuation">(</span>time<span class="token operator">-</span>minTime<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            minTime <span class="token operator">=</span> time<span class="token operator">+</span><span class="token number">2000</span><span class="token punctuation">;</span><span class="token comment">//下次点击的最小时间</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
    <span class="token keyword">if</span><span class="token punctuation">(</span>finger <span class="token operator">==</span> <span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
        <span class="token function">$</span><span class="token punctuation">(</span><span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
            <span class="token keyword">var</span> formData <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">FormData</span><span class="token punctuation">(</span><span class="token function">$</span><span class="token punctuation">(</span><span class="token string">&quot;[name='&quot;</span><span class="token operator">+</span>form<span class="token operator">+</span><span class="token string">&quot;']&quot;</span><span class="token punctuation">)</span><span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>formData<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token string">'file'</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            $<span class="token punctuation">.</span><span class="token function">ajax</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
                <span class="token literal-property property">url</span><span class="token operator">:</span> url<span class="token punctuation">,</span>
                <span class="token literal-property property">type</span><span class="token operator">:</span> <span class="token string">'POST'</span><span class="token punctuation">,</span>
                <span class="token literal-property property">cache</span><span class="token operator">:</span> <span class="token boolean">false</span><span class="token punctuation">,</span>
                <span class="token literal-property property">data</span><span class="token operator">:</span> formData<span class="token punctuation">,</span>
                <span class="token comment">// 告诉jQuery不要去处理发送的数据</span>
                <span class="token literal-property property">processData</span><span class="token operator">:</span> <span class="token boolean">false</span><span class="token punctuation">,</span>
                <span class="token comment">// 告诉jQuery不要去设置Content-Type请求头</span>
                <span class="token literal-property property">contentType</span><span class="token operator">:</span> <span class="token boolean">false</span><span class="token punctuation">,</span>
                <span class="token function-variable function">beforeSend</span><span class="token operator">:</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
                    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">&quot;正在进行，请稍候&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token punctuation">}</span><span class="token punctuation">,</span>
                <span class="token function-variable function">success</span><span class="token operator">:</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token parameter">res</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
                    <span class="token keyword">var</span> data <span class="token operator">=</span> <span class="token constant">JSON</span><span class="token punctuation">.</span><span class="token function">parse</span><span class="token punctuation">(</span>res<span class="token punctuation">)</span><span class="token punctuation">;</span>
                    <span class="token keyword">if</span> <span class="token punctuation">(</span>data<span class="token punctuation">.</span>warn <span class="token operator">==</span> <span class="token number">2</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
                        <span class="token keyword">if</span> <span class="token punctuation">(</span>data<span class="token punctuation">.</span>href<span class="token punctuation">)</span> <span class="token punctuation">{</span><span class="token comment">//如果异步返回的json参数中定义了重定向url，则跳转到本url</span>
                            window<span class="token punctuation">.</span>location<span class="token punctuation">.</span>href <span class="token operator">=</span> data<span class="token punctuation">.</span>href<span class="token punctuation">;</span>
                        <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
                            window<span class="token punctuation">.</span>location<span class="token punctuation">.</span><span class="token function">reload</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                        <span class="token punctuation">}</span>
                    <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
                        <span class="token function">warn</span><span class="token punctuation">(</span>data<span class="token punctuation">.</span>warn<span class="token punctuation">)</span><span class="token punctuation">;</span>
                    <span class="token punctuation">}</span>
                <span class="token punctuation">}</span><span class="token punctuation">,</span>
                <span class="token function-variable function">error</span><span class="token operator">:</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token parameter">responseStr</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
                    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">&quot;error&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token punctuation">}</span>
            <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token punctuation">}</span><span class="token punctuation">)</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div></li></ul> <h2 id="导出"><a href="#导出" class="header-anchor">#</a> 导出</h2> <ul><li><p>最新的导出</p></li> <li><div class="language-php extra-class"><pre class="language-php"><code><span class="token comment">/***导出****/</span>
<span class="token keyword">public</span> <span class="token keyword">function</span> <span class="token function-definition function">export</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
    <span class="token comment">/************************员工管理-导出excel*****************************/</span>
    <span class="token comment">//查询你要导出的数据库表的所有备注和字段名</span>
    <span class="token variable">$productArr</span> <span class="token operator">=</span> <span class="token variable">$this</span><span class="token operator">-&gt;</span><span class="token function">sqlQueryAll</span><span class="token punctuation">(</span><span class="token string double-quoted-string">&quot;SELECT  
                        COLUMN_NAME as `字段名`,  
                        COLUMN_COMMENT  AS  `备注`  
                        FROM information_schema.COLUMNS WHERE TABLE_NAME='product'&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token keyword">foreach</span> <span class="token punctuation">(</span><span class="token variable">$productArr</span> <span class="token keyword">as</span> <span class="token variable">$thing</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
        <span class="token comment">//如果表中有用不到的字段就用判断排除</span>
        <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token variable">$thing</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'字段名'</span><span class="token punctuation">]</span><span class="token operator">!=</span><span class="token string double-quoted-string">&quot;id&quot;</span><span class="token operator">&amp;&amp;</span><span class="token variable">$thing</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'字段名'</span><span class="token punctuation">]</span><span class="token operator">!=</span><span class="token string double-quoted-string">&quot;time&quot;</span><span class="token operator">&amp;&amp;</span><span class="token variable">$thing</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'字段名'</span><span class="token punctuation">]</span><span class="token operator">!=</span><span class="token string double-quoted-string">&quot;updateTime&quot;</span>
           <span class="token operator">&amp;&amp;</span><span class="token variable">$thing</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'字段名'</span><span class="token punctuation">]</span><span class="token operator">!=</span><span class="token string double-quoted-string">&quot;isUse&quot;</span>
          <span class="token punctuation">)</span><span class="token punctuation">{</span>
            <span class="token variable">$wordArr</span><span class="token punctuation">[</span><span class="token variable">$thing</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'字段名'</span><span class="token punctuation">]</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token variable">$thing</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'备注'</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
    <span class="token comment">//取出session中存储的模糊查询sql语句</span>
    <span class="token variable">$product</span> <span class="token operator">=</span> <span class="token variable">$this</span><span class="token operator">-&gt;</span><span class="token function">sqlQueryAll</span><span class="token punctuation">(</span><span class="token variable">$this</span><span class="token operator">-&gt;</span><span class="token property">get</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'sql'</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>  <span class="token comment">//查你要导出的数据的那张表</span>
    <span class="token variable">$config</span> <span class="token operator">=</span> <span class="token punctuation">[</span>
        <span class="token string single-quoted-string">'path'</span> <span class="token operator">=&gt;</span> <span class="token variable">$this</span><span class="token operator">-&gt;</span><span class="token function">getTmpDir</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">.</span> <span class="token string single-quoted-string">'/'</span><span class="token punctuation">,</span>
    <span class="token punctuation">]</span><span class="token punctuation">;</span>
    <span class="token variable">$name</span> <span class="token operator">=</span> <span class="token string double-quoted-string">&quot;产品信息&quot;</span><span class="token operator">.</span><span class="token function">date</span><span class="token punctuation">(</span><span class="token string double-quoted-string">&quot;YmdHis&quot;</span><span class="token punctuation">)</span><span class="token operator">.</span><span class="token string double-quoted-string">&quot;.xlsx&quot;</span><span class="token punctuation">;</span>
    <span class="token variable">$fileName</span>   <span class="token operator">=</span> <span class="token variable">$name</span> <span class="token punctuation">;</span>
    <span class="token variable">$xlsxObject</span> <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name class-name-fully-qualified"><span class="token punctuation">\</span>Vtiful<span class="token punctuation">\</span>Kernel<span class="token punctuation">\</span>Excel</span><span class="token punctuation">(</span><span class="token variable">$config</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token comment">// Init File</span>
    <span class="token comment">//    $fileObject = $excel-&gt;fileName($fileName);</span>
    <span class="token variable">$fileObject</span> <span class="token operator">=</span> <span class="token variable">$xlsxObject</span><span class="token operator">-&gt;</span><span class="token function">fileName</span><span class="token punctuation">(</span><span class="token variable">$fileName</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token variable">$head</span> <span class="token operator">=</span> <span class="token keyword">array</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token variable">$word</span> <span class="token operator">=</span> <span class="token keyword">array</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token variable">$sqlWord</span> <span class="token operator">=</span> <span class="token keyword">array</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>


    <span class="token keyword">foreach</span> <span class="token punctuation">(</span><span class="token variable">$wordArr</span> <span class="token keyword">as</span> <span class="token variable">$k</span><span class="token operator">=&gt;</span><span class="token variable">$v</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
        <span class="token variable">$sqlWord</span><span class="token punctuation">[</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token variable">$k</span><span class="token punctuation">;</span>   <span class="token comment">//一维数组,字段名,英文</span>
        <span class="token variable">$head</span><span class="token punctuation">[</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token variable">$wordArr</span><span class="token punctuation">[</span><span class="token variable">$k</span><span class="token punctuation">]</span><span class="token punctuation">;</span>  <span class="token comment">//一维数组,表头,中文</span>
    <span class="token punctuation">}</span>
    <span class="token variable">$head</span><span class="token punctuation">[</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token string double-quoted-string">&quot;状态&quot;</span><span class="token punctuation">;</span>
    <span class="token keyword">foreach</span> <span class="token punctuation">(</span><span class="token variable">$product</span> <span class="token keyword">as</span> <span class="token variable">$c</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
        <span class="token variable">$box</span> <span class="token operator">=</span> <span class="token keyword">array</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>  <span class="token comment">//一维数组,放每个数据,直到塞满一条就清空</span>
        <span class="token keyword">foreach</span> <span class="token punctuation">(</span><span class="token variable">$sqlWord</span> <span class="token keyword">as</span> <span class="token variable">$english</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token variable">$box</span><span class="token punctuation">[</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token variable">$c</span><span class="token punctuation">[</span><span class="token variable">$english</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
        <span class="token variable">$box</span><span class="token punctuation">[</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token variable">$c</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'isUse'</span><span class="token punctuation">]</span><span class="token operator">==</span><span class="token number">0</span><span class="token operator">?</span><span class="token string single-quoted-string">'停用'</span><span class="token punctuation">:</span><span class="token string single-quoted-string">'启用'</span><span class="token punctuation">;</span>
        <span class="token variable">$word</span><span class="token punctuation">[</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token variable">$box</span><span class="token punctuation">;</span> <span class="token comment">//二维数组,[0] =&gt; 第一条数据,[1] =&gt; 第二条数据</span>
    <span class="token punctuation">}</span>

    <span class="token comment">// Writing data to a file ......</span>
    <span class="token variable">$fileObject</span><span class="token operator">-&gt;</span><span class="token function">header</span><span class="token punctuation">(</span><span class="token variable">$head</span><span class="token punctuation">)</span><span class="token operator">-&gt;</span>
        <span class="token function">data</span><span class="token punctuation">(</span><span class="token variable">$word</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token comment">// Outptu</span>
    <span class="token variable">$filePath</span> <span class="token operator">=</span> <span class="token variable">$fileObject</span><span class="token operator">-&gt;</span><span class="token function">output</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token comment">// Set Header</span>
    <span class="token function">header</span><span class="token punctuation">(</span><span class="token string double-quoted-string">&quot;Content-Type: application/vnd.openxmlformats-officedocument.spreadsheetml.sheet&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token function">header</span><span class="token punctuation">(</span><span class="token string single-quoted-string">'Content-Disposition: attachment;filename=&quot;'</span> <span class="token operator">.</span> <span class="token variable">$fileName</span> <span class="token operator">.</span> <span class="token string single-quoted-string">'&quot;'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token function">header</span><span class="token punctuation">(</span><span class="token string single-quoted-string">'Cache-Control: max-age=0'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token function">copy</span><span class="token punctuation">(</span><span class="token variable">$filePath</span><span class="token punctuation">,</span> <span class="token string single-quoted-string">'php://output'</span><span class="token punctuation">)</span> <span class="token operator">===</span> <span class="token constant boolean">false</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token comment">// Throw exception</span>
    <span class="token punctuation">}</span>

    <span class="token comment">// Delete temporary file</span>
    @<span class="token function">unlink</span><span class="token punctuation">(</span><span class="token variable">$filePath</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token punctuation">}</span>
</code></pre></div></li></ul> <h2 id="word"><a href="#word" class="header-anchor">#</a> Word</h2> <ul><li><p>html生成word文档</p></li> <li><p>首先有两个方法,一个是生成文档,一个是生成并且下载文档</p> <div class="language-php extra-class"><pre class="language-php"><code><span class="token comment">/***生成文档***/</span>
<span class="token keyword">function</span> <span class="token function-definition function">createWord</span><span class="token punctuation">(</span><span class="token variable">$content</span><span class="token operator">=</span><span class="token string single-quoted-string">''</span><span class="token punctuation">,</span><span class="token variable">$fileName</span><span class="token operator">=</span><span class="token string single-quoted-string">'new_file.doc'</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
    <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token keyword">empty</span><span class="token punctuation">(</span><span class="token variable">$content</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
        <span class="token keyword">return</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token variable">$content</span><span class="token operator">=</span><span class="token string single-quoted-string">'&lt;html 
            xmlns:o=&quot;urn:schemas-microsoft-com:office:office&quot; 
            xmlns:w=&quot;urn:schemas-microsoft-com:office:word&quot; 
            xmlns=&quot;http://www.w3.org/TR/REC-html40&quot;&gt;
            &lt;meta charset=&quot;UTF-8&quot; /&gt;'</span><span class="token operator">.</span><span class="token variable">$content</span><span class="token operator">.</span><span class="token string single-quoted-string">'&lt;/html&gt;'</span><span class="token punctuation">;</span>
    <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token keyword">empty</span><span class="token punctuation">(</span><span class="token variable">$fileName</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
        <span class="token variable">$fileName</span><span class="token operator">=</span><span class="token function">date</span><span class="token punctuation">(</span><span class="token string single-quoted-string">'YmdHis'</span><span class="token punctuation">)</span><span class="token operator">.</span><span class="token string single-quoted-string">'.doc'</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token variable">$fp</span><span class="token operator">=</span><span class="token function">fopen</span><span class="token punctuation">(</span><span class="token variable">$fileName</span><span class="token punctuation">,</span><span class="token string single-quoted-string">'wb'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token function">fwrite</span><span class="token punctuation">(</span><span class="token variable">$fp</span><span class="token punctuation">,</span><span class="token variable">$content</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token function">fclose</span><span class="token punctuation">(</span><span class="token variable">$fp</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token comment">/**
     * @desc 方法二、生成word文档并下载
     * @param $content
     * @param string $fileName
     */</span>
<span class="token keyword">function</span> <span class="token function-definition function">downloadWord</span><span class="token punctuation">(</span><span class="token variable">$content</span><span class="token punctuation">,</span> <span class="token variable">$fileName</span><span class="token operator">=</span><span class="token string single-quoted-string">'new_file.doc'</span><span class="token punctuation">)</span><span class="token punctuation">{</span>

    <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token keyword">empty</span><span class="token punctuation">(</span><span class="token variable">$content</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
        <span class="token keyword">return</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token function">header</span><span class="token punctuation">(</span><span class="token string double-quoted-string">&quot;Cache-Control: no-cache, must-revalidate&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token function">header</span><span class="token punctuation">(</span><span class="token string double-quoted-string">&quot;Pragma: no-cache&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token function">header</span><span class="token punctuation">(</span><span class="token string double-quoted-string">&quot;Content-Type: application/octet-stream&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token function">header</span><span class="token punctuation">(</span><span class="token string double-quoted-string">&quot;Content-Disposition: attachment; filename=<span class="token interpolation"><span class="token variable">$fileName</span></span>&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token variable">$html</span> <span class="token operator">=</span> <span class="token string single-quoted-string">'&lt;html xmlns:v=&quot;urn:schemas-microsoft-com:vml&quot;
         xmlns:o=&quot;urn:schemas-microsoft-com:office:office&quot;
         xmlns:w=&quot;urn:schemas-microsoft-com:office:word&quot; 
         xmlns:m=&quot;http://schemas.microsoft.com/office/2004/12/omml&quot; 
         xmlns=&quot;http://www.w3.org/TR/REC-html40&quot;&gt;'</span><span class="token punctuation">;</span>
    <span class="token variable">$html</span> <span class="token operator">.=</span> <span class="token string single-quoted-string">'&lt;head&gt;&lt;meta charset=&quot;UTF-8&quot; /&gt;&lt;/head&gt;'</span><span class="token punctuation">;</span>

    <span class="token keyword">echo</span> <span class="token variable">$html</span> <span class="token operator">.</span> <span class="token string single-quoted-string">'&lt;body&gt;'</span><span class="token operator">.</span><span class="token variable">$content</span> <span class="token operator">.</span><span class="token string single-quoted-string">'&lt;/body&gt;&lt;/html&gt;'</span><span class="token punctuation">;</span>

<span class="token punctuation">}</span>
</code></pre></div></li> <li><p>然后这次我使用的是先用layer选择一个参数,然后点击提交再进入一个新页面,就在这个新页面展示word文档以及导出按钮之类的东西</p> <div class="language-php extra-class"><pre class="language-php"><code><span class="token keyword">if</span><span class="token punctuation">(</span><span class="token function">power</span><span class="token punctuation">(</span><span class="token string double-quoted-string">&quot;finalStatement&quot;</span><span class="token punctuation">,</span><span class="token string double-quoted-string">&quot;createFile&quot;</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
    <span class="token variable">$mx</span> <span class="token operator">.=</span> <span class="token string double-quoted-string">&quot;&lt;span class='spanButton' title='生成结算表' onclick=\&quot;layer('finalStatement','createFinalStatement',{id:'&quot;</span> <span class="token operator">.</span> <span class="token variable">$array</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'id'</span><span class="token punctuation">]</span> <span class="token operator">.</span> <span class="token string double-quoted-string">&quot;'})\&quot;&gt;生成结算表&lt;/span&gt;&amp;nbsp;&quot;</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token comment">//生成文档弹窗</span>
<span class="token keyword">public</span> <span class="token keyword">function</span> <span class="token function-definition function">createFinalStatement</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
    <span class="token variable">$finalStatement</span> <span class="token operator">=</span> <span class="token function">query</span><span class="token punctuation">(</span><span class="token string double-quoted-string">&quot;finalStatement&quot;</span><span class="token punctuation">,</span><span class="token string double-quoted-string">&quot; id = '&quot;</span><span class="token operator">.</span><span class="token variable">$this</span><span class="token operator">-&gt;</span><span class="token property">post</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'id'</span><span class="token punctuation">]</span><span class="token operator">.</span><span class="token string double-quoted-string">&quot;' &quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token variable">$hidden</span> <span class="token operator">=</span> <span class="token function">hidden</span><span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'name'</span><span class="token operator">=&gt;</span><span class="token string single-quoted-string">'id'</span><span class="token punctuation">,</span><span class="token string single-quoted-string">'value'</span><span class="token operator">=&gt;</span><span class="token variable">$this</span><span class="token operator">-&gt;</span><span class="token property">post</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'id'</span><span class="token punctuation">]</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token keyword">empty</span><span class="token punctuation">(</span><span class="token variable">$finalStatement</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'id'</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
        <span class="token variable">$html</span> <span class="token operator">=</span> <span class="token string double-quoted-string">&quot;传递过来的结算单ID查询不到具体数据&quot;</span>
            <span class="token punctuation">;</span>
    <span class="token punctuation">}</span><span class="token keyword">else</span><span class="token punctuation">{</span>
        <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token keyword">empty</span><span class="token punctuation">(</span><span class="token variable">$html</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
            <span class="token variable">$html</span> <span class="token operator">=</span> <span class="token variable">$this</span><span class="token operator">-&gt;</span><span class="token function">layerEdit</span><span class="token punctuation">(</span><span class="token keyword">array</span><span class="token punctuation">(</span><span class="token string double-quoted-string">&quot;table&quot;</span> <span class="token operator">=&gt;</span> <span class="token keyword">array</span><span class="token punctuation">(</span>
                must<span class="token operator">.</span><span class="token string double-quoted-string">&quot;选择模板：&quot;</span> <span class="token operator">=&gt;</span> <span class="token function">radio</span><span class="token punctuation">(</span><span class="token keyword">array</span><span class="token punctuation">(</span><span class="token string double-quoted-string">&quot;name&quot;</span> <span class="token operator">=&gt;</span> <span class="token string double-quoted-string">&quot;template&quot;</span><span class="token punctuation">,</span><span class="token string double-quoted-string">&quot;value&quot;</span> <span class="token operator">=&gt;</span> <span class="token keyword">array</span><span class="token punctuation">(</span><span class="token string double-quoted-string">&quot;带签字栏&quot;</span><span class="token punctuation">,</span><span class="token string double-quoted-string">&quot;带备注栏&quot;</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
            <span class="token punctuation">)</span><span class="token punctuation">,</span>
                                           <span class="token string double-quoted-string">&quot;hidden&quot;</span> <span class="token operator">=&gt;</span> <span class="token variable">$hidden</span>

                                          <span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token punctuation">}</span>

    <span class="token punctuation">}</span>

    <span class="token keyword">return</span> <span class="token variable">$this</span><span class="token operator">-&gt;</span><span class="token function">layer</span><span class="token punctuation">(</span><span class="token keyword">array</span><span class="token punctuation">(</span><span class="token string double-quoted-string">&quot;title&quot;</span> <span class="token operator">=&gt;</span> <span class="token string double-quoted-string">&quot;选择模板&quot;</span><span class="token punctuation">,</span><span class="token string double-quoted-string">&quot;height&quot;</span> <span class="token operator">=&gt;</span> <span class="token number">120</span><span class="token punctuation">,</span><span class="token string double-quoted-string">&quot;width&quot;</span> <span class="token operator">=&gt;</span> <span class="token number">800</span><span class="token punctuation">,</span><span class="token string double-quoted-string">&quot;html&quot;</span> <span class="token operator">=&gt;</span> <span class="token variable">$html</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
<span class="token keyword">public</span> <span class="token keyword">function</span> <span class="token function-definition function">createFinalStatementEdit</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
    <span class="token comment">//判断</span>
    <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token operator">!</span><span class="token function">power</span><span class="token punctuation">(</span><span class="token string double-quoted-string">&quot;finalStatement&quot;</span><span class="token punctuation">,</span><span class="token string double-quoted-string">&quot;createFile&quot;</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
        <span class="token variable">$json</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'warn'</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token string double-quoted-string">&quot;权限不足&quot;</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span><span class="token keyword">elseif</span><span class="token punctuation">(</span><span class="token keyword">empty</span><span class="token punctuation">(</span><span class="token variable">$this</span><span class="token operator">-&gt;</span><span class="token property">post</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'template'</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
        <span class="token variable">$json</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'warn'</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token string double-quoted-string">&quot;请选择模板&quot;</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span><span class="token keyword">else</span><span class="token punctuation">{</span>
        <span class="token variable">$json</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'warn'</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token number">2</span><span class="token punctuation">;</span>
        <span class="token variable">$json</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'href'</span><span class="token punctuation">]</span> <span class="token operator">=</span> root<span class="token operator">.</span><span class="token string double-quoted-string">&quot;control/adIndex.php?cla=finalStatement&amp;fun=reviewFinalStatement&amp;id=&quot;</span><span class="token operator">.</span><span class="token variable">$this</span><span class="token operator">-&gt;</span><span class="token property">post</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'id'</span><span class="token punctuation">]</span><span class="token operator">.</span><span class="token string double-quoted-string">&quot;&amp;template=&quot;</span><span class="token operator">.</span><span class="token variable">$this</span><span class="token operator">-&gt;</span><span class="token property">post</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'template'</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
        <span class="token keyword">return</span> <span class="token function">json_encode</span><span class="token punctuation">(</span><span class="token variable">$json</span><span class="token punctuation">,</span><span class="token number">320</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div></li> <li><p>之后跳转到具体的新函数中用html写好word样式,取出数据填充进去</p> <div class="language-php extra-class"><pre class="language-php"><code><span class="token keyword">public</span> <span class="token keyword">function</span> <span class="token function-definition function">reviewFinalStatement</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>

    <span class="token comment">//判断</span>
    <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token operator">!</span><span class="token function">power</span><span class="token punctuation">(</span><span class="token string double-quoted-string">&quot;finalStatement&quot;</span><span class="token punctuation">,</span><span class="token string double-quoted-string">&quot;createFile&quot;</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
        <span class="token variable">$html</span> <span class="token operator">=</span> <span class="token string double-quoted-string">&quot;权限不足&quot;</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span><span class="token keyword">elseif</span><span class="token punctuation">(</span><span class="token keyword">empty</span><span class="token punctuation">(</span><span class="token variable">$this</span><span class="token operator">-&gt;</span><span class="token property">get</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'template'</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
        <span class="token variable">$html</span> <span class="token operator">=</span> <span class="token string double-quoted-string">&quot;未接收到选择的模板&quot;</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span><span class="token keyword">elseif</span><span class="token punctuation">(</span><span class="token keyword">empty</span><span class="token punctuation">(</span><span class="token variable">$this</span><span class="token operator">-&gt;</span><span class="token property">get</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'id'</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
        <span class="token variable">$html</span> <span class="token operator">=</span> <span class="token string double-quoted-string">&quot;未接收到结算单的ID&quot;</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span><span class="token keyword">else</span><span class="token punctuation">{</span>
        <span class="token variable">$finalStatement</span> <span class="token operator">=</span> <span class="token function">query</span><span class="token punctuation">(</span><span class="token string double-quoted-string">&quot;finalStatement&quot;</span><span class="token punctuation">,</span><span class="token string double-quoted-string">&quot;id = '<span class="token interpolation"><span class="token punctuation">{</span><span class="token variable">$this</span><span class="token operator">-&gt;</span><span class="token property">get</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'id'</span><span class="token punctuation">]</span><span class="token punctuation">}</span></span>'&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token variable">$idStr</span> <span class="token operator">=</span> <span class="token string double-quoted-string">&quot;'&quot;</span> <span class="token operator">.</span> <span class="token function">implode</span><span class="token punctuation">(</span><span class="token string double-quoted-string">&quot;','&quot;</span><span class="token punctuation">,</span> <span class="token function">json_decode</span><span class="token punctuation">(</span><span class="token variable">$finalStatement</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'productListIdJson'</span><span class="token punctuation">]</span><span class="token punctuation">,</span><span class="token constant boolean">true</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token operator">.</span> <span class="token string double-quoted-string">&quot;'&quot;</span><span class="token punctuation">;</span>
        <span class="token variable">$allProductList</span> <span class="token operator">=</span> <span class="token variable">$this</span><span class="token operator">-&gt;</span><span class="token function">sqlQueryAll</span><span class="token punctuation">(</span><span class="token string double-quoted-string">&quot;select * from productList where id in (<span class="token interpolation"><span class="token variable">$idStr</span></span>) order by time desc&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token variable">$num</span> <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">;</span>

        <span class="token variable">$total</span> <span class="token operator">=</span> <span class="token string single-quoted-string">''</span><span class="token punctuation">;</span>
        <span class="token keyword">foreach</span><span class="token punctuation">(</span><span class="token variable">$allProductList</span> <span class="token keyword">as</span> <span class="token variable">$pl</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
            <span class="token variable">$orderList</span> <span class="token operator">=</span> <span class="token function">query</span><span class="token punctuation">(</span><span class="token string double-quoted-string">&quot;orderList&quot;</span><span class="token punctuation">,</span><span class="token string double-quoted-string">&quot;id = '<span class="token interpolation"><span class="token punctuation">{</span><span class="token variable">$pl</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'orderId'</span><span class="token punctuation">]</span><span class="token punctuation">}</span></span>'&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token variable">$number</span> <span class="token operator">=</span> <span class="token string double-quoted-string">&quot;&lt;td width=\&quot;20\&quot; colspan=\&quot;2\&quot;&gt;<span class="token interpolation"><span class="token variable">$num</span></span>&lt;/td&gt;&quot;</span><span class="token punctuation">;</span>
            <span class="token variable">$time</span> <span class="token operator">=</span> <span class="token string double-quoted-string">&quot;&lt;td width=\&quot;100\&quot; colspan=\&quot;10\&quot;&gt;&quot;</span><span class="token operator">.</span><span class="token function">date</span><span class="token punctuation">(</span><span class="token string double-quoted-string">&quot;Y-m-d&quot;</span><span class="token punctuation">,</span><span class="token function">strtotime</span><span class="token punctuation">(</span><span class="token variable">$pl</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'time'</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token operator">.</span><span class="token string double-quoted-string">&quot;&lt;/td&gt;&quot;</span><span class="token punctuation">;</span>
            <span class="token variable">$name</span> <span class="token operator">=</span> <span class="token string double-quoted-string">&quot;&lt;td width=\&quot;120\&quot; colspan=\&quot;5\&quot;&gt;&quot;</span><span class="token operator">.</span><span class="token variable">$pl</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'name'</span><span class="token punctuation">]</span><span class="token operator">.</span><span class="token string double-quoted-string">&quot;&lt;/td&gt;&quot;</span><span class="token punctuation">;</span>
            <span class="token variable">$dataDetail</span> <span class="token operator">=</span> <span class="token string double-quoted-string">&quot;&lt;td width=\&quot;600\&quot; colspan=\&quot;12\&quot;&gt;
                内容:&quot;</span><span class="token operator">.</span><span class="token variable">$pl</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'context'</span><span class="token punctuation">]</span><span class="token operator">.</span><span class="token string double-quoted-string">&quot;\n规格:&quot;</span><span class="token operator">.</span><span class="token variable">$pl</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'specification'</span><span class="token punctuation">]</span><span class="token operator">.</span><span class="token string double-quoted-string">&quot;\n工艺:&quot;</span><span class="token operator">.</span><span class="token variable">$pl</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'skill'</span><span class="token punctuation">]</span><span class="token operator">.</span><span class="token string double-quoted-string">&quot;&lt;/td&gt;&quot;</span><span class="token punctuation">;</span>
            <span class="token variable">$count</span> <span class="token operator">=</span> <span class="token string double-quoted-string">&quot;&lt;td width=\&quot;60\&quot; colspan=\&quot;4\&quot;&gt;&quot;</span><span class="token operator">.</span><span class="token variable">$pl</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'count'</span><span class="token punctuation">]</span><span class="token operator">.</span><span class="token string double-quoted-string">&quot;&lt;/td&gt;&quot;</span><span class="token punctuation">;</span>
            <span class="token variable">$price</span> <span class="token operator">=</span> <span class="token string double-quoted-string">&quot;&lt;td width=\&quot;10\&quot; colspan=\&quot;3\&quot;&gt;&quot;</span><span class="token operator">.</span><span class="token variable">$pl</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'price'</span><span class="token punctuation">]</span><span class="token operator">.</span><span class="token string double-quoted-string">&quot;&lt;/td&gt;&quot;</span><span class="token punctuation">;</span>
            <span class="token variable">$money</span> <span class="token operator">=</span> <span class="token string double-quoted-string">&quot;&lt;td width=\&quot;60\&quot; colspan=\&quot;4\&quot;&gt;&quot;</span><span class="token operator">.</span><span class="token variable">$pl</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'price'</span><span class="token punctuation">]</span><span class="token operator">*</span><span class="token variable">$pl</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'count'</span><span class="token punctuation">]</span><span class="token operator">.</span><span class="token string double-quoted-string">&quot;&lt;/td&gt;&quot;</span><span class="token punctuation">;</span>
            <span class="token variable">$principal</span> <span class="token operator">=</span> <span class="token string double-quoted-string">&quot;&lt;td width=\&quot;90\&quot; colspan=\&quot;3\&quot;&gt;&quot;</span><span class="token operator">.</span><span class="token variable">$orderList</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'contacts'</span><span class="token punctuation">]</span><span class="token operator">.</span><span class="token string double-quoted-string">&quot;&lt;/td&gt;&quot;</span><span class="token punctuation">;</span>
            <span class="token variable">$down</span> <span class="token operator">=</span> <span class="token string double-quoted-string">&quot;&lt;td width=\&quot;150\&quot; colspan=\&quot;3\&quot;&gt;&lt;/td&gt;&quot;</span><span class="token punctuation">;</span>
            <span class="token variable">$num</span><span class="token operator">++</span><span class="token punctuation">;</span>

            <span class="token variable">$total</span> <span class="token operator">.=</span> <span class="token string double-quoted-string">&quot;&lt;tr&gt;
                    <span class="token interpolation"><span class="token variable">$number</span></span><span class="token interpolation"><span class="token variable">$time</span></span><span class="token interpolation"><span class="token variable">$name</span></span><span class="token interpolation"><span class="token variable">$dataDetail</span></span><span class="token interpolation"><span class="token variable">$count</span></span><span class="token interpolation"><span class="token variable">$price</span></span><span class="token interpolation"><span class="token variable">$money</span></span><span class="token interpolation"><span class="token variable">$principal</span></span><span class="token interpolation"><span class="token variable">$down</span></span>
                &lt;/tr&gt;&quot;</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>


        <span class="token variable">$side</span> <span class="token operator">=</span> <span class="token variable">$this</span><span class="token operator">-&gt;</span><span class="token property">get</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'template'</span><span class="token punctuation">]</span><span class="token operator">==</span><span class="token string single-quoted-string">'带签字栏'</span><span class="token operator">?</span><span class="token string double-quoted-string">&quot;签字&quot;</span><span class="token punctuation">:</span><span class="token string double-quoted-string">&quot;备注&quot;</span><span class="token punctuation">;</span>

        <span class="token variable">$print</span> <span class="token operator">=</span> <span class="token string double-quoted-string">&quot;&lt;div class='spanButton' style='float: left;float: top;margin-left: 20px'&gt;打印&lt;/div&gt;&quot;</span><span class="token punctuation">;</span>
        <span class="token variable">$kehu</span> <span class="token operator">=</span> <span class="token function">query</span><span class="token punctuation">(</span><span class="token string double-quoted-string">&quot;kehu&quot;</span><span class="token punctuation">,</span><span class="token string double-quoted-string">&quot;khid = '<span class="token interpolation"><span class="token punctuation">{</span><span class="token variable">$orderList</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'khid'</span><span class="token punctuation">]</span><span class="token punctuation">}</span></span>'&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token variable">$html</span> <span class="token operator">=</span> <span class="token string double-quoted-string">&quot;

                &lt;div style=\&quot;font-family:微软雅黑;font-size:19px;font-weight: bold;text-align:center\&quot;&gt;广告宣传服务费结算表&lt;/div&gt;
                &lt;div id='unit' style='float: left;'&gt;客户单位:&quot;</span><span class="token operator">.</span><span class="token variable">$kehu</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'unit'</span><span class="token punctuation">]</span><span class="token operator">.</span><span class="token string double-quoted-string">&quot;&lt;/div&gt;
                &lt;table border=\&quot;1\&quot; cellpadding=\&quot;3\&quot; cellspacing=\&quot;0\&quot;&gt;
                    &lt;tr&gt;
                        &lt;th width=\&quot;20\&quot; colspan=\&quot;2\&quot;&gt;序：&lt;/th&gt;
                        &lt;th width=\&quot;100\&quot; colspan=\&quot;10\&quot;&gt;时间：&lt;/th&gt;
                        &lt;th width=\&quot;120\&quot; colspan=\&quot;5\&quot;&gt;产品名称：&lt;/th&gt;
                        &lt;th width=\&quot;600\&quot; colspan=\&quot;12\&quot;&gt;材料组成及制作工艺：&lt;/th&gt;
                        &lt;th width=\&quot;60\&quot; colspan=\&quot;4\&quot;&gt;数量：&lt;/th&gt;
                        &lt;th width=\&quot;10\&quot; colspan=\&quot;3\&quot;&gt;单价：&lt;/th&gt;
                        &lt;th width=\&quot;60\&quot; colspan=\&quot;4\&quot;&gt;小计：&lt;/th&gt;
                        &lt;th width=\&quot;90\&quot; colspan=\&quot;3\&quot;&gt;联系人：&lt;/th&gt;
                        &lt;th width=\&quot;150\&quot; colspan=\&quot;3\&quot;&gt;&quot;</span><span class="token operator">.</span><span class="token variable">$side</span><span class="token operator">.</span><span class="token string double-quoted-string">&quot;：&lt;/th&gt;
                    &lt;/tr&gt;
                    <span class="token interpolation"><span class="token variable">$total</span></span>
                 &lt;/table&gt;

            &quot;</span><span class="token punctuation">;</span>
        <span class="token variable">$postUrl</span> <span class="token operator">=</span> root<span class="token operator">.</span><span class="token string double-quoted-string">&quot;control/adIndex.php?cla=&quot;</span><span class="token operator">.</span><span class="token variable">$this</span><span class="token operator">-&gt;</span><span class="token property">get</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'cla'</span><span class="token punctuation">]</span><span class="token operator">.</span><span class="token string double-quoted-string">&quot;&amp;fun=exportWord&amp;id=&quot;</span><span class="token operator">.</span><span class="token variable">$this</span><span class="token operator">-&gt;</span><span class="token property">get</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'id'</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
        <span class="token variable">$export</span> <span class="token operator">=</span> <span class="token string double-quoted-string">&quot;&lt;a href='<span class="token interpolation"><span class="token variable">$postUrl</span></span>' class='spanButton' style='float: left;float: top;margin-left: 50px'&gt;导出&lt;/a&gt;\n&quot;</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token keyword">return</span> <span class="token function">head</span><span class="token punctuation">(</span><span class="token string double-quoted-string">&quot;ad&quot;</span><span class="token punctuation">)</span><span class="token operator">.</span><span class="token variable">$export</span><span class="token operator">.</span><span class="token variable">$print</span><span class="token operator">.</span><span class="token variable">$html</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre></div></li> <li><p>然后在展示界面写好导出的按钮,跳转到本类的另一个函数,在那个函数中使用之前封装好的生成word文档并下载的函数,就可以下载这个文档了,使用即可,不需要return</p> <div class="language-php extra-class"><pre class="language-php"><code><span class="token keyword">public</span> <span class="token keyword">function</span> <span class="token function-definition function">exportWord</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
    <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token keyword">empty</span><span class="token punctuation">(</span><span class="token variable">$this</span><span class="token operator">-&gt;</span><span class="token property">get</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'id'</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
        <span class="token keyword">echo</span> <span class="token string single-quoted-string">'没接收到ID'</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span><span class="token keyword">else</span><span class="token punctuation">{</span>
        <span class="token variable">$finalStatement</span> <span class="token operator">=</span> <span class="token function">query</span><span class="token punctuation">(</span><span class="token string double-quoted-string">&quot;finalStatement&quot;</span><span class="token punctuation">,</span><span class="token string double-quoted-string">&quot;id = '<span class="token interpolation"><span class="token punctuation">{</span><span class="token variable">$this</span><span class="token operator">-&gt;</span><span class="token property">get</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'id'</span><span class="token punctuation">]</span><span class="token punctuation">}</span></span>'&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token variable">$idStr</span> <span class="token operator">=</span> <span class="token string double-quoted-string">&quot;'&quot;</span> <span class="token operator">.</span> <span class="token function">implode</span><span class="token punctuation">(</span><span class="token string double-quoted-string">&quot;','&quot;</span><span class="token punctuation">,</span> <span class="token function">json_decode</span><span class="token punctuation">(</span><span class="token variable">$finalStatement</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'productListIdJson'</span><span class="token punctuation">]</span><span class="token punctuation">,</span><span class="token constant boolean">true</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token operator">.</span> <span class="token string double-quoted-string">&quot;'&quot;</span><span class="token punctuation">;</span>
        <span class="token variable">$allProductList</span> <span class="token operator">=</span> <span class="token variable">$this</span><span class="token operator">-&gt;</span><span class="token function">sqlQueryAll</span><span class="token punctuation">(</span><span class="token string double-quoted-string">&quot;select * from productList where id in (<span class="token interpolation"><span class="token variable">$idStr</span></span>) order by time desc&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token variable">$num</span> <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">;</span>

        <span class="token variable">$total</span> <span class="token operator">=</span> <span class="token string single-quoted-string">''</span><span class="token punctuation">;</span>
        <span class="token keyword">foreach</span><span class="token punctuation">(</span><span class="token variable">$allProductList</span> <span class="token keyword">as</span> <span class="token variable">$pl</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
            <span class="token variable">$orderList</span> <span class="token operator">=</span> <span class="token function">query</span><span class="token punctuation">(</span><span class="token string double-quoted-string">&quot;orderList&quot;</span><span class="token punctuation">,</span><span class="token string double-quoted-string">&quot;id = '<span class="token interpolation"><span class="token punctuation">{</span><span class="token variable">$pl</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'orderId'</span><span class="token punctuation">]</span><span class="token punctuation">}</span></span>'&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token variable">$number</span> <span class="token operator">=</span> <span class="token string double-quoted-string">&quot;&lt;td width=\&quot;20\&quot; colspan=\&quot;2\&quot;&gt;<span class="token interpolation"><span class="token variable">$num</span></span>&lt;/td&gt;&quot;</span><span class="token punctuation">;</span>
            <span class="token variable">$time</span> <span class="token operator">=</span> <span class="token string double-quoted-string">&quot;&lt;td width=\&quot;100\&quot; colspan=\&quot;10\&quot;&gt;&quot;</span><span class="token operator">.</span><span class="token function">date</span><span class="token punctuation">(</span><span class="token string double-quoted-string">&quot;Y-m-d&quot;</span><span class="token punctuation">,</span><span class="token function">strtotime</span><span class="token punctuation">(</span><span class="token variable">$pl</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'time'</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token operator">.</span><span class="token string double-quoted-string">&quot;&lt;/td&gt;&quot;</span><span class="token punctuation">;</span>
            <span class="token variable">$name</span> <span class="token operator">=</span> <span class="token string double-quoted-string">&quot;&lt;td width=\&quot;120\&quot; colspan=\&quot;5\&quot;&gt;&quot;</span><span class="token operator">.</span><span class="token variable">$pl</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'name'</span><span class="token punctuation">]</span><span class="token operator">.</span><span class="token string double-quoted-string">&quot;&lt;/td&gt;&quot;</span><span class="token punctuation">;</span>
            <span class="token variable">$dataDetail</span> <span class="token operator">=</span> <span class="token string double-quoted-string">&quot;&lt;td width=\&quot;600\&quot; colspan=\&quot;12\&quot;&gt;
                内容:&quot;</span><span class="token operator">.</span><span class="token variable">$pl</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'context'</span><span class="token punctuation">]</span><span class="token operator">.</span><span class="token string double-quoted-string">&quot;\n规格:&quot;</span><span class="token operator">.</span><span class="token variable">$pl</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'specification'</span><span class="token punctuation">]</span><span class="token operator">.</span><span class="token string double-quoted-string">&quot;\n工艺:&quot;</span><span class="token operator">.</span><span class="token variable">$pl</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'skill'</span><span class="token punctuation">]</span><span class="token operator">.</span><span class="token string double-quoted-string">&quot;&lt;/td&gt;&quot;</span><span class="token punctuation">;</span>
            <span class="token variable">$count</span> <span class="token operator">=</span> <span class="token string double-quoted-string">&quot;&lt;td width=\&quot;60\&quot; colspan=\&quot;4\&quot;&gt;&quot;</span><span class="token operator">.</span><span class="token variable">$pl</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'count'</span><span class="token punctuation">]</span><span class="token operator">.</span><span class="token string double-quoted-string">&quot;&lt;/td&gt;&quot;</span><span class="token punctuation">;</span>
            <span class="token variable">$price</span> <span class="token operator">=</span> <span class="token string double-quoted-string">&quot;&lt;td width=\&quot;10\&quot; colspan=\&quot;3\&quot;&gt;&quot;</span><span class="token operator">.</span><span class="token variable">$pl</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'price'</span><span class="token punctuation">]</span><span class="token operator">.</span><span class="token string double-quoted-string">&quot;&lt;/td&gt;&quot;</span><span class="token punctuation">;</span>
            <span class="token variable">$money</span> <span class="token operator">=</span> <span class="token string double-quoted-string">&quot;&lt;td width=\&quot;60\&quot; colspan=\&quot;4\&quot;&gt;&quot;</span><span class="token operator">.</span><span class="token variable">$pl</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'price'</span><span class="token punctuation">]</span><span class="token operator">*</span><span class="token variable">$pl</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'count'</span><span class="token punctuation">]</span><span class="token operator">.</span><span class="token string double-quoted-string">&quot;&lt;/td&gt;&quot;</span><span class="token punctuation">;</span>
            <span class="token variable">$principal</span> <span class="token operator">=</span> <span class="token string double-quoted-string">&quot;&lt;td width=\&quot;90\&quot; colspan=\&quot;3\&quot;&gt;&quot;</span><span class="token operator">.</span><span class="token variable">$orderList</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'contacts'</span><span class="token punctuation">]</span><span class="token operator">.</span><span class="token string double-quoted-string">&quot;&lt;/td&gt;&quot;</span><span class="token punctuation">;</span>
            <span class="token variable">$down</span> <span class="token operator">=</span> <span class="token string double-quoted-string">&quot;&lt;td width=\&quot;150\&quot; colspan=\&quot;3\&quot;&gt;&lt;/td&gt;&quot;</span><span class="token punctuation">;</span>
            <span class="token variable">$num</span><span class="token operator">++</span><span class="token punctuation">;</span>

            <span class="token variable">$total</span> <span class="token operator">.=</span> <span class="token string double-quoted-string">&quot;&lt;tr&gt;
                    <span class="token interpolation"><span class="token variable">$number</span></span><span class="token interpolation"><span class="token variable">$time</span></span><span class="token interpolation"><span class="token variable">$name</span></span><span class="token interpolation"><span class="token variable">$dataDetail</span></span><span class="token interpolation"><span class="token variable">$count</span></span><span class="token interpolation"><span class="token variable">$price</span></span><span class="token interpolation"><span class="token variable">$money</span></span><span class="token interpolation"><span class="token variable">$principal</span></span><span class="token interpolation"><span class="token variable">$down</span></span>
                &lt;/tr&gt;&quot;</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>


        <span class="token variable">$side</span> <span class="token operator">=</span> <span class="token variable">$this</span><span class="token operator">-&gt;</span><span class="token property">get</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'template'</span><span class="token punctuation">]</span><span class="token operator">==</span><span class="token string single-quoted-string">'带签字栏'</span><span class="token operator">?</span><span class="token string double-quoted-string">&quot;签字&quot;</span><span class="token punctuation">:</span><span class="token string double-quoted-string">&quot;备注&quot;</span><span class="token punctuation">;</span>

        <span class="token variable">$kehu</span> <span class="token operator">=</span> <span class="token function">query</span><span class="token punctuation">(</span><span class="token string double-quoted-string">&quot;kehu&quot;</span><span class="token punctuation">,</span><span class="token string double-quoted-string">&quot;khid = '<span class="token interpolation"><span class="token punctuation">{</span><span class="token variable">$orderList</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'khid'</span><span class="token punctuation">]</span><span class="token punctuation">}</span></span>'&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token variable">$html</span> <span class="token operator">=</span> <span class="token string double-quoted-string">&quot;

                &lt;div style=\&quot;font-family:微软雅黑;font-size:19px;font-weight: bold;text-align:center\&quot;&gt;广告宣传服务费结算表&lt;/div&gt;
                &lt;div id='unit' style='float: left;'&gt;客户单位:&quot;</span><span class="token operator">.</span><span class="token variable">$kehu</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'unit'</span><span class="token punctuation">]</span><span class="token operator">.</span><span class="token string double-quoted-string">&quot;&lt;/div&gt;
                &lt;table border=\&quot;1\&quot; cellpadding=\&quot;3\&quot; cellspacing=\&quot;0\&quot;&gt;
                    &lt;tr&gt;
                        &lt;th width=\&quot;20\&quot; colspan=\&quot;2\&quot;&gt;序：&lt;/th&gt;
                        &lt;th width=\&quot;100\&quot; colspan=\&quot;10\&quot;&gt;时间：&lt;/th&gt;
                        &lt;th width=\&quot;120\&quot; colspan=\&quot;5\&quot;&gt;产品名称：&lt;/th&gt;
                        &lt;th width=\&quot;600\&quot; colspan=\&quot;12\&quot;&gt;材料组成及制作工艺：&lt;/th&gt;
                        &lt;th width=\&quot;60\&quot; colspan=\&quot;4\&quot;&gt;数量：&lt;/th&gt;
                        &lt;th width=\&quot;10\&quot; colspan=\&quot;3\&quot;&gt;单价：&lt;/th&gt;
                        &lt;th width=\&quot;60\&quot; colspan=\&quot;4\&quot;&gt;小计：&lt;/th&gt;
                        &lt;th width=\&quot;90\&quot; colspan=\&quot;3\&quot;&gt;联系人：&lt;/th&gt;
                        &lt;th width=\&quot;150\&quot; colspan=\&quot;3\&quot;&gt;&quot;</span><span class="token operator">.</span><span class="token variable">$side</span><span class="token operator">.</span><span class="token string double-quoted-string">&quot;：&lt;/th&gt;
                    &lt;/tr&gt;
                    <span class="token interpolation"><span class="token variable">$total</span></span>
                 &lt;/table&gt;

            &quot;</span><span class="token punctuation">;</span>
        <span class="token variable">$this</span><span class="token operator">-&gt;</span><span class="token function">downloadWord</span><span class="token punctuation">(</span><span class="token variable">$html</span><span class="token punctuation">,</span><span class="token function">suiji</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">.</span><span class="token string double-quoted-string">&quot;.doc&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token comment">//        return $html;</span>
<span class="token punctuation">}</span>

</code></pre></div></li></ul></div> <footer class="page-edit"><!----> <div class="last-updated"><span class="prefix">Last Updated:</span> <span class="time">9/27/2020, 10:06:51 PM</span></div></footer> <div class="page-nav"><p class="inner"><span class="prev">
      ←
      <a href="/yumu/公司框架/老框架.html" class="prev">
        老框架
      </a></span> <span class="next"><a href="/yumu/公司框架/框架通用.html">
        框架通用
      </a>
      →
    </span></p></div> </main></div><div class="global-ui"></div></div>
    <script src="/assets/js/app.6ef7aeda.js" defer></script><script src="/assets/js/2.716a1f37.js" defer></script><script src="/assets/js/87.5ec873ab.js" defer></script>
  </body>
</html>
