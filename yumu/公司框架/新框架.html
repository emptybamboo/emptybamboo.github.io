<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>一二级菜单以及权限配置 | 学而时习之</title>
    <meta name="generator" content="VuePress 1.9.7">
    <link rel="icon" href="/img/qiyu.jpg">
    <meta name="description" content="个人学习博客">
    
    <link rel="preload" href="/assets/css/0.styles.e4d8b86b.css" as="style"><link rel="preload" href="/assets/js/app.6ef7aeda.js" as="script"><link rel="preload" href="/assets/js/2.716a1f37.js" as="script"><link rel="preload" href="/assets/js/89.286a5312.js" as="script"><link rel="prefetch" href="/assets/js/10.a4a050d1.js"><link rel="prefetch" href="/assets/js/11.344787d3.js"><link rel="prefetch" href="/assets/js/12.b25f9ccf.js"><link rel="prefetch" href="/assets/js/13.fbdea543.js"><link rel="prefetch" href="/assets/js/14.5fc0584b.js"><link rel="prefetch" href="/assets/js/15.688b7501.js"><link rel="prefetch" href="/assets/js/16.fbd251ee.js"><link rel="prefetch" href="/assets/js/17.6b6b044b.js"><link rel="prefetch" href="/assets/js/18.4da62780.js"><link rel="prefetch" href="/assets/js/19.e76bd09c.js"><link rel="prefetch" href="/assets/js/20.c6c4fad3.js"><link rel="prefetch" href="/assets/js/21.76180caa.js"><link rel="prefetch" href="/assets/js/22.6f1b73fd.js"><link rel="prefetch" href="/assets/js/23.a95962c2.js"><link rel="prefetch" href="/assets/js/24.eee43d5e.js"><link rel="prefetch" href="/assets/js/25.56e05948.js"><link rel="prefetch" href="/assets/js/26.43f2e3ff.js"><link rel="prefetch" href="/assets/js/27.09054ea0.js"><link rel="prefetch" href="/assets/js/28.c4e54eaa.js"><link rel="prefetch" href="/assets/js/29.06c6b4e5.js"><link rel="prefetch" href="/assets/js/3.eaf135e1.js"><link rel="prefetch" href="/assets/js/30.250c7c81.js"><link rel="prefetch" href="/assets/js/31.91b37571.js"><link rel="prefetch" href="/assets/js/32.d2677ff0.js"><link rel="prefetch" href="/assets/js/33.41ead764.js"><link rel="prefetch" href="/assets/js/34.133f8e54.js"><link rel="prefetch" href="/assets/js/35.362db0cb.js"><link rel="prefetch" href="/assets/js/36.db01e9cc.js"><link rel="prefetch" href="/assets/js/37.78fd90d2.js"><link rel="prefetch" href="/assets/js/38.27112b1c.js"><link rel="prefetch" href="/assets/js/39.c077219c.js"><link rel="prefetch" href="/assets/js/4.75ddad43.js"><link rel="prefetch" href="/assets/js/40.c9153258.js"><link rel="prefetch" href="/assets/js/41.c0b0dba4.js"><link rel="prefetch" href="/assets/js/42.787b0675.js"><link rel="prefetch" href="/assets/js/43.35499284.js"><link rel="prefetch" href="/assets/js/44.ea23a009.js"><link rel="prefetch" href="/assets/js/45.e5cd72c6.js"><link rel="prefetch" href="/assets/js/46.f1392760.js"><link rel="prefetch" href="/assets/js/47.1553f24b.js"><link rel="prefetch" href="/assets/js/48.c696d608.js"><link rel="prefetch" href="/assets/js/49.a7940cc9.js"><link rel="prefetch" href="/assets/js/5.f9f3c101.js"><link rel="prefetch" href="/assets/js/50.e8cadfe4.js"><link rel="prefetch" href="/assets/js/51.080e63aa.js"><link rel="prefetch" href="/assets/js/52.7347d36c.js"><link rel="prefetch" href="/assets/js/53.aba50764.js"><link rel="prefetch" href="/assets/js/54.ca1160dc.js"><link rel="prefetch" href="/assets/js/55.b6574861.js"><link rel="prefetch" href="/assets/js/56.be3c310f.js"><link rel="prefetch" href="/assets/js/57.037820ea.js"><link rel="prefetch" href="/assets/js/58.24474c32.js"><link rel="prefetch" href="/assets/js/59.3b585e3d.js"><link rel="prefetch" href="/assets/js/6.c86d08c0.js"><link rel="prefetch" href="/assets/js/60.75b5bae2.js"><link rel="prefetch" href="/assets/js/61.1831f564.js"><link rel="prefetch" href="/assets/js/62.18a1b459.js"><link rel="prefetch" href="/assets/js/63.346f7f49.js"><link rel="prefetch" href="/assets/js/64.a7683029.js"><link rel="prefetch" href="/assets/js/65.1a938596.js"><link rel="prefetch" href="/assets/js/66.0106ad50.js"><link rel="prefetch" href="/assets/js/67.b0b943da.js"><link rel="prefetch" href="/assets/js/68.60534009.js"><link rel="prefetch" href="/assets/js/69.72e1bfa9.js"><link rel="prefetch" href="/assets/js/7.e0e4b61b.js"><link rel="prefetch" href="/assets/js/70.3a29dfd9.js"><link rel="prefetch" href="/assets/js/71.3e57d5ec.js"><link rel="prefetch" href="/assets/js/72.be56e12f.js"><link rel="prefetch" href="/assets/js/73.b6934116.js"><link rel="prefetch" href="/assets/js/74.81f5b5c3.js"><link rel="prefetch" href="/assets/js/75.e9dacdaf.js"><link rel="prefetch" href="/assets/js/76.7c0855f1.js"><link rel="prefetch" href="/assets/js/77.98a4a794.js"><link rel="prefetch" href="/assets/js/78.3049e29b.js"><link rel="prefetch" href="/assets/js/79.9c741fac.js"><link rel="prefetch" href="/assets/js/8.8c856480.js"><link rel="prefetch" href="/assets/js/80.46cc42c2.js"><link rel="prefetch" href="/assets/js/81.2647d9b6.js"><link rel="prefetch" href="/assets/js/82.0c7a9946.js"><link rel="prefetch" href="/assets/js/83.fa03835c.js"><link rel="prefetch" href="/assets/js/84.909232bc.js"><link rel="prefetch" href="/assets/js/85.7cf12395.js"><link rel="prefetch" href="/assets/js/86.805e61d2.js"><link rel="prefetch" href="/assets/js/87.5ec873ab.js"><link rel="prefetch" href="/assets/js/88.54c3c15b.js"><link rel="prefetch" href="/assets/js/9.6133e2ec.js"><link rel="prefetch" href="/assets/js/90.e91320ce.js"><link rel="prefetch" href="/assets/js/91.932f1454.js">
    <link rel="stylesheet" href="/assets/css/0.styles.e4d8b86b.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container"><header class="navbar"><div class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/" class="home-link router-link-active"><!----> <span class="site-name">学而时习之</span></a> <div class="links"><div class="search-box"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <nav class="nav-links can-hide"><div class="nav-item"><a href="/" class="nav-link">
  主页
</a></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="博文" class="dropdown-title"><span class="title">博文</span> <span class="arrow down"></span></button> <button type="button" aria-label="博文" class="mobile-dropdown-title"><span class="title">博文</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/vuePress/" class="nav-link">
  博客相关知识
</a></li><li class="dropdown-item"><!----> <a href="/javaBasics/" class="nav-link">
  JavaSE基础知识
</a></li><li class="dropdown-item"><!----> <a href="/javaFramework/" class="nav-link">
  Java框架知识
</a></li><li class="dropdown-item"><!----> <a href="/book/" class="nav-link">
  技术书籍
</a></li><li class="dropdown-item"><!----> <a href="/js/" class="nav-link">
  前端
</a></li><li class="dropdown-item"><!----> <a href="/sql/" class="nav-link">
  数据库知识
</a></li><li class="dropdown-item"><!----> <a href="/projectPractice/" class="nav-link">
  项目实战
</a></li><li class="dropdown-item"><!----> <a href="/projectNote/" class="nav-link">
  工作项目积累
</a></li><li class="dropdown-item"><!----> <a href="/faultNote/" class="nav-link">
  记错本
</a></li><li class="dropdown-item"><!----> <a href="/php/" class="nav-link">
  php
</a></li><li class="dropdown-item"><!----> <a href="/linux/" class="nav-link">
  linux学习
</a></li><li class="dropdown-item"><!----> <a href="/git/" class="nav-link">
  git笔记
</a></li><li class="dropdown-item"><!----> <a href="/middleware/" class="nav-link">
  中间件
</a></li><li class="dropdown-item"><!----> <a href="/docker/" class="nav-link">
  docker笔记
</a></li><li class="dropdown-item"><!----> <a href="/nginx/" class="nav-link">
  nginx笔记
</a></li><li class="dropdown-item"><!----> <a href="/systemArchitecture/" class="nav-link">
  系统架构
</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="工具网站" class="dropdown-title"><span class="title">工具网站</span> <span class="arrow down"></span></button> <button type="button" aria-label="工具网站" class="mobile-dropdown-title"><span class="title">工具网站</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="https://postimages.org" target="_blank" rel="noopener noreferrer" class="nav-link external">
  postimages图床
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li></ul></div></div> <!----></nav></div></header> <div class="sidebar-mask"></div> <aside class="sidebar"><nav class="nav-links"><div class="nav-item"><a href="/" class="nav-link">
  主页
</a></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="博文" class="dropdown-title"><span class="title">博文</span> <span class="arrow down"></span></button> <button type="button" aria-label="博文" class="mobile-dropdown-title"><span class="title">博文</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/vuePress/" class="nav-link">
  博客相关知识
</a></li><li class="dropdown-item"><!----> <a href="/javaBasics/" class="nav-link">
  JavaSE基础知识
</a></li><li class="dropdown-item"><!----> <a href="/javaFramework/" class="nav-link">
  Java框架知识
</a></li><li class="dropdown-item"><!----> <a href="/book/" class="nav-link">
  技术书籍
</a></li><li class="dropdown-item"><!----> <a href="/js/" class="nav-link">
  前端
</a></li><li class="dropdown-item"><!----> <a href="/sql/" class="nav-link">
  数据库知识
</a></li><li class="dropdown-item"><!----> <a href="/projectPractice/" class="nav-link">
  项目实战
</a></li><li class="dropdown-item"><!----> <a href="/projectNote/" class="nav-link">
  工作项目积累
</a></li><li class="dropdown-item"><!----> <a href="/faultNote/" class="nav-link">
  记错本
</a></li><li class="dropdown-item"><!----> <a href="/php/" class="nav-link">
  php
</a></li><li class="dropdown-item"><!----> <a href="/linux/" class="nav-link">
  linux学习
</a></li><li class="dropdown-item"><!----> <a href="/git/" class="nav-link">
  git笔记
</a></li><li class="dropdown-item"><!----> <a href="/middleware/" class="nav-link">
  中间件
</a></li><li class="dropdown-item"><!----> <a href="/docker/" class="nav-link">
  docker笔记
</a></li><li class="dropdown-item"><!----> <a href="/nginx/" class="nav-link">
  nginx笔记
</a></li><li class="dropdown-item"><!----> <a href="/systemArchitecture/" class="nav-link">
  系统架构
</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="工具网站" class="dropdown-title"><span class="title">工具网站</span> <span class="arrow down"></span></button> <button type="button" aria-label="工具网站" class="mobile-dropdown-title"><span class="title">工具网站</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="https://postimages.org" target="_blank" rel="noopener noreferrer" class="nav-link external">
  postimages图床
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li></ul></div></div> <!----></nav>  <ul class="sidebar-links"><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading open"><span>公司框架使用</span> <span class="arrow down"></span></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/yumu/公司框架/新框架.html" class="active sidebar-link">新框架</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/yumu/公司框架/新框架.html#一二级菜单以及权限配置" class="sidebar-link">一二级菜单以及权限配置</a></li><li class="sidebar-sub-header"><a href="/yumu/公司框架/新框架.html#面向对象" class="sidebar-link">面向对象</a></li><li class="sidebar-sub-header"><a href="/yumu/公司框架/新框架.html#增查删改" class="sidebar-link">增查删改</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/yumu/公司框架/新框架.html#增" class="sidebar-link">增</a></li><li class="sidebar-sub-header"><a href="/yumu/公司框架/新框架.html#查" class="sidebar-link">查</a></li><li class="sidebar-sub-header"><a href="/yumu/公司框架/新框架.html#删" class="sidebar-link">删</a></li><li class="sidebar-sub-header"><a href="/yumu/公司框架/新框架.html#改" class="sidebar-link">改</a></li></ul></li><li class="sidebar-sub-header"><a href="/yumu/公司框架/新框架.html#弹出层" class="sidebar-link">弹出层</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/yumu/公司框架/新框架.html#基础" class="sidebar-link">基础</a></li><li class="sidebar-sub-header"><a href="/yumu/公司框架/新框架.html#进阶" class="sidebar-link">进阶</a></li><li class="sidebar-sub-header"><a href="/yumu/公司框架/新框架.html#改造框架中的layer" class="sidebar-link">改造框架中的layer</a></li></ul></li><li class="sidebar-sub-header"><a href="/yumu/公司框架/新框架.html#导入导出" class="sidebar-link">导入导出</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/yumu/公司框架/新框架.html#导出" class="sidebar-link">导出</a></li></ul></li><li class="sidebar-sub-header"><a href="/yumu/公司框架/新框架.html#小功能" class="sidebar-link">小功能</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/yumu/公司框架/新框架.html#选择字段显示对应字段表格" class="sidebar-link">选择字段显示对应字段表格</a></li><li class="sidebar-sub-header"><a href="/yumu/公司框架/新框架.html#导入" class="sidebar-link">导入</a></li></ul></li><li class="sidebar-sub-header"><a href="/yumu/公司框架/新框架.html#分支-tab" class="sidebar-link">分支(tab)</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/yumu/公司框架/新框架.html#分支菜单" class="sidebar-link">分支菜单</a></li><li class="sidebar-sub-header"><a href="/yumu/公司框架/新框架.html#分支页面" class="sidebar-link">分支页面</a></li><li class="sidebar-sub-header"><a href="/yumu/公司框架/新框架.html#注意事项" class="sidebar-link">注意事项</a></li><li class="sidebar-sub-header"><a href="/yumu/公司框架/新框架.html#数据操作" class="sidebar-link">数据操作</a></li><li class="sidebar-sub-header"><a href="/yumu/公司框架/新框架.html#分支页面点击按钮切换表格显示范围" class="sidebar-link">分支页面点击按钮切换表格显示范围</a></li></ul></li><li class="sidebar-sub-header"><a href="/yumu/公司框架/新框架.html#数组" class="sidebar-link">数组</a></li><li class="sidebar-sub-header"><a href="/yumu/公司框架/新框架.html#上传文件" class="sidebar-link">上传文件</a></li><li class="sidebar-sub-header"><a href="/yumu/公司框架/新框架.html#富文本编辑器" class="sidebar-link">富文本编辑器</a></li><li class="sidebar-sub-header"><a href="/yumu/公司框架/新框架.html#表格" class="sidebar-link">表格</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/yumu/公司框架/新框架.html#写死表格" class="sidebar-link">写死表格</a></li></ul></li></ul></li><li><a href="/yumu/公司框架/老框架.html" class="sidebar-link">老框架</a></li><li><a href="/yumu/公司框架/2020开年新框架.html" class="sidebar-link">2020框架</a></li><li><a href="/yumu/公司框架/框架通用.html" class="sidebar-link">框架通用</a></li><li><a href="/yumu/公司框架/js相关.html" class="sidebar-link">js相关</a></li></ul></section></li></ul> </aside> <main class="page"> <div class="theme-default-content content__default"><h2 id="一二级菜单以及权限配置"><a href="#一二级菜单以及权限配置" class="header-anchor">#</a> 一二级菜单以及权限配置</h2> <ul><li>在<code>configure.php</code>中,创建新的数组(按照它原先的格式),一级数组是一级菜单,二级数组是二级菜单,二级数组的元素就是权限,然后到公司官网里的项目代码里更新之后,再到管理员权限里打钩,就可以显示新的一级二级页面.</li></ul> <h2 id="面向对象"><a href="#面向对象" class="header-anchor">#</a> 面向对象</h2> <ul><li><p>现在的公司框架采用了一部分面向对象的思想,但凡有需要单独建立数据库表的模块,就需要单独建一个类(Class文件),其中大致分为五个部分</p> <ol><li><p><code>listSearch</code>方法,这个方法定义了我们当前页面表格的搜索框.需要去<code>listSearch</code>中注册类.</p> <div class="language-php extra-class"><pre class="language-php"><code><span class="token keyword">public</span> <span class="token keyword">function</span> <span class="token function-definition function">listSearch</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
        <span class="token variable">$result</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'html'</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token string double-quoted-string">&quot;&quot;</span><span class="token punctuation">;</span>
        <span class="token variable">$result</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'html'</span><span class="token punctuation">]</span> <span class="token operator">.=</span>
            <span class="token function">text</span><span class="token punctuation">(</span><span class="token keyword">array</span><span class="token punctuation">(</span><span class="token string double-quoted-string">&quot;name&quot;</span> <span class="token operator">=&gt;</span> <span class="token string double-quoted-string">&quot;userName&quot;</span><span class="token punctuation">,</span><span class="token string double-quoted-string">&quot;title&quot;</span> <span class="token operator">=&gt;</span> <span class="token string double-quoted-string">&quot;会员名称&quot;</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token operator">.</span>
            <span class="token function">text</span><span class="token punctuation">(</span><span class="token keyword">array</span><span class="token punctuation">(</span><span class="token string double-quoted-string">&quot;name&quot;</span> <span class="token operator">=&gt;</span> <span class="token string double-quoted-string">&quot;userCard&quot;</span><span class="token punctuation">,</span><span class="token string double-quoted-string">&quot;title&quot;</span> <span class="token operator">=&gt;</span> <span class="token string double-quoted-string">&quot;会员卡号&quot;</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token operator">.</span>
            <span class="token function">text</span><span class="token punctuation">(</span><span class="token keyword">array</span><span class="token punctuation">(</span><span class="token string double-quoted-string">&quot;name&quot;</span> <span class="token operator">=&gt;</span> <span class="token string double-quoted-string">&quot;birthday&quot;</span><span class="token punctuation">,</span><span class="token string double-quoted-string">&quot;laydate&quot;</span> <span class="token operator">=&gt;</span> <span class="token keyword">array</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span><span class="token string double-quoted-string">&quot;title&quot;</span> <span class="token operator">=&gt;</span> <span class="token string double-quoted-string">&quot;生日&quot;</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">//返回</span>
        <span class="token keyword">return</span> <span class="token variable">$result</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
</code></pre></div></li> <li><p><code>listReasult</code>方法,这个方法定义了具体的页面,包括表格以及表格的所有行列,表头的各个按钮,以及表中的针对每条数据的编辑按钮.写好之后需要去<code>listReasult.php</code>注册类.</p></li> <li><p><code>tab</code>方法,用来定义详情页的分支页面,第一个分支页面是写在<code>detailPara.php</code>中,自从第二个开始,就需要写在类文件中,最终需要注册在<code>detailTab.php</code>文件中,第二个分支的方法在类中必须起名为tab,因为这个是默认名,在注册时填三个参数即可,如果你有两个以上的分支,第三个分支的时候你就可以自定义类中的分支方法名,这个方法名在注册的时候,需要加上第四个参数&quot;fun&quot; =&gt; &quot;方法名&quot;.</p></li> <li><p>弹出层方法,用来定义弹出层的页面显示,格式为<code>xxxLayer</code>,以Layer结尾,写好之后需要到<code>layer.php</code>中去注册,注册时需要填类名以及方法名(方法名只需要填后缀Layer之前的部分).</p></li> <li><p>异步数据处理方法,用来处理弹出层或者是单个页面的表单提交的数据,格式为<code>xxxData</code>,以Data结尾,写好之后需要去<code>data.php</code>注册类(方法名只需要填后缀Data之前的部分).</p> <div class="language-php extra-class"><pre class="language-php"><code><span class="token string double-quoted-string">&quot;workHolidayClass&quot;</span> <span class="token operator">=&gt;</span> <span class="token keyword">array</span><span class="token punctuation">(</span><span class="token string double-quoted-string">&quot;workHoliday&quot;</span><span class="token punctuation">,</span><span class="token string double-quoted-string">&quot;adWorkAuditing&quot;</span><span class="token punctuation">,</span><span class="token string double-quoted-string">&quot;workHolidayRebut&quot;</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
       <span class="token string double-quoted-string">&quot;workAddClass&quot;</span> <span class="token operator">=&gt;</span> 
</code></pre></div></li></ol></li></ul> <h2 id="增查删改"><a href="#增查删改" class="header-anchor">#</a> 增查删改</h2> <h3 id="增"><a href="#增" class="header-anchor">#</a> 增</h3> <ul><li>公司框架大多数使用的是异步处理数据,所以增类的方法一般都是写在类文件中,以Data结尾,写完之后去<code>data.php</code>注册类即可.</li></ul> <h3 id="查"><a href="#查" class="header-anchor">#</a> 查</h3> <ul><li><p>所有查询功能,基本上搜索框是写在类文件中的<code>listSearch</code>方法,如果有下拉搜索框,就需要先去para数据库表中建一个字段,以逗号分割放入下拉搜索框的所有选项.当然写完之后需要去<code>listSearch.php</code>中注册才能显示注册框.</p></li> <li><p>如果你不想让当前页面显示搜索框以及搜索按钮,你只需要在类文件的<code>listSearch</code>方法中定义一个空的html返回去即可.</p> <div class="language-php extra-class"><pre class="language-php"><code><span class="token keyword">public</span> <span class="token keyword">function</span> <span class="token function-definition function">listSearch</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
        <span class="token variable">$result</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'html'</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token string double-quoted-string">&quot;&quot;</span><span class="token punctuation">;</span>
        <span class="token comment">//返回空html</span>
        <span class="token keyword">return</span> <span class="token variable">$result</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
</code></pre></div></li></ul> <h3 id="删"><a href="#删" class="header-anchor">#</a> 删</h3> <ul><li><p>删除功能都是写在<code>delete.php</code>文件中,似乎也可以写在类文件,但是我目前还没研究出具体怎么写在类文件中</p></li> <li><p>首先删除按钮上绑定了js方法用以获取表单提交的数据,按钮还携带了复选框的多个id,以及携带的状态,在<code>delete.php</code>中就是靠elseif判断状态是否是对应的删除方法的.</p></li> <li><p>删除中一般使用post获取id,这个id的名字是可以变动的,不一定就叫id,也可能是userId,具体叫什么,取决于具体页面中定义的多选框中起的id名.</p> <div class="language-php extra-class"><pre class="language-php"><code><span class="token keyword">elseif</span><span class="token punctuation">(</span><span class="token variable">$get</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'type'</span><span class="token punctuation">]</span> <span class="token operator">==</span> <span class="token string double-quoted-string">&quot;deleteClient&quot;</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
    <span class="token variable">$array</span> <span class="token operator">=</span> <span class="token variable">$post</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'userId'</span><span class="token punctuation">]</span><span class="token punctuation">;</span>  <span class="token comment">//这里这个post得到的userId是在Class中起好的名字</span>
</code></pre></div><div class="language-php extra-class"><pre class="language-php"><code><span class="token variable">$checkbox</span>  <span class="token operator">=</span> <span class="token string double-quoted-string">&quot;&lt;input name='userId[]' type='checkbox' value='&quot;</span><span class="token operator">.</span><span class="token variable">$array</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'khid'</span><span class="token punctuation">]</span><span class="token operator">.</span><span class="token string double-quoted-string">&quot;'/&gt;&quot;</span><span class="token punctuation">;</span>
<span class="token comment">//userId的名字就起在这个Class中的input框中</span>
</code></pre></div></li></ul> <h3 id="改"><a href="#改" class="header-anchor">#</a> 改</h3> <ul><li>修改的方法和新增一般是写在同一个方法中,方法中用是否有主键id为区分,各自写好新增与修改的功能.</li></ul> <h2 id="弹出层"><a href="#弹出层" class="header-anchor">#</a> 弹出层</h2> <h3 id="基础"><a href="#基础" class="header-anchor">#</a> 基础</h3> <ul><li>一般是在类文件中写好Layer为后缀的弹出层页面显示方法,然后去<code>layer.php</code>中注册即可显示弹出层,在这个方法中,还可以夹带隐藏域input标签,和表单一起提交,非常的方便.</li> <li>具体弹出层数据的处理方法也就是类文件中的Data结尾的数据处理方法了.</li></ul> <h3 id="进阶"><a href="#进阶" class="header-anchor">#</a> 进阶</h3> <ul><li><p>如果想让弹出层<strong>不显示提交按钮</strong>,该怎么做呢?应该去<code>layer.php</code>中判断,如果你得到的type不是你需要让提交按钮不出现的那个弹窗,就让他正常运行代码生成button,这也就意味着你如果得到了你需要让提交按钮不出现的那个弹窗的type,提交按钮就不会生成.</p> <div class="language-php extra-class"><pre class="language-php"><code><span class="token keyword">if</span><span class="token punctuation">(</span><span class="token variable">$data</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'type'</span><span class="token punctuation">]</span><span class="token operator">!=</span><span class="token string single-quoted-string">'adUserExport'</span><span class="token punctuation">)</span><span class="token punctuation">{</span>   
    <span class="token comment">//如果有多个不让生成提交按钮的弹出层,就在这括号里后接or $data['type']!='你不想生成按钮的弹出层'</span>
          <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token keyword">empty</span><span class="token punctuation">(</span><span class="token variable">$result</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'button'</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
                <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token keyword">empty</span><span class="token punctuation">(</span><span class="token variable">$result</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'formTwo'</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
                   <span class="token variable">$result</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'button'</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token variable">$this</span><span class="token operator">-&gt;</span><span class="token function">button</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token punctuation">}</span><span class="token keyword">else</span><span class="token punctuation">{</span>
                   <span class="token variable">$result</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'button'</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token variable">$this</span><span class="token operator">-&gt;</span><span class="token function">button</span><span class="token punctuation">(</span><span class="token keyword">array</span><span class="token punctuation">(</span><span class="token string double-quoted-string">&quot;formTwo&quot;</span> <span class="token operator">=&gt;</span> <span class="token variable">$result</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'formTwo'</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                      <span class="token punctuation">}</span>
                <span class="token punctuation">}</span>
               <span class="token punctuation">}</span>
</code></pre></div></li></ul> <hr> <ul><li><p><strong>弹出层</strong>按道理是会携带主页面表格<strong>复选框选中的id</strong>的,也就可以拿着这些id做对应的操作,那么<strong>如何拿到</strong>?</p></li> <li><p>在Class中的弹出层方法里,携带listForm传给$result,起名为formTwo,因为在layer的按钮生成方法里会去拿这个formTwo,意思是提交的第二个表单.</p> <div class="language-php extra-class"><pre class="language-php"><code> <span class="token keyword">public</span> <span class="token keyword">function</span> <span class="token function-definition function">adUserCountLayer</span><span class="token punctuation">(</span><span class="token variable">$data</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
       <span class="token variable">$result</span> <span class="token operator">=</span> <span class="token keyword">array</span><span class="token punctuation">(</span><span class="token string double-quoted-string">&quot;title&quot;</span> <span class="token operator">=&gt;</span> <span class="token string double-quoted-string">&quot;添加次数&quot;</span><span class="token punctuation">,</span><span class="token string double-quoted-string">&quot;height&quot;</span> <span class="token operator">=&gt;</span> <span class="token number">190</span><span class="token punctuation">,</span><span class="token string double-quoted-string">&quot;width&quot;</span> <span class="token operator">=&gt;</span> <span class="token number">600</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
       <span class="token variable">$result</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'table'</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token keyword">array</span><span class="token punctuation">(</span>
           <span class="token string double-quoted-string">&quot;温馨提示：&quot;</span> <span class="token operator">=&gt;</span> <span class="token string double-quoted-string">&quot;&lt;span class='smallWord'&gt;您正在增加会员的剩余次数。&lt;/span&gt;&quot;</span><span class="token punctuation">,</span>
           must<span class="token operator">.</span><span class="token string double-quoted-string">&quot;输入次数：&quot;</span> <span class="token operator">=&gt;</span> <span class="token function">text</span><span class="token punctuation">(</span><span class="token keyword">array</span><span class="token punctuation">(</span>
               <span class="token string double-quoted-string">&quot;name&quot;</span> <span class="token operator">=&gt;</span> <span class="token string double-quoted-string">&quot;adUserCount&quot;</span><span class="token punctuation">,</span>
               <span class="token string double-quoted-string">&quot;value&quot;</span> <span class="token operator">=&gt;</span> <span class="token string double-quoted-string">&quot;&quot;</span><span class="token punctuation">,</span>
               <span class="token string double-quoted-string">&quot;class&quot;</span> <span class="token operator">=&gt;</span> <span class="token string double-quoted-string">&quot;text textPrice&quot;</span><span class="token punctuation">,</span>
           <span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
           must<span class="token operator">.</span><span class="token string double-quoted-string">&quot;登录密码：&quot;</span> <span class="token operator">=&gt;</span> <span class="token function">password</span><span class="token punctuation">(</span><span class="token keyword">array</span><span class="token punctuation">(</span><span class="token string double-quoted-string">&quot;name&quot;</span> <span class="token operator">=&gt;</span> <span class="token string double-quoted-string">&quot;password&quot;</span><span class="token punctuation">,</span><span class="token string double-quoted-string">&quot;class&quot;</span> <span class="token operator">=&gt;</span> <span class="token string double-quoted-string">&quot;text textPrice&quot;</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
       <span class="token punctuation">)</span><span class="token punctuation">;</span>
       <span class="token variable">$result</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'formTwo'</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token string single-quoted-string">'listForm'</span><span class="token punctuation">;</span>  <span class="token comment">//这一句就可以把页面表单复选框的id传过去,起名为formTwo</span>
       <span class="token keyword">return</span> <span class="token variable">$result</span><span class="token punctuation">;</span>
 
   <span class="token punctuation">}</span>
</code></pre></div><div class="language-php extra-class"><pre class="language-php"><code> <span class="token keyword">public</span> <span class="token keyword">function</span> <span class="token function-definition function">button</span><span class="token punctuation">(</span><span class="token variable">$data</span> <span class="token operator">=</span> <span class="token string double-quoted-string">&quot;&quot;</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
        <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token operator">!</span><span class="token keyword">empty</span><span class="token punctuation">(</span><span class="token variable">$data</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'formTwo'</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
            <span class="token comment">//在这里会判断有没有需要提交的第二个表单名称,如果有就拿到,自然就拿到了我们需要的id</span>
            <span class="token variable">$formTwo</span> <span class="token operator">=</span> <span class="token string double-quoted-string">&quot;,&quot;</span><span class="token operator">.</span><span class="token variable">$data</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'formTwo'</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
        <span class="token keyword">return</span> <span class="token string double-quoted-string">&quot;&lt;input onclick=\&quot;subForm('&quot;</span><span class="token operator">.</span><span class="token variable">$this</span><span class="token operator">-&gt;</span><span class="token property">type</span><span class="token operator">.</span><span class="token string double-quoted-string">&quot;Form&quot;</span><span class="token operator">.</span><span class="token variable">$formTwo</span><span class="token operator">.</span><span class="token string double-quoted-string">&quot;',root+'control/data.php?type=&quot;</span><span class="token operator">.</span><span class="token variable">$this</span><span class="token operator">-&gt;</span><span class="token property">type</span><span class="token operator">.</span><span class="token string double-quoted-string">&quot;')\&quot; type='button' class='button' value='确认提交'&gt;&quot;</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
</code></pre></div></li></ul> <h3 id="改造框架中的layer"><a href="#改造框架中的layer" class="header-anchor">#</a> 改造框架中的layer</h3> <ul><li><p>不想要layer中有默认按钮,就去layer中,把生成按钮部分的代码排除你的那个layer名</p> <div class="language-php extra-class"><pre class="language-php"><code><span class="token keyword">if</span><span class="token punctuation">(</span><span class="token variable">$data</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'type'</span><span class="token punctuation">]</span><span class="token operator">!=</span><span class="token string single-quoted-string">'adUserExport'</span><span class="token operator">&amp;&amp;</span><span class="token variable">$data</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'type'</span><span class="token punctuation">]</span><span class="token operator">!=</span><span class="token string single-quoted-string">'equitiesContext'</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
    <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token keyword">empty</span><span class="token punctuation">(</span><span class="token variable">$result</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'button'</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
        <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token keyword">empty</span><span class="token punctuation">(</span><span class="token variable">$result</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'formTwo'</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
            <span class="token variable">$result</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'button'</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token variable">$this</span><span class="token operator">-&gt;</span><span class="token function">button</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span><span class="token keyword">else</span><span class="token punctuation">{</span>
            <span class="token variable">$result</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'button'</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token variable">$this</span><span class="token operator">-&gt;</span><span class="token function">button</span><span class="token punctuation">(</span><span class="token keyword">array</span><span class="token punctuation">(</span><span class="token string double-quoted-string">&quot;formTwo&quot;</span> <span class="token operator">=&gt;</span> <span class="token variable">$result</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'formTwo'</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div></li> <li><p>不想要layer中有默认自带的id隐藏域同理</p> <div class="language-php extra-class"><pre class="language-php"><code> <span class="token comment">//在指定的弹出层内不要加ID隐藏域</span>
                <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token variable">$data</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'type'</span><span class="token punctuation">]</span><span class="token operator">!=</span><span class="token string single-quoted-string">'equitiesContext'</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
                    <span class="token variable">$result</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'table'</span><span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token variable">$hidden</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token variable">$result</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'button'</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
                <span class="token punctuation">}</span>
</code></pre></div></li> <li><div class="language-php extra-class"><pre class="language-php"><code><span class="token comment">//如果要自定义提交按钮,就重新定义button,只要在layer函数中传asyn就可以(asyn这个名字你随便起,叫abc都行)</span>
<span class="token keyword">if</span><span class="token punctuation">(</span><span class="token operator">!</span><span class="token keyword">empty</span><span class="token punctuation">(</span><span class="token variable">$result</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'asyn'</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">{</span><span class="token comment">//khidSubForm是重定义的表单提交JS方法</span>
    <span class="token variable">$result</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'button'</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token string double-quoted-string">&quot;&lt;input onclick=\&quot;khidSubForm('&quot;</span><span class="token operator">.</span><span class="token variable">$this</span><span class="token operator">-&gt;</span><span class="token property">type</span><span class="token operator">.</span><span class="token string double-quoted-string">&quot;Form&quot;</span><span class="token operator">.</span><span class="token variable">$formTwo</span><span class="token operator">.</span><span class="token string double-quoted-string">&quot;',root+'control/data.php?type=&quot;</span><span class="token operator">.</span><span class="token variable">$this</span><span class="token operator">-&gt;</span><span class="token property">type</span><span class="token operator">.</span><span class="token string double-quoted-string">&quot;')\&quot; type='button' class='button' value='确认提交'&gt;&quot;</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token comment">//改良版本,如果要重定义按钮,就穿$result['asyn</span><span class="token string single-quoted-string">'],值为自定义的异步提交JS方法名,然后把传过来的方法名拼接到按钮上即可
if(!empty($result['</span>asyn<span class="token string single-quoted-string">'])){
    $result['</span>button<span class="token string single-quoted-string">'] = &quot;&lt;input onclick=\&quot;&quot;.$result['</span>asyn<span class="token string single-quoted-string">'].&quot;('</span><span class="token string double-quoted-string">&quot;.<span class="token interpolation"><span class="token variable">$this</span><span class="token operator">-&gt;</span><span class="token property">type</span></span>.&quot;</span>Form<span class="token string double-quoted-string">&quot;.<span class="token interpolation"><span class="token variable">$formTwo</span></span>.&quot;</span><span class="token string single-quoted-string">',root+'</span>control<span class="token operator">/</span>data<span class="token operator">.</span>php<span class="token operator">?</span>type<span class="token operator">=</span><span class="token string double-quoted-string">&quot;.<span class="token interpolation"><span class="token variable">$this</span><span class="token operator">-&gt;</span><span class="token property">type</span></span>.&quot;</span><span class="token string single-quoted-string">')\&quot; type='</span>button<span class="token string single-quoted-string">' class='</span>button<span class="token string single-quoted-string">' value='</span>确认提交'<span class="token operator">&gt;</span>&quot;<span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre></div><div class="language-php extra-class"><pre class="language-php"><code><span class="token keyword">public</span> <span class="token keyword">function</span> <span class="token function-definition function">addUserLayer</span><span class="token punctuation">(</span><span class="token variable">$data</span><span class="token punctuation">)</span>
<span class="token punctuation">{</span>
    <span class="token variable">$result</span> <span class="token operator">=</span> <span class="token keyword">array</span><span class="token punctuation">(</span><span class="token string double-quoted-string">&quot;title&quot;</span> <span class="token operator">=&gt;</span> <span class="token string double-quoted-string">&quot;新增会员&quot;</span><span class="token punctuation">,</span> <span class="token string double-quoted-string">&quot;height&quot;</span> <span class="token operator">=&gt;</span> <span class="token number">234</span><span class="token punctuation">,</span> <span class="token string double-quoted-string">&quot;width&quot;</span> <span class="token operator">=&gt;</span> <span class="token number">600</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token variable">$result</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'table'</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token keyword">array</span><span class="token punctuation">(</span>

        <span class="token string double-quoted-string">&quot;会员名称：&quot;</span> <span class="token operator">=&gt;</span> <span class="token function">text</span><span class="token punctuation">(</span><span class="token keyword">array</span><span class="token punctuation">(</span><span class="token string double-quoted-string">&quot;name&quot;</span> <span class="token operator">=&gt;</span> <span class="token string double-quoted-string">&quot;name&quot;</span><span class="token punctuation">,</span><span class="token string double-quoted-string">&quot;class&quot;</span><span class="token operator">=&gt;</span><span class="token string double-quoted-string">&quot;addUser&quot;</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
        <span class="token string double-quoted-string">&quot;性别&quot;</span> <span class="token operator">=&gt;</span> <span class="token function">radio</span><span class="token punctuation">(</span><span class="token keyword">array</span><span class="token punctuation">(</span><span class="token string double-quoted-string">&quot;name&quot;</span> <span class="token operator">=&gt;</span> <span class="token string double-quoted-string">&quot;sex&quot;</span><span class="token punctuation">,</span><span class="token string double-quoted-string">&quot;class&quot;</span><span class="token operator">=&gt;</span><span class="token string double-quoted-string">&quot;addUser&quot;</span><span class="token punctuation">,</span><span class="token string double-quoted-string">&quot;value&quot;</span> <span class="token operator">=&gt;</span> <span class="token keyword">array</span><span class="token punctuation">(</span><span class="token string double-quoted-string">&quot;男&quot;</span><span class="token punctuation">,</span><span class="token string double-quoted-string">&quot;女&quot;</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
        <span class="token string double-quoted-string">&quot;会员手机号：&quot;</span> <span class="token operator">=&gt;</span>  <span class="token function">text</span><span class="token punctuation">(</span><span class="token keyword">array</span><span class="token punctuation">(</span>
            <span class="token string double-quoted-string">&quot;name&quot;</span> <span class="token operator">=&gt;</span> <span class="token string double-quoted-string">&quot;phone&quot;</span><span class="token punctuation">,</span>
            <span class="token string double-quoted-string">&quot;class&quot;</span><span class="token operator">=&gt;</span><span class="token string double-quoted-string">&quot;addUser&quot;</span><span class="token punctuation">,</span>
        <span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
        <span class="token string double-quoted-string">&quot;备注&quot;</span> <span class="token operator">=&gt;</span> <span class="token function">textarea</span><span class="token punctuation">(</span><span class="token keyword">array</span><span class="token punctuation">(</span>
            <span class="token string double-quoted-string">&quot;name&quot;</span> <span class="token operator">=&gt;</span> <span class="token string double-quoted-string">&quot;text&quot;</span><span class="token punctuation">,</span>
            <span class="token string double-quoted-string">&quot;class&quot;</span><span class="token operator">=&gt;</span><span class="token string double-quoted-string">&quot;addUser&quot;</span><span class="token punctuation">,</span>
        <span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
    <span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token variable">$result</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'asyn'</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">;</span><span class="token comment">//随便传个asyn过去就可以满足layer.php中我们定义的条件.就可以自定义异步提交按钮</span>

    <span class="token keyword">return</span> <span class="token variable">$result</span><span class="token punctuation">;</span>

<span class="token punctuation">}</span>
</code></pre></div><div class="language-js extra-class"><pre class="language-js"><code><span class="token comment">/********收银页面-新增会员带客户ID到第一弹出层-异步提交函数**************************/</span>
<span class="token comment">//form支持多表单提交，中间用,隔开，url为提交地址</span>
<span class="token keyword">function</span> <span class="token function">khidSubForm</span><span class="token punctuation">(</span><span class="token parameter">form<span class="token punctuation">,</span>url</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
    <span class="token comment">//防止高频点击</span>
    <span class="token keyword">var</span> date <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Date</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">var</span> time <span class="token operator">=</span> date<span class="token punctuation">.</span><span class="token function">getTime</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">//毫秒时间戳</span>
    <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token keyword">typeof</span> minTime <span class="token operator">==</span> <span class="token string">&quot;undefined&quot;</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
        <span class="token keyword">var</span> finger <span class="token operator">=</span> <span class="token number">2</span><span class="token punctuation">;</span>
        minTime <span class="token operator">=</span> time<span class="token operator">+</span><span class="token number">2000</span><span class="token punctuation">;</span><span class="token comment">//下次点击的最小时间</span>
        console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">&quot;定义minTime&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span><span class="token keyword">else</span><span class="token punctuation">{</span>
        <span class="token keyword">if</span><span class="token punctuation">(</span>minTime <span class="token operator">&amp;&amp;</span> time <span class="token operator">&lt;</span> minTime<span class="token punctuation">)</span><span class="token punctuation">{</span>
            <span class="token keyword">var</span> finger <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">;</span>
            <span class="token function">warn</span><span class="token punctuation">(</span><span class="token string">&quot;操作过于频繁&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">&quot;time:&quot;</span><span class="token operator">+</span>time<span class="token operator">+</span><span class="token string">&quot;，mintime:&quot;</span><span class="token operator">+</span>minTime<span class="token operator">+</span><span class="token string">&quot;，差额：&quot;</span><span class="token operator">+</span><span class="token punctuation">(</span>time<span class="token operator">-</span>minTime<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span><span class="token keyword">else</span><span class="token punctuation">{</span>
            <span class="token keyword">var</span> finger <span class="token operator">=</span> <span class="token number">2</span><span class="token punctuation">;</span>
            console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">&quot;time:&quot;</span><span class="token operator">+</span>time<span class="token operator">+</span><span class="token string">&quot;，mintime:&quot;</span><span class="token operator">+</span>minTime<span class="token operator">+</span><span class="token string">&quot;，多出：&quot;</span><span class="token operator">+</span><span class="token punctuation">(</span>time<span class="token operator">-</span>minTime<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            minTime <span class="token operator">=</span> time<span class="token operator">+</span><span class="token number">2000</span><span class="token punctuation">;</span><span class="token comment">//下次点击的最小时间</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
    <span class="token keyword">if</span><span class="token punctuation">(</span>finger <span class="token operator">==</span> <span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
        <span class="token comment">//串联表单</span>
        <span class="token keyword">var</span> formName <span class="token operator">=</span> form<span class="token punctuation">.</span><span class="token function">split</span><span class="token punctuation">(</span><span class="token string">&quot;,&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">var</span> serialize <span class="token operator">=</span> <span class="token string">&quot;&quot;</span><span class="token punctuation">;</span>
        <span class="token keyword">var</span> a <span class="token operator">=</span> <span class="token string">&quot;&quot;</span><span class="token punctuation">;</span>
        console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>formName<span class="token punctuation">.</span>length<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">for</span><span class="token punctuation">(</span><span class="token keyword">var</span> i<span class="token operator">=</span><span class="token number">0</span><span class="token punctuation">;</span>i<span class="token operator">&lt;</span>formName<span class="token punctuation">.</span>length<span class="token punctuation">;</span>i<span class="token operator">++</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
            <span class="token keyword">if</span><span class="token punctuation">(</span>serialize <span class="token operator">==</span> <span class="token string">&quot;&quot;</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
                a <span class="token operator">=</span> <span class="token string">&quot;&quot;</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span><span class="token keyword">else</span><span class="token punctuation">{</span>
                a <span class="token operator">=</span> <span class="token string">&quot;&amp;&quot;</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span>
            <span class="token keyword">if</span><span class="token punctuation">(</span>formName<span class="token punctuation">[</span>i<span class="token punctuation">]</span> <span class="token operator">!=</span> <span class="token string">&quot;&quot;</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
                serialize <span class="token operator">+=</span> a <span class="token operator">+</span> <span class="token function">$</span><span class="token punctuation">(</span><span class="token string">&quot;[name=&quot;</span><span class="token operator">+</span>formName<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token operator">+</span><span class="token string">&quot;]&quot;</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">serialize</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span>
        <span class="token punctuation">}</span>	
        <span class="token comment">//异步提交数据</span>
        $<span class="token punctuation">.</span><span class="token function">post</span><span class="token punctuation">(</span>url<span class="token punctuation">,</span>serialize<span class="token punctuation">,</span><span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">data</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
            <span class="token comment">//console.log(data);</span>
            <span class="token keyword">if</span><span class="token punctuation">(</span>data<span class="token punctuation">.</span>status <span class="token operator">==</span> <span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">{</span><span class="token comment">//这里不能用data.warn==2判断了,应该自定义一个传过来的值,我用了status.</span>
                <span class="token function">warn</span><span class="token punctuation">(</span>data<span class="token punctuation">.</span>warn<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">//这里要写弹窗,因为如果你不想刷新,还要弹出这个新增成功,就必须在JS里调用弹窗方法.</span>
                <span class="token comment">//如果传了2,就可以把对应客户ID传递到初始弹窗</span>
                <span class="token function">$</span><span class="token punctuation">(</span><span class="token string">'#placeAnOrder'</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">find</span><span class="token punctuation">(</span><span class="token string">&quot;[name=khid]&quot;</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">attr</span><span class="token punctuation">(</span><span class="token string">'value'</span><span class="token punctuation">,</span>data<span class="token punctuation">.</span>khid<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">//改变房间内容</span>

                <span class="token function">$</span><span class="token punctuation">(</span><span class="token string">'div'</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">find</span><span class="token punctuation">(</span><span class="token string">&quot;[name=userTel]&quot;</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">text</span><span class="token punctuation">(</span>data<span class="token punctuation">.</span>phone<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">//改变房间内容</span>
                <span class="token function">$</span><span class="token punctuation">(</span><span class="token string">'div'</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">find</span><span class="token punctuation">(</span><span class="token string">&quot;[name=userName]&quot;</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">text</span><span class="token punctuation">(</span>data<span class="token punctuation">.</span>userName<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">//改变房间内容</span>
                <span class="token function">$</span><span class="token punctuation">(</span><span class="token string">'div'</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">find</span><span class="token punctuation">(</span><span class="token string">&quot;[name=userLevel]&quot;</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">text</span><span class="token punctuation">(</span>data<span class="token punctuation">.</span>userLevel<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">//改变房间内容</span>
                <span class="token function">$</span><span class="token punctuation">(</span><span class="token string">'div'</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">find</span><span class="token punctuation">(</span><span class="token string">&quot;[name=svip]&quot;</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">text</span><span class="token punctuation">(</span>data<span class="token punctuation">.</span>svip<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">//改变房间内容</span>
                <span class="token function">$</span><span class="token punctuation">(</span><span class="token string">'div'</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">find</span><span class="token punctuation">(</span><span class="token string">&quot;[name=userPoint]&quot;</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">text</span><span class="token punctuation">(</span>data<span class="token punctuation">.</span>userPoint<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">//改变房间内容</span>
                <span class="token function">$</span><span class="token punctuation">(</span><span class="token string">'div'</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">find</span><span class="token punctuation">(</span><span class="token string">&quot;[name=balance]&quot;</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">text</span><span class="token punctuation">(</span>data<span class="token punctuation">.</span>balance<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">//改变房间内容</span>
                <span class="token function">$</span><span class="token punctuation">(</span><span class="token string">'div'</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">find</span><span class="token punctuation">(</span><span class="token string">&quot;[name=secretRoomCount]&quot;</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">text</span><span class="token punctuation">(</span>data<span class="token punctuation">.</span>secretRoomCount<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">//改变房间内容</span>
                <span class="token function">$</span><span class="token punctuation">(</span><span class="token string">'div'</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">find</span><span class="token punctuation">(</span><span class="token string">&quot;[name=mergeCount]&quot;</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">text</span><span class="token punctuation">(</span>data<span class="token punctuation">.</span>mergeCount<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">//改变房间内容</span>

                <span class="token function">$</span><span class="token punctuation">(</span><span class="token string">'span'</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">find</span><span class="token punctuation">(</span><span class="token string">&quot;[name=equitiesContext]&quot;</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">attr</span><span class="token punctuation">(</span><span class="token string">'onclick'</span><span class="token punctuation">,</span><span class="token string">&quot;layer('equitiesContext',{'khid':'&quot;</span><span class="token operator">+</span>data<span class="token punctuation">.</span>khid<span class="token operator">+</span><span class="token string">&quot;'})&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">//改变房间内容</span>
            <span class="token punctuation">}</span><span class="token keyword">else</span><span class="token punctuation">{</span>
                <span class="token function">warn</span><span class="token punctuation">(</span>data<span class="token punctuation">.</span>warn<span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span>
        <span class="token punctuation">}</span><span class="token punctuation">,</span><span class="token string">&quot;json&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div></li></ul> <h2 id="导入导出"><a href="#导入导出" class="header-anchor">#</a> 导入导出</h2> <h3 id="导出"><a href="#导出" class="header-anchor">#</a> 导出</h3> <ul><li><p>从数据库读取备注和字段名的情况下,使用以下代码.去data.php写</p> <div class="language-php extra-class"><pre class="language-php"><code><span class="token comment">/************************员工管理-导出excel*****************************/</span>
<span class="token comment">//到这个页面去完成导出功能</span>
<span class="token keyword">elseif</span><span class="token punctuation">(</span><span class="token variable">$get</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'type'</span><span class="token punctuation">]</span> <span class="token operator">==</span> <span class="token string single-quoted-string">'adminExport'</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
   <span class="token comment">//查询你要导出的数据库表的所有备注和字段名</span>
    <span class="token variable">$adminArr</span> <span class="token operator">=</span> <span class="token function">sqlQueryAll</span><span class="token punctuation">(</span><span class="token string double-quoted-string">&quot;SELECT  
                        COLUMN_NAME as `字段名`,  
                        COLUMN_COMMENT  AS  `备注`  
                        FROM information_schema.COLUMNS WHERE TABLE_NAME='admin'&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token keyword">foreach</span> <span class="token punctuation">(</span><span class="token variable">$adminArr</span> <span class="token keyword">as</span> <span class="token variable">$thing</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
        <span class="token comment">//如果表中有用不到的字段就用判断排除</span>
        <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token variable">$thing</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'字段名'</span><span class="token punctuation">]</span><span class="token operator">!=</span><span class="token string double-quoted-string">&quot;time&quot;</span><span class="token operator">&amp;&amp;</span><span class="token variable">$thing</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'字段名'</span><span class="token punctuation">]</span><span class="token operator">!=</span><span class="token string double-quoted-string">&quot;companyId&quot;</span><span class="token operator">&amp;&amp;</span><span class="token variable">$thing</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'字段名'</span><span class="token punctuation">]</span><span class="token operator">!=</span><span class="token string double-quoted-string">&quot;adid&quot;</span>
            <span class="token operator">&amp;&amp;</span><span class="token variable">$thing</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'字段名'</span><span class="token punctuation">]</span><span class="token operator">!=</span><span class="token string double-quoted-string">&quot;adDutyId&quot;</span><span class="token operator">&amp;&amp;</span><span class="token variable">$thing</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'字段名'</span><span class="token punctuation">]</span><span class="token operator">!=</span><span class="token string double-quoted-string">&quot;personalSocialSecurityType&quot;</span><span class="token operator">&amp;&amp;</span><span class="token variable">$thing</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'字段名'</span><span class="token punctuation">]</span><span class="token operator">!=</span><span class="token string double-quoted-string">&quot;companySocialSecurityType&quot;</span>
            <span class="token operator">&amp;&amp;</span><span class="token variable">$thing</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'字段名'</span><span class="token punctuation">]</span><span class="token operator">!=</span><span class="token string double-quoted-string">&quot;adLoginName&quot;</span><span class="token operator">&amp;&amp;</span><span class="token variable">$thing</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'字段名'</span><span class="token punctuation">]</span><span class="token operator">!=</span><span class="token string double-quoted-string">&quot;manager&quot;</span><span class="token operator">&amp;&amp;</span><span class="token variable">$thing</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'字段名'</span><span class="token punctuation">]</span><span class="token operator">!=</span><span class="token string double-quoted-string">&quot;state&quot;</span>
            <span class="token operator">&amp;&amp;</span><span class="token variable">$thing</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'字段名'</span><span class="token punctuation">]</span><span class="token operator">!=</span><span class="token string double-quoted-string">&quot;adpas&quot;</span><span class="token operator">&amp;&amp;</span><span class="token variable">$thing</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'字段名'</span><span class="token punctuation">]</span><span class="token operator">!=</span><span class="token string double-quoted-string">&quot;touxiang&quot;</span><span class="token operator">&amp;&amp;</span><span class="token variable">$thing</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'字段名'</span><span class="token punctuation">]</span><span class="token operator">!=</span><span class="token string double-quoted-string">&quot;IDCardFront&quot;</span>
            <span class="token operator">&amp;&amp;</span><span class="token variable">$thing</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'字段名'</span><span class="token punctuation">]</span><span class="token operator">!=</span><span class="token string double-quoted-string">&quot;IDCardBack&quot;</span><span class="token operator">&amp;&amp;</span><span class="token variable">$thing</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'字段名'</span><span class="token punctuation">]</span><span class="token operator">!=</span><span class="token string double-quoted-string">&quot;diploma&quot;</span><span class="token operator">&amp;&amp;</span><span class="token variable">$thing</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'字段名'</span><span class="token punctuation">]</span><span class="token operator">!=</span><span class="token string double-quoted-string">&quot;bankIco&quot;</span>
            <span class="token operator">&amp;&amp;</span><span class="token variable">$thing</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'字段名'</span><span class="token punctuation">]</span><span class="token operator">!=</span><span class="token string double-quoted-string">&quot;picture&quot;</span><span class="token operator">&amp;&amp;</span><span class="token variable">$thing</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'字段名'</span><span class="token punctuation">]</span><span class="token operator">!=</span><span class="token string double-quoted-string">&quot;lastMoney&quot;</span><span class="token operator">&amp;&amp;</span><span class="token variable">$thing</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'字段名'</span><span class="token punctuation">]</span><span class="token operator">!=</span><span class="token string double-quoted-string">&quot;money&quot;</span>
            <span class="token operator">&amp;&amp;</span><span class="token variable">$thing</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'字段名'</span><span class="token punctuation">]</span><span class="token operator">!=</span><span class="token string double-quoted-string">&quot;socialSecurity&quot;</span><span class="token operator">&amp;&amp;</span><span class="token variable">$thing</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'字段名'</span><span class="token punctuation">]</span><span class="token operator">!=</span><span class="token string double-quoted-string">&quot;socialSecurityNum&quot;</span><span class="token operator">&amp;&amp;</span><span class="token variable">$thing</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'字段名'</span><span class="token punctuation">]</span><span class="token operator">!=</span><span class="token string double-quoted-string">&quot;gateKey&quot;</span>
            <span class="token operator">&amp;&amp;</span><span class="token variable">$thing</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'字段名'</span><span class="token punctuation">]</span><span class="token operator">!=</span><span class="token string double-quoted-string">&quot;schoolEnd&quot;</span><span class="token operator">&amp;&amp;</span><span class="token variable">$thing</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'字段名'</span><span class="token punctuation">]</span><span class="token operator">!=</span><span class="token string double-quoted-string">&quot;IDCardRegionId&quot;</span><span class="token operator">&amp;&amp;</span><span class="token variable">$thing</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'字段名'</span><span class="token punctuation">]</span><span class="token operator">!=</span><span class="token string double-quoted-string">&quot;liveRegionId&quot;</span>
            <span class="token operator">&amp;&amp;</span><span class="token variable">$thing</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'字段名'</span><span class="token punctuation">]</span><span class="token operator">!=</span><span class="token string double-quoted-string">&quot;dingtalkId&quot;</span><span class="token operator">&amp;&amp;</span><span class="token variable">$thing</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'字段名'</span><span class="token punctuation">]</span><span class="token operator">!=</span><span class="token string double-quoted-string">&quot;loginErrorNum&quot;</span><span class="token operator">&amp;&amp;</span><span class="token variable">$thing</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'字段名'</span><span class="token punctuation">]</span><span class="token operator">!=</span><span class="token string double-quoted-string">&quot;loginErrorDay&quot;</span>
            <span class="token operator">&amp;&amp;</span><span class="token variable">$thing</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'字段名'</span><span class="token punctuation">]</span><span class="token operator">!=</span><span class="token string double-quoted-string">&quot;jobNum&quot;</span>
        <span class="token punctuation">)</span><span class="token punctuation">{</span>
            <span class="token variable">$wordArr</span><span class="token punctuation">[</span><span class="token variable">$thing</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'字段名'</span><span class="token punctuation">]</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token variable">$thing</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'备注'</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
     <span class="token comment">//取出session中存储的模糊查询sql语句</span>
    <span class="token variable">$admin</span> <span class="token operator">=</span> <span class="token function">sqlQueryAll</span><span class="token punctuation">(</span><span class="token variable">$_SESSION</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'adminSql'</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>  <span class="token comment">//查你要导出的数据的那张表</span>
    <span class="token variable">$config</span> <span class="token operator">=</span> <span class="token punctuation">[</span>
        <span class="token string single-quoted-string">'path'</span> <span class="token operator">=&gt;</span> <span class="token function">getTmpDir</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">.</span> <span class="token string single-quoted-string">'/'</span><span class="token punctuation">,</span>
    <span class="token punctuation">]</span><span class="token punctuation">;</span>
    <span class="token variable">$name</span> <span class="token operator">=</span> <span class="token string double-quoted-string">&quot;员工记录&quot;</span><span class="token operator">.</span><span class="token function">date</span><span class="token punctuation">(</span><span class="token string double-quoted-string">&quot;YmdHis&quot;</span><span class="token punctuation">)</span><span class="token operator">.</span><span class="token string double-quoted-string">&quot;.xlsx&quot;</span><span class="token punctuation">;</span>
    <span class="token variable">$fileName</span>   <span class="token operator">=</span> <span class="token variable">$name</span> <span class="token punctuation">;</span>
    <span class="token variable">$xlsxObject</span> <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name class-name-fully-qualified"><span class="token punctuation">\</span>Vtiful<span class="token punctuation">\</span>Kernel<span class="token punctuation">\</span>Excel</span><span class="token punctuation">(</span><span class="token variable">$config</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// Init File</span>
<span class="token comment">//    $fileObject = $excel-&gt;fileName($fileName);</span>
    <span class="token variable">$fileObject</span> <span class="token operator">=</span> <span class="token variable">$xlsxObject</span><span class="token operator">-&gt;</span><span class="token function">fileName</span><span class="token punctuation">(</span><span class="token variable">$fileName</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token variable">$head</span> <span class="token operator">=</span> <span class="token keyword">array</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token variable">$word</span> <span class="token operator">=</span> <span class="token keyword">array</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token variable">$sqlWord</span> <span class="token operator">=</span> <span class="token keyword">array</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token variable">$head</span><span class="token punctuation">[</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token string double-quoted-string">&quot;工号&quot;</span><span class="token punctuation">;</span>
        <span class="token keyword">foreach</span> <span class="token punctuation">(</span><span class="token variable">$wordArr</span> <span class="token keyword">as</span> <span class="token variable">$k</span><span class="token operator">=&gt;</span><span class="token variable">$v</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
            <span class="token variable">$sqlWord</span><span class="token punctuation">[</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token variable">$k</span><span class="token punctuation">;</span>   <span class="token comment">//一维数组,字段名,英文</span>
            <span class="token variable">$head</span><span class="token punctuation">[</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token variable">$wordArr</span><span class="token punctuation">[</span><span class="token variable">$k</span><span class="token punctuation">]</span><span class="token punctuation">;</span>  <span class="token comment">//一维数组,表头,中文</span>
        <span class="token punctuation">}</span>

        <span class="token keyword">foreach</span> <span class="token punctuation">(</span><span class="token variable">$admin</span> <span class="token keyword">as</span> <span class="token variable">$c</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
            <span class="token variable">$box</span> <span class="token operator">=</span> <span class="token keyword">array</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>  <span class="token comment">//一维数组,放每个数据,直到塞满一条就清空</span>
            <span class="token variable">$box</span><span class="token punctuation">[</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token variable">$c</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'jobNum'</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
            <span class="token keyword">foreach</span> <span class="token punctuation">(</span><span class="token variable">$sqlWord</span> <span class="token keyword">as</span> <span class="token variable">$english</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
                <span class="token variable">$box</span><span class="token punctuation">[</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token variable">$c</span><span class="token punctuation">[</span><span class="token variable">$english</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span>
            <span class="token variable">$word</span><span class="token punctuation">[</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token variable">$box</span><span class="token punctuation">;</span> <span class="token comment">//二维数组,[0] =&gt; 第一条数据,[1] =&gt; 第二条数据</span>
        <span class="token punctuation">}</span>

<span class="token comment">// Writing data to a file ......</span>
    <span class="token variable">$fileObject</span><span class="token operator">-&gt;</span><span class="token function">header</span><span class="token punctuation">(</span><span class="token variable">$head</span><span class="token punctuation">)</span><span class="token operator">-&gt;</span>
    <span class="token function">data</span><span class="token punctuation">(</span><span class="token variable">$word</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">// Outptu</span>
    <span class="token variable">$filePath</span> <span class="token operator">=</span> <span class="token variable">$fileObject</span><span class="token operator">-&gt;</span><span class="token function">output</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// Set Header</span>
    <span class="token function">header</span><span class="token punctuation">(</span><span class="token string double-quoted-string">&quot;Content-Type: application/vnd.openxmlformats-officedocument.spreadsheetml.sheet&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token function">header</span><span class="token punctuation">(</span><span class="token string single-quoted-string">'Content-Disposition: attachment;filename=&quot;'</span> <span class="token operator">.</span> <span class="token variable">$fileName</span> <span class="token operator">.</span> <span class="token string single-quoted-string">'&quot;'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token function">header</span><span class="token punctuation">(</span><span class="token string single-quoted-string">'Cache-Control: max-age=0'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token function">copy</span><span class="token punctuation">(</span><span class="token variable">$filePath</span><span class="token punctuation">,</span> <span class="token string single-quoted-string">'php://output'</span><span class="token punctuation">)</span> <span class="token operator">===</span> <span class="token constant boolean">false</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token comment">// Throw exception</span>
    <span class="token punctuation">}</span>

<span class="token comment">// Delete temporary file</span>
    @<span class="token function">unlink</span><span class="token punctuation">(</span><span class="token variable">$filePath</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre></div></li></ul> <h2 id="小功能"><a href="#小功能" class="header-anchor">#</a> 小功能</h2> <h3 id="选择字段显示对应字段表格"><a href="#选择字段显示对应字段表格" class="header-anchor">#</a> 选择字段显示对应字段表格</h3> <ul><li><div class="language-sql extra-class"><pre class="language-sql"><code><span class="token keyword">SELECT</span>  
COLUMN_NAME<span class="token punctuation">,</span>  
COLUMN_COMMENT  <span class="token keyword">AS</span>  <span class="token identifier"><span class="token punctuation">`</span>备注<span class="token punctuation">`</span></span>  
<span class="token keyword">FROM</span> information_schema<span class="token punctuation">.</span><span class="token keyword">COLUMNS</span> <span class="token keyword">WHERE</span> TABLE_NAME<span class="token operator">=</span><span class="token string">'xxx_table_name'</span>  <span class="token comment">//表名就算是关键字,也不用加``.</span>
</code></pre></div></li> <li><div class="language-php extra-class"><pre class="language-php"><code><span class="token variable">$wordArr</span> <span class="token operator">=</span> <span class="token function">sqlQueryAll</span><span class="token punctuation">(</span><span class="token string double-quoted-string">&quot;SELECT  
                       COLUMN_NAME as `字段名`,  
                       COLUMN_COMMENT  AS  `备注`  
                       FROM information_schema.COLUMNS WHERE TABLE_NAME='check'&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  
       <span class="token keyword">foreach</span> <span class="token punctuation">(</span><span class="token variable">$wordArr</span> <span class="token keyword">as</span> <span class="token variable">$thing</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
           <span class="token comment">//如果表中有用不到的字段就用判断排除,导出时必须要,但是导入时这一步没必要,因为多余字段筛选不到</span>
           <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token variable">$thing</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'字段名'</span><span class="token punctuation">]</span><span class="token operator">!=</span><span class="token string double-quoted-string">&quot;time&quot;</span><span class="token operator">&amp;&amp;</span><span class="token variable">$thing</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'字段名'</span><span class="token punctuation">]</span><span class="token operator">!=</span><span class="token string double-quoted-string">&quot;id&quot;</span><span class="token operator">&amp;&amp;</span><span class="token variable">$thing</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'字段名'</span><span class="token punctuation">]</span><span class="token operator">!=</span><span class="token string double-quoted-string">&quot;adid&quot;</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
               <span class="token variable">$word</span><span class="token punctuation">[</span><span class="token variable">$thing</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'字段名'</span><span class="token punctuation">]</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token variable">$thing</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'备注'</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
           <span class="token punctuation">}</span>
       <span class="token punctuation">}</span>
</code></pre></div><div class="language-php extra-class"><pre class="language-php"><code><span class="token comment">/**
 * 先通过我们要拿的字段名,去$key中找到对应的数字键,拿着这个键,去$v[$performanceAwardKey]找到对应的数据
 * @param $string 要找寻的字段
 * @param $v 具体的数据数组 array(3) { [0]=&gt; int(233) [1]=&gt; int(6) [2]=&gt; int(11) }
 * @param $key 数据库字段数组 array(3) { [0]=&gt; string(6) &quot;jobNum&quot; [1]=&gt; string(11) &quot;foodSubsidy&quot; [2]=&gt; string(7) &quot;subsidy&quot; }
 * @return mixed
 */</span>
<span class="token keyword">function</span> <span class="token function-definition function">findKey</span><span class="token punctuation">(</span><span class="token variable">$string</span><span class="token punctuation">,</span><span class="token variable">$v</span><span class="token punctuation">,</span><span class="token variable">$key</span><span class="token punctuation">,</span><span class="token variable">$existSalary</span><span class="token punctuation">)</span>
<span class="token punctuation">{</span>
    <span class="token variable">$k</span> <span class="token operator">=</span> <span class="token function">array_search</span><span class="token punctuation">(</span><span class="token variable">$string</span><span class="token punctuation">,</span><span class="token variable">$key</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token variable">$k</span> <span class="token operator">==</span> <span class="token constant boolean">false</span><span class="token punctuation">)</span><span class="token punctuation">{</span><span class="token comment">//如果array_search返回false,说明现在需要的数据,不在我们导入的excel表格中</span>
        <span class="token variable">$result</span>  <span class="token operator">=</span> <span class="token function">findSalaryData</span><span class="token punctuation">(</span><span class="token variable">$string</span><span class="token punctuation">,</span><span class="token variable">$existSalary</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">//那我们就先从本年本月这条salary数据中去拿</span>
        <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token keyword">empty</span><span class="token punctuation">(</span><span class="token variable">$result</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">{</span><span class="token comment">//如果拿到的为空,那就给它赋值为0</span>
            <span class="token variable">$result</span> <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span><span class="token keyword">else</span><span class="token punctuation">{</span><span class="token comment">//如果没返回false,那就说明我们需要的数据在导入的excel表格中存在,那就直接拿出来用.</span>
        <span class="token variable">$result</span>  <span class="token operator">=</span> <span class="token variable">$v</span><span class="token punctuation">[</span><span class="token variable">$k</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token keyword">return</span> <span class="token variable">$result</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token keyword">function</span> <span class="token function-definition function">findSalaryData</span><span class="token punctuation">(</span><span class="token variable">$string</span><span class="token punctuation">,</span><span class="token variable">$existSalary</span><span class="token punctuation">)</span>
<span class="token punctuation">{</span>
    <span class="token keyword">return</span> <span class="token variable">$existSalary</span><span class="token punctuation">[</span><span class="token variable">$string</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre></div></li></ul> <hr> <ul><li><p>点击按钮切换列表显示分类,使用一种新而简单的方法.</p></li> <li><p>如果在tab分支中,就在$edit前面拼接</p> <div class="language-php extra-class"><pre class="language-php"><code><span class="token variable">$html</span> <span class="token operator">=</span> <span class="token string double-quoted-string">&quot;&lt;p&gt;&quot;</span><span class="token operator">.</span><span class="token string double-quoted-string">&quot;&lt;div style='margin: 12px;'&gt;
                &lt;span class='bigSpan choice' onclick=\&quot;switchCoupon(this,'未使用')\&quot;&gt;未使用&lt;/span&gt;
                &lt;span class='bigSpan'  onclick=\&quot;switchCoupon(this,'已使用')\&quot;&gt;已使用&lt;/span&gt;
                &lt;span class='bigSpan'  onclick=\&quot;switchCoupon(this,'已失效')\&quot;&gt;已失效&lt;/span&gt;
                &lt;/div&gt;&quot;</span><span class="token operator">.</span>
            <span class="token string double-quoted-string">&quot;&lt;/p&gt;&quot;</span><span class="token operator">.</span><span class="token variable">$edit</span><span class="token operator">.</span>space<span class="token operator">.</span><span class="token string double-quoted-string">&quot;&lt;form name='couponForm'&gt;&quot;</span><span class="token operator">.</span><span class="token function">tableMany</span><span class="token punctuation">(</span><span class="token keyword">array</span><span class="token punctuation">(</span><span class="token string double-quoted-string">&quot;tr&quot;</span> <span class="token operator">=&gt;</span> <span class="token variable">$tr</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token operator">.</span>&quot;<span class="token operator">&lt;</span><span class="token operator">/</span>form<span class="token operator">&gt;</span><span class="token operator">&lt;</span>script<span class="token operator">&gt;</span>
</code></pre></div></li> <li><p>如果是主页面就在listSearch中拼接.</p></li> <li><p>然后使用重写的JS方法<code>switchCoupon</code></p></li> <li><p>直接去异步添加Session,然后在列表处拼接SQL,判断不同的session拼接不同的条件.</p> <div class="language-php extra-class"><pre class="language-php"><code><span class="token comment">/**********切换优惠券列表**********/</span>
<span class="token keyword">elseif</span><span class="token punctuation">(</span><span class="token variable">$get</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'type'</span><span class="token punctuation">]</span> <span class="token operator">==</span> <span class="token string double-quoted-string">&quot;saveCouponSession&quot;</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token variable">$_SESSION</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'haveCouponWorkFlow'</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token variable">$post</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'workFlow'</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
    <span class="token variable">$json</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'href'</span><span class="token punctuation">]</span> <span class="token operator">=</span> root<span class="token operator">.</span><span class="token string double-quoted-string">&quot;control/detail.php?type=adUser&amp;menu=coupon&amp;id=&quot;</span><span class="token operator">.</span><span class="token variable">$post</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'khid'</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre></div></li> <li><p>直接把回显按钮高亮的那部分html也在这个session判断中完成即可.</p> <div class="language-php extra-class"><pre class="language-php"><code><span class="token comment">/**********切换优惠券列表**********/</span>
<span class="token comment">//反正现在Class的切换是由php代码完成,这里就不用去掉/添加html的class了</span>
<span class="token keyword">function</span> <span class="token function-definition function">switchCoupon</span><span class="token punctuation">(</span>e<span class="token punctuation">,</span>workFlow<span class="token punctuation">,</span>khid<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    $<span class="token operator">.</span><span class="token function">post</span><span class="token punctuation">(</span>root<span class="token operator">+</span><span class="token string double-quoted-string">&quot;control/data.php?type=saveCouponSession&quot;</span><span class="token punctuation">,</span><span class="token punctuation">{</span>workFlow<span class="token punctuation">:</span>workFlow<span class="token punctuation">,</span><span class="token argument-name">khid</span><span class="token punctuation">:</span>khid<span class="token punctuation">}</span><span class="token punctuation">,</span><span class="token keyword">function</span><span class="token punctuation">(</span>data<span class="token punctuation">)</span><span class="token punctuation">{</span>
        window<span class="token operator">.</span>location<span class="token operator">.</span>href <span class="token operator">=</span> data<span class="token operator">.</span>href<span class="token punctuation">;</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span><span class="token string double-quoted-string">&quot;json&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre></div><div class="language-php extra-class"><pre class="language-php"><code><span class="token keyword">if</span><span class="token punctuation">(</span><span class="token variable">$_SESSION</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'haveCouponWorkFlow'</span><span class="token punctuation">]</span><span class="token operator">==</span><span class="token string single-quoted-string">'已使用'</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
    <span class="token variable">$sql</span>  <span class="token operator">=</span> <span class="token string double-quoted-string">&quot;and workFlow = '已使用'&quot;</span><span class="token punctuation">;</span>
    <span class="token variable">$switch</span> <span class="token operator">=</span> <span class="token string double-quoted-string">&quot;
                &lt;span class='bigSpan' onclick=\&quot;switchCoupon(this,'未使用','<span class="token interpolation"><span class="token variable">$userId</span></span>')\&quot;&gt;未使用&lt;/span&gt;
                &lt;span class='bigSpan choice'  onclick=\&quot;switchCoupon(this,'已使用','<span class="token interpolation"><span class="token variable">$userId</span></span>')\&quot;&gt;已使用&lt;/span&gt;
                &lt;span class='bigSpan'  onclick=\&quot;switchCoupon(this,'已失效','<span class="token interpolation"><span class="token variable">$userId</span></span>')\&quot;&gt;已失效&lt;/span&gt;
                &quot;</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token keyword">elseif</span> <span class="token punctuation">(</span><span class="token variable">$_SESSION</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'haveCouponWorkFlow'</span><span class="token punctuation">]</span><span class="token operator">==</span><span class="token string single-quoted-string">'已失效'</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
    <span class="token variable">$sql</span>  <span class="token operator">=</span> <span class="token string double-quoted-string">&quot;and workFlow = '已失效'&quot;</span><span class="token punctuation">;</span>
    <span class="token variable">$switch</span> <span class="token operator">=</span> <span class="token string double-quoted-string">&quot;
                &lt;span class='bigSpan' onclick=\&quot;switchCoupon(this,'未使用','<span class="token interpolation"><span class="token variable">$userId</span></span>')\&quot;&gt;未使用&lt;/span&gt;
                &lt;span class='bigSpan'  onclick=\&quot;switchCoupon(this,'已使用','<span class="token interpolation"><span class="token variable">$userId</span></span>')\&quot;&gt;已使用&lt;/span&gt;
                &lt;span class='bigSpan choice'  onclick=\&quot;switchCoupon(this,'已失效','<span class="token interpolation"><span class="token variable">$userId</span></span>')\&quot;&gt;已失效&lt;/span&gt;
                &quot;</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token keyword">else</span><span class="token punctuation">{</span>
    <span class="token variable">$sql</span>  <span class="token operator">=</span> <span class="token string double-quoted-string">&quot;and workFlow = ''&quot;</span><span class="token punctuation">;</span>
    <span class="token variable">$switch</span> <span class="token operator">=</span> <span class="token string double-quoted-string">&quot;
                &lt;span class='bigSpan choice' onclick=\&quot;switchCoupon(this,'未使用','<span class="token interpolation"><span class="token variable">$userId</span></span>')\&quot;&gt;未使用&lt;/span&gt;
                &lt;span class='bigSpan'  onclick=\&quot;switchCoupon(this,'已使用','<span class="token interpolation"><span class="token variable">$userId</span></span>')\&quot;&gt;已使用&lt;/span&gt;
                &lt;span class='bigSpan'  onclick=\&quot;switchCoupon(this,'已失效','<span class="token interpolation"><span class="token variable">$userId</span></span>')\&quot;&gt;已失效&lt;/span&gt;
                &quot;</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
<span class="token variable">$haveCoupon</span> <span class="token operator">=</span> <span class="token function">sqlQueryAll</span><span class="token punctuation">(</span><span class="token string double-quoted-string">&quot;select id,workFlow,couponId,time from haveCoupon
                      where khid = '<span class="token interpolation"><span class="token variable">$userId</span></span>'&quot;</span><span class="token operator">.</span><span class="token variable">$sql</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div></li> <li><p>当然CSS少不了</p></li> <li><div class="language-css extra-class"><pre class="language-css"><code><span class="token selector">.choice</span><span class="token punctuation">{</span>
    <span class="token property">background-color</span><span class="token punctuation">:</span> #3e97ff<span class="token important">!important</span><span class="token punctuation">;</span>
    <span class="token property">color</span><span class="token punctuation">:</span> #ffffff<span class="token important">!important</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
<span class="token selector">.bigSpan</span><span class="token punctuation">{</span>
    <span class="token property">padding</span><span class="token punctuation">:</span> 0px 6px 0 6px<span class="token punctuation">;</span>
    <span class="token property">border</span><span class="token punctuation">:</span> 1px solid #cddba2<span class="token punctuation">;</span>
    <span class="token property">border-radius</span><span class="token punctuation">:</span> 4px<span class="token punctuation">;</span>
    <span class="token property">background-color</span><span class="token punctuation">:</span> #ffffff<span class="token punctuation">;</span>
    <span class="token property">color</span><span class="token punctuation">:</span> #7d6b6b<span class="token punctuation">;</span>
    <span class="token property">cursor</span><span class="token punctuation">:</span> pointer<span class="token punctuation">;</span>
    <span class="token property">white-space</span><span class="token punctuation">:</span> nowrap<span class="token punctuation">;</span>
    <span class="token property">user-select</span><span class="token punctuation">:</span> none<span class="token punctuation">;</span>
    <span class="token property">font-size</span><span class="token punctuation">:</span> 20px<span class="token punctuation">;</span>
    <span class="token property">margin</span><span class="token punctuation">:</span> 10px<span class="token punctuation">;</span>
    <span class="token property">position</span><span class="token punctuation">:</span> relative<span class="token punctuation">;</span>
<span class="token punctuation">}</span>
<span class="token selector">.numEm</span><span class="token punctuation">{</span>
    <span class="token property">position</span><span class="token punctuation">:</span> absolute<span class="token punctuation">;</span>
    <span class="token property">color</span><span class="token punctuation">:</span> black<span class="token punctuation">;</span>
    <span class="token property">top</span><span class="token punctuation">:</span> -11px<span class="token punctuation">;</span>
    <span class="token property">right</span><span class="token punctuation">:</span> -16px<span class="token punctuation">;</span>
    <span class="token property">width</span><span class="token punctuation">:</span> 20px<span class="token punctuation">;</span>
    <span class="token property">background-color</span><span class="token punctuation">:</span> yellow<span class="token punctuation">;</span>
    <span class="token property">text-align</span><span class="token punctuation">:</span> center<span class="token punctuation">;</span>
    <span class="token property">font-style</span><span class="token punctuation">:</span> normal<span class="token punctuation">;</span>
    <span class="token property">font-size</span><span class="token punctuation">:</span> 13px<span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre></div></li></ul> <h3 id="导入"><a href="#导入" class="header-anchor">#</a> 导入</h3> <ul><li><p>去post.php里写代码,从数据库直接拿备注和字段名,就用以下代码.</p> <div class="language-php extra-class"><pre class="language-php"><code><span class="token keyword">elseif</span> <span class="token punctuation">(</span><span class="token variable">$get</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'type'</span><span class="token punctuation">]</span> <span class="token operator">==</span> <span class="token string single-quoted-string">'importChangeRecord'</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token comment">//赋值</span>
    <span class="token variable">$password</span> <span class="token operator">=</span> <span class="token variable">$post</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'password'</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
<span class="token comment">//判断</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span><span class="token function">power</span><span class="token punctuation">(</span><span class="token string double-quoted-string">&quot;admin&quot;</span><span class="token punctuation">,</span> <span class="token string double-quoted-string">&quot;import&quot;</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token variable">$warn</span> <span class="token operator">=</span> <span class="token string double-quoted-string">&quot;权限不足&quot;</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span> <span class="token keyword">elseif</span> <span class="token punctuation">(</span><span class="token keyword">empty</span><span class="token punctuation">(</span><span class="token variable">$password</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token variable">$warn</span> <span class="token operator">=</span> <span class="token string double-quoted-string">&quot;管理员登录密码为空&quot;</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span><span class="token keyword">elseif</span> <span class="token punctuation">(</span><span class="token keyword">empty</span><span class="token punctuation">(</span><span class="token variable">$_FILES</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'adjustExcel'</span><span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token string double-quoted-string">&quot;tmp_name&quot;</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token variable">$warn</span> <span class="token operator">=</span> <span class="token string double-quoted-string">&quot;没有上传文件&quot;</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token keyword">elseif</span> <span class="token punctuation">(</span><span class="token function">md5</span><span class="token punctuation">(</span><span class="token variable">$password</span><span class="token punctuation">)</span> <span class="token operator">!=</span> <span class="token variable">$control</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'adpas'</span><span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token variable">$warn</span> <span class="token operator">=</span> <span class="token string double-quoted-string">&quot;管理员登录密码输入有误&quot;</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
        <span class="token variable">$adid</span> <span class="token operator">=</span> <span class="token variable">$_GET</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'adid'</span><span class="token punctuation">]</span><span class="token punctuation">;</span>

        <span class="token variable">$adminArr</span> <span class="token operator">=</span> <span class="token function">sqlQueryAll</span><span class="token punctuation">(</span><span class="token string double-quoted-string">&quot;SELECT  
                        COLUMN_NAME as `字段名`,  
                        COLUMN_COMMENT  AS  `备注`  
                        FROM information_schema.COLUMNS WHERE TABLE_NAME='adjust'&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token keyword">foreach</span> <span class="token punctuation">(</span><span class="token variable">$adminArr</span> <span class="token keyword">as</span> <span class="token variable">$thing</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
            <span class="token comment">//导出时这里如果表中有用不到的字段就用判断排除,但导入不用,因为导入的数组会去我们从数据库拿到的字段名一一对应,对应上了才会塞进数据库.</span>
            <span class="token variable">$wordArr</span><span class="token punctuation">[</span><span class="token variable">$thing</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'字段名'</span><span class="token punctuation">]</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token variable">$thing</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'备注'</span><span class="token punctuation">]</span><span class="token punctuation">;</span><span class="token comment">//字段名为key,备注为value.</span>
        <span class="token punctuation">}</span>
        <span class="token variable">$name</span> <span class="token operator">=</span> <span class="token variable">$_FILES</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'adjustExcel'</span><span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token string double-quoted-string">&quot;tmp_name&quot;</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
        <span class="token variable">$successNum</span> <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>


        <span class="token variable">$config</span>   <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token string single-quoted-string">'path'</span> <span class="token operator">=&gt;</span> <span class="token string single-quoted-string">''</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
        <span class="token variable">$excel</span>    <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name class-name-fully-qualified"><span class="token punctuation">\</span>Vtiful<span class="token punctuation">\</span>Kernel<span class="token punctuation">\</span>Excel</span><span class="token punctuation">(</span><span class="token variable">$config</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

         <span class="token comment">/******excel表格中时间列筛选*******/</span>
        <span class="token variable">$dataHead</span> <span class="token operator">=</span> <span class="token variable">$excel</span><span class="token operator">-&gt;</span><span class="token function">openFile</span><span class="token punctuation">(</span><span class="token variable">$name</span><span class="token punctuation">)</span>
            <span class="token operator">-&gt;</span><span class="token function">openSheet</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
            <span class="token operator">-&gt;</span><span class="token function">getSheetData</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">foreach</span> <span class="token punctuation">(</span><span class="token variable">$dataHead</span> <span class="token keyword">as</span> <span class="token variable">$k</span> <span class="token operator">=&gt;</span> <span class="token variable">$v</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
            <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token variable">$k</span><span class="token operator">==</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
                <span class="token variable">$head</span> <span class="token operator">=</span> <span class="token variable">$v</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span>
        <span class="token punctuation">}</span>
        <span class="token variable">$timeArr</span> <span class="token operator">=</span> <span class="token keyword">array</span><span class="token punctuation">(</span><span class="token string double-quoted-string">&quot;调岗时间&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">//所有要转换的时间列表头手动写为一个数组</span>
        <span class="token variable">$temp</span> <span class="token operator">=</span> <span class="token keyword">array</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token variable">$tempKey</span> <span class="token operator">=</span> <span class="token keyword">array</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">foreach</span> <span class="token punctuation">(</span><span class="token variable">$timeArr</span> <span class="token keyword">as</span> <span class="token variable">$t</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
            <span class="token variable">$adjustTime</span> <span class="token operator">=</span> <span class="token function">array_search</span><span class="token punctuation">(</span><span class="token variable">$t</span><span class="token punctuation">,</span><span class="token variable">$head</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token variable">$temp</span><span class="token punctuation">[</span><span class="token variable">$adjustTime</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token class-name class-name-fully-qualified static-context"><span class="token punctuation">\</span>Vtiful<span class="token punctuation">\</span>Kernel<span class="token punctuation">\</span>Excel</span><span class="token operator">::</span><span class="token constant">TYPE_TIMESTAMP</span><span class="token punctuation">;</span>
            <span class="token variable">$tempKey</span><span class="token punctuation">[</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token variable">$adjustTime</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
        <span class="token comment">/*********时间列筛选结束********/</span>

        <span class="token variable">$data</span> <span class="token operator">=</span> <span class="token variable">$excel</span><span class="token operator">-&gt;</span><span class="token function">openFile</span><span class="token punctuation">(</span><span class="token variable">$name</span><span class="token punctuation">)</span>
            <span class="token operator">-&gt;</span><span class="token function">openSheet</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
            <span class="token operator">-&gt;</span><span class="token function">getSheetData</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token function">mysqli_autocommit</span><span class="token punctuation">(</span><span class="token variable">$con</span><span class="token punctuation">,</span><span class="token constant boolean">false</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">//表示事务开始</span>
        <span class="token variable">$word</span> <span class="token operator">=</span> <span class="token keyword">array</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">//遍历excel表格中的数据,第一行表头存到head,其余数据存word</span>
        <span class="token keyword">foreach</span> <span class="token punctuation">(</span><span class="token variable">$data</span> <span class="token keyword">as</span> <span class="token variable">$k</span> <span class="token operator">=&gt;</span> <span class="token variable">$v</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
            <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token variable">$k</span><span class="token operator">==</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">{</span><span class="token comment">//只存第一行,因为第一行是表头</span>
                <span class="token variable">$head</span> <span class="token operator">=</span> <span class="token variable">$v</span><span class="token punctuation">;</span><span class="token comment">//一维数组,存表头中文</span>
            <span class="token punctuation">}</span><span class="token keyword">else</span><span class="token punctuation">{</span>
                <span class="token variable">$word</span><span class="token punctuation">[</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token variable">$v</span><span class="token punctuation">;</span><span class="token comment">//一维数组</span>
            <span class="token punctuation">}</span>
        <span class="token punctuation">}</span>
        <span class="token variable">$key</span> <span class="token operator">=</span> <span class="token keyword">array</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">//把表头数组遍历,在我们写好的字段数据$show中找到对应的字段名,存入key数组.</span>
        <span class="token keyword">foreach</span> <span class="token punctuation">(</span><span class="token variable">$head</span> <span class="token keyword">as</span> <span class="token variable">$v</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
            <span class="token variable">$one</span> <span class="token operator">=</span> <span class="token function">array_search</span><span class="token punctuation">(</span><span class="token variable">$v</span><span class="token punctuation">,</span><span class="token variable">$wordArr</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token variable">$key</span><span class="token punctuation">[</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token variable">$one</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>


        <span class="token keyword">foreach</span> <span class="token punctuation">(</span><span class="token variable">$word</span> <span class="token keyword">as</span> <span class="token variable">$kk</span><span class="token operator">=&gt;</span><span class="token variable">$v</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
            <span class="token variable">$field</span> <span class="token operator">=</span> <span class="token keyword">array</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>



            <span class="token keyword">foreach</span> <span class="token punctuation">(</span><span class="token variable">$v</span> <span class="token keyword">as</span> <span class="token variable">$k</span> <span class="token operator">=&gt;</span> <span class="token variable">$a</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
                 <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token function">in_array</span><span class="token punctuation">(</span><span class="token variable">$k</span><span class="token punctuation">,</span><span class="token variable">$tempKey</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
                    <span class="token variable">$a</span> <span class="token operator">=</span> <span class="token function">date</span><span class="token punctuation">(</span><span class="token string single-quoted-string">'Y-m-d'</span><span class="token punctuation">,</span><span class="token variable">$a</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token punctuation">}</span><span class="token comment">//时间戳格式处理</span>
                    <span class="token variable">$field</span><span class="token punctuation">[</span><span class="token variable">$key</span><span class="token punctuation">[</span><span class="token variable">$k</span><span class="token punctuation">]</span><span class="token punctuation">]</span> <span class="token operator">=</span>  <span class="token variable">$a</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span>

                <span class="token variable">$field</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'adid'</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token variable">$adid</span><span class="token punctuation">;</span>
                <span class="token variable">$field</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'id'</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token function">suiji</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token variable">$field</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'time'</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token variable">$date</span><span class="token punctuation">;</span>

                <span class="token variable">$success</span><span class="token punctuation">[</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token function">insert</span><span class="token punctuation">(</span><span class="token keyword">array</span><span class="token punctuation">(</span><span class="token string double-quoted-string">&quot;table&quot;</span> <span class="token operator">=&gt;</span> <span class="token string double-quoted-string">&quot;adjust&quot;</span><span class="token punctuation">,</span><span class="token string double-quoted-string">&quot;field&quot;</span> <span class="token operator">=&gt;</span> <span class="token variable">$field</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>



        <span class="token punctuation">}</span>
<span class="token comment">//        var_dump($successNum);</span>
        <span class="token keyword">foreach</span> <span class="token punctuation">(</span><span class="token variable">$success</span> <span class="token keyword">as</span> <span class="token variable">$successKey</span> <span class="token operator">=&gt;</span> <span class="token variable">$successValue</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
            <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token variable">$successValue</span> <span class="token operator">==</span> <span class="token string double-quoted-string">&quot;新增成功&quot;</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
                <span class="token keyword">unset</span><span class="token punctuation">(</span><span class="token variable">$success</span><span class="token punctuation">[</span><span class="token variable">$successKey</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token variable">$successNum</span><span class="token operator">++</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span>
            <span class="token keyword">else</span><span class="token punctuation">{</span>
              <span class="token variable">$failedNum</span> <span class="token operator">=</span> <span class="token variable">$successKey</span><span class="token operator">+</span><span class="token number">1</span><span class="token punctuation">;</span>
                <span class="token variable">$failed</span> <span class="token operator">.=</span> <span class="token variable">$failedNum</span><span class="token operator">.</span><span class="token string double-quoted-string">&quot; &quot;</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span>

        <span class="token punctuation">}</span>
        <span class="token variable">$success</span> <span class="token operator">=</span> <span class="token function">array_values</span><span class="token punctuation">(</span><span class="token variable">$success</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token function">count</span><span class="token punctuation">(</span><span class="token variable">$success</span><span class="token punctuation">)</span><span class="token operator">&lt;</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
            <span class="token function">mysqli_commit</span><span class="token punctuation">(</span><span class="token variable">$con</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span><span class="token keyword">else</span><span class="token punctuation">{</span>
            <span class="token function">mysqli_rollback</span><span class="token punctuation">(</span><span class="token variable">$con</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>

        <span class="token function">mysqli_autocommit</span><span class="token punctuation">(</span><span class="token variable">$con</span><span class="token punctuation">,</span><span class="token constant boolean">true</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">//表示事务结束</span>

        <span class="token variable">$text</span> <span class="token operator">=</span> <span class="token string double-quoted-string">&quot;导入如果出现问题,问题分别出现在第&quot;</span><span class="token operator">.</span><span class="token variable">$failed</span><span class="token operator">.</span><span class="token string double-quoted-string">&quot;行&quot;</span><span class="token punctuation">;</span>
        <span class="token function">logText</span><span class="token punctuation">(</span><span class="token keyword">array</span><span class="token punctuation">(</span><span class="token string double-quoted-string">&quot;type&quot;</span> <span class="token operator">=&gt;</span> <span class="token string double-quoted-string">&quot;admin&quot;</span><span class="token punctuation">,</span><span class="token string double-quoted-string">&quot;text&quot;</span> <span class="token operator">=&gt;</span> <span class="token variable">$text</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token variable">$warn</span> <span class="token operator">=</span> <span class="token string double-quoted-string">&quot;导入了<span class="token interpolation"><span class="token punctuation">{</span><span class="token variable">$successNum</span><span class="token punctuation">}</span></span>条调岗信息,如有问题请到系统日期查看详情&quot;</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div></li></ul> <h2 id="分支-tab"><a href="#分支-tab" class="header-anchor">#</a> 分支(tab)</h2> <h3 id="分支菜单"><a href="#分支菜单" class="header-anchor">#</a> 分支菜单</h3> <ul><li><p>如果想要写分支tab的方法,按框架要求是要写在Class中的,起不同的方法名,去<code>detailTab.php</code>中注册即可.</p></li> <li><p>分支页面的第一个,是写在<code>detailPara.php</code>中的,写的时候可以<strong>定义分支菜单</strong>的各个按钮,但是要注意,写好之后必须把<code>$menu</code>写进<code>$para</code>里,不然是不会显示分支菜单的</p> <div class="language-php extra-class"><pre class="language-php"><code><span class="token variable">$menu</span> <span class="token operator">=</span> <span class="token keyword">array</span><span class="token punctuation">(</span><span class="token string double-quoted-string">&quot;edit&quot;</span> <span class="token operator">=&gt;</span> <span class="token string double-quoted-string">&quot;基本信息&quot;</span><span class="token punctuation">,</span><span class="token string double-quoted-string">&quot;info&quot;</span> <span class="token operator">=&gt;</span> <span class="token string double-quoted-string">&quot;辅助信息&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">//分支菜单数组</span>
<span class="token variable">$para</span> <span class="token operator">=</span> <span class="token keyword">array</span><span class="token punctuation">(</span><span class="token string double-quoted-string">&quot;id&quot;</span> <span class="token operator">=&gt;</span> <span class="token variable">$adDuty</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'id'</span><span class="token punctuation">]</span><span class="token punctuation">,</span><span class="token string double-quoted-string">&quot;title&quot;</span> <span class="token operator">=&gt;</span> <span class="token variable">$adDuty</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'department'</span><span class="token punctuation">]</span><span class="token operator">.</span><span class="token string double-quoted-string">&quot;-&quot;</span><span class="token operator">.</span><span class="token variable">$adDuty</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'name'</span><span class="token punctuation">]</span><span class="token punctuation">,</span><span class="token string double-quoted-string">&quot;button&quot;</span> <span class="token operator">=&gt;</span> <span class="token string double-quoted-string">&quot;更新&quot;</span><span class="token punctuation">,</span><span class="token string double-quoted-string">&quot;menu&quot;</span> <span class="token operator">=&gt;</span> <span class="token variable">$menu</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">//分支菜单需要放到$para中才生效</span>
</code></pre></div></li></ul> <h3 id="分支页面"><a href="#分支页面" class="header-anchor">#</a> 分支页面</h3> <ul><li><p>分支页面的生成</p> <ul><li><p>按钮的名字定义在<code>detailPara.php</code>中写的第一个分支页面中.</p></li> <li><p>第一个页面写在<code>detailPara.php</code>中</p></li> <li><p>第二个页面写在Class中,方法名为tab.写完之后去<code>detailTab.php</code>中注册.</p></li> <li><p>从第三个开始也是写在Class中,但是名字可以自定义,写完之后也是去<code>detailTab.php</code>中注册,但是注册填的东西不太一样,数组中需要多填一个元素key为&quot;fun&quot;,value为Class中的分页方法名.</p> <div class="language-php extra-class"><pre class="language-php"><code><span class="token comment">//就在这里注册,type不用多说,menu就是你在detailPara中定义的,Class就是写在了哪个类里</span>
<span class="token variable">$class</span> <span class="token operator">=</span> <span class="token keyword">array</span><span class="token punctuation">(</span>
        <span class="token keyword">array</span><span class="token punctuation">(</span><span class="token string double-quoted-string">&quot;type&quot;</span> <span class="token operator">=&gt;</span> <span class="token string double-quoted-string">&quot;adClient&quot;</span><span class="token punctuation">,</span><span class="token string double-quoted-string">&quot;menu&quot;</span> <span class="token operator">=&gt;</span> <span class="token string double-quoted-string">&quot;info&quot;</span><span class="token punctuation">,</span><span class="token string double-quoted-string">&quot;class&quot;</span> <span class="token operator">=&gt;</span> <span class="token string double-quoted-string">&quot;clientClass&quot;</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
        <span class="token keyword">array</span><span class="token punctuation">(</span><span class="token string double-quoted-string">&quot;type&quot;</span> <span class="token operator">=&gt;</span> <span class="token string double-quoted-string">&quot;adClient&quot;</span><span class="token punctuation">,</span><span class="token string double-quoted-string">&quot;menu&quot;</span> <span class="token operator">=&gt;</span> <span class="token string double-quoted-string">&quot;out&quot;</span><span class="token punctuation">,</span><span class="token string double-quoted-string">&quot;class&quot;</span> <span class="token operator">=&gt;</span> <span class="token string double-quoted-string">&quot;workOutClass&quot;</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
        <span class="token keyword">array</span><span class="token punctuation">(</span><span class="token string double-quoted-string">&quot;type&quot;</span> <span class="token operator">=&gt;</span> <span class="token string double-quoted-string">&quot;adClient&quot;</span><span class="token punctuation">,</span><span class="token string double-quoted-string">&quot;menu&quot;</span> <span class="token operator">=&gt;</span> <span class="token string double-quoted-string">&quot;add&quot;</span><span class="token punctuation">,</span><span class="token string double-quoted-string">&quot;class&quot;</span> <span class="token operator">=&gt;</span> <span class="token string double-quoted-string">&quot;workAddClass&quot;</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
        <span class="token keyword">array</span><span class="token punctuation">(</span><span class="token string double-quoted-string">&quot;type&quot;</span> <span class="token operator">=&gt;</span> <span class="token string double-quoted-string">&quot;adClient&quot;</span><span class="token punctuation">,</span><span class="token string double-quoted-string">&quot;menu&quot;</span> <span class="token operator">=&gt;</span> <span class="token string double-quoted-string">&quot;invoice&quot;</span><span class="token punctuation">,</span><span class="token string double-quoted-string">&quot;class&quot;</span> <span class="token operator">=&gt;</span> <span class="token string double-quoted-string">&quot;invoiceClass&quot;</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
        <span class="token keyword">array</span><span class="token punctuation">(</span><span class="token string double-quoted-string">&quot;type&quot;</span> <span class="token operator">=&gt;</span> <span class="token string double-quoted-string">&quot;adDevelop&quot;</span><span class="token punctuation">,</span><span class="token string double-quoted-string">&quot;menu&quot;</span> <span class="token operator">=&gt;</span> <span class="token string double-quoted-string">&quot;out&quot;</span><span class="token punctuation">,</span><span class="token string double-quoted-string">&quot;class&quot;</span> <span class="token operator">=&gt;</span> <span class="token string double-quoted-string">&quot;workOutClass&quot;</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
        <span class="token keyword">array</span><span class="token punctuation">(</span><span class="token string double-quoted-string">&quot;type&quot;</span> <span class="token operator">=&gt;</span> <span class="token string double-quoted-string">&quot;adDevelop&quot;</span><span class="token punctuation">,</span><span class="token string double-quoted-string">&quot;menu&quot;</span> <span class="token operator">=&gt;</span> <span class="token string double-quoted-string">&quot;add&quot;</span><span class="token punctuation">,</span><span class="token string double-quoted-string">&quot;class&quot;</span> <span class="token operator">=&gt;</span> <span class="token string double-quoted-string">&quot;workAddClass&quot;</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
    <span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><div class="language-php extra-class"><pre class="language-php"><code><span class="token comment">//菜单数组,detailtab中注册类时的tab就写在这里(detailPara)</span>
   <span class="token variable">$menu</span> <span class="token operator">=</span> <span class="token keyword">array</span><span class="token punctuation">(</span><span class="token string double-quoted-string">&quot;edit&quot;</span> <span class="token operator">=&gt;</span> <span class="token string double-quoted-string">&quot;基本信息&quot;</span><span class="token punctuation">,</span> <span class="token string double-quoted-string">&quot;tag&quot;</span> <span class="token operator">=&gt;</span> <span class="token string double-quoted-string">&quot;会员标签&quot;</span><span class="token punctuation">,</span> <span class="token string double-quoted-string">&quot;history&quot;</span> <span class="token operator">=&gt;</span> <span class="token string double-quoted-string">&quot;历史主题&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><div class="language-php extra-class"><pre class="language-php"><code><span class="token comment">//根据detailTab中的这段代码,可以得到一些信息,那就是上面的类注册代码中,我们可以看到都没有下面这段代码中的$value['fun'],为什么呢?因为都还没传递,如果传递之后,就说明你在同一个类里,写了第二个或更多的分支方法,需要用这个$value['fun']来区分,$value['fun']也就是我们的分支方法名.</span>
<span class="token comment">//$value['fun']默认是tab,也就是说如果我们只在Class中写了一个分值方法,那这个方法必须用这里规定的默认值为方法名,也就是tab为方法名.</span>
 <span class="token keyword">foreach</span><span class="token punctuation">(</span><span class="token variable">$class</span> <span class="token keyword">as</span> <span class="token variable">$value</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
        <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token variable">$get</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'type'</span><span class="token punctuation">]</span> <span class="token operator">==</span> <span class="token variable">$value</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'type'</span><span class="token punctuation">]</span> <span class="token keyword">and</span> <span class="token variable">$get</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'menu'</span><span class="token punctuation">]</span> <span class="token operator">==</span> <span class="token variable">$value</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'menu'</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
            <span class="token variable">$name</span> <span class="token operator">=</span> <span class="token variable">$value</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'class'</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
            <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token keyword">empty</span><span class="token punctuation">(</span><span class="token variable">$value</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'fun'</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
                <span class="token variable">$fun</span> <span class="token operator">=</span> <span class="token string double-quoted-string">&quot;tab&quot;</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span><span class="token keyword">else</span><span class="token punctuation">{</span>
                <span class="token variable">$fun</span> <span class="token operator">=</span> <span class="token variable">$value</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'fun'</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
</code></pre></div></li></ul></li></ul> <hr> <ul><li><p>如果要<strong>在Class写tab分页</strong>,需要像listResult方法一样,去使用多选,还有多选删除,那就都给表格头的按钮起一样的名字,第一个$edit,后面的都用$edit.=来拼接.(等于把复选框,弹出层,按钮都写出来,然后把它们都拼到$edit里)</p> <div class="language-php extra-class"><pre class="language-php"><code><span class="token variable">$edit</span> <span class="token operator">=</span> <span class="token function">checkAll</span><span class="token punctuation">(</span><span class="token string double-quoted-string">&quot;userTagForm&quot;</span><span class="token punctuation">,</span> <span class="token string double-quoted-string">&quot;id&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>  <span class="token comment">//复选框获取标签id</span>
 
       <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token function">power</span><span class="token punctuation">(</span><span class="token string double-quoted-string">&quot;adUser&quot;</span><span class="token punctuation">,</span><span class="token string double-quoted-string">&quot;editTag&quot;</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
           <span class="token comment">//在本类里写layer弹出层方法</span>
           <span class="token variable">$edit</span> <span class="token operator">.=</span> <span class="token string double-quoted-string">&quot;&lt;span class='spanButton' title='给会员添加标签' onclick=\&quot;layer('adUserAddSingleTag',{'id':'<span class="token interpolation"><span class="token variable">$_POST</span><span class="token punctuation">[</span>id<span class="token punctuation">]</span></span>'})\&quot;&gt;添加标签&lt;/span&gt;&amp;nbsp;&quot;</span><span class="token punctuation">;</span>
       <span class="token punctuation">}</span>
       <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token function">power</span><span class="token punctuation">(</span><span class="token string double-quoted-string">&quot;adUser&quot;</span><span class="token punctuation">,</span><span class="token string double-quoted-string">&quot;delTag&quot;</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
           <span class="token comment">//去delete中写删除方法</span>
           <span class="token variable">$edit</span> <span class="token operator">.=</span> <span class="token string double-quoted-string">&quot;&lt;span class='spanButton' title='删除会员的标签' onclick=\&quot;pasWarn('userTagForm','adUserDelSingleTag')\&quot;&gt;删除&lt;/span&gt;&quot;</span><span class="token punctuation">;</span>
       <span class="token punctuation">}</span>
</code></pre></div></li></ul> <hr> <ul><li><p>如果要在一个<strong>详情页面插入表格</strong>,前提是这个页面已经有输入框,上传框之类的东西,那就在本来插入输入框的位置插入html标签,引号内不能写php代码,就在外部代码部分写好循环生成表格的代码(类似Class中tab的代码),赋给一个变量$x,最后把$x拼给双引号内部.</p></li> <li><p>这样子插入的表格会很不好看,可以在html中插入一个style标签写好样式,把表格背景改为白色,表格字体居中</p></li> <li><div class="language-php extra-class"><pre class="language-php"><code><span class="token comment">//style标签就是这样插入的</span>
<span class="token variable">$html</span> <span class="token operator">=</span> <span class="token variable">$edit</span><span class="token operator">.</span>space<span class="token operator">.</span><span class="token string double-quoted-string">&quot;&lt;style&gt;.tableMany td{background-color: white!important;
    text-align: center!important;}&lt;/style&gt;&lt;form name='roundForm'&gt;&quot;</span><span class="token operator">.</span><span class="token function">tableMany</span><span class="token punctuation">(</span><span class="token keyword">array</span><span class="token punctuation">(</span><span class="token string double-quoted-string">&quot;tr&quot;</span> <span class="token operator">=&gt;</span> <span class="token variable">$tr</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token operator">.</span><span class="token string double-quoted-string">&quot;&lt;input name='themeId' style='display: none' value='<span class="token interpolation"><span class="token variable">$themeId</span></span>' /&gt;&lt;/form&gt;&quot;</span><span class="token punctuation">;</span>

</code></pre></div></li></ul> <h3 id="注意事项"><a href="#注意事项" class="header-anchor">#</a> 注意事项</h3> <ul><li><p>新框架中的分支页,<strong>第一个分支页在$menu中必须起名为edit</strong>,改为其他的就会出现问题,当你点击其他分支再点回第一个就回不来了.</p> <div class="language-php extra-class"><pre class="language-php"><code><span class="token variable">$menu</span> <span class="token operator">=</span> <span class="token keyword">array</span><span class="token punctuation">(</span><span class="token string double-quoted-string">&quot;edit&quot;</span> <span class="token operator">=&gt;</span> <span class="token string double-quoted-string">&quot;岗位信息&quot;</span><span class="token punctuation">,</span> <span class="token string double-quoted-string">&quot;personal&quot;</span> <span class="token operator">=&gt;</span> <span class="token string double-quoted-string">&quot;个人资料&quot;</span><span class="token punctuation">,</span> <span class="token string double-quoted-string">&quot;join&quot;</span> <span class="token operator">=&gt;</span> <span class="token string double-quoted-string">&quot;入职信息&quot;</span><span class="token punctuation">,</span> <span class="token string double-quoted-string">&quot;salary&quot;</span> <span class="token operator">=&gt;</span> <span class="token string double-quoted-string">&quot;薪资信息&quot;</span><span class="token punctuation">,</span> <span class="token string double-quoted-string">&quot;insurance&quot;</span> <span class="token operator">=&gt;</span> <span class="token string double-quoted-string">&quot;保险信息&quot;</span><span class="token punctuation">,</span> <span class="token string double-quoted-string">&quot;change&quot;</span> <span class="token operator">=&gt;</span> <span class="token string double-quoted-string">&quot;调岗记录&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div></li></ul> <h3 id="数据操作"><a href="#数据操作" class="header-anchor">#</a> 数据操作</h3> <ul><li><p>新框架中,如果想要<strong>在第二,三甚至之后的分支页面中</strong>完成像第一个edit分支一样的<strong>对主表的数据操作更新</strong>.</p></li> <li><p>那就需要自己在Class中写的分支方法中用form标签把自己写好的那堆输入框下拉框包裹起来</p></li> <li><p>然后在form包裹区域的最后连接上一个自己写的按钮标签.</p></li> <li><p>如果有区域联动下拉,那他们的formName部分要写自己写的那个form标签的name进去.</p></li> <li><p>在提交按钮的subForm方法中,那个跳转到data.php的链接最后的type就对应你在Class中写的处理数据方法名,当然是无Data后缀的.</p> <div class="language-php extra-class"><pre class="language-php"><code> <span class="token keyword">public</span> <span class="token keyword">function</span> <span class="token function-definition function">tab</span><span class="token punctuation">(</span><span class="token variable">$data</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
<span class="token comment">//定义参数</span>
        <span class="token variable">$id</span> <span class="token operator">=</span> <span class="token variable">$data</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'post'</span><span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'id'</span><span class="token punctuation">]</span><span class="token punctuation">;</span>

            <span class="token variable">$admin</span> <span class="token operator">=</span> <span class="token function">query</span><span class="token punctuation">(</span><span class="token string double-quoted-string">&quot;admin&quot;</span><span class="token punctuation">,</span> <span class="token string double-quoted-string">&quot; adid = '<span class="token interpolation"><span class="token variable">$id</span></span>' &quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>


            <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token keyword">empty</span><span class="token punctuation">(</span><span class="token variable">$admin</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'adid'</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
                <span class="token variable">$para</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'warn'</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token string double-quoted-string">&quot;未找到此员工&quot;</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
                <span class="token variable">$button</span> <span class="token operator">=</span> <span class="token string double-quoted-string">&quot;更新&quot;</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span>

        <span class="token variable">$trData</span> <span class="token operator">=</span> <span class="token keyword">array</span><span class="token punctuation">(</span>
            <span class="token keyword">array</span><span class="token punctuation">(</span>
                must<span class="token operator">.</span><span class="token string double-quoted-string">&quot;性别：&quot;</span> <span class="token operator">=&gt;</span> <span class="token function">select</span><span class="token punctuation">(</span><span class="token keyword">array</span><span class="token punctuation">(</span><span class="token string double-quoted-string">&quot;name&quot;</span> <span class="token operator">=&gt;</span> <span class="token string double-quoted-string">&quot;sex&quot;</span><span class="token punctuation">,</span><span class="token string double-quoted-string">&quot;title&quot;</span> <span class="token operator">=&gt;</span> <span class="token string double-quoted-string">&quot;选择性别&quot;</span><span class="token punctuation">,</span><span class="token string double-quoted-string">&quot;option&quot;</span> <span class="token operator">=&gt;</span> <span class="token function">explode</span><span class="token punctuation">(</span><span class="token string double-quoted-string">&quot;,&quot;</span><span class="token punctuation">,</span><span class="token function">para</span><span class="token punctuation">(</span><span class="token string double-quoted-string">&quot;sex&quot;</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">,</span><span class="token string double-quoted-string">&quot;value&quot;</span> <span class="token operator">=&gt;</span> <span class="token variable">$admin</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'sex'</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
                <span class="token string double-quoted-string">&quot;生日：&quot;</span> <span class="token operator">=&gt;</span> <span class="token function">text</span><span class="token punctuation">(</span><span class="token keyword">array</span><span class="token punctuation">(</span><span class="token string double-quoted-string">&quot;name&quot;</span> <span class="token operator">=&gt;</span> <span class="token string double-quoted-string">&quot;birthday&quot;</span><span class="token punctuation">,</span><span class="token string double-quoted-string">&quot;laydate&quot;</span> <span class="token operator">=&gt;</span> <span class="token keyword">array</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span><span class="token string double-quoted-string">&quot;title&quot;</span> <span class="token operator">=&gt;</span> <span class="token string double-quoted-string">&quot;生日&quot;</span><span class="token punctuation">,</span><span class="token string double-quoted-string">&quot;value&quot;</span> <span class="token operator">=&gt;</span> <span class="token variable">$admin</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'birthday'</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
            <span class="token punctuation">)</span><span class="token punctuation">,</span>
            <span class="token keyword">array</span><span class="token punctuation">(</span>
                must<span class="token operator">.</span><span class="token string double-quoted-string">&quot;年龄：&quot;</span> <span class="token operator">=&gt;</span> <span class="token function">text</span><span class="token punctuation">(</span><span class="token keyword">array</span><span class="token punctuation">(</span><span class="token string double-quoted-string">&quot;name&quot;</span> <span class="token operator">=&gt;</span> <span class="token string double-quoted-string">&quot;age&quot;</span><span class="token punctuation">,</span><span class="token string double-quoted-string">&quot;value&quot;</span> <span class="token operator">=&gt;</span> <span class="token variable">$admin</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'age'</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
                <span class="token string double-quoted-string">&quot;民族：&quot;</span> <span class="token operator">=&gt;</span> <span class="token function">text</span><span class="token punctuation">(</span><span class="token keyword">array</span><span class="token punctuation">(</span><span class="token string double-quoted-string">&quot;name&quot;</span> <span class="token operator">=&gt;</span> <span class="token string double-quoted-string">&quot;nationality&quot;</span><span class="token punctuation">,</span><span class="token string double-quoted-string">&quot;value&quot;</span> <span class="token operator">=&gt;</span> <span class="token variable">$admin</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'nationality'</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
            <span class="token punctuation">)</span><span class="token punctuation">,</span>
            <span class="token keyword">array</span><span class="token punctuation">(</span>
                must<span class="token operator">.</span><span class="token string double-quoted-string">&quot;户口性质：&quot;</span> <span class="token operator">=&gt;</span> <span class="token function">text</span><span class="token punctuation">(</span><span class="token keyword">array</span><span class="token punctuation">(</span><span class="token string double-quoted-string">&quot;name&quot;</span> <span class="token operator">=&gt;</span> <span class="token string double-quoted-string">&quot;residence&quot;</span><span class="token punctuation">,</span><span class="token string double-quoted-string">&quot;value&quot;</span> <span class="token operator">=&gt;</span> <span class="token variable">$admin</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'residence'</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
                <span class="token string double-quoted-string">&quot;婚否：&quot;</span> <span class="token operator">=&gt;</span> <span class="token function">select</span><span class="token punctuation">(</span><span class="token keyword">array</span><span class="token punctuation">(</span><span class="token string double-quoted-string">&quot;name&quot;</span> <span class="token operator">=&gt;</span> <span class="token string double-quoted-string">&quot;isMarry&quot;</span><span class="token punctuation">,</span><span class="token string double-quoted-string">&quot;title&quot;</span> <span class="token operator">=&gt;</span> <span class="token string double-quoted-string">&quot;选择性别&quot;</span><span class="token punctuation">,</span><span class="token string double-quoted-string">&quot;option&quot;</span> <span class="token operator">=&gt;</span> <span class="token function">explode</span><span class="token punctuation">(</span><span class="token string double-quoted-string">&quot;,&quot;</span><span class="token punctuation">,</span><span class="token function">para</span><span class="token punctuation">(</span><span class="token string double-quoted-string">&quot;isMarry&quot;</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">,</span><span class="token string double-quoted-string">&quot;value&quot;</span> <span class="token operator">=&gt;</span> <span class="token variable">$admin</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'isMarry'</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
            <span class="token punctuation">)</span><span class="token punctuation">,</span>
            <span class="token keyword">array</span><span class="token punctuation">(</span>
                <span class="token string double-quoted-string">&quot;生育：&quot;</span> <span class="token operator">=&gt;</span> <span class="token function">select</span><span class="token punctuation">(</span><span class="token keyword">array</span><span class="token punctuation">(</span><span class="token string double-quoted-string">&quot;name&quot;</span> <span class="token operator">=&gt;</span> <span class="token string double-quoted-string">&quot;hasChild&quot;</span><span class="token punctuation">,</span><span class="token string double-quoted-string">&quot;title&quot;</span> <span class="token operator">=&gt;</span> <span class="token string double-quoted-string">&quot;生育与否&quot;</span><span class="token punctuation">,</span><span class="token string double-quoted-string">&quot;option&quot;</span> <span class="token operator">=&gt;</span> <span class="token function">explode</span><span class="token punctuation">(</span><span class="token string double-quoted-string">&quot;,&quot;</span><span class="token punctuation">,</span><span class="token function">para</span><span class="token punctuation">(</span><span class="token string double-quoted-string">&quot;hasChild&quot;</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">,</span><span class="token string double-quoted-string">&quot;value&quot;</span> <span class="token operator">=&gt;</span> <span class="token variable">$admin</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'hasChild'</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
                <span class="token string double-quoted-string">&quot;政治面貌：&quot;</span> <span class="token operator">=&gt;</span> <span class="token function">select</span><span class="token punctuation">(</span><span class="token keyword">array</span><span class="token punctuation">(</span><span class="token string double-quoted-string">&quot;name&quot;</span> <span class="token operator">=&gt;</span> <span class="token string double-quoted-string">&quot;politicsStatus&quot;</span><span class="token punctuation">,</span><span class="token string double-quoted-string">&quot;title&quot;</span> <span class="token operator">=&gt;</span> <span class="token string double-quoted-string">&quot;生育与否&quot;</span><span class="token punctuation">,</span><span class="token string double-quoted-string">&quot;option&quot;</span> <span class="token operator">=&gt;</span> <span class="token function">explode</span><span class="token punctuation">(</span><span class="token string double-quoted-string">&quot;,&quot;</span><span class="token punctuation">,</span><span class="token function">para</span><span class="token punctuation">(</span><span class="token string double-quoted-string">&quot;politicsStatus&quot;</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">,</span><span class="token string double-quoted-string">&quot;value&quot;</span> <span class="token operator">=&gt;</span> <span class="token variable">$admin</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'politicsStatus'</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
            <span class="token punctuation">)</span><span class="token punctuation">,</span>
            <span class="token keyword">array</span><span class="token punctuation">(</span>
                <span class="token string double-quoted-string">&quot;档案地址：&quot;</span> <span class="token operator">=&gt;</span> <span class="token function">text</span><span class="token punctuation">(</span><span class="token keyword">array</span><span class="token punctuation">(</span><span class="token string double-quoted-string">&quot;name&quot;</span> <span class="token operator">=&gt;</span> <span class="token string double-quoted-string">&quot;fileAddress&quot;</span><span class="token punctuation">,</span><span class="token string double-quoted-string">&quot;value&quot;</span> <span class="token operator">=&gt;</span> <span class="token variable">$admin</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'fileAddress'</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
                <span class="token string double-quoted-string">&quot;学历：&quot;</span> <span class="token operator">=&gt;</span> <span class="token function">select</span><span class="token punctuation">(</span><span class="token keyword">array</span><span class="token punctuation">(</span><span class="token string double-quoted-string">&quot;name&quot;</span> <span class="token operator">=&gt;</span> <span class="token string double-quoted-string">&quot;educationalBackground&quot;</span><span class="token punctuation">,</span><span class="token string double-quoted-string">&quot;title&quot;</span> <span class="token operator">=&gt;</span> <span class="token string double-quoted-string">&quot;学历&quot;</span><span class="token punctuation">,</span><span class="token string double-quoted-string">&quot;option&quot;</span> <span class="token operator">=&gt;</span> <span class="token function">explode</span><span class="token punctuation">(</span><span class="token string double-quoted-string">&quot;,&quot;</span><span class="token punctuation">,</span><span class="token function">para</span><span class="token punctuation">(</span><span class="token string double-quoted-string">&quot;educationalBackground&quot;</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">,</span><span class="token string double-quoted-string">&quot;value&quot;</span> <span class="token operator">=&gt;</span> <span class="token variable">$admin</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'educationalBackground'</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
                <span class="token punctuation">)</span><span class="token punctuation">,</span>
            <span class="token keyword">array</span><span class="token punctuation">(</span>
                must<span class="token operator">.</span><span class="token string double-quoted-string">&quot;毕业学校：&quot;</span> <span class="token operator">=&gt;</span> <span class="token function">text</span><span class="token punctuation">(</span><span class="token keyword">array</span><span class="token punctuation">(</span><span class="token string double-quoted-string">&quot;name&quot;</span> <span class="token operator">=&gt;</span> <span class="token string double-quoted-string">&quot;school&quot;</span><span class="token punctuation">,</span><span class="token string double-quoted-string">&quot;value&quot;</span> <span class="token operator">=&gt;</span> <span class="token variable">$admin</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'school'</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
                <span class="token string double-quoted-string">&quot;专业：&quot;</span> <span class="token operator">=&gt;</span> <span class="token function">text</span><span class="token punctuation">(</span><span class="token keyword">array</span><span class="token punctuation">(</span><span class="token string double-quoted-string">&quot;name&quot;</span> <span class="token operator">=&gt;</span> <span class="token string double-quoted-string">&quot;schoolMajor&quot;</span><span class="token punctuation">,</span><span class="token string double-quoted-string">&quot;value&quot;</span> <span class="token operator">=&gt;</span> <span class="token variable">$admin</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'schoolMajor'</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
                <span class="token punctuation">)</span><span class="token punctuation">,</span>
            <span class="token keyword">array</span><span class="token punctuation">(</span>
                <span class="token string double-quoted-string">&quot;证书：&quot;</span> <span class="token operator">=&gt;</span> <span class="token function">text</span><span class="token punctuation">(</span><span class="token keyword">array</span><span class="token punctuation">(</span><span class="token string double-quoted-string">&quot;name&quot;</span> <span class="token operator">=&gt;</span> <span class="token string double-quoted-string">&quot;certificate&quot;</span><span class="token punctuation">,</span><span class="token string double-quoted-string">&quot;value&quot;</span> <span class="token operator">=&gt;</span> <span class="token variable">$admin</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'certificate'</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
                <span class="token string double-quoted-string">&quot;电子邮箱：&quot;</span> <span class="token operator">=&gt;</span> <span class="token function">text</span><span class="token punctuation">(</span><span class="token keyword">array</span><span class="token punctuation">(</span><span class="token string double-quoted-string">&quot;name&quot;</span> <span class="token operator">=&gt;</span> <span class="token string double-quoted-string">&quot;email&quot;</span><span class="token punctuation">,</span><span class="token string double-quoted-string">&quot;value&quot;</span> <span class="token operator">=&gt;</span> <span class="token variable">$admin</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'email'</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
            <span class="token punctuation">)</span><span class="token punctuation">,</span>
            <span class="token keyword">array</span><span class="token punctuation">(</span>
                <span class="token string double-quoted-string">&quot;联系电话：&quot;</span> <span class="token operator">=&gt;</span> <span class="token function">text</span><span class="token punctuation">(</span><span class="token keyword">array</span><span class="token punctuation">(</span><span class="token string double-quoted-string">&quot;name&quot;</span> <span class="token operator">=&gt;</span> <span class="token string double-quoted-string">&quot;phone&quot;</span><span class="token punctuation">,</span><span class="token string double-quoted-string">&quot;value&quot;</span> <span class="token operator">=&gt;</span> <span class="token variable">$admin</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'phone'</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
                <span class="token string double-quoted-string">&quot;身份证号：&quot;</span> <span class="token operator">=&gt;</span> <span class="token function">text</span><span class="token punctuation">(</span><span class="token keyword">array</span><span class="token punctuation">(</span><span class="token string double-quoted-string">&quot;name&quot;</span> <span class="token operator">=&gt;</span> <span class="token string double-quoted-string">&quot;IDCard&quot;</span><span class="token punctuation">,</span><span class="token string double-quoted-string">&quot;value&quot;</span> <span class="token operator">=&gt;</span> <span class="token variable">$admin</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'IDCard'</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
            <span class="token punctuation">)</span><span class="token punctuation">,</span>
            <span class="token keyword">array</span><span class="token punctuation">(</span>
                <span class="token string double-quoted-string">&quot;身份证居住地址：&quot;</span> <span class="token operator">=&gt;</span> <span class="token function">regionSelect</span><span class="token punctuation">(</span><span class="token string single-quoted-string">'personalForm'</span><span class="token punctuation">,</span><span class="token variable">$admin</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'IDCardRegionId'</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token operator">.</span>
                    <span class="token function">text</span><span class="token punctuation">(</span><span class="token keyword">array</span><span class="token punctuation">(</span><span class="token string double-quoted-string">&quot;name&quot;</span> <span class="token operator">=&gt;</span> <span class="token string double-quoted-string">&quot;liveAddress&quot;</span><span class="token punctuation">,</span><span class="token string double-quoted-string">&quot;value&quot;</span> <span class="token operator">=&gt;</span> <span class="token variable">$admin</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'IDCardAddress'</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
            <span class="token punctuation">)</span><span class="token punctuation">,</span>
            <span class="token keyword">array</span><span class="token punctuation">(</span>
                <span class="token string double-quoted-string">&quot;工资卡号：&quot;</span> <span class="token operator">=&gt;</span> <span class="token function">text</span><span class="token punctuation">(</span><span class="token keyword">array</span><span class="token punctuation">(</span><span class="token string double-quoted-string">&quot;name&quot;</span> <span class="token operator">=&gt;</span> <span class="token string double-quoted-string">&quot;bankNum&quot;</span><span class="token punctuation">,</span><span class="token string double-quoted-string">&quot;value&quot;</span> <span class="token operator">=&gt;</span> <span class="token variable">$admin</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'bankNum'</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
                <span class="token string double-quoted-string">&quot;开户行：&quot;</span> <span class="token operator">=&gt;</span> <span class="token function">text</span><span class="token punctuation">(</span><span class="token keyword">array</span><span class="token punctuation">(</span><span class="token string double-quoted-string">&quot;name&quot;</span> <span class="token operator">=&gt;</span> <span class="token string double-quoted-string">&quot;bankName&quot;</span><span class="token punctuation">,</span><span class="token string double-quoted-string">&quot;value&quot;</span> <span class="token operator">=&gt;</span> <span class="token variable">$admin</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'bankName'</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
            <span class="token punctuation">)</span><span class="token punctuation">,</span>
            <span class="token keyword">array</span><span class="token punctuation">(</span>
                <span class="token string double-quoted-string">&quot;紧急联系人：&quot;</span> <span class="token operator">=&gt;</span> <span class="token function">text</span><span class="token punctuation">(</span><span class="token keyword">array</span><span class="token punctuation">(</span><span class="token string double-quoted-string">&quot;name&quot;</span> <span class="token operator">=&gt;</span> <span class="token string double-quoted-string">&quot;urgencyContact&quot;</span><span class="token punctuation">,</span><span class="token string double-quoted-string">&quot;value&quot;</span> <span class="token operator">=&gt;</span> <span class="token variable">$admin</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'urgencyContact'</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
                <span class="token string double-quoted-string">&quot;紧急联系人电话：&quot;</span> <span class="token operator">=&gt;</span> <span class="token function">text</span><span class="token punctuation">(</span><span class="token keyword">array</span><span class="token punctuation">(</span><span class="token string double-quoted-string">&quot;name&quot;</span> <span class="token operator">=&gt;</span> <span class="token string double-quoted-string">&quot;urgencyPhone&quot;</span><span class="token punctuation">,</span><span class="token string double-quoted-string">&quot;value&quot;</span> <span class="token operator">=&gt;</span> <span class="token variable">$admin</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'urgencyPhone'</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
            <span class="token punctuation">)</span><span class="token punctuation">,</span>
            <span class="token keyword">array</span><span class="token punctuation">(</span>
                <span class="token string double-quoted-string">&quot;现居住地址：&quot;</span> <span class="token operator">=&gt;</span> <span class="token function">regionSelect</span><span class="token punctuation">(</span><span class="token string single-quoted-string">'personalForm'</span><span class="token punctuation">,</span><span class="token variable">$admin</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'liveRegionId'</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token operator">.</span>
                    <span class="token function">text</span><span class="token punctuation">(</span><span class="token keyword">array</span><span class="token punctuation">(</span><span class="token string double-quoted-string">&quot;name&quot;</span> <span class="token operator">=&gt;</span> <span class="token string double-quoted-string">&quot;liveAddress&quot;</span><span class="token punctuation">,</span><span class="token string double-quoted-string">&quot;value&quot;</span> <span class="token operator">=&gt;</span> <span class="token variable">$admin</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'liveAddress'</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
            <span class="token punctuation">)</span><span class="token punctuation">,</span>
        <span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token variable">$photo</span> <span class="token operator">=</span> <span class="token keyword">array</span><span class="token punctuation">(</span>
            <span class="token comment">//头像字段用作员工照片,身份证正面字段用作证件照片</span>
            <span class="token keyword">array</span><span class="token punctuation">(</span><span class="token string double-quoted-string">&quot;title&quot;</span> <span class="token operator">=&gt;</span> <span class="token string double-quoted-string">&quot;员工照片&quot;</span><span class="token punctuation">,</span><span class="token string double-quoted-string">&quot;url&quot;</span> <span class="token operator">=&gt;</span> <span class="token variable">$admin</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'picture'</span><span class="token punctuation">]</span><span class="token punctuation">,</span><span class="token string double-quoted-string">&quot;type&quot;</span> <span class="token operator">=&gt;</span> <span class="token string double-quoted-string">&quot;picture&quot;</span><span class="token punctuation">,</span><span class="token string double-quoted-string">&quot;id&quot;</span> <span class="token operator">=&gt;</span> <span class="token variable">$admin</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'adid'</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
            <span class="token keyword">array</span><span class="token punctuation">(</span><span class="token string double-quoted-string">&quot;title&quot;</span> <span class="token operator">=&gt;</span> <span class="token string double-quoted-string">&quot;身份证&quot;</span><span class="token punctuation">,</span><span class="token string double-quoted-string">&quot;url&quot;</span> <span class="token operator">=&gt;</span> <span class="token variable">$admin</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'IDCardFront'</span><span class="token punctuation">]</span><span class="token punctuation">,</span><span class="token string double-quoted-string">&quot;type&quot;</span> <span class="token operator">=&gt;</span> <span class="token string double-quoted-string">&quot;IDCardFront&quot;</span><span class="token punctuation">,</span><span class="token string double-quoted-string">&quot;id&quot;</span> <span class="token operator">=&gt;</span> <span class="token variable">$admin</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'adid'</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
        <span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">;</span>
        <span class="token variable">$html</span> <span class="token operator">=</span> <span class="token string double-quoted-string">&quot;&lt;form name='personalForm'&gt;&quot;</span><span class="token operator">.</span><span class="token function">tableEdit</span><span class="token punctuation">(</span><span class="token variable">$trData</span><span class="token punctuation">)</span><span class="token operator">.</span>
            <span class="token string double-quoted-string">&quot;&lt;div onclick=\&quot;subForm('adminPersonalForm',root+'control/data.php?type=adminPersonalEdit')\&quot; class='formButton'&gt;&quot;</span><span class="token operator">.</span><span class="token variable">$button</span><span class="token operator">.</span><span class="token string double-quoted-string">&quot;&lt;/div&gt;&quot;</span><span class="token operator">.</span>
            <span class="token string double-quoted-string">&quot;&lt;/form&gt;&quot;</span><span class="token operator">.</span><span class="token function">photo</span><span class="token punctuation">(</span><span class="token variable">$photo</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">return</span> <span class="token variable">$html</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

</code></pre></div></li></ul> <h3 id="分支页面点击按钮切换表格显示范围"><a href="#分支页面点击按钮切换表格显示范围" class="header-anchor">#</a> 分支页面点击按钮切换表格显示范围</h3> <ul><li><p>在类中的tab分页里写切换表格显示的按钮,可能会遇到一些问题</p></li> <li><p>首先就是写的隐藏域hidden的value不能用<code>$date['post']</code>拿到,因为就在本页面根本不是post.</p></li> <li><p>所以就需要换个思路,改写js方法.</p></li> <li><p>首先从<code>detail.php</code>文件中可以看到,切换tab分页的方法就是一个叫<code>detailTab()</code>的方法,切换分页同时带三个值过来,这三个值也是这方法的条件参数,分别是type,menu,id.</p> <ul><li><p>type:<code>configure.php</code>中定义的当前页面的英文名</p></li> <li><p>menu:<code>detailPara.php</code>中定义的tab分页的按钮menu代号</p></li> <li><p>id:自然就是我们点进详情的这条数据的主ID</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token comment">/*******详情页选项卡切换***********************************************/</span>
<span class="token keyword">function</span> <span class="token function">detailTab</span><span class="token punctuation">(</span><span class="token parameter">type<span class="token punctuation">,</span>menu<span class="token punctuation">,</span>id</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
	<span class="token comment">//切换导航</span>
	<span class="token function">$</span><span class="token punctuation">(</span><span class="token string">&quot;#pageMenu &gt; ul &gt; li&quot;</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">removeClass</span><span class="token punctuation">(</span><span class="token string">&quot;pageMenuHover&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token function">$</span><span class="token punctuation">(</span><span class="token string">&quot;[pageMenu=&quot;</span><span class="token operator">+</span>menu<span class="token operator">+</span><span class="token string">&quot;]&quot;</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">addClass</span><span class="token punctuation">(</span><span class="token string">&quot;pageMenuHover&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token comment">//切换内容页</span>
	<span class="token function">$</span><span class="token punctuation">(</span><span class="token string">&quot;[pagediv]&quot;</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">hide</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token keyword">var</span> pagediv <span class="token operator">=</span> <span class="token function">$</span><span class="token punctuation">(</span><span class="token string">&quot;[pagediv=&quot;</span><span class="token operator">+</span>menu<span class="token operator">+</span><span class="token string">&quot;]&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token keyword">if</span><span class="token punctuation">(</span>pagediv<span class="token punctuation">.</span>length <span class="token operator">==</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">{</span><span class="token comment">//这里做了判断,如果这个节点存在,就直接展示而不往下执行了,所以在我们自己写的js方法里就要移除这个节点.</span>
		pagediv<span class="token punctuation">.</span><span class="token function">show</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token punctuation">}</span><span class="token keyword">else</span><span class="token punctuation">{</span>
		$<span class="token punctuation">.</span><span class="token function">post</span><span class="token punctuation">(</span>root<span class="token operator">+</span><span class="token string">&quot;control/detailTab.php?type=&quot;</span><span class="token operator">+</span>type<span class="token operator">+</span><span class="token string">&quot;&amp;menu=&quot;</span><span class="token operator">+</span>menu<span class="token punctuation">,</span><span class="token punctuation">{</span><span class="token literal-property property">id</span><span class="token operator">:</span>id<span class="token punctuation">}</span><span class="token punctuation">,</span><span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">data</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
			<span class="token keyword">if</span><span class="token punctuation">(</span>data<span class="token punctuation">.</span>warn<span class="token punctuation">)</span><span class="token punctuation">{</span>
				<span class="token function">warn</span><span class="token punctuation">(</span>data<span class="token punctuation">.</span>warn<span class="token punctuation">)</span><span class="token punctuation">;</span>
			<span class="token punctuation">}</span><span class="token keyword">else</span><span class="token punctuation">{</span>
				<span class="token function">$</span><span class="token punctuation">(</span><span class="token string">&quot;#pageMenu&quot;</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">after</span><span class="token punctuation">(</span>data<span class="token punctuation">.</span>html<span class="token punctuation">)</span><span class="token punctuation">;</span>
			<span class="token punctuation">}</span>
		<span class="token punctuation">}</span><span class="token punctuation">,</span><span class="token string">&quot;json&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div></li></ul></li> <li><p>但是detailTab方法只能带这三个参数,要想点击按钮切换表格展示数据分类,那就得需要第四个参数,所以我们在自己写的js方法中带上这个状态参数workFlow.</p></li> <li><p>进入js之后我们再把id和workFlow拼接,用一个符号隔开,再起名为id放到<code>detailTab()</code>方法的id参数上.到Class中我们写的分页代码方法里,再用<code>$data['post']</code>拿到<code>$data['post']['id']</code>,使用<code>explode()</code>函数分割为两个字符串,前一个为id,后一个为workFlow.</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token comment">/**********切换审核列表**********/</span>
<span class="token keyword">function</span> <span class="token function">changeMenu</span><span class="token punctuation">(</span><span class="token parameter">e<span class="token punctuation">,</span>type<span class="token punctuation">,</span>menu<span class="token punctuation">,</span>id<span class="token punctuation">,</span>workFlow</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token function">$</span><span class="token punctuation">(</span><span class="token string">&quot;[pagediv=&quot;</span><span class="token operator">+</span>menu<span class="token operator">+</span><span class="token string">&quot;]&quot;</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">remove</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    id <span class="token operator">=</span> id<span class="token operator">+</span><span class="token string">'-'</span><span class="token operator">+</span>workFlow<span class="token punctuation">;</span>
    <span class="token function">detailTab</span><span class="token punctuation">(</span>type<span class="token punctuation">,</span>menu<span class="token punctuation">,</span>id<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre></div></li> <li><p>这样相当于每次点击按钮都是切换tab,会刷新,所以按钮样式的改变也不能通过js方法,要在php代码里解决.</p></li> <li><p>所以就拿我们截断的字符串里的workFlow作为判断条件,在三个按钮上分别加上选中样式即可.</p> <div class="language-php extra-class"><pre class="language-php"><code><span class="token keyword">if</span><span class="token punctuation">(</span><span class="token variable">$thing</span><span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token operator">==</span><span class="token string double-quoted-string">&quot;&quot;</span><span class="token operator">||</span><span class="token variable">$thing</span><span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token operator">==</span><span class="token string double-quoted-string">&quot;全部&quot;</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
            <span class="token variable">$edit</span> <span class="token operator">.=</span><span class="token string double-quoted-string">&quot;&lt;div style='margin: 12px;'&gt;
                    &lt;span class='bigSpan choice' onclick=\&quot;changeMenu(this,'driver','money','<span class="token interpolation"><span class="token variable">$driverId</span></span>','全部')\&quot;&gt;全部&lt;/span&gt;
                    &lt;span class='bigSpan' onclick=\&quot;changeMenu(this,'driver','money','<span class="token interpolation"><span class="token variable">$driverId</span></span>','提现支出')\&quot;&gt;提现支出&lt;/span&gt;
                    &lt;span class='bigSpan'  onclick=\&quot;changeMenu(this,'driver','money','<span class="token interpolation"><span class="token variable">$driverId</span></span>','车费划分')\&quot;&gt;车费划分&lt;/span&gt;
                &lt;/div&gt;&quot;</span><span class="token punctuation">;</span>
            <span class="token variable">$moneyCount</span> <span class="token operator">=</span> <span class="token function">sqlQueryAll</span><span class="token punctuation">(</span><span class="token string double-quoted-string">&quot;select w.money as money,'提现支出' as type,w.updateTime as time from withdraw as w where w.driverId = '<span class="token interpolation"><span class="token punctuation">{</span><span class="token variable">$driver</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'id'</span><span class="token punctuation">]</span><span class="token punctuation">}</span></span>'
                        union all
                        select b.money*d.postRadio as money,'车费划分' as type,b.updateTime as time from buyCar as b
                        left join journey as j on b.journeyId = j.id
                        left join driver as d on j.driverId = d.id where d.isPostMoney != '' and b.workFlow = '已完成' and d.id = '<span class="token interpolation"><span class="token punctuation">{</span><span class="token variable">$driver</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'id'</span><span class="token punctuation">]</span><span class="token punctuation">}</span></span>'&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span><span class="token keyword">elseif</span> <span class="token punctuation">(</span><span class="token variable">$thing</span><span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token operator">==</span><span class="token string double-quoted-string">&quot;提现支出&quot;</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
            <span class="token variable">$edit</span> <span class="token operator">.=</span><span class="token string double-quoted-string">&quot;&lt;div style='margin: 12px;'&gt;
                    &lt;span class='bigSpan' onclick=\&quot;changeMenu(this,'driver','money','<span class="token interpolation"><span class="token variable">$driverId</span></span>','全部')\&quot;&gt;全部&lt;/span&gt;
                    &lt;span class='bigSpan choice' onclick=\&quot;changeMenu(this,'driver','money','<span class="token interpolation"><span class="token variable">$driverId</span></span>','提现支出')\&quot;&gt;提现支出&lt;/span&gt;
                    &lt;span class='bigSpan'  onclick=\&quot;changeMenu(this,'driver','money','<span class="token interpolation"><span class="token variable">$driverId</span></span>','车费划分')\&quot;&gt;车费划分&lt;/span&gt;
                &lt;/div&gt;&quot;</span><span class="token punctuation">;</span>
            <span class="token variable">$moneyCount</span> <span class="token operator">=</span> <span class="token function">sqlQueryAll</span><span class="token punctuation">(</span><span class="token string double-quoted-string">&quot;select w.money as money,'提现支出' as type,w.updateTime as time from withdraw as w where w.driverId = '<span class="token interpolation"><span class="token punctuation">{</span><span class="token variable">$driver</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'id'</span><span class="token punctuation">]</span><span class="token punctuation">}</span></span>'&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span><span class="token keyword">else</span><span class="token punctuation">{</span>
            <span class="token variable">$edit</span> <span class="token operator">.=</span><span class="token string double-quoted-string">&quot;&lt;div style='margin: 12px;'&gt;
                    &lt;span class='bigSpan' onclick=\&quot;changeMenu(this,'driver','money','<span class="token interpolation"><span class="token variable">$driverId</span></span>','全部')\&quot;&gt;全部&lt;/span&gt;
                    &lt;span class='bigSpan' onclick=\&quot;changeMenu(this,'driver','money','<span class="token interpolation"><span class="token variable">$driverId</span></span>','提现支出')\&quot;&gt;提现支出&lt;/span&gt;
                    &lt;span class='bigSpan choice'  onclick=\&quot;changeMenu(this,'driver','money','<span class="token interpolation"><span class="token variable">$driverId</span></span>','车费划分')\&quot;&gt;车费划分&lt;/span&gt;
                &lt;/div&gt;&quot;</span><span class="token punctuation">;</span>
            <span class="token variable">$moneyCount</span> <span class="token operator">=</span> <span class="token function">sqlQueryAll</span><span class="token punctuation">(</span><span class="token string double-quoted-string">&quot;select b.money*d.postRadio as money,'车费划分' as type,b.updateTime as time from buyCar as b
                        left join journey as j on b.journeyId = j.id
                        left join driver as d on j.driverId = d.id where d.isPostMoney != '' and b.workFlow = '已完成' and d.id = '<span class="token interpolation"><span class="token punctuation">{</span><span class="token variable">$driver</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'id'</span><span class="token punctuation">]</span><span class="token punctuation">}</span></span>'&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
</code></pre></div></li></ul> <h2 id="数组"><a href="#数组" class="header-anchor">#</a> 数组</h2> <ul><li><p>如果你想<strong>把一个数组中的某个值删除掉</strong>,然后得到删掉这个值的新数组,那你需要使用<strong>array_filp方法</strong>,这个方法相当于你把数组的<strong>键值对倒换</strong>,然后你就可以通过你知道的那个想删除掉的值,也就是颠倒后的键获取到它在这个数组中的键,也就是颠倒后的数组中的值.</p></li> <li><p>然后使用unset方法,把这个数组带着键放进去,就可以删除掉这个数组中的你想删掉的那个元素,你的数组也就得到了更新.</p></li> <li><div class="language-php extra-class"><pre class="language-php"><code><span class="token variable">$a</span> <span class="token operator">=</span> <span class="token function">array_flip</span><span class="token punctuation">(</span><span class="token variable">$tagArr</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">//颠倒那个我们想删掉某个元素的数组</span>
           <span class="token variable">$key</span> <span class="token operator">=</span> <span class="token variable">$a</span><span class="token punctuation">[</span><span class="token variable">$id</span><span class="token punctuation">]</span><span class="token punctuation">;</span>	<span class="token comment">//然后这个$id就是我们知道的那个值,但我们不知道这个值在数组中的键,现在这个颠倒后的数组,就可以拿$id作为键,获取它的值,这个获取到的值,就是原先数组中我们想删掉的那个元素的键</span>
           <span class="token keyword">unset</span><span class="token punctuation">(</span><span class="token variable">$tagArr</span><span class="token punctuation">[</span><span class="token variable">$key</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">//然后使用unset方法,删掉数组中键为我们获取到的键的那个元素,数组也完成了更新</span>
</code></pre></div></li> <li><p>但是这样会有个问题,删除掉某个元素的一维数组就不再是普通的一位数组了,存到数据库就会出问题,必须再使用一个方法把<strong>一维数组重新排序</strong>.也就是<strong>array_values</strong>方法</p></li> <li><div class="language-php extra-class"><pre class="language-php"><code><span class="token function">array_values</span><span class="token punctuation">(</span><span class="token variable">$tagArr</span><span class="token punctuation">)</span>  <span class="token comment">//这个方法可以让一维数组重新排序成键为0,1,2,3的一维数组</span>
</code></pre></div></li></ul> <hr> <h2 id="上传文件"><a href="#上传文件" class="header-anchor">#</a> 上传文件</h2> <ul><li><p><strong>上传文件</strong>部分的代码在后端<strong>异步处理</strong>的时候,<strong>接收到的文件</strong>$file不是随便得到的,这个<code>$file=$_FILES[&quot;file&quot;]</code>得到的$file是怎么来的呢?<strong>方括号中的&quot;file&quot;<strong>就是在前端</strong>隐藏的上传input标签的name</strong>,你给这个隐藏的上传文件标签的name起什么名字,后端就拿到的是哪个文件.</p></li> <li><div class="language-php extra-class"><pre class="language-php"><code><span class="token comment">//类文件中的处理数据方法</span>
<span class="token keyword">public</span> <span class="token keyword">function</span> <span class="token function-definition function">adTagEditData</span><span class="token punctuation">(</span><span class="token variable">$data</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
        <span class="token variable">$url</span> <span class="token operator">=</span> <span class="token string double-quoted-string">&quot;file/&quot;</span><span class="token operator">.</span><span class="token function">date</span><span class="token punctuation">(</span><span class="token string double-quoted-string">&quot;Ym&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token operator">!</span><span class="token function">file_exists</span><span class="token punctuation">(</span>serverRoot<span class="token operator">.</span><span class="token variable">$url</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
            <span class="token function">mkdir</span><span class="token punctuation">(</span>serverRoot<span class="token operator">.</span><span class="token variable">$url</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>

        <span class="token variable">$max_file_size</span><span class="token operator">=</span><span class="token number">200000000</span><span class="token punctuation">;</span>     <span class="token comment">//上传文件大小限制, 单位BYTE</span>

        <span class="token variable">$file</span><span class="token operator">=</span><span class="token variable">$_FILES</span><span class="token punctuation">[</span><span class="token string double-quoted-string">&quot;file&quot;</span><span class="token punctuation">]</span><span class="token punctuation">;</span>  <span class="token comment">//此处方括号中的字符串就是前端input文件上传标签的name属性的值</span>
<span class="token comment">//        $fileName=$file[&quot;name&quot;];</span>
        <span class="token variable">$filetype</span> <span class="token operator">=</span> <span class="token variable">$file</span><span class="token punctuation">[</span><span class="token string double-quoted-string">&quot;type&quot;</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
        <span class="token variable">$filesize</span> <span class="token operator">=</span> <span class="token variable">$file</span><span class="token punctuation">[</span><span class="token string double-quoted-string">&quot;size&quot;</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
</code></pre></div></li> <li><div class="language-php extra-class"><pre class="language-php"><code><span class="token comment">//detailPara.php中写的页面部分 </span>
<span class="token variable">$para</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'tr'</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token keyword">array</span><span class="token punctuation">(</span>
                <span class="token keyword">array</span><span class="token punctuation">(</span><span class="token string double-quoted-string">&quot;标签&quot;</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
                <span class="token keyword">array</span><span class="token punctuation">(</span>
                    <span class="token comment">//这里标签图片的部分中,第一个input标签就是隐藏了的上传文件标签,它的name属性的值就是后端异步处理数据时,想拿到这个上传的文件所必需的,$file=$_FILES[&quot;file&quot;]这样才能拿到上传的文件的各种属性,而方括号中的字符串就是隐藏的上传文件标签的name属性</span>
                    <span class="token string double-quoted-string">&quot;标签名称：&quot;</span> <span class="token operator">=&gt;</span> <span class="token function">text</span><span class="token punctuation">(</span><span class="token keyword">array</span><span class="token punctuation">(</span><span class="token string double-quoted-string">&quot;name&quot;</span> <span class="token operator">=&gt;</span> <span class="token string double-quoted-string">&quot;tagName&quot;</span><span class="token punctuation">,</span><span class="token string double-quoted-string">&quot;value&quot;</span> <span class="token operator">=&gt;</span> <span class="token variable">$adTag</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'tagName'</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
                    <span class="token string double-quoted-string">&quot;标签图片：&quot;</span> <span class="token operator">=&gt;</span> <span class="token string double-quoted-string">&quot;&lt;input name=\&quot;file\&quot; type=\&quot;file\&quot; id=\&quot;file\&quot; onchange='preview(this)' style='display: none'&gt;
                                &lt;img src='<span class="token interpolation"><span class="token variable">$img</span></span>' id=\&quot;yulan\&quot;&gt;
                                &lt;img src='<span class="token interpolation"><span class="token variable">$logo</span></span>' onclick='uploadImg()'&gt;&quot;</span>
                <span class="token punctuation">,</span>
                <span class="token punctuation">)</span><span class="token punctuation">,</span>
</code></pre></div></li></ul> <hr> <ul><li><p>异步处理上传文件时,不要把上传写在方法最上面,因为这样的话在底下更新数据,很有可能出现上传成功但是更新失败的情况,这样的话文件上传了,数据却更新失败,那么文件就成了废文件.</p></li> <li><p>所以我们应该在返回插入/更新数据成功信息后,再进行上传操作,不过因为上面的数据更新或插入时拿不到图片url,就必须在下面上传完毕后,再把url使用update语句更新到刚才那条数据中.</p></li> <li><p>这里就必须使用<code>mysqli_insert_id($con)</code>方法,使用这个方法可以得到上一步执行的SQL语句得到的id,所以在上面的插入语句insert就是用这个方法拿id,然后更新url数据的.</p></li> <li><p>不过这里的上传还是没封装上传方法之前的,很臃肿.</p></li> <li><div class="language-php extra-class"><pre class="language-php"><code><span class="token keyword">public</span> <span class="token keyword">function</span> <span class="token function-definition function">adTagEditData</span><span class="token punctuation">(</span><span class="token variable">$data</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
     <span class="token comment">//赋值</span>
     <span class="token variable">$field</span> <span class="token operator">=</span> <span class="token keyword">array</span><span class="token punctuation">(</span>
         <span class="token string double-quoted-string">&quot;tagName&quot;</span> <span class="token operator">=&gt;</span> <span class="token variable">$data</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'post'</span><span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'tagName'</span><span class="token punctuation">]</span><span class="token punctuation">,</span><span class="token comment">//标签名称</span>
<span class="token comment">//            &quot;imgUrl&quot; =&gt; $dir,//标签图片url    这里因为不是先上传,自然也就拿不到url.</span>
            <span class="token string double-quoted-string">&quot;text&quot;</span> <span class="token operator">=&gt;</span> <span class="token variable">$data</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'post'</span><span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'text'</span><span class="token punctuation">]</span><span class="token punctuation">,</span><span class="token comment">//备注</span>
        <span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token variable">$adTag</span> <span class="token operator">=</span> <span class="token function">query</span><span class="token punctuation">(</span><span class="token string double-quoted-string">&quot;adTag&quot;</span><span class="token punctuation">,</span><span class="token string double-quoted-string">&quot; id = '&quot;</span><span class="token operator">.</span><span class="token variable">$data</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'post'</span><span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'id'</span><span class="token punctuation">]</span><span class="token operator">.</span><span class="token string double-quoted-string">&quot;' &quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">//判断</span>
        <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token operator">!</span><span class="token function">power</span><span class="token punctuation">(</span><span class="token string double-quoted-string">&quot;adTag&quot;</span><span class="token punctuation">,</span><span class="token string double-quoted-string">&quot;edit&quot;</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
            <span class="token variable">$json</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'warn'</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token string double-quoted-string">&quot;您没有编辑标签的权限&quot;</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span><span class="token keyword">elseif</span><span class="token punctuation">(</span><span class="token keyword">empty</span><span class="token punctuation">(</span><span class="token variable">$field</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'tagName'</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
            <span class="token variable">$json</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'warn'</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token string double-quoted-string">&quot;请填写标签名称&quot;</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
        <span class="token comment">//如果数据库中没这个id说明需要新建,用insert语句</span>
        <span class="token keyword">elseif</span><span class="token punctuation">(</span><span class="token keyword">empty</span><span class="token punctuation">(</span><span class="token variable">$adTag</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'id'</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
            <span class="token variable">$field</span><span class="token punctuation">[</span><span class="token string double-quoted-string">&quot;id&quot;</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token variable">$data</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'post'</span><span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'id'</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
            <span class="token variable">$json</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'warn'</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token function">insert</span><span class="token punctuation">(</span><span class="token keyword">array</span><span class="token punctuation">(</span><span class="token string double-quoted-string">&quot;table&quot;</span> <span class="token operator">=&gt;</span> <span class="token string double-quoted-string">&quot;adTag&quot;</span><span class="token punctuation">,</span><span class="token string double-quoted-string">&quot;field&quot;</span> <span class="token operator">=&gt;</span> <span class="token variable">$field</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
        <span class="token comment">//否则就代表数据库里有这个id,则是更新,使用update语句</span>
        <span class="token keyword">else</span><span class="token punctuation">{</span>
            <span class="token variable">$json</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'warn'</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token function">update</span><span class="token punctuation">(</span><span class="token keyword">array</span><span class="token punctuation">(</span><span class="token string double-quoted-string">&quot;table&quot;</span> <span class="token operator">=&gt;</span> <span class="token string double-quoted-string">&quot;adTag&quot;</span><span class="token punctuation">,</span><span class="token string double-quoted-string">&quot;field&quot;</span> <span class="token operator">=&gt;</span> <span class="token variable">$field</span><span class="token punctuation">,</span><span class="token string double-quoted-string">&quot;where&quot;</span> <span class="token operator">=&gt;</span> <span class="token string double-quoted-string">&quot;id = '&quot;</span><span class="token operator">.</span><span class="token variable">$data</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'post'</span><span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'id'</span><span class="token punctuation">]</span><span class="token operator">.</span><span class="token string double-quoted-string">&quot;'&quot;</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
        <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token function">in_array</span><span class="token punctuation">(</span><span class="token variable">$json</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'warn'</span><span class="token punctuation">]</span><span class="token punctuation">,</span><span class="token keyword">array</span><span class="token punctuation">(</span><span class="token string double-quoted-string">&quot;新增成功&quot;</span><span class="token punctuation">,</span><span class="token string double-quoted-string">&quot;更新成功&quot;</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
            <span class="token comment">//上传文件搬到这里,防止上传成功更新却失败的情况</span>
            <span class="token variable">$url</span> <span class="token operator">=</span> <span class="token string double-quoted-string">&quot;file/&quot;</span><span class="token operator">.</span><span class="token function">date</span><span class="token punctuation">(</span><span class="token string double-quoted-string">&quot;Ym&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token operator">!</span><span class="token function">file_exists</span><span class="token punctuation">(</span>serverRoot<span class="token operator">.</span><span class="token variable">$url</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
                <span class="token function">mkdir</span><span class="token punctuation">(</span>serverRoot<span class="token operator">.</span><span class="token variable">$url</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span>

            <span class="token variable">$max_file_size</span><span class="token operator">=</span><span class="token number">200000000</span><span class="token punctuation">;</span>     <span class="token comment">//上传文件大小限制, 单位BYTE</span>

            <span class="token variable">$file</span><span class="token operator">=</span><span class="token variable">$_FILES</span><span class="token punctuation">[</span><span class="token string double-quoted-string">&quot;file&quot;</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
            <span class="token variable">$filetype</span> <span class="token operator">=</span> <span class="token variable">$file</span><span class="token punctuation">[</span><span class="token string double-quoted-string">&quot;type&quot;</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
            <span class="token variable">$filesize</span> <span class="token operator">=</span> <span class="token variable">$file</span><span class="token punctuation">[</span><span class="token string double-quoted-string">&quot;size&quot;</span><span class="token punctuation">]</span><span class="token punctuation">;</span>

            <span class="token variable">$base64</span> <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">base64_file</span><span class="token punctuation">(</span><span class="token string double-quoted-string">&quot;img&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token variable">$expandedName</span> <span class="token operator">=</span> <span class="token variable">$base64</span><span class="token operator">-&gt;</span><span class="token function">mime</span><span class="token punctuation">(</span><span class="token variable">$filetype</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token variable">$typeJudge</span> <span class="token operator">=</span> <span class="token function">typeFile</span><span class="token punctuation">(</span><span class="token variable">$filetype</span><span class="token punctuation">)</span><span class="token punctuation">;</span>  <span class="token comment">// 文件类型判断</span>

            <span class="token comment">//$typeJudge['warn</span><span class="token string single-quoted-string">']为空意味着typeFile方法没有传递错误信息,说明文件格式没问题
            //格式没问题才考虑判断大小,文件是否存在
            if(empty($typeJudge['</span>warn<span class="token string single-quoted-string">'])){
                if($filesize &gt; $max_file_size){                // 文件大小判断
                    $json['</span>warn<span class="token string single-quoted-string">'] = &quot;文件太大!&quot;;
                    exit;
                }


                $src = $url.&quot;/&quot;.suiji().&quot;.&quot;.$expandedName;

                $filename = iconv(&quot;UTF-8&quot;,&quot;gb2312&quot;,serverRoot.$src);
                //当文件存在
                if (file_exists($filename)) {
                    //echo $fileName.&quot; already exists.&quot;;
                    $json['</span>warn<span class="token string single-quoted-string">'] = $filename.&quot;文件存在&quot;;

                    $dir = $src;

                }else{//当文件不存在
                    move_uploaded_file($_FILES[&quot;file&quot;][&quot;tmp_name&quot;],$filename);
                    $dir = $src;
                }
            }

            //将图片url更新进之前的那条数据里
            $field = array(
            &quot;imgUrl&quot; =&gt; $dir,//标签图片url
            );
            //拿到全局变量中的数据库连接con
            $con = $GLOBALS['</span>con<span class="token string single-quoted-string">'];
            //mysqli_insert_id这个方法可以拿到上传前的更新或插入语句的那条数据的id,就用这个id来把上传完毕的url更新到那条数据中
            $successId = mysqli_insert_id($con);  
            update(array(&quot;table&quot; =&gt; &quot;adTag&quot;,&quot;field&quot; =&gt; $field,&quot;where&quot; =&gt; &quot;id = '</span><span class="token string double-quoted-string">&quot;.<span class="token interpolation"><span class="token variable">$successId</span></span>.&quot;</span><span class="token string single-quoted-string">'&quot;));


            //添加日志
            $type = mb_substr($json['</span>warn<span class="token string single-quoted-string">'],0,2,'</span>utf<span class="token operator">-</span><span class="token number">8</span><span class="token string single-quoted-string">');
            $text = $data['</span>control<span class="token string single-quoted-string">']['</span>adName<span class="token string single-quoted-string">'].$type.&quot;了一个标签：&quot;.$field['</span>tagName<span class="token string single-quoted-string">'];
            logText(array(&quot;type&quot; =&gt; &quot;adTag&quot;,&quot;text&quot; =&gt; $text));
            //返回
            $_SESSION['</span>warn<span class="token string single-quoted-string">'] = $json['</span>warn<span class="token string single-quoted-string">'];
            $json['</span>warn<span class="token string single-quoted-string">'] = 2;
        }
        $json['</span>href<span class="token string single-quoted-string">'] = root.&quot;control/detail.php?type=adTag&amp;id=&quot;.$data['</span>post<span class="token string single-quoted-string">']['</span>id'<span class="token punctuation">]</span><span class="token punctuation">;</span>
        <span class="token keyword">return</span> <span class="token variable">$json</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
</code></pre></div></li></ul> <hr> <ul><li><p><strong>最好的上传</strong>就应该在extend中定义一个方法,传标签name给这个方法,方法返回一个url地址拿来用即可,这个url可以直接存进数据库.但是要注意,上传文件的操作应该放在更新数据之后,先更新除图片URL之外的数据,全都更新完,再上传,拿到上传图片URL,更新到刚才那条数据中去,防止更新数据失败上传却成功堆积垃圾文件的情况.</p> <div class="language-php extra-class"><pre class="language-php"><code><span class="token comment">//extend.php文件中封装的上传方法</span>
<span class="token keyword">function</span> <span class="token function-definition function">ThemeUpload</span><span class="token punctuation">(</span><span class="token variable">$name</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
    <span class="token variable">$url</span> <span class="token operator">=</span> <span class="token string double-quoted-string">&quot;file/&quot;</span><span class="token operator">.</span><span class="token function">date</span><span class="token punctuation">(</span><span class="token string double-quoted-string">&quot;Ym&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token operator">!</span><span class="token function">file_exists</span><span class="token punctuation">(</span>serverRoot<span class="token operator">.</span><span class="token variable">$url</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
        <span class="token function">mkdir</span><span class="token punctuation">(</span>serverRoot<span class="token operator">.</span><span class="token variable">$url</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token variable">$max_file_size</span><span class="token operator">=</span><span class="token number">200000000</span><span class="token punctuation">;</span>     <span class="token comment">//上传文件大小限制, 单位BYTE</span>

    <span class="token variable">$file</span><span class="token operator">=</span><span class="token variable">$_FILES</span><span class="token punctuation">[</span><span class="token variable">$name</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
    <span class="token variable">$filetype</span> <span class="token operator">=</span> <span class="token variable">$file</span><span class="token punctuation">[</span><span class="token string double-quoted-string">&quot;type&quot;</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
    <span class="token variable">$filesize</span> <span class="token operator">=</span> <span class="token variable">$file</span><span class="token punctuation">[</span><span class="token string double-quoted-string">&quot;size&quot;</span><span class="token punctuation">]</span><span class="token punctuation">;</span>

    <span class="token variable">$base64</span> <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">base64_file</span><span class="token punctuation">(</span><span class="token string double-quoted-string">&quot;img&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token variable">$expandedName</span> <span class="token operator">=</span> <span class="token variable">$base64</span><span class="token operator">-&gt;</span><span class="token function">mime</span><span class="token punctuation">(</span><span class="token variable">$filetype</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token variable">$typeJudge</span> <span class="token operator">=</span> <span class="token function">typeFile</span><span class="token punctuation">(</span><span class="token variable">$filetype</span><span class="token punctuation">)</span><span class="token punctuation">;</span>  <span class="token comment">// 文件类型判断</span>

    <span class="token comment">//$typeJudge['warn']为空意味着typeFile方法没有传递错误信息,说明文件格式没问题</span>
    <span class="token comment">//格式没问题才考虑判断大小,文件是否存在</span>
    <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token keyword">empty</span><span class="token punctuation">(</span><span class="token variable">$typeJudge</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'warn'</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
        <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token variable">$filesize</span> <span class="token operator">&gt;</span> <span class="token variable">$max_file_size</span><span class="token punctuation">)</span><span class="token punctuation">{</span>                <span class="token comment">// 文件大小判断</span>
            <span class="token variable">$json</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'warn'</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token string double-quoted-string">&quot;文件太大!&quot;</span><span class="token punctuation">;</span>
            <span class="token keyword">exit</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>


        <span class="token variable">$src</span> <span class="token operator">=</span> <span class="token variable">$url</span><span class="token operator">.</span><span class="token string double-quoted-string">&quot;/&quot;</span><span class="token operator">.</span><span class="token function">suiji</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">.</span><span class="token string double-quoted-string">&quot;.&quot;</span><span class="token operator">.</span><span class="token variable">$expandedName</span><span class="token punctuation">;</span>

        <span class="token variable">$filename</span> <span class="token operator">=</span> <span class="token function">iconv</span><span class="token punctuation">(</span><span class="token string double-quoted-string">&quot;UTF-8&quot;</span><span class="token punctuation">,</span><span class="token string double-quoted-string">&quot;gb2312&quot;</span><span class="token punctuation">,</span>serverRoot<span class="token operator">.</span><span class="token variable">$src</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">//当文件存在</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token function">file_exists</span><span class="token punctuation">(</span><span class="token variable">$filename</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token comment">//echo $fileName.&quot; already exists.&quot;;</span>
            <span class="token variable">$json</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'warn'</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token variable">$filename</span><span class="token operator">.</span><span class="token string double-quoted-string">&quot;文件存在&quot;</span><span class="token punctuation">;</span>

            <span class="token variable">$dir</span> <span class="token operator">=</span> <span class="token variable">$src</span><span class="token punctuation">;</span>

        <span class="token punctuation">}</span><span class="token keyword">else</span><span class="token punctuation">{</span><span class="token comment">//当文件不存在</span>
            <span class="token variable">$chenggong</span> <span class="token operator">=</span> <span class="token function">move_uploaded_file</span><span class="token punctuation">(</span><span class="token variable">$_FILES</span><span class="token punctuation">[</span><span class="token variable">$name</span><span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token string double-quoted-string">&quot;tmp_name&quot;</span><span class="token punctuation">]</span><span class="token punctuation">,</span><span class="token variable">$filename</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token variable">$dir</span> <span class="token operator">=</span> <span class="token variable">$src</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>


        <span class="token keyword">return</span> <span class="token variable">$dir</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div><div class="language-php extra-class"><pre class="language-php"><code><span class="token comment">//Class文件中上传部分的代码</span>
<span class="token keyword">if</span><span class="token punctuation">(</span><span class="token function">in_array</span><span class="token punctuation">(</span><span class="token variable">$json</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'warn'</span><span class="token punctuation">]</span><span class="token punctuation">,</span><span class="token keyword">array</span><span class="token punctuation">(</span><span class="token string double-quoted-string">&quot;新增成功&quot;</span><span class="token punctuation">,</span><span class="token string double-quoted-string">&quot;更新成功&quot;</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
            <span class="token comment">//上传文件搬到这里,防止上传成功更新却失败的情况</span>
            <span class="token comment">//ThemeUpload是封装在extend.php中的方法</span>
            <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token variable">$_FILES</span><span class="token punctuation">[</span><span class="token string double-quoted-string">&quot;file&quot;</span><span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'name'</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
                <span class="token variable">$name</span> <span class="token operator">=</span> <span class="token string double-quoted-string">&quot;file&quot;</span><span class="token punctuation">;</span>
                <span class="token variable">$dir</span> <span class="token operator">=</span> <span class="token function">ThemeUpload</span><span class="token punctuation">(</span><span class="token variable">$name</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span>
            <span class="token comment">//将图片url更新进之前的那条数据里</span>
            <span class="token variable">$field</span> <span class="token operator">=</span> <span class="token keyword">array</span><span class="token punctuation">(</span>
            <span class="token string double-quoted-string">&quot;imgUrl&quot;</span> <span class="token operator">=&gt;</span> <span class="token variable">$dir</span><span class="token punctuation">,</span><span class="token comment">//标签图片url</span>
            <span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token comment">//拿到全局变量中的数据库连接con</span>
            <span class="token variable">$con</span> <span class="token operator">=</span> <span class="token variable">$GLOBALS</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'con'</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
            <span class="token variable">$successId</span> <span class="token operator">=</span> <span class="token function">mysqli_insert_id</span><span class="token punctuation">(</span><span class="token variable">$con</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token function">update</span><span class="token punctuation">(</span><span class="token keyword">array</span><span class="token punctuation">(</span><span class="token string double-quoted-string">&quot;table&quot;</span> <span class="token operator">=&gt;</span> <span class="token string double-quoted-string">&quot;adTag&quot;</span><span class="token punctuation">,</span><span class="token string double-quoted-string">&quot;field&quot;</span> <span class="token operator">=&gt;</span> <span class="token variable">$field</span><span class="token punctuation">,</span><span class="token string double-quoted-string">&quot;where&quot;</span> <span class="token operator">=&gt;</span> <span class="token string double-quoted-string">&quot;id = '&quot;</span><span class="token operator">.</span><span class="token variable">$successId</span><span class="token operator">.</span><span class="token string double-quoted-string">&quot;'&quot;</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>


            <span class="token comment">//添加日志</span>
            <span class="token variable">$type</span> <span class="token operator">=</span> <span class="token function">mb_substr</span><span class="token punctuation">(</span><span class="token variable">$json</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'warn'</span><span class="token punctuation">]</span><span class="token punctuation">,</span><span class="token number">0</span><span class="token punctuation">,</span><span class="token number">2</span><span class="token punctuation">,</span><span class="token string single-quoted-string">'utf-8'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token variable">$text</span> <span class="token operator">=</span> <span class="token variable">$data</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'control'</span><span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'adName'</span><span class="token punctuation">]</span><span class="token operator">.</span><span class="token variable">$type</span><span class="token operator">.</span><span class="token string double-quoted-string">&quot;了一个标签：&quot;</span><span class="token operator">.</span><span class="token variable">$field</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'tagName'</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
            <span class="token function">logText</span><span class="token punctuation">(</span><span class="token keyword">array</span><span class="token punctuation">(</span><span class="token string double-quoted-string">&quot;type&quot;</span> <span class="token operator">=&gt;</span> <span class="token string double-quoted-string">&quot;adTag&quot;</span><span class="token punctuation">,</span><span class="token string double-quoted-string">&quot;text&quot;</span> <span class="token operator">=&gt;</span> <span class="token variable">$text</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token comment">//返回</span>
            <span class="token variable">$_SESSION</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'warn'</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token variable">$json</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'warn'</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
            <span class="token variable">$json</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'warn'</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token number">2</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
</code></pre></div></li></ul> <hr> <ul><li>使用<strong>unlink</strong>方法可以<strong>删除上传的文件</strong>.</li></ul> <hr> <ul><li><p>如果想要点击上传立刻上传并进行数据库操作,就必须给自己写好的表格加上一个form,然后进入<code>post.php</code>去进行数据操作.</p> <div class="language-php extra-class"><pre class="language-php"><code><span class="token variable">$html</span> <span class="token operator">=</span> space<span class="token operator">.</span><span class="token string double-quoted-string">&quot;&lt;h3&gt;图片配置&lt;/h3&gt;&quot;</span><span class="token operator">.</span><span class="token string double-quoted-string">&quot;&lt;style&gt;.tableMany td{background-color: white!important;
    text-align: center!important;}.tableMany tr:hover {color: #555!important;}&lt;/style&gt;&quot;</span><span class="token operator">.</span>
    <span class="token string double-quoted-string">&quot;&lt;form  name='shopPicForm' method='post' enctype='multipart/form-data' action='&quot;</span><span class="token operator">.</span>root<span class="token operator">.</span><span class="token string double-quoted-string">&quot;control/post.php?type=shopPicUpload'&gt;&quot;</span><span class="token operator">.</span><span class="token string double-quoted-string">&quot;&lt;input name='shopId' value='<span class="token interpolation"><span class="token variable">$shopId</span></span>' style='display: none' /&gt;&quot;</span><span class="token operator">.</span><span class="token function">tableMany</span><span class="token punctuation">(</span><span class="token keyword">array</span><span class="token punctuation">(</span><span class="token string double-quoted-string">&quot;tr&quot;</span> <span class="token operator">=&gt;</span> <span class="token variable">$tr</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token operator">.</span><span class="token string double-quoted-string">&quot;&lt;/form&gt;&quot;</span><span class="token punctuation">;</span><span class="token comment">//这里的form就是我们要写的,name可以自己定</span>
</code></pre></div></li> <li><p>前面上传按钮部分,要加一个点击事件,触发form表单</p> <div class="language-php extra-class"><pre class="language-php"><code><span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token variable">$x</span><span class="token operator">=</span><span class="token number">0</span><span class="token punctuation">;</span><span class="token variable">$x</span><span class="token operator">&lt;</span><span class="token number">5</span><span class="token punctuation">;</span><span class="token variable">$x</span><span class="token operator">++</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
    <span class="token comment">//onchange='document.shopPicForm.submit()' 就是这个事件</span>
    <span class="token variable">$up</span> <span class="token operator">=</span> <span class="token string double-quoted-string">&quot;&lt;input name=\&quot;file&quot;</span><span class="token operator">.</span><span class="token variable">$x</span><span class="token operator">.</span><span class="token string double-quoted-string">&quot;\&quot; type=\&quot;file\&quot; id=\&quot;file&quot;</span><span class="token operator">.</span><span class="token variable">$x</span><span class="token operator">.</span><span class="token string double-quoted-string">&quot;\&quot;  onchange='document.shopPicForm.submit()' style='display: none'&gt;
&lt;span class='spanButton' onclick='uploadImg(this)' id='&quot;</span><span class="token operator">.</span><span class="token variable">$x</span><span class="token operator">.</span><span class="token string double-quoted-string">&quot;'&gt;上传&lt;/span&gt;&quot;</span>
        <span class="token punctuation">;</span>
    <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token keyword">empty</span><span class="token punctuation">(</span><span class="token variable">$shopPic</span><span class="token punctuation">[</span><span class="token variable">$x</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
        <span class="token variable">$tr</span><span class="token punctuation">[</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token keyword">array</span><span class="token punctuation">(</span><span class="token string single-quoted-string">''</span><span class="token punctuation">,</span><span class="token string single-quoted-string">''</span><span class="token punctuation">,</span><span class="token string single-quoted-string">''</span><span class="token punctuation">,</span><span class="token variable">$up</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span><span class="token keyword">else</span><span class="token punctuation">{</span>
        <span class="token variable">$img</span> <span class="token operator">=</span> root<span class="token operator">.</span><span class="token variable">$shopPic</span><span class="token punctuation">[</span><span class="token variable">$x</span><span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token string double-quoted-string">&quot;url&quot;</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
        <span class="token variable">$tr</span><span class="token punctuation">[</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token keyword">array</span><span class="token punctuation">(</span><span class="token variable">$shopPic</span><span class="token punctuation">[</span><span class="token variable">$x</span><span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'id'</span><span class="token punctuation">]</span><span class="token punctuation">,</span><span class="token variable">$shopPic</span><span class="token punctuation">[</span><span class="token variable">$x</span><span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'name'</span><span class="token punctuation">]</span><span class="token punctuation">,</span><span class="token string double-quoted-string">&quot;&lt;img style='width: 40px;height: 40px' src='<span class="token interpolation"><span class="token variable">$img</span></span>' /&gt;&quot;</span><span class="token punctuation">,</span><span class="token variable">$up</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div></li> <li><p>然后跑到<code>post.php</code>中去进行数据操作</p> <div class="language-php extra-class"><pre class="language-php"><code><span class="token comment">/************门店小程序图片配置***************/</span>
<span class="token keyword">elseif</span><span class="token punctuation">(</span><span class="token variable">$get</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'type'</span><span class="token punctuation">]</span> <span class="token operator">==</span> <span class="token string double-quoted-string">&quot;shopPicUpload&quot;</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token variable">$_FILES</span><span class="token punctuation">[</span><span class="token string double-quoted-string">&quot;file0&quot;</span><span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'name'</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">{</span>    <span class="token comment">//缩略图</span>
        <span class="token variable">$name</span> <span class="token operator">=</span> <span class="token string double-quoted-string">&quot;file0&quot;</span><span class="token punctuation">;</span>
        <span class="token variable">$dir</span> <span class="token operator">=</span> <span class="token function">ThemeUpload</span><span class="token punctuation">(</span><span class="token variable">$name</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token variable">$sequece</span> <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token variable">$_FILES</span><span class="token punctuation">[</span><span class="token string double-quoted-string">&quot;file1&quot;</span><span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'name'</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">{</span><span class="token comment">//详情图1</span>
        <span class="token variable">$name</span> <span class="token operator">=</span> <span class="token string double-quoted-string">&quot;file1&quot;</span><span class="token punctuation">;</span>
        <span class="token variable">$dir</span> <span class="token operator">=</span> <span class="token function">ThemeUpload</span><span class="token punctuation">(</span><span class="token variable">$name</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token variable">$sequece</span> <span class="token operator">=</span> <span class="token number">2</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token variable">$_FILES</span><span class="token punctuation">[</span><span class="token string double-quoted-string">&quot;file2&quot;</span><span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'name'</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">{</span><span class="token comment">//详情图2</span>
        <span class="token variable">$name</span> <span class="token operator">=</span> <span class="token string double-quoted-string">&quot;file2&quot;</span><span class="token punctuation">;</span>
        <span class="token variable">$dir</span> <span class="token operator">=</span> <span class="token function">ThemeUpload</span><span class="token punctuation">(</span><span class="token variable">$name</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token variable">$sequece</span> <span class="token operator">=</span> <span class="token number">3</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token variable">$_FILES</span><span class="token punctuation">[</span><span class="token string double-quoted-string">&quot;file3&quot;</span><span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'name'</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">{</span><span class="token comment">//详情图3</span>
        <span class="token variable">$name</span> <span class="token operator">=</span> <span class="token string double-quoted-string">&quot;file3&quot;</span><span class="token punctuation">;</span>
        <span class="token variable">$dir</span> <span class="token operator">=</span> <span class="token function">ThemeUpload</span><span class="token punctuation">(</span><span class="token variable">$name</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token variable">$sequece</span> <span class="token operator">=</span> <span class="token number">4</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token variable">$_FILES</span><span class="token punctuation">[</span><span class="token string double-quoted-string">&quot;file4&quot;</span><span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'name'</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">{</span><span class="token comment">//详情图3</span>
        <span class="token variable">$name</span> <span class="token operator">=</span> <span class="token string double-quoted-string">&quot;file4&quot;</span><span class="token punctuation">;</span>
        <span class="token variable">$dir</span> <span class="token operator">=</span> <span class="token function">ThemeUpload</span><span class="token punctuation">(</span><span class="token variable">$name</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token variable">$sequece</span> <span class="token operator">=</span> <span class="token number">5</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token comment">//将图片url更新进之前的那条数据里</span>
    <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token variable">$sequece</span><span class="token operator">==</span><span class="token number">5</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
        <span class="token variable">$field</span> <span class="token operator">=</span> <span class="token keyword">array</span><span class="token punctuation">(</span>
            <span class="token string double-quoted-string">&quot;shopId&quot;</span> <span class="token operator">=&gt;</span> <span class="token variable">$post</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'shopId'</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
            <span class="token string double-quoted-string">&quot;name&quot;</span> <span class="token operator">=&gt;</span> <span class="token string single-quoted-string">'封面图'</span><span class="token punctuation">,</span>
            <span class="token string double-quoted-string">&quot;sequence&quot;</span> <span class="token operator">=&gt;</span> <span class="token variable">$sequece</span><span class="token punctuation">,</span>
            <span class="token string double-quoted-string">&quot;url&quot;</span> <span class="token operator">=&gt;</span> <span class="token variable">$dir</span><span class="token punctuation">,</span><span class="token comment">//标签图片url</span>
            <span class="token string double-quoted-string">&quot;time&quot;</span> <span class="token operator">=&gt;</span> <span class="token variable">$time</span><span class="token punctuation">,</span><span class="token comment">//标签图片url</span>
            <span class="token string double-quoted-string">&quot;updateTime&quot;</span> <span class="token operator">=&gt;</span> <span class="token variable">$time</span><span class="token punctuation">,</span><span class="token comment">//标签图片url</span>
        <span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span><span class="token keyword">else</span><span class="token punctuation">{</span>
        <span class="token variable">$field</span> <span class="token operator">=</span> <span class="token keyword">array</span><span class="token punctuation">(</span>
            <span class="token string double-quoted-string">&quot;shopId&quot;</span> <span class="token operator">=&gt;</span> <span class="token variable">$post</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'shopId'</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
            <span class="token string double-quoted-string">&quot;name&quot;</span> <span class="token operator">=&gt;</span> <span class="token string single-quoted-string">'轮播图'</span><span class="token operator">.</span><span class="token variable">$sequece</span><span class="token punctuation">,</span>
            <span class="token string double-quoted-string">&quot;sequence&quot;</span> <span class="token operator">=&gt;</span> <span class="token variable">$sequece</span><span class="token punctuation">,</span>
            <span class="token string double-quoted-string">&quot;url&quot;</span> <span class="token operator">=&gt;</span> <span class="token variable">$dir</span><span class="token punctuation">,</span><span class="token comment">//标签图片url</span>
            <span class="token string double-quoted-string">&quot;time&quot;</span> <span class="token operator">=&gt;</span> <span class="token variable">$time</span><span class="token punctuation">,</span><span class="token comment">//标签图片url</span>
            <span class="token string double-quoted-string">&quot;updateTime&quot;</span> <span class="token operator">=&gt;</span> <span class="token variable">$time</span><span class="token punctuation">,</span><span class="token comment">//标签图片url</span>
        <span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token variable">$pic</span> <span class="token operator">=</span> <span class="token function">sqlQueryAll</span><span class="token punctuation">(</span><span class="token string double-quoted-string">&quot;select * from shopPic where shopId = '<span class="token interpolation"><span class="token punctuation">{</span><span class="token variable">$post</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'shopId'</span><span class="token punctuation">]</span><span class="token punctuation">}</span></span>'&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">//用上一条执行的SQL语句的id查询详情图表</span>
    <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token operator">!</span><span class="token keyword">empty</span><span class="token punctuation">(</span><span class="token variable">$pic</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">{</span>     <span class="token comment">//如果能从详情图表用themeId查出记录来,那就说明这条记录之前有,现在是在更新</span>
        <span class="token variable">$ids</span> <span class="token operator">=</span> <span class="token keyword">array</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>  <span class="token comment">//创建一个数组用来接收每个详情图的id</span>
        <span class="token keyword">foreach</span> <span class="token punctuation">(</span><span class="token variable">$pic</span> <span class="token keyword">as</span> <span class="token variable">$picId</span><span class="token punctuation">)</span><span class="token punctuation">{</span>  <span class="token comment">//把每条记录的id收集器来,存到数组$ids中</span>
            <span class="token variable">$ids</span><span class="token punctuation">[</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token variable">$picId</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'id'</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
    <span class="token variable">$updateID</span> <span class="token operator">=</span> <span class="token keyword">array</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token variable">$sequece</span><span class="token punctuation">)</span><span class="token punctuation">{</span>  <span class="token comment">//如果数组中有数字,说明更新图片了</span>
        <span class="token function">test</span><span class="token punctuation">(</span><span class="token string double-quoted-string">&quot;进入更新顺寻判断,顺序=&quot;</span><span class="token operator">.</span><span class="token variable">$sequece</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token function">count</span><span class="token punctuation">(</span><span class="token variable">$ids</span><span class="token punctuation">)</span><span class="token operator">&gt;</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">{</span>  <span class="token comment">//如果$ids不为空,就代表是更新,才会往下执行</span>
            <span class="token function">test</span><span class="token punctuation">(</span><span class="token string double-quoted-string">&quot;进入ids不为空判断&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token keyword">foreach</span> <span class="token punctuation">(</span><span class="token variable">$ids</span> <span class="token keyword">as</span> <span class="token variable">$shopPicId</span><span class="token punctuation">)</span><span class="token punctuation">{</span>  <span class="token comment">//遍历每个详情图id</span>
                <span class="token variable">$shopPic</span> <span class="token operator">=</span> <span class="token function">query</span><span class="token punctuation">(</span><span class="token string double-quoted-string">&quot;shopPic&quot;</span><span class="token punctuation">,</span><span class="token string double-quoted-string">&quot;id = '<span class="token interpolation"><span class="token variable">$shopPicId</span></span>'&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>  <span class="token comment">//循环每次赋值都会覆盖掉,只要不是追加数组就不怕数据堆积</span>
                <span class="token function">test</span><span class="token punctuation">(</span><span class="token string double-quoted-string">&quot;查询出的图片顺序=&quot;</span><span class="token operator">.</span><span class="token variable">$shopPic</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'sequence'</span><span class="token punctuation">]</span><span class="token operator">.</span><span class="token string double-quoted-string">&quot;图片id=&quot;</span><span class="token operator">.</span><span class="token variable">$shopPicId</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token variable">$shopPic</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'sequence'</span><span class="token punctuation">]</span><span class="token operator">==</span><span class="token variable">$sequece</span><span class="token punctuation">)</span><span class="token punctuation">{</span>  <span class="token comment">//如果相同主题id查出来的几条详情图数据中有一条的顺序字段和我们判断的这个顺序重复</span>
                    <span class="token comment">//                    mysqli_query($con, &quot; delete from shopPic where id = '$shopPicId[id]' &quot;);  //先删掉这条数据</span>
                    <span class="token function">test</span><span class="token punctuation">(</span><span class="token string double-quoted-string">&quot;进入顺序相同判断&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                    <span class="token function">unlink</span><span class="token punctuation">(</span>serverRoot<span class="token operator">.</span><span class="token variable">$shopPicId</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'url'</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>  <span class="token comment">//然后就删掉这个顺序的旧图片</span>
                    <span class="token variable">$updateID</span><span class="token punctuation">[</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token variable">$shopPicId</span><span class="token punctuation">;</span>
                <span class="token punctuation">}</span>
            <span class="token punctuation">}</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
    <span class="token function">test</span><span class="token punctuation">(</span><span class="token string double-quoted-string">&quot;更新ID=&quot;</span><span class="token operator">.</span><span class="token variable">$updateID</span><span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token comment">//如果$updateArr数组中有元素说明是图片更新</span>
    <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token function">count</span><span class="token punctuation">(</span><span class="token variable">$updateID</span><span class="token punctuation">)</span><span class="token operator">&gt;</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
        <span class="token keyword">unset</span><span class="token punctuation">(</span><span class="token variable">$field</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'time'</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token function">update</span><span class="token punctuation">(</span><span class="token keyword">array</span><span class="token punctuation">(</span><span class="token string double-quoted-string">&quot;table&quot;</span> <span class="token operator">=&gt;</span> <span class="token string double-quoted-string">&quot;shopPic&quot;</span><span class="token punctuation">,</span><span class="token string double-quoted-string">&quot;field&quot;</span> <span class="token operator">=&gt;</span> <span class="token variable">$field</span><span class="token punctuation">,</span><span class="token string double-quoted-string">&quot;where&quot;</span><span class="token operator">=&gt;</span><span class="token string double-quoted-string">&quot;id = '<span class="token interpolation"><span class="token variable">$updateID</span><span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span></span>'&quot;</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token comment">//否则是新增</span>
    <span class="token keyword">else</span><span class="token punctuation">{</span>
        <span class="token variable">$field</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'id'</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token function">suiji</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token function">insert</span><span class="token punctuation">(</span><span class="token keyword">array</span><span class="token punctuation">(</span><span class="token string double-quoted-string">&quot;table&quot;</span> <span class="token operator">=&gt;</span> <span class="token string double-quoted-string">&quot;shopPic&quot;</span><span class="token punctuation">,</span> <span class="token string double-quoted-string">&quot;field&quot;</span> <span class="token operator">=&gt;</span> <span class="token variable">$field</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token comment">//post页面的跳转要这样写</span>
    <span class="token variable">$locationUrl</span> <span class="token operator">=</span> root<span class="token operator">.</span><span class="token string double-quoted-string">&quot;control/detail.php?type=shop&amp;menu=config&amp;id=&quot;</span><span class="token operator">.</span><span class="token variable">$post</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'shopId'</span><span class="token punctuation">]</span><span class="token punctuation">;</span>

<span class="token punctuation">}</span>
</code></pre></div></li></ul> <hr> <ul><li><p>上传图片(详情页包含其他输入信息,点击提交再一起上传)</p></li> <li><p>首先在detailPara中写好上传表格</p> <div class="language-php extra-class"><pre class="language-php"><code><span class="token variable">$tr</span><span class="token punctuation">[</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token keyword">array</span><span class="token punctuation">(</span><span class="token string double-quoted-string">&quot;图片名称&quot;</span><span class="token punctuation">,</span><span class="token string double-quoted-string">&quot;预览&quot;</span><span class="token punctuation">,</span><span class="token string double-quoted-string">&quot;操作&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">//不知道要怎样拿到按钮传过来的id</span>
        <span class="token comment">//拿到全局变量中的数据库连接con</span>
        <span class="token comment">//用get拿到id</span>
        <span class="token variable">$commodityPic</span> <span class="token operator">=</span> <span class="token function">sqlQueryAll</span><span class="token punctuation">(</span><span class="token string double-quoted-string">&quot;select * from commodityPic where commodityId = '<span class="token interpolation"><span class="token punctuation">{</span><span class="token variable">$commodity</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'id'</span><span class="token punctuation">]</span><span class="token punctuation">}</span></span>' order by sequence&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token variable">$x</span><span class="token operator">=</span><span class="token number">0</span><span class="token punctuation">;</span><span class="token variable">$x</span><span class="token operator">&lt;</span><span class="token number">4</span><span class="token punctuation">;</span><span class="token variable">$x</span><span class="token operator">++</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
            <span class="token comment">//previewCommodityPic是详情页表格显示版本的预览JS方法</span>
            <span class="token comment">//uploadImg是通用上传JS方法</span>
            <span class="token variable">$up</span> <span class="token operator">=</span> <span class="token string double-quoted-string">&quot;&lt;input name=\&quot;file&quot;</span><span class="token operator">.</span><span class="token variable">$x</span><span class="token operator">.</span><span class="token string double-quoted-string">&quot;\&quot; type=\&quot;file\&quot; id=\&quot;file&quot;</span><span class="token operator">.</span><span class="token variable">$x</span><span class="token operator">.</span><span class="token string double-quoted-string">&quot;\&quot;  onchange='previewCommodityPic(this)' num='<span class="token interpolation"><span class="token variable">$x</span></span>'   style='display: none'&gt;
&lt;span class='spanButton' onclick='uploadImg(this)' id='&quot;</span><span class="token operator">.</span><span class="token variable">$x</span><span class="token operator">.</span><span class="token string double-quoted-string">&quot;'&gt;上传&lt;/span&gt;&quot;</span><span class="token punctuation">;</span>
<span class="token keyword">if</span><span class="token punctuation">(</span><span class="token keyword">empty</span><span class="token punctuation">(</span><span class="token variable">$commodityPic</span><span class="token punctuation">[</span><span class="token variable">$x</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
   <span class="token variable">$tr</span><span class="token punctuation">[</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token keyword">array</span><span class="token punctuation">(</span><span class="token string single-quoted-string">''</span><span class="token punctuation">,</span><span class="token string single-quoted-string">'&lt;img src=\'\' id=&quot;yulan&quot;&gt;'</span><span class="token punctuation">,</span><span class="token variable">$up</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">//在没图片的时候,表格中图片位置加上预览标签</span>
<span class="token punctuation">}</span><span class="token keyword">else</span><span class="token punctuation">{</span>
                <span class="token variable">$img</span> <span class="token operator">=</span> root<span class="token operator">.</span><span class="token variable">$commodityPic</span><span class="token punctuation">[</span><span class="token variable">$x</span><span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token string double-quoted-string">&quot;url&quot;</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
                <span class="token variable">$tr</span><span class="token punctuation">[</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token keyword">array</span><span class="token punctuation">(</span><span class="token variable">$commodityPic</span><span class="token punctuation">[</span><span class="token variable">$x</span><span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'name'</span><span class="token punctuation">]</span><span class="token punctuation">,</span><span class="token string double-quoted-string">&quot;&lt;img  id='yulan' style='width: 100px;height: 100px' src='<span class="token interpolation"><span class="token variable">$img</span></span>' /&gt;&quot;</span><span class="token punctuation">,</span><span class="token variable">$up</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">//给表格中图片显示标签加上yulan类,方便js预览方法生效</span>
            <span class="token punctuation">}</span>
        <span class="token punctuation">}</span>
        <span class="token variable">$html</span> <span class="token operator">=</span> space<span class="token operator">.</span><span class="token string double-quoted-string">&quot;&lt;h3&gt;图片配置&lt;/h3&gt;&quot;</span><span class="token operator">.</span><span class="token string double-quoted-string">&quot;&lt;style&gt;.tableMany td{background-color: white!important;
    text-align: center!important;}.tableMany tr:hover {color: #555!important;}&lt;/style&gt;&quot;</span><span class="token operator">.</span>
            <span class="token function">tableMany</span><span class="token punctuation">(</span><span class="token keyword">array</span><span class="token punctuation">(</span><span class="token string double-quoted-string">&quot;tr&quot;</span> <span class="token operator">=&gt;</span> <span class="token variable">$tr</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><div class="language-js extra-class"><pre class="language-js"><code><span class="token comment">//图片上传弹出框预览js</span>
<span class="token keyword">function</span> <span class="token function">previewCommodityPic</span><span class="token punctuation">(</span><span class="token parameter">a</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">var</span> file <span class="token operator">=</span> a<span class="token punctuation">.</span>files<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>window<span class="token punctuation">.</span>FileReader<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">var</span> reader <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">FileReader</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        reader<span class="token punctuation">.</span><span class="token function">readAsDataURL</span><span class="token punctuation">(</span>file<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">//监听文件读取结束后事件</span>
        reader<span class="token punctuation">.</span><span class="token function-variable function">onloadend</span> <span class="token operator">=</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token parameter">e</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token comment">//e.target.result就是最后的路径地址</span>
            <span class="token comment">//这里因为把预览标签放到了表格里,节点变化,所以需要寻找父级节点来控制预览</span>
            <span class="token function">$</span><span class="token punctuation">(</span>a<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">parent</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">parent</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">find</span><span class="token punctuation">(</span><span class="token string">&quot;#yulan&quot;</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">attr</span><span class="token punctuation">(</span><span class="token string">&quot;style&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;width: 100px;height: 100px&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token function">$</span><span class="token punctuation">(</span>a<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">parent</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">parent</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">find</span><span class="token punctuation">(</span><span class="token string">&quot;#yulan&quot;</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">attr</span><span class="token punctuation">(</span><span class="token string">&quot;src&quot;</span><span class="token punctuation">,</span> e<span class="token punctuation">.</span>target<span class="token punctuation">.</span>result<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div><div class="language-js extra-class"><pre class="language-js"><code><span class="token comment">//点击上传图片,触发真正上传按钮被点击事件</span>
<span class="token keyword">function</span> <span class="token function">uploadImg</span><span class="token punctuation">(</span><span class="token parameter">e</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token comment">// alert(&quot;#file&quot;+$(e).attr(&quot;id&quot;));</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token function">$</span><span class="token punctuation">(</span>e<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">attr</span><span class="token punctuation">(</span><span class="token string">&quot;id&quot;</span><span class="token punctuation">)</span> <span class="token operator">===</span> <span class="token string">&quot;&quot;</span> <span class="token operator">||</span> <span class="token function">$</span><span class="token punctuation">(</span>e<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">attr</span><span class="token punctuation">(</span><span class="token string">&quot;id&quot;</span><span class="token punctuation">)</span> <span class="token operator">==</span> <span class="token keyword">null</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token function">$</span><span class="token punctuation">(</span><span class="token string">&quot;#file&quot;</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">click</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
        i <span class="token operator">=</span> <span class="token function">$</span><span class="token punctuation">(</span>e<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">attr</span><span class="token punctuation">(</span><span class="token string">&quot;id&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>       <span class="token comment">// e.target表示被点击的目标</span>
        id <span class="token operator">=</span> <span class="token string">&quot;#file&quot;</span><span class="token operator">+</span>i<span class="token punctuation">;</span>
        <span class="token function">$</span><span class="token punctuation">(</span>id<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">click</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div></li> <li><p>然后在detailPara的最后一定要加上<code>$para['upload'] = 'upload'</code></p> <div class="language-php extra-class"><pre class="language-php"><code><span class="token variable">$para</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'tr'</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token keyword">array</span><span class="token punctuation">(</span>
            <span class="token keyword">array</span><span class="token punctuation">(</span>
                <span class="token string double-quoted-string">&quot;商品类型：&quot;</span> <span class="token operator">=&gt;</span> <span class="token variable">$type</span><span class="token punctuation">,</span>
                must<span class="token operator">.</span><span class="token string double-quoted-string">&quot;商品名称：&quot;</span> <span class="token operator">=&gt;</span> <span class="token variable">$commodityName</span><span class="token punctuation">,</span>
            <span class="token punctuation">)</span><span class="token punctuation">,</span>
            <span class="token keyword">array</span><span class="token punctuation">(</span>
                <span class="token string double-quoted-string">&quot;商品状态：&quot;</span> <span class="token operator">=&gt;</span> <span class="token function">select</span><span class="token punctuation">(</span><span class="token keyword">array</span><span class="token punctuation">(</span><span class="token string double-quoted-string">&quot;name&quot;</span> <span class="token operator">=&gt;</span> <span class="token string double-quoted-string">&quot;workFlow&quot;</span><span class="token punctuation">,</span>
                    <span class="token string double-quoted-string">&quot;title&quot;</span> <span class="token operator">=&gt;</span> <span class="token string double-quoted-string">&quot;商品状态&quot;</span><span class="token punctuation">,</span>
                    <span class="token string double-quoted-string">&quot;value&quot;</span> <span class="token operator">=&gt;</span> <span class="token variable">$commodity</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'workFlow'</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
                    <span class="token string double-quoted-string">&quot;option&quot;</span> <span class="token operator">=&gt;</span> <span class="token keyword">array</span><span class="token punctuation">(</span><span class="token string double-quoted-string">&quot;上架&quot;</span><span class="token punctuation">,</span><span class="token string double-quoted-string">&quot;下架&quot;</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">,</span>

                must<span class="token operator">.</span><span class="token string double-quoted-string">&quot;单价：&quot;</span> <span class="token operator">=&gt;</span> <span class="token function">text</span><span class="token punctuation">(</span><span class="token keyword">array</span><span class="token punctuation">(</span><span class="token string double-quoted-string">&quot;name&quot;</span> <span class="token operator">=&gt;</span> <span class="token string double-quoted-string">&quot;price&quot;</span><span class="token punctuation">,</span><span class="token string double-quoted-string">&quot;value&quot;</span> <span class="token operator">=&gt;</span> <span class="token variable">$commodity</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'price'</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
            <span class="token punctuation">)</span><span class="token punctuation">,</span>
            <span class="token keyword">array</span><span class="token punctuation">(</span>
                must<span class="token operator">.</span><span class="token string double-quoted-string">&quot;伯爵币：&quot;</span> <span class="token operator">=&gt;</span> <span class="token function">text</span><span class="token punctuation">(</span><span class="token keyword">array</span><span class="token punctuation">(</span><span class="token string double-quoted-string">&quot;name&quot;</span> <span class="token operator">=&gt;</span> <span class="token string double-quoted-string">&quot;earlCoin&quot;</span><span class="token punctuation">,</span><span class="token string double-quoted-string">&quot;value&quot;</span> <span class="token operator">=&gt;</span> <span class="token variable">$commodity</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'earlCoin'</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
                must<span class="token operator">.</span><span class="token string double-quoted-string">&quot;发行数量：&quot;</span> <span class="token operator">=&gt;</span> <span class="token function">text</span><span class="token punctuation">(</span><span class="token keyword">array</span><span class="token punctuation">(</span><span class="token string double-quoted-string">&quot;name&quot;</span> <span class="token operator">=&gt;</span> <span class="token string double-quoted-string">&quot;publishNum&quot;</span><span class="token punctuation">,</span><span class="token string double-quoted-string">&quot;value&quot;</span> <span class="token operator">=&gt;</span> <span class="token variable">$commodity</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'publishNum'</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
            <span class="token punctuation">)</span><span class="token punctuation">,</span>
            <span class="token keyword">array</span><span class="token punctuation">(</span>
                <span class="token string double-quoted-string">&quot;商品描述：&quot;</span> <span class="token operator">=&gt;</span> <span class="token function">textarea</span><span class="token punctuation">(</span><span class="token keyword">array</span><span class="token punctuation">(</span><span class="token string double-quoted-string">&quot;name&quot;</span> <span class="token operator">=&gt;</span> <span class="token string double-quoted-string">&quot;description&quot;</span><span class="token punctuation">,</span><span class="token string double-quoted-string">&quot;value&quot;</span> <span class="token operator">=&gt;</span> <span class="token variable">$commodity</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'description'</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
            <span class="token punctuation">)</span><span class="token punctuation">,</span>
            <span class="token keyword">array</span><span class="token punctuation">(</span>
              <span class="token string double-quoted-string">&quot; &quot;</span> <span class="token operator">=&gt;</span> <span class="token variable">$webPage</span><span class="token punctuation">,</span>
            <span class="token punctuation">)</span><span class="token punctuation">,</span>
            <span class="token keyword">array</span><span class="token punctuation">(</span><span class="token string double-quoted-string">&quot;图片配置&quot;</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
            <span class="token keyword">array</span><span class="token punctuation">(</span>
                <span class="token string double-quoted-string">&quot; &quot;</span> <span class="token operator">=&gt;</span> <span class="token variable">$html</span><span class="token punctuation">,</span>
            <span class="token punctuation">)</span>
        <span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token variable">$para</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'upload'</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token string double-quoted-string">&quot;upload&quot;</span><span class="token punctuation">;</span>
</code></pre></div></li> <li><p>因为在<code>detail</code>中做了相应的判断,普通的详情页提交按钮,是不能提交上传文件的,我们重写了一个方法,做了一个新的标签,在需要提交上传文件的情况下替换掉相关的按钮.</p> <div class="language-php extra-class"><pre class="language-php"><code><span class="token comment">/****基本资料新增和修改页面*************************************************/</span>
    <span class="token keyword">public</span> <span class="token keyword">function</span> <span class="token function-definition function">table</span><span class="token punctuation">(</span><span class="token variable">$para</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
        <span class="token comment">//如果有表单</span>
        <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token function">count</span><span class="token punctuation">(</span><span class="token variable">$para</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'tr'</span><span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token operator">&gt;</span> <span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
            <span class="token comment">//表单提交</span>
            <span class="token comment">//在这里做判断,某种情况下改变这里的$sub,让其不再引用subForm方法,而是使用自定义的js方法</span>
            <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token keyword">empty</span><span class="token punctuation">(</span><span class="token variable">$para</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'sub'</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
                <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token operator">!</span><span class="token keyword">empty</span><span class="token punctuation">(</span><span class="token variable">$para</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'upload'</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
                    <span class="token comment">//这里就是上传图片的新增详情页面自定义js方法的提交按钮</span>
                    <span class="token variable">$sub</span> <span class="token operator">=</span> <span class="token string double-quoted-string">&quot;upForm('&quot;</span><span class="token operator">.</span><span class="token variable">$para</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'type'</span><span class="token punctuation">]</span><span class="token operator">.</span><span class="token string double-quoted-string">&quot;Form',root+'control/data.php?type=&quot;</span><span class="token operator">.</span><span class="token variable">$para</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'type'</span><span class="token punctuation">]</span><span class="token operator">.</span><span class="token string double-quoted-string">&quot;Edit')&quot;</span><span class="token punctuation">;</span><span class="token comment">//upForm就是我们重写的</span>
                <span class="token punctuation">}</span><span class="token keyword">else</span><span class="token punctuation">{</span>
                    <span class="token variable">$sub</span> <span class="token operator">=</span> <span class="token string double-quoted-string">&quot;subForm('&quot;</span><span class="token operator">.</span><span class="token variable">$para</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'type'</span><span class="token punctuation">]</span><span class="token operator">.</span><span class="token string double-quoted-string">&quot;Form',root+'control/data.php?type=&quot;</span><span class="token operator">.</span><span class="token variable">$para</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'type'</span><span class="token punctuation">]</span><span class="token operator">.</span><span class="token string double-quoted-string">&quot;Edit')&quot;</span><span class="token punctuation">;</span>
                <span class="token punctuation">}</span>
            <span class="token punctuation">}</span><span class="token keyword">else</span><span class="token punctuation">{</span>
                <span class="token variable">$sub</span> <span class="token operator">=</span> <span class="token variable">$para</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'sub'</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span>
            <span class="token comment">//生成表单</span>
            <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token variable">$para</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'type'</span><span class="token punctuation">]</span><span class="token operator">==</span><span class="token string double-quoted-string">&quot;adRoom&quot;</span><span class="token punctuation">)</span><span class="token punctuation">{</span>  <span class="token comment">//如果是组队管理这个状态,就不生成button</span>
                <span class="token variable">$form</span> <span class="token operator">=</span> <span class="token string double-quoted-string">&quot;
			&lt;form name='&quot;</span><span class="token operator">.</span><span class="token variable">$para</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'type'</span><span class="token punctuation">]</span><span class="token operator">.</span><span class="token string double-quoted-string">&quot;Form'&gt;
				&quot;</span><span class="token operator">.</span><span class="token function">tableEdit</span><span class="token punctuation">(</span><span class="token variable">$para</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'tr'</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token operator">.</span><span class="token string double-quoted-string">&quot;
				&lt;input name='id' type='hidden' value='&quot;</span><span class="token operator">.</span><span class="token variable">$para</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'id'</span><span class="token punctuation">]</span><span class="token operator">.</span><span class="token string double-quoted-string">&quot;'&gt;
			&lt;/form&gt;
			&quot;</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span><span class="token keyword">else</span><span class="token punctuation">{</span>  <span class="token comment">//否则就生成button</span>
                <span class="token variable">$form</span> <span class="token operator">=</span> <span class="token string double-quoted-string">&quot;
			&lt;form name='&quot;</span><span class="token operator">.</span><span class="token variable">$para</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'type'</span><span class="token punctuation">]</span><span class="token operator">.</span><span class="token string double-quoted-string">&quot;Form'&gt;
				&quot;</span><span class="token operator">.</span><span class="token function">tableEdit</span><span class="token punctuation">(</span><span class="token variable">$para</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'tr'</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token operator">.</span><span class="token string double-quoted-string">&quot;
				&lt;input name='id' type='hidden' value='&quot;</span><span class="token operator">.</span><span class="token variable">$para</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'id'</span><span class="token punctuation">]</span><span class="token operator">.</span><span class="token string double-quoted-string">&quot;'&gt;
				&lt;div onclick=\&quot;&quot;</span><span class="token operator">.</span><span class="token variable">$sub</span><span class="token operator">.</span><span class="token string double-quoted-string">&quot;\&quot; class='formButton'&gt;&quot;</span><span class="token operator">.</span><span class="token variable">$para</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'button'</span><span class="token punctuation">]</span><span class="token operator">.</span><span class="token string double-quoted-string">&quot;&lt;/div&gt;
			&lt;/form&gt;
			&quot;</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span>


        <span class="token punctuation">}</span>
        <span class="token comment">//生成页卡</span>
        <span class="token variable">$html</span> <span class="token operator">=</span> <span class="token string double-quoted-string">&quot;
		&lt;div class='pageDiv' pageDiv='edit'&gt;
			&quot;</span><span class="token operator">.</span><span class="token variable">$form</span><span class="token operator">.</span><span class="token variable">$para</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'other'</span><span class="token punctuation">]</span><span class="token operator">.</span><span class="token string double-quoted-string">&quot;
		&lt;/div&gt;&quot;</span><span class="token punctuation">;</span>
        <span class="token comment">//返回</span>
        <span class="token keyword">return</span> <span class="token variable">$html</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
</code></pre></div><div class="language-js extra-class"><pre class="language-js"><code><span class="token comment">/********异步提交函数**************************/</span>
<span class="token comment">//图片上传版本js</span>
<span class="token keyword">function</span> <span class="token function">upForm</span><span class="token punctuation">(</span><span class="token parameter">form<span class="token punctuation">,</span>url</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
    <span class="token comment">// alert(form);</span>
    <span class="token comment">//防止高频点击</span>
    <span class="token keyword">var</span> date <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Date</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">var</span> time <span class="token operator">=</span> date<span class="token punctuation">.</span><span class="token function">getTime</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">//毫秒时间戳</span>
    <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token keyword">typeof</span> minTime <span class="token operator">==</span> <span class="token string">&quot;undefined&quot;</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
        <span class="token keyword">var</span> finger <span class="token operator">=</span> <span class="token number">2</span><span class="token punctuation">;</span>
        minTime <span class="token operator">=</span> time<span class="token operator">+</span><span class="token number">2000</span><span class="token punctuation">;</span><span class="token comment">//下次点击的最小时间</span>
        console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">&quot;定义minTime&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span><span class="token keyword">else</span><span class="token punctuation">{</span>
        <span class="token keyword">if</span><span class="token punctuation">(</span>minTime <span class="token operator">&amp;&amp;</span> time <span class="token operator">&lt;</span> minTime<span class="token punctuation">)</span><span class="token punctuation">{</span>
            <span class="token keyword">var</span> finger <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">;</span>
            <span class="token function">warn</span><span class="token punctuation">(</span><span class="token string">&quot;操作过于频繁&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">&quot;time:&quot;</span><span class="token operator">+</span>time<span class="token operator">+</span><span class="token string">&quot;，mintime:&quot;</span><span class="token operator">+</span>minTime<span class="token operator">+</span><span class="token string">&quot;，差额：&quot;</span><span class="token operator">+</span><span class="token punctuation">(</span>time<span class="token operator">-</span>minTime<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span><span class="token keyword">else</span><span class="token punctuation">{</span>
            <span class="token keyword">var</span> finger <span class="token operator">=</span> <span class="token number">2</span><span class="token punctuation">;</span>
            console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">&quot;time:&quot;</span><span class="token operator">+</span>time<span class="token operator">+</span><span class="token string">&quot;，mintime:&quot;</span><span class="token operator">+</span>minTime<span class="token operator">+</span><span class="token string">&quot;，多出：&quot;</span><span class="token operator">+</span><span class="token punctuation">(</span>time<span class="token operator">-</span>minTime<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            minTime <span class="token operator">=</span> time<span class="token operator">+</span><span class="token number">2000</span><span class="token punctuation">;</span><span class="token comment">//下次点击的最小时间</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
    <span class="token keyword">if</span><span class="token punctuation">(</span>finger <span class="token operator">==</span> <span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
        <span class="token function">$</span><span class="token punctuation">(</span><span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
            <span class="token keyword">var</span> formData <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">FormData</span><span class="token punctuation">(</span><span class="token function">$</span><span class="token punctuation">(</span><span class="token string">&quot;[name='&quot;</span><span class="token operator">+</span>form<span class="token operator">+</span><span class="token string">&quot;']&quot;</span><span class="token punctuation">)</span><span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>formData<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token string">'file'</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            $<span class="token punctuation">.</span><span class="token function">ajax</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
                <span class="token literal-property property">url</span><span class="token operator">:</span> url<span class="token punctuation">,</span>
                <span class="token literal-property property">type</span><span class="token operator">:</span> <span class="token string">'POST'</span><span class="token punctuation">,</span>
                <span class="token literal-property property">cache</span><span class="token operator">:</span> <span class="token boolean">false</span><span class="token punctuation">,</span>
                <span class="token literal-property property">data</span><span class="token operator">:</span> formData<span class="token punctuation">,</span>
                <span class="token comment">// 告诉jQuery不要去处理发送的数据</span>
                <span class="token literal-property property">processData</span><span class="token operator">:</span> <span class="token boolean">false</span><span class="token punctuation">,</span>
                <span class="token comment">// 告诉jQuery不要去设置Content-Type请求头</span>
                <span class="token literal-property property">contentType</span><span class="token operator">:</span> <span class="token boolean">false</span><span class="token punctuation">,</span>
                <span class="token function-variable function">beforeSend</span><span class="token operator">:</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
                    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">&quot;正在进行，请稍候&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token punctuation">}</span><span class="token punctuation">,</span>
                <span class="token function-variable function">success</span><span class="token operator">:</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token parameter">res</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
                    <span class="token keyword">var</span> data <span class="token operator">=</span> <span class="token constant">JSON</span><span class="token punctuation">.</span><span class="token function">parse</span><span class="token punctuation">(</span>res<span class="token punctuation">)</span><span class="token punctuation">;</span>
                    <span class="token keyword">if</span> <span class="token punctuation">(</span>data<span class="token punctuation">.</span>warn <span class="token operator">==</span> <span class="token number">2</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
                        <span class="token keyword">if</span> <span class="token punctuation">(</span>data<span class="token punctuation">.</span>href<span class="token punctuation">)</span> <span class="token punctuation">{</span><span class="token comment">//如果异步返回的json参数中定义了重定向url，则跳转到本url</span>
                            window<span class="token punctuation">.</span>location<span class="token punctuation">.</span>href <span class="token operator">=</span> data<span class="token punctuation">.</span>href<span class="token punctuation">;</span>
                        <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
                            window<span class="token punctuation">.</span>location<span class="token punctuation">.</span><span class="token function">reload</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                        <span class="token punctuation">}</span>
                    <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
                        <span class="token function">warn</span><span class="token punctuation">(</span>data<span class="token punctuation">.</span>warn<span class="token punctuation">)</span><span class="token punctuation">;</span>
                    <span class="token punctuation">}</span>
                <span class="token punctuation">}</span><span class="token punctuation">,</span>
                <span class="token function-variable function">error</span><span class="token operator">:</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token parameter">responseStr</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
                    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">&quot;error&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token punctuation">}</span>
            <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token punctuation">}</span><span class="token punctuation">)</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

</code></pre></div></li></ul> <h2 id="富文本编辑器"><a href="#富文本编辑器" class="header-anchor">#</a> 富文本编辑器</h2> <ul><li><p>如果你要在网页中插入一个文本编辑器,可以插图片那种,这里目前在做的项目用的是<code>wangeditor</code>.</p></li> <li><p>项目中是要往一个分支页中写编辑器,那就在Class文件中的tab方法里(因为这是第二个分支)写好页面,然后return这个页面.</p> <div class="language-javascript extra-class"><pre class="language-javascript"><code><span class="token keyword">public</span> <span class="token keyword">function</span> <span class="token function">tab</span><span class="token punctuation">(</span><span class="token parameter">$data</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
        $themeId <span class="token operator">=</span> $data<span class="token punctuation">[</span><span class="token string">'post'</span><span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token string">'id'</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
        $theme <span class="token operator">=</span> <span class="token function">query</span><span class="token punctuation">(</span><span class="token string">&quot;theme&quot;</span><span class="token punctuation">,</span><span class="token string">&quot;id = $themeId&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        $webPage <span class="token operator">=</span> &quot;
                    <span class="token operator">&lt;</span>form name<span class="token operator">=</span><span class="token string">'wangEditorForm'</span><span class="token operator">&gt;</span>
                    <span class="token operator">&lt;</span>div id<span class="token operator">=</span>\&quot;editor\&quot;<span class="token operator">&gt;</span>
                       
                    <span class="token operator">&lt;</span><span class="token operator">/</span>div<span class="token operator">&gt;</span>
                    <span class="token operator">&lt;</span>textarea id<span class="token operator">=</span>\&quot;text1\&quot; name<span class="token operator">=</span><span class="token string">'imageText'</span> style<span class="token operator">=</span>\&quot;display<span class="token operator">:</span>none<span class="token punctuation">;</span>width<span class="token operator">:</span><span class="token number">100</span><span class="token operator">%</span><span class="token punctuation">;</span> height<span class="token operator">:</span>200px<span class="token punctuation">;</span>\&quot;<span class="token operator">&gt;</span><span class="token operator">&lt;</span><span class="token operator">/</span>textarea<span class="token operator">&gt;</span>
                    <span class="token operator">&lt;</span>input name<span class="token operator">=</span><span class="token string">'themeId'</span> value<span class="token operator">=</span><span class="token string">'$themeId'</span> style<span class="token operator">=</span><span class="token string">'display: none'</span> <span class="token operator">/</span><span class="token operator">&gt;</span>
                    <span class="token operator">&lt;</span>div onclick<span class="token operator">=</span>\&quot;<span class="token function">subForm</span><span class="token punctuation">(</span><span class="token string">'wangEditorForm'</span><span class="token punctuation">,</span>root<span class="token operator">+</span><span class="token string">'control/data.php?type=adThemeStrategy'</span><span class="token punctuation">)</span>\&quot; <span class="token keyword">class</span><span class="token operator">=</span>\&quot;formButton\&quot;<span class="token operator">&gt;</span>提交<span class="token operator">&lt;</span><span class="token operator">/</span>div<span class="token operator">&gt;</span>
                    <span class="token operator">&lt;</span><span class="token operator">/</span>form<span class="token operator">&gt;</span>
                    <span class="token operator">&lt;</span><span class="token operator">!</span><span class="token operator">--</span> 注意， 只需要引用 <span class="token constant">JS</span>，无需引用任何 <span class="token constant">CSS</span> ！！！<span class="token operator">--</span><span class="token operator">&gt;</span>
                    <span class="token operator">&lt;</span>script type<span class="token operator">=</span>\<span class="token string">&quot;text/javascript\&quot; src=\&quot;&quot;</span><span class="token punctuation">.</span>root<span class="token punctuation">.</span>&quot;control<span class="token operator">/</span>wangEditor<span class="token punctuation">.</span>min<span class="token punctuation">.</span>js\&quot;<span class="token operator">&gt;</span><span class="token operator">&lt;</span><span class="token operator">/</span>script<span class="token operator">&gt;</span>
                    <span class="token operator">&lt;</span>script type<span class="token operator">=</span>\&quot;text<span class="token operator">/</span>javascript\&quot;<span class="token operator">&gt;</span>
                        <span class="token keyword">var</span> <span class="token constant">E</span> <span class="token operator">=</span> window<span class="token punctuation">.</span>wangEditor
                        <span class="token keyword">var</span> editor <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">E</span><span class="token punctuation">(</span><span class="token string">'#editor'</span><span class="token punctuation">)</span>
                        <span class="token keyword">var</span> text1 <span class="token operator">=</span> <span class="token function">$</span><span class="token punctuation">(</span><span class="token string">'#text1'</span><span class="token punctuation">)</span>
                        editor<span class="token punctuation">.</span>customConfig<span class="token punctuation">.</span><span class="token function-variable function">onchange</span> <span class="token operator">=</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token parameter">html</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
                            <span class="token comment">// 监控变化，同步更新到 textarea</span>
                            text1<span class="token punctuation">.</span><span class="token function">val</span><span class="token punctuation">(</span>html<span class="token punctuation">)</span>
                        <span class="token punctuation">}</span>
                        <span class="token comment">// 或者 var editor = new E( document.getElementById('editor') )</span>
                        <span class="token comment">// 配置服务器端地址</span>
                        editor<span class="token punctuation">.</span>customConfig<span class="token punctuation">.</span>uploadImgServer <span class="token operator">=</span> <span class="token string">'/upload'</span>
                        <span class="token comment">// 配置服务器端地址</span>
                        editor<span class="token punctuation">.</span>customConfig<span class="token punctuation">.</span><span class="token function-variable function">customUploadImg</span> <span class="token operator">=</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token parameter">files<span class="token punctuation">,</span> insert</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
                            <span class="token comment">// files 是 input 中选中的文件列表</span>
                            <span class="token comment">// insert 是获取图片 url 后，插入到编辑器的方法</span>
                            <span class="token keyword">var</span> formData <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">FormData</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                            <span class="token keyword">for</span><span class="token punctuation">(</span><span class="token keyword">var</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>i<span class="token operator">&lt;</span>files<span class="token punctuation">.</span>length<span class="token punctuation">;</span>i<span class="token operator">++</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
                                formData<span class="token punctuation">.</span><span class="token function">append</span><span class="token punctuation">(</span>\&quot;upfile<span class="token punctuation">[</span><span class="token punctuation">]</span>\&quot;<span class="token punctuation">,</span> files<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                            <span class="token punctuation">}</span>
                            $<span class="token punctuation">.</span><span class="token function">ajax</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
                                <span class="token literal-property property">url</span><span class="token operator">:</span> root<span class="token operator">+</span>\&quot;control<span class="token operator">/</span>data<span class="token punctuation">.</span>php<span class="token operator">?</span>type<span class="token operator">=</span>createDir\&quot;<span class="token punctuation">,</span>
                                <span class="token literal-property property">type</span><span class="token operator">:</span> \&quot;<span class="token constant">POST</span>\&quot;<span class="token punctuation">,</span>
                                <span class="token literal-property property">data</span><span class="token operator">:</span>formData<span class="token punctuation">,</span>
                                <span class="token literal-property property">cache</span><span class="token operator">:</span><span class="token boolean">false</span><span class="token punctuation">,</span>         <span class="token comment">//不设置缓存</span>
                                <span class="token literal-property property">processData</span><span class="token operator">:</span> <span class="token boolean">false</span><span class="token punctuation">,</span>  <span class="token comment">// 不处理数据</span>
                                <span class="token literal-property property">contentType</span><span class="token operator">:</span> <span class="token boolean">false</span><span class="token punctuation">,</span>   <span class="token comment">// 不设置内容类型</span>
                                <span class="token function-variable function">success</span><span class="token operator">:</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token parameter">res</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
                                    <span class="token keyword">var</span> data <span class="token operator">=</span> <span class="token constant">JSON</span><span class="token punctuation">.</span><span class="token function">parse</span><span class="token punctuation">(</span>res<span class="token punctuation">)</span><span class="token punctuation">;</span>
                                    <span class="token comment">// 上传代码返回结果之后，将图片插入到编辑器中</span>
                                    $<span class="token punctuation">.</span><span class="token function">each</span><span class="token punctuation">(</span>data<span class="token punctuation">.</span>imgUrl<span class="token punctuation">,</span><span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">index<span class="token punctuation">,</span>value</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
                                        <span class="token function">insert</span><span class="token punctuation">(</span>value<span class="token punctuation">)</span>
                                    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                                <span class="token punctuation">}</span><span class="token punctuation">,</span>
                                <span class="token function-variable function">error</span><span class="token operator">:</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token parameter">responseStr</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
                                    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>\&quot;error\&quot;<span class="token punctuation">)</span><span class="token punctuation">;</span>
                                <span class="token punctuation">}</span>
                            <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                        <span class="token punctuation">}</span>
                        editor<span class="token punctuation">.</span><span class="token function">create</span><span class="token punctuation">(</span><span class="token punctuation">)</span>           <span class="token comment">//创建文本编辑器</span>
                        editor<span class="token punctuation">.</span>txt<span class="token punctuation">.</span><span class="token function">html</span><span class="token punctuation">(</span><span class="token string">'{$theme['</span>imageText<span class="token string">']}'</span><span class="token punctuation">)</span>  <span class="token comment">//回显编辑器输入提交的内容</span>
                        <span class="token comment">// 初始化 textarea 的值</span>
                        text1<span class="token punctuation">.</span><span class="token function">val</span><span class="token punctuation">(</span>editor<span class="token punctuation">.</span>txt<span class="token punctuation">.</span><span class="token function">html</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
                    <span class="token operator">&lt;</span><span class="token operator">/</span>script<span class="token operator">&gt;</span>
                    <span class="token operator">&lt;</span><span class="token operator">/</span>html<span class="token operator">&gt;</span>
                    &quot;<span class="token punctuation">;</span>
        <span class="token keyword">return</span> $webPage<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
</code></pre></div><ul><li>数据处理的方法写在类中,在<code>data.php</code>注册.</li></ul> <div class="language-php extra-class"><pre class="language-php"><code><span class="token comment">/*******主题管理-主题管理-列表详情-攻略图文设置-异步处理******************************
     * $data = array(
     * &quot;post&quot; =&gt; &quot;以post形式提交的参数&quot;,
     * &quot;control&quot; =&gt; &quot;当前管理员参数&quot;,
     * );
     */</span>
    <span class="token keyword">public</span> <span class="token keyword">function</span> <span class="token function-definition function">adThemeStrategyData</span><span class="token punctuation">(</span><span class="token variable">$data</span><span class="token punctuation">)</span>
    <span class="token punctuation">{</span>

        <span class="token variable">$themeId</span> <span class="token operator">=</span> <span class="token variable">$data</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'post'</span><span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'themeId'</span><span class="token punctuation">]</span><span class="token punctuation">;</span><span class="token comment">//主题id,拿到所有文本编辑器输入的内容存入主题表的对应字段</span>
        <span class="token comment">//同一个主题可能有多个场次</span>
        <span class="token variable">$theme</span> <span class="token operator">=</span> <span class="token function">query</span><span class="token punctuation">(</span><span class="token string double-quoted-string">&quot;theme&quot;</span><span class="token punctuation">,</span><span class="token string double-quoted-string">&quot;id = '<span class="token interpolation"><span class="token variable">$themeId</span></span>'&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">//判断</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span><span class="token function">power</span><span class="token punctuation">(</span><span class="token string double-quoted-string">&quot;adTheme&quot;</span><span class="token punctuation">,</span> <span class="token string double-quoted-string">&quot;editRound&quot;</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token variable">$json</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'warn'</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token string double-quoted-string">&quot;您没有编辑图文攻略的权限&quot;</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span> <span class="token keyword">elseif</span> <span class="token punctuation">(</span><span class="token keyword">empty</span><span class="token punctuation">(</span><span class="token variable">$themeId</span><span class="token punctuation">)</span> <span class="token keyword">or</span> <span class="token variable">$themeId</span> <span class="token operator">==</span> <span class="token string double-quoted-string">&quot;&quot;</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token variable">$json</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'warn'</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token string double-quoted-string">&quot;主题ID为空&quot;</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span> <span class="token keyword">elseif</span> <span class="token punctuation">(</span><span class="token keyword">empty</span><span class="token punctuation">(</span><span class="token variable">$theme</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'id'</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token variable">$json</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'warn'</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token string double-quoted-string">&quot;未找到此主题&quot;</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span><span class="token keyword">elseif</span> <span class="token punctuation">(</span><span class="token keyword">empty</span><span class="token punctuation">(</span><span class="token variable">$data</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'post'</span><span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'imageText'</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token variable">$json</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'warn'</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token string double-quoted-string">&quot;请输入攻略&quot;</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
            <span class="token variable">$imageText</span> <span class="token operator">=</span> <span class="token variable">$data</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'post'</span><span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'imageText'</span><span class="token punctuation">]</span><span class="token punctuation">;</span>  <span class="token comment">//取出编辑器的图文</span>
            <span class="token variable">$text</span> <span class="token operator">=</span> <span class="token function">htmlspecialchars_decode</span><span class="token punctuation">(</span><span class="token variable">$imageText</span><span class="token punctuation">)</span><span class="token punctuation">;</span>  <span class="token comment">//把预定义的 HTML 实体转换为字符。</span>
                <span class="token function">update</span><span class="token punctuation">(</span><span class="token keyword">array</span><span class="token punctuation">(</span>
                    <span class="token string double-quoted-string">&quot;table&quot;</span> <span class="token operator">=&gt;</span> <span class="token string double-quoted-string">&quot;theme&quot;</span><span class="token punctuation">,</span>
                    <span class="token string double-quoted-string">&quot;field&quot;</span> <span class="token operator">=&gt;</span> <span class="token keyword">array</span><span class="token punctuation">(</span>
                        <span class="token string double-quoted-string">&quot;imageText&quot;</span> <span class="token operator">=&gt;</span> <span class="token variable">$text</span><span class="token punctuation">,</span><span class="token comment">//转换之后插入图文攻略</span>
                    <span class="token punctuation">)</span><span class="token punctuation">,</span>
                    <span class="token string double-quoted-string">&quot;where&quot;</span> <span class="token operator">=&gt;</span> <span class="token string double-quoted-string">&quot;id = <span class="token interpolation"><span class="token variable">$themeId</span></span>&quot;</span><span class="token punctuation">,</span>
                <span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token comment">//返回</span>
                <span class="token variable">$json</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'warn'</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token number">2</span><span class="token punctuation">;</span>
                <span class="token variable">$_SESSION</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'warn'</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token string double-quoted-string">&quot;图文攻略更新成功&quot;</span><span class="token punctuation">;</span>
            <span class="token variable">$json</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'href'</span><span class="token punctuation">]</span> <span class="token operator">=</span> root<span class="token operator">.</span><span class="token string double-quoted-string">&quot;control/detail.php?type=adTheme&amp;id=<span class="token interpolation"><span class="token punctuation">{</span><span class="token variable">$themeId</span><span class="token punctuation">}</span></span>&amp;menu=set&quot;</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span>

        <span class="token keyword">return</span> <span class="token variable">$json</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
</code></pre></div></li></ul> <h2 id="表格"><a href="#表格" class="header-anchor">#</a> 表格</h2> <h3 id="写死表格"><a href="#写死表格" class="header-anchor">#</a> 写死表格</h3> <ul><li><p>显示固定的几行列表,就算没数据也展示,点击按钮可以新增对应那行的记录</p></li> <li><p>原来有数据的行点击按钮可以更新记录.</p> <div class="language-php extra-class"><pre class="language-php"><code><span class="token variable">$tr</span><span class="token punctuation">[</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token keyword">array</span><span class="token punctuation">(</span><span class="token string double-quoted-string">&quot;会员等级&quot;</span><span class="token punctuation">,</span><span class="token string double-quoted-string">&quot;会员升级日期&quot;</span><span class="token punctuation">,</span><span class="token string double-quoted-string">&quot;操作&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">//不知道要怎样拿到按钮传过来的id</span>
<span class="token comment">//拿到全局变量中的数据库连接con</span>
<span class="token comment">//用get拿到id</span>
<span class="token variable">$userPointLevels</span> <span class="token operator">=</span> <span class="token function">sqlQueryAll</span><span class="token punctuation">(</span><span class="token string double-quoted-string">&quot;select * from userPointLevel order by lowestPoint&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token variable">$updateRecords</span> <span class="token operator">=</span> <span class="token function">sqlQueryAll</span><span class="token punctuation">(</span><span class="token string double-quoted-string">&quot;select up.id,up.level,us.levelName,up.upgradeTime from updateRecord as up 
                                  left join userPointLevel as us on us.id = up.level 
                                  where up.khid = '<span class="token interpolation"><span class="token punctuation">{</span><span class="token variable">$kehu</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'khid'</span><span class="token punctuation">]</span><span class="token punctuation">}</span></span>'
                                   order by us.lowestPoint
                                  &quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token keyword">foreach</span> <span class="token punctuation">(</span><span class="token variable">$userPointLevels</span> <span class="token keyword">as</span> <span class="token variable">$userPointLevel</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
    <span class="token variable">$upl</span><span class="token punctuation">[</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token variable">$userPointLevel</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'id'</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
<span class="token variable">$userPointLevelNum</span> <span class="token operator">=</span> <span class="token function">sqlNum</span><span class="token punctuation">(</span><span class="token string double-quoted-string">&quot;userPointLevel&quot;</span><span class="token punctuation">,</span><span class="token string double-quoted-string">&quot;1 = 1&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token variable">$x</span><span class="token operator">=</span><span class="token number">0</span><span class="token punctuation">;</span><span class="token variable">$x</span><span class="token operator">&lt;</span><span class="token variable">$userPointLevelNum</span><span class="token punctuation">;</span><span class="token variable">$x</span><span class="token operator">++</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
    <span class="token variable">$userId</span><span class="token punctuation">[</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token variable">$userPointLevels</span><span class="token punctuation">[</span><span class="token variable">$x</span><span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'id'</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
    <span class="token variable">$upgradeLevel</span><span class="token punctuation">[</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token variable">$updateRecords</span><span class="token punctuation">[</span><span class="token variable">$x</span><span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'level'</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token function">in_array</span><span class="token punctuation">(</span><span class="token variable">$updateRecords</span><span class="token punctuation">[</span><span class="token variable">$x</span><span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'level'</span><span class="token punctuation">]</span><span class="token punctuation">,</span><span class="token variable">$upl</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token variable">$mx</span> <span class="token operator">=</span> <span class="token string double-quoted-string">&quot;&lt;span onclick=\&quot;layer('editRecord',{'id':'<span class="token interpolation"><span class="token punctuation">{</span><span class="token variable">$updateRecords</span><span class="token punctuation">[</span><span class="token variable">$x</span><span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'id'</span><span class="token punctuation">]</span><span class="token punctuation">}</span></span>','khid':'<span class="token interpolation"><span class="token punctuation">{</span><span class="token variable">$kehu</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'khid'</span><span class="token punctuation">]</span><span class="token punctuation">}</span></span>','levelId':'<span class="token interpolation"><span class="token punctuation">{</span><span class="token variable">$userPointLevels</span><span class="token punctuation">[</span><span class="token variable">$x</span><span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'id'</span><span class="token punctuation">]</span><span class="token punctuation">}</span></span>'})\&quot; class='spanButton'&gt;修改日期&lt;/span&gt;\n&quot;</span><span class="token punctuation">;</span>
        <span class="token variable">$tr</span><span class="token punctuation">[</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token keyword">array</span><span class="token punctuation">(</span><span class="token variable">$updateRecords</span><span class="token punctuation">[</span><span class="token variable">$x</span><span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'levelName'</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token variable">$updateRecords</span><span class="token punctuation">[</span><span class="token variable">$x</span><span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'upgradeTime'</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token variable">$mx</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
        <span class="token variable">$id</span> <span class="token operator">=</span> <span class="token function">suiji</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token variable">$mx</span> <span class="token operator">=</span> <span class="token string double-quoted-string">&quot;&lt;span onclick=\&quot;layer('editRecord',{'id':'<span class="token interpolation"><span class="token variable">$id</span></span>','khid':'<span class="token interpolation"><span class="token punctuation">{</span><span class="token variable">$kehu</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'khid'</span><span class="token punctuation">]</span><span class="token punctuation">}</span></span>','levelId':'<span class="token interpolation"><span class="token punctuation">{</span><span class="token variable">$userPointLevels</span><span class="token punctuation">[</span><span class="token variable">$x</span><span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'id'</span><span class="token punctuation">]</span><span class="token punctuation">}</span></span>'})\&quot; class='spanButton'&gt;修改日期&lt;/span&gt;\n&quot;</span><span class="token punctuation">;</span>
        <span class="token variable">$tr</span><span class="token punctuation">[</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token keyword">array</span><span class="token punctuation">(</span><span class="token variable">$userPointLevels</span><span class="token punctuation">[</span><span class="token variable">$x</span><span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'levelName'</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token string single-quoted-string">''</span><span class="token punctuation">,</span> <span class="token variable">$mx</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>



<span class="token comment">//在这里也拼接一个隐藏的input标签,携带主题id过去,让我们在删除的异步方法里可以拿得到</span>
<span class="token comment">//这个$html就是我们主题管理列表详情的场次表格,放到下面的array(&quot;场次信息&quot;)之下</span>
<span class="token comment">//因为是插入的表格所以样式不规范,很难看,插入一个style改变样式即可</span>
<span class="token variable">$html</span> <span class="token operator">=</span> space<span class="token operator">.</span><span class="token string double-quoted-string">&quot;&lt;style&gt;.tableMany td{background-color: white!important;
    text-align: center!important;}.tableMany tr:hover {color: #555!important;}&lt;/style&gt;&quot;</span><span class="token operator">.</span> <span class="token function">tableMany</span><span class="token punctuation">(</span><span class="token keyword">array</span><span class="token punctuation">(</span><span class="token string double-quoted-string">&quot;tr&quot;</span> <span class="token operator">=&gt;</span> <span class="token variable">$tr</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div></li></ul></div> <footer class="page-edit"><!----> <div class="last-updated"><span class="prefix">Last Updated:</span> <span class="time">9/27/2020, 10:06:51 PM</span></div></footer> <div class="page-nav"><p class="inner"><!----> <span class="next"><a href="/yumu/公司框架/老框架.html">
        老框架
      </a>
      →
    </span></p></div> </main></div><div class="global-ui"></div></div>
    <script src="/assets/js/app.6ef7aeda.js" defer></script><script src="/assets/js/2.716a1f37.js" defer></script><script src="/assets/js/89.286a5312.js" defer></script>
  </body>
</html>
