<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>RabbitMQ入门 | 学而时习之</title>
    <meta name="generator" content="VuePress 1.9.7">
    <link rel="icon" href="/img/qiyu.jpg">
    <meta name="description" content="个人学习博客">
    
    <link rel="preload" href="/assets/css/0.styles.e4d8b86b.css" as="style"><link rel="preload" href="/assets/js/app.6ef7aeda.js" as="script"><link rel="preload" href="/assets/js/2.716a1f37.js" as="script"><link rel="preload" href="/assets/js/49.a7940cc9.js" as="script"><link rel="prefetch" href="/assets/js/10.a4a050d1.js"><link rel="prefetch" href="/assets/js/11.344787d3.js"><link rel="prefetch" href="/assets/js/12.b25f9ccf.js"><link rel="prefetch" href="/assets/js/13.fbdea543.js"><link rel="prefetch" href="/assets/js/14.5fc0584b.js"><link rel="prefetch" href="/assets/js/15.688b7501.js"><link rel="prefetch" href="/assets/js/16.fbd251ee.js"><link rel="prefetch" href="/assets/js/17.6b6b044b.js"><link rel="prefetch" href="/assets/js/18.4da62780.js"><link rel="prefetch" href="/assets/js/19.e76bd09c.js"><link rel="prefetch" href="/assets/js/20.c6c4fad3.js"><link rel="prefetch" href="/assets/js/21.76180caa.js"><link rel="prefetch" href="/assets/js/22.6f1b73fd.js"><link rel="prefetch" href="/assets/js/23.a95962c2.js"><link rel="prefetch" href="/assets/js/24.eee43d5e.js"><link rel="prefetch" href="/assets/js/25.56e05948.js"><link rel="prefetch" href="/assets/js/26.43f2e3ff.js"><link rel="prefetch" href="/assets/js/27.09054ea0.js"><link rel="prefetch" href="/assets/js/28.c4e54eaa.js"><link rel="prefetch" href="/assets/js/29.06c6b4e5.js"><link rel="prefetch" href="/assets/js/3.eaf135e1.js"><link rel="prefetch" href="/assets/js/30.250c7c81.js"><link rel="prefetch" href="/assets/js/31.91b37571.js"><link rel="prefetch" href="/assets/js/32.d2677ff0.js"><link rel="prefetch" href="/assets/js/33.41ead764.js"><link rel="prefetch" href="/assets/js/34.133f8e54.js"><link rel="prefetch" href="/assets/js/35.362db0cb.js"><link rel="prefetch" href="/assets/js/36.db01e9cc.js"><link rel="prefetch" href="/assets/js/37.78fd90d2.js"><link rel="prefetch" href="/assets/js/38.27112b1c.js"><link rel="prefetch" href="/assets/js/39.c077219c.js"><link rel="prefetch" href="/assets/js/4.75ddad43.js"><link rel="prefetch" href="/assets/js/40.c9153258.js"><link rel="prefetch" href="/assets/js/41.c0b0dba4.js"><link rel="prefetch" href="/assets/js/42.787b0675.js"><link rel="prefetch" href="/assets/js/43.35499284.js"><link rel="prefetch" href="/assets/js/44.ea23a009.js"><link rel="prefetch" href="/assets/js/45.e5cd72c6.js"><link rel="prefetch" href="/assets/js/46.f1392760.js"><link rel="prefetch" href="/assets/js/47.1553f24b.js"><link rel="prefetch" href="/assets/js/48.c696d608.js"><link rel="prefetch" href="/assets/js/5.f9f3c101.js"><link rel="prefetch" href="/assets/js/50.e8cadfe4.js"><link rel="prefetch" href="/assets/js/51.080e63aa.js"><link rel="prefetch" href="/assets/js/52.7347d36c.js"><link rel="prefetch" href="/assets/js/53.aba50764.js"><link rel="prefetch" href="/assets/js/54.ca1160dc.js"><link rel="prefetch" href="/assets/js/55.b6574861.js"><link rel="prefetch" href="/assets/js/56.be3c310f.js"><link rel="prefetch" href="/assets/js/57.037820ea.js"><link rel="prefetch" href="/assets/js/58.24474c32.js"><link rel="prefetch" href="/assets/js/59.3b585e3d.js"><link rel="prefetch" href="/assets/js/6.c86d08c0.js"><link rel="prefetch" href="/assets/js/60.75b5bae2.js"><link rel="prefetch" href="/assets/js/61.1831f564.js"><link rel="prefetch" href="/assets/js/62.18a1b459.js"><link rel="prefetch" href="/assets/js/63.346f7f49.js"><link rel="prefetch" href="/assets/js/64.a7683029.js"><link rel="prefetch" href="/assets/js/65.1a938596.js"><link rel="prefetch" href="/assets/js/66.0106ad50.js"><link rel="prefetch" href="/assets/js/67.b0b943da.js"><link rel="prefetch" href="/assets/js/68.60534009.js"><link rel="prefetch" href="/assets/js/69.72e1bfa9.js"><link rel="prefetch" href="/assets/js/7.e0e4b61b.js"><link rel="prefetch" href="/assets/js/70.3a29dfd9.js"><link rel="prefetch" href="/assets/js/71.3e57d5ec.js"><link rel="prefetch" href="/assets/js/72.be56e12f.js"><link rel="prefetch" href="/assets/js/73.b6934116.js"><link rel="prefetch" href="/assets/js/74.81f5b5c3.js"><link rel="prefetch" href="/assets/js/75.e9dacdaf.js"><link rel="prefetch" href="/assets/js/76.7c0855f1.js"><link rel="prefetch" href="/assets/js/77.98a4a794.js"><link rel="prefetch" href="/assets/js/78.3049e29b.js"><link rel="prefetch" href="/assets/js/79.9c741fac.js"><link rel="prefetch" href="/assets/js/8.8c856480.js"><link rel="prefetch" href="/assets/js/80.46cc42c2.js"><link rel="prefetch" href="/assets/js/81.2647d9b6.js"><link rel="prefetch" href="/assets/js/82.0c7a9946.js"><link rel="prefetch" href="/assets/js/83.fa03835c.js"><link rel="prefetch" href="/assets/js/84.909232bc.js"><link rel="prefetch" href="/assets/js/85.7cf12395.js"><link rel="prefetch" href="/assets/js/86.805e61d2.js"><link rel="prefetch" href="/assets/js/87.5ec873ab.js"><link rel="prefetch" href="/assets/js/88.54c3c15b.js"><link rel="prefetch" href="/assets/js/89.286a5312.js"><link rel="prefetch" href="/assets/js/9.6133e2ec.js"><link rel="prefetch" href="/assets/js/90.e91320ce.js"><link rel="prefetch" href="/assets/js/91.932f1454.js">
    <link rel="stylesheet" href="/assets/css/0.styles.e4d8b86b.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container"><header class="navbar"><div class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/" class="home-link router-link-active"><!----> <span class="site-name">学而时习之</span></a> <div class="links"><div class="search-box"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <nav class="nav-links can-hide"><div class="nav-item"><a href="/" class="nav-link">
  主页
</a></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="博文" class="dropdown-title"><span class="title">博文</span> <span class="arrow down"></span></button> <button type="button" aria-label="博文" class="mobile-dropdown-title"><span class="title">博文</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/vuePress/" class="nav-link">
  博客相关知识
</a></li><li class="dropdown-item"><!----> <a href="/javaBasics/" class="nav-link">
  JavaSE基础知识
</a></li><li class="dropdown-item"><!----> <a href="/javaFramework/" class="nav-link">
  Java框架知识
</a></li><li class="dropdown-item"><!----> <a href="/book/" class="nav-link">
  技术书籍
</a></li><li class="dropdown-item"><!----> <a href="/js/" class="nav-link">
  前端
</a></li><li class="dropdown-item"><!----> <a href="/sql/" class="nav-link">
  数据库知识
</a></li><li class="dropdown-item"><!----> <a href="/projectPractice/" class="nav-link">
  项目实战
</a></li><li class="dropdown-item"><!----> <a href="/projectNote/" class="nav-link">
  工作项目积累
</a></li><li class="dropdown-item"><!----> <a href="/faultNote/" class="nav-link">
  记错本
</a></li><li class="dropdown-item"><!----> <a href="/php/" class="nav-link">
  php
</a></li><li class="dropdown-item"><!----> <a href="/linux/" class="nav-link">
  linux学习
</a></li><li class="dropdown-item"><!----> <a href="/git/" class="nav-link">
  git笔记
</a></li><li class="dropdown-item"><!----> <a href="/middleware/" class="nav-link router-link-active">
  中间件
</a></li><li class="dropdown-item"><!----> <a href="/docker/" class="nav-link">
  docker笔记
</a></li><li class="dropdown-item"><!----> <a href="/nginx/" class="nav-link">
  nginx笔记
</a></li><li class="dropdown-item"><!----> <a href="/systemArchitecture/" class="nav-link">
  系统架构
</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="工具网站" class="dropdown-title"><span class="title">工具网站</span> <span class="arrow down"></span></button> <button type="button" aria-label="工具网站" class="mobile-dropdown-title"><span class="title">工具网站</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="https://postimages.org" target="_blank" rel="noopener noreferrer" class="nav-link external">
  postimages图床
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li></ul></div></div> <!----></nav></div></header> <div class="sidebar-mask"></div> <aside class="sidebar"><nav class="nav-links"><div class="nav-item"><a href="/" class="nav-link">
  主页
</a></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="博文" class="dropdown-title"><span class="title">博文</span> <span class="arrow down"></span></button> <button type="button" aria-label="博文" class="mobile-dropdown-title"><span class="title">博文</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/vuePress/" class="nav-link">
  博客相关知识
</a></li><li class="dropdown-item"><!----> <a href="/javaBasics/" class="nav-link">
  JavaSE基础知识
</a></li><li class="dropdown-item"><!----> <a href="/javaFramework/" class="nav-link">
  Java框架知识
</a></li><li class="dropdown-item"><!----> <a href="/book/" class="nav-link">
  技术书籍
</a></li><li class="dropdown-item"><!----> <a href="/js/" class="nav-link">
  前端
</a></li><li class="dropdown-item"><!----> <a href="/sql/" class="nav-link">
  数据库知识
</a></li><li class="dropdown-item"><!----> <a href="/projectPractice/" class="nav-link">
  项目实战
</a></li><li class="dropdown-item"><!----> <a href="/projectNote/" class="nav-link">
  工作项目积累
</a></li><li class="dropdown-item"><!----> <a href="/faultNote/" class="nav-link">
  记错本
</a></li><li class="dropdown-item"><!----> <a href="/php/" class="nav-link">
  php
</a></li><li class="dropdown-item"><!----> <a href="/linux/" class="nav-link">
  linux学习
</a></li><li class="dropdown-item"><!----> <a href="/git/" class="nav-link">
  git笔记
</a></li><li class="dropdown-item"><!----> <a href="/middleware/" class="nav-link router-link-active">
  中间件
</a></li><li class="dropdown-item"><!----> <a href="/docker/" class="nav-link">
  docker笔记
</a></li><li class="dropdown-item"><!----> <a href="/nginx/" class="nav-link">
  nginx笔记
</a></li><li class="dropdown-item"><!----> <a href="/systemArchitecture/" class="nav-link">
  系统架构
</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="工具网站" class="dropdown-title"><span class="title">工具网站</span> <span class="arrow down"></span></button> <button type="button" aria-label="工具网站" class="mobile-dropdown-title"><span class="title">工具网站</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="https://postimages.org" target="_blank" rel="noopener noreferrer" class="nav-link external">
  postimages图床
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li></ul></div></div> <!----></nav>  <ul class="sidebar-links"><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading open"><span>中间件</span> <span class="arrow down"></span></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/middleware/rabbitmq/rabbitmq.html" aria-current="page" class="active sidebar-link">rabbitmq笔记</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/middleware/rabbitmq/rabbitmq.html#核心概念" class="sidebar-link">核心概念</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/middleware/rabbitmq/rabbitmq.html#producer-生产者-和-consumer-消费者" class="sidebar-link">Producer(生产者) 和 Consumer(消费者)</a></li><li class="sidebar-sub-header"><a href="/middleware/rabbitmq/rabbitmq.html#exchange-交换器" class="sidebar-link">Exchange(交换器)</a></li><li class="sidebar-sub-header"><a href="/middleware/rabbitmq/rabbitmq.html#broker-消息中间件的服务节点" class="sidebar-link">Broker（消息中间件的服务节点）</a></li></ul></li><li class="sidebar-sub-header"><a href="/middleware/rabbitmq/rabbitmq.html#安装" class="sidebar-link">安装</a></li><li class="sidebar-sub-header"><a href="/middleware/rabbitmq/rabbitmq.html#使用" class="sidebar-link">使用</a></li></ul></li></ul></section></li></ul> </aside> <main class="page"> <div class="theme-default-content content__default"><h1 id="rabbitmq入门"><a href="#rabbitmq入门" class="header-anchor">#</a> <strong>RabbitMQ入门</strong></h1> <ul><li>刚开始我一直不明白什么是所谓中间件,对MQ的具体定位和概念模糊不清,以为是和Java项目深度绑定的一个东西,类似maven中拉来的某个依赖一样,结果某一天我突然开窍了,明白不是如此</li> <li>MQ这种中间件,顾名思义,是<strong>不依赖任何项目</strong>的<strong>单独组件</strong>,就和Mysql类似的,<strong>独立部署</strong>在那里,不同的项目可以通过这个中间件来交互数据,A项目作为生产者,B项目作为消费者,一个发数据,一个接数据,各司其职</li></ul> <h2 id="核心概念"><a href="#核心概念" class="header-anchor">#</a> 核心概念</h2> <ul><li><code>RabbitMQ</code> 整体上是一个<strong>生产者</strong>与<strong>消费者模型</strong>，主要负责接收、存储和转发消息。可以把消息传递的过程想象成：当你将一个包裹送到邮局，邮局会暂存并最终将邮件通过邮递员送到收件人的手上，<code>RabbitMQ</code>就好比由<strong>邮局</strong>、<strong>邮箱</strong>和<strong>邮递员</strong>组成的一个系统。从计算机术语层面来说，<code>RabbitMQ</code>模型<strong>更像</strong>是一种<strong>交换机模型</strong>。</li></ul> <h3 id="producer-生产者-和-consumer-消费者"><a href="#producer-生产者-和-consumer-消费者" class="header-anchor">#</a> Producer(生产者) 和 Consumer(消费者)</h3> <ul><li><strong>Producer(生产者)</strong> :生产消息的一方（邮件投递者）</li> <li><strong>Consumer(消费者)</strong> :消费消息的一方（邮件收件人）</li> <li>消息一般由 2 部分组成：<strong>消息头</strong>（或者说是标签 Label）和 <strong>消息体</strong>。
<ul><li><strong>消息体</strong>也可以称为 <code>payLoad</code> ,消息体是不透明的.</li> <li>而<strong>消息头</strong>则由一系列的可选属性组成，这些属性包括 <code>routing-key（路由键</code>）、<code>priority（相对于其他消息的优先权）</code>、<code>delivery-mode（指出该消息可能需要持久性存储）</code>等。生产者把消息交由<code>RabbitMQ</code> 后，<code>RabbitMQ</code>会根据消息头把消息发送给感兴趣的 Consumer(消费者)。</li></ul></li></ul> <h3 id="exchange-交换器"><a href="#exchange-交换器" class="header-anchor">#</a> Exchange(交换器)</h3> <ul><li><p>在 <code>RabbitMQ</code> 中，消息并不是直接被投递到 <strong>Queue(消息队列)</strong> 中的，中间还必须经过 <strong>Exchange(交换器)</strong></p></li> <li><p>交换器接收生产者发送的消息,然后路由到服务器的队列中,如果路由不到就返回给生产者或丢弃</p></li></ul> <h4 id="exchange-types-交换器类型"><a href="#exchange-types-交换器类型" class="header-anchor">#</a> Exchange Types(交换器类型)</h4> <ul><li><p>RabbitMQ 常用的 Exchange Type 有 <strong>fanout</strong>、<strong>direct</strong>、<strong>topic</strong>、<strong>headers</strong> 这四种（AMQP规范里还提到两种 Exchange Type，分别为 system 与 自定义，这里不予以描述）。</p> <h5 id="_1-fanout"><a href="#_1-fanout" class="header-anchor">#</a> ① fanout</h5> <p><strong>fanout</strong> 类型的Exchange路由规则非常简单，它会把所有发送到该Exchange的消息路由到所有与它绑定的Queue中，<strong>不需要做任何判断操作</strong>，所以 fanout 类型是所有的交换机类型里面<strong>速度最快</strong>的。fanout 类型常用来<strong>广播消息</strong>。</p> <h5 id="_2-direct"><a href="#_2-direct" class="header-anchor">#</a> ② direct</h5> <p><strong>direct</strong> 类型的Exchange路由规则也很简单，它会把消息路由到那些 <code>Bindingkey</code> 与 <code>outingKey</code> <strong>完全匹配</strong>的 Queue 中。</p> <p><a href="https://camo.githubusercontent.com/74a37d60211f66e4831fc101de1480d56ca0e0e66757f030c228103bb28a903b/687474703a2f2f6d792d626c6f672d746f2d7573652e6f73732d636e2d6265696a696e672e616c6979756e63732e636f6d2f31382d31322d31362f33373030383032312e6a7067" target="_blank" rel="noopener noreferrer"><img src="https://camo.githubusercontent.com/74a37d60211f66e4831fc101de1480d56ca0e0e66757f030c228103bb28a903b/687474703a2f2f6d792d626c6f672d746f2d7573652e6f73732d636e2d6265696a696e672e616c6979756e63732e636f6d2f31382d31322d31362f33373030383032312e6a7067" alt="direct 类型交换器"><span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></p> <p>以上图为例，如果发送消息的时候设置路由键为“warning”,那么消息会路由到 Queue1 和 Queue2。如果在发送消息的时候设置路由键为&quot;Info”或者&quot;debug”，消息只会路由到Queue2。如果以其他的路由键发送消息，则消息不会路由到这两个队列中。</p> <p>direct 类型常用在<strong>处理有优先级的任务</strong>，根据任务的优先级把消息发送到对应的队列，这样可以指派更多的资源去处理高优先级的队列。</p> <h5 id="_3-topic"><a href="#_3-topic" class="header-anchor">#</a> ③ topic</h5> <p>前面讲到direct类型的交换器路由规则是完全匹配 <code>BindingKey</code>和 <code>RoutingKey</code> ，但是这种严格的匹配方式在很多情况下不能满足实际业务的需求。<strong>topic</strong>类型的交换器在匹配规则上进行了扩展，它与 direct 类型的交换器相似，也是将消息路由到 <code>BindingKey</code>和 <code>RoutingKey</code>相匹配的队列中，但这里的匹配规则有些不同,等于是以<strong>特定规则模糊匹配</strong>，它约定：</p> <ul><li>RoutingKey 为一个点号“．”分隔的字符串（被点号“．”分隔开的每一段独立的字符串称为一个单词），如 “com.rabbitmq.client”、“java.util.concurrent”、“com.hidden.client”;</li> <li>BindingKey 和 RoutingKey 一样也是点号“．”分隔的字符串；</li> <li>BindingKey 中可以存在两种特殊字符串“<em>”和“#”，用于做模糊匹配，其中“</em>”用于匹配一个单词，“#”用于匹配多个单词(可以是零个)。</li></ul> <p><a href="https://camo.githubusercontent.com/c678fb21b871686d9c1ae5c196c81877c0e014ac9d354c3f01a3ee716dca3fc5/687474703a2f2f6d792d626c6f672d746f2d7573652e6f73732d636e2d6265696a696e672e616c6979756e63732e636f6d2f31382d31322d31362f37333834332e6a7067" target="_blank" rel="noopener noreferrer"><img src="https://camo.githubusercontent.com/c678fb21b871686d9c1ae5c196c81877c0e014ac9d354c3f01a3ee716dca3fc5/687474703a2f2f6d792d626c6f672d746f2d7573652e6f73732d636e2d6265696a696e672e616c6979756e63732e636f6d2f31382d31322d31362f37333834332e6a7067" alt="topic 类型交换器"><span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></p> <p>以上图为例：</p> <ul><li>路由键为 “com.rabbitmq.client” 的消息会同时路由到 Queuel 和 Queue2;</li> <li>路由键为 “com.hidden.client” 的消息只会路由到 Queue2 中；</li> <li>路由键为 “com.hidden.demo” 的消息只会路由到 Queue2 中；</li> <li>路由键为 “java.rabbitmq.demo” 的消息只会路由到Queuel中；</li> <li>路由键为 “java.util.concurrent” 的消息将会被丢弃或者返回给生产者（需要设置 mandatory 参数），因为它没有匹配任何路由键。</li></ul> <h5 id="_4-headers-不推荐"><a href="#_4-headers-不推荐" class="header-anchor">#</a> ④ headers(不推荐)</h5> <p>headers 类型的交换器不依赖于路由键的匹配规则来路由消息，而是根据发送的消息内容中的 headers 属性进行匹配。在绑定队列和交换器时制定一组键值对，当发送消息到交换器时，RabbitMQ会获取到该消息的 headers（也是一个键值对的形式)'对比其中的键值对是否完全匹配队列和交换器绑定时指定的键值对，如果完全匹配则消息会路由到该队列，否则不会路由到该队列。headers 类型的交换器性能会很差，而且也不实用，基本上不会看到它的存在。</p></li> <li><p>生产者把消息发给交换器的时候会指定一个**RoutingKey(路由键)<strong>来指定该消息的路由规则,这个路由键必须和交换器类型以及</strong>绑定键(BindingKey)**联合使用才能最终生效</p></li> <li><p><strong>可以这样理解:交换器就是个中间人,他拥有自己的类型,由自己的类型去决定该不该将拥有某些路由键的消息接纳进来,然后再根据绑定键(可多个)确定和交换器自己会产生关联的队列,再根据交换器类型决定要怎么分配这些消息到队列中.交换器和队列是多对多的关系</strong></p></li> <li><p><strong>绑定键确定交换器和队列之间的关联关系,是交换器和队列的一个通道桥梁,这个桥梁可以是完整的一个字符串,也可以是一个模糊匹配的规则型字符串,根据交换器的类型不同而决定如何匹配路由键.而路由键则一定是一个完整的字符串,也是根据交换器的类型不同而决定如何匹配绑定键.</strong></p></li> <li><p><strong>一个消息需要先指定交换器,在java中是<code>convertAndSend(exchange, routingKey, message)</code>这个方法指定Exchange、Routing Key以及消息本身。如果找不到对应交换器就会报错,路由键匹配不到也会报错</strong></p></li> <li><p><strong>教程中说到如果路由键匹配不到队列除了报错还可以返回给生产者,这个就需要在Java代码中自己开启了.</strong></p></li></ul> <h3 id="broker-消息中间件的服务节点"><a href="#broker-消息中间件的服务节点" class="header-anchor">#</a> Broker（消息中间件的服务节点）</h3> <ul><li>据观察broker就是交换器+队列</li></ul> <h2 id="安装"><a href="#安装" class="header-anchor">#</a> 安装</h2> <ul><li>windows系统的安装首先需要去<code>erlang</code>官网下载<code>erlang</code></li> <li>但是要注意<code>erlang</code>版本和<code>rabbitmq</code>版本是要严格对应的,不对应会出问题.</li> <li>其实可以先下载<code>rabbitmq</code>的安装程序,安装的时候会告诉你,还没安装<code>erlang</code>是否跳转到<code>erlang</code>官网,你点击是跳进去下载更方便</li> <li>安装好<code>erlang</code>去配置环境变量,配置好之后就可以安装<code>rabbitmq</code></li> <li>安装完成之后这时你打开<code>RabbitService MQ - start</code>,进入它自带的后台管理地址<code>http://localhost:15672</code>.发现进不去</li> <li>需要打开cmd运行<code>rabbitmq-plugins enable rabbitmq_management</code>之后才可以正常打开</li></ul> <h2 id="使用"><a href="#使用" class="header-anchor">#</a> 使用</h2> <ul><li><p>队列的创建是在管理后台手动创建的,交换器也是,然后在交换器的部分,有一个binding也就是路由规则也需要在后台手动编辑</p></li> <li><p>首先需要再pom.xml引入依赖</p> <div class="language-xml extra-class"><pre class="language-xml"><code><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependency</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">&gt;</span></span>org.springframework.boot<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">&gt;</span></span>spring-boot-starter-amqp<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependency</span><span class="token punctuation">&gt;</span></span>
</code></pre></div></li> <li><p>然后在yml文件中配置</p> <div class="language-yml extra-class"><pre class="language-yml"><code><span class="token key atrule">spring</span><span class="token punctuation">:</span>
  <span class="token key atrule">rabbitmq</span><span class="token punctuation">:</span>
    <span class="token key atrule">host</span><span class="token punctuation">:</span> localhost
    <span class="token key atrule">port</span><span class="token punctuation">:</span> <span class="token number">5672</span>
    <span class="token key atrule">username</span><span class="token punctuation">:</span> guest
    <span class="token key atrule">password</span><span class="token punctuation">:</span> guest
</code></pre></div></li> <li><p>启动类中我们需要配置注入<code>MessageConverter</code>对象</p></li> <li><p><code>MessageConverter</code>用于将Java对象转换为RabbitMQ的消息。默认情况下，Spring Boot使用<code>SimpleMessageConverter</code>，只能发送<code>String</code>和<code>byte[]</code>类型的消息，不太方便。使用<code>Jackson2JsonMessageConverter</code>，我们就可以发送JavaBean对象，由Spring Boot自动序列化为JSON并以文本消息传递。</p></li> <li><p>引入starter之后所有rabbitmq的bean自动装配,我们就可以拿到rabbitTemplate.这个对象是使用在生产者模块的.</p></li> <li><p>发送消息时，使用<code>convertAndSend(exchange, routingKey, message)</code>可以指定Exchange、Routing Key以及消息本身。这里传入JavaBean后会自动序列化为JSON文本。上述代码将<code>RegistrationMessage</code>发送到<code>registration</code>，将<code>LoginMessage</code>发送到<code>login</code>，并根据登录是否成功来指定Routing Key。</p> <div class="language-java extra-class"><pre class="language-java"><code><span class="token annotation punctuation">@Component</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">MessagingService</span> <span class="token punctuation">{</span>
    <span class="token annotation punctuation">@Autowired</span>
    <span class="token class-name">RabbitTemplate</span> rabbitTemplate<span class="token punctuation">;</span>

    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">sendRegistrationMessage</span><span class="token punctuation">(</span><span class="token class-name">RegistrationMessage</span> msg<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token comment">//这个方法就是把消息发送到rabbitmq中,也就是找个交换器往里塞</span>
        <span class="token comment">//第一个参数是交换器的名字,第二个是路由键,第三个是我们要传递的消息对象</span>
        <span class="token comment">//路由键可以不指定,消息就会被塞到指定交换器的不需要对应路由键的队列中去</span>
        rabbitTemplate<span class="token punctuation">.</span><span class="token function">convertAndSend</span><span class="token punctuation">(</span><span class="token string">&quot;registration&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;&quot;</span><span class="token punctuation">,</span> msg<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">sendLoginMessage</span><span class="token punctuation">(</span><span class="token class-name">LoginMessage</span> msg<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token class-name">String</span> routingKey <span class="token operator">=</span> msg<span class="token punctuation">.</span>success <span class="token operator">?</span> <span class="token string">&quot;&quot;</span> <span class="token operator">:</span> <span class="token string">&quot;login_failed&quot;</span><span class="token punctuation">;</span>
        rabbitTemplate<span class="token punctuation">.</span><span class="token function">convertAndSend</span><span class="token punctuation">(</span><span class="token string">&quot;login&quot;</span><span class="token punctuation">,</span> routingKey<span class="token punctuation">,</span> msg<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div></li> <li><p>接收消息时在对应的接收方法上使用<code>@RabbitListener</code>注解,属性<code>queues = QUEUE_MAIL</code>等于号后面是队列的名字,然后在方法里写这个队列接收到消息时的处理业务</p></li> <li><p>直接指定一个Queue并投递消息也是可以的，此时指定Routing Key为Queue的名称即可，因为RabbitMQ提供了一个<code>default exchange</code>用于根据Routing Key查找Queue并直接投递消息到指定的Queue。但是要实现一对多的投递就必须自己配置Exchange。</p></li></ul></div> <footer class="page-edit"><!----> <div class="last-updated"><span class="prefix">Last Updated:</span> <span class="time">6/7/2022, 3:59:33 PM</span></div></footer> <!----> </main></div><div class="global-ui"></div></div>
    <script src="/assets/js/app.6ef7aeda.js" defer></script><script src="/assets/js/2.716a1f37.js" defer></script><script src="/assets/js/49.a7940cc9.js" defer></script>
  </body>
</html>
